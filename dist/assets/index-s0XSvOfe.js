(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function Px(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vd={exports:{}},Ea={};var mb;function zA(){if(mb)return Ea;mb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var c in s)c!=="key"&&(o[c]=s[c])}else o=s;return s=o.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:o}}return Ea.Fragment=e,Ea.jsx=t,Ea.jsxs=t,Ea}var _b;function VA(){return _b||(_b=1,vd.exports=zA()),vd.exports}var ce=VA(),xd={exports:{}},Ie={};var yb;function HA(){if(yb)return Ie;yb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function b(C){return C===null||typeof C!="object"?null:(C=y&&C[y]||C["@@iterator"],typeof C=="function"?C:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,R={};function E(C,k,X){this.props=C,this.context=k,this.refs=R,this.updater=X||x}E.prototype.isReactComponent={},E.prototype.setState=function(C,k){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,k,"setState")},E.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function B(){}B.prototype=E.prototype;function M(C,k,X){this.props=C,this.context=k,this.refs=R,this.updater=X||x}var D=M.prototype=new B;D.constructor=M,T(D,E.prototype),D.isPureReactComponent=!0;var F=Array.isArray;function W(){}var ee={H:null,A:null,T:null,S:null},ae=Object.prototype.hasOwnProperty;function ne(C,k,X){var re=X.ref;return{$$typeof:n,type:C,key:k,ref:re!==void 0?re:null,props:X}}function fe(C,k){return ne(C.type,k,C.props)}function pe(C){return typeof C=="object"&&C!==null&&C.$$typeof===n}function ge(C){var k={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(X){return k[X]})}var xe=/\/+/g;function de(C,k){return typeof C=="object"&&C!==null&&C.key!=null?ge(""+C.key):k.toString(36)}function Xe(C){switch(C.status){case"fulfilled":return C.value;case"rejected":throw C.reason;default:switch(typeof C.status=="string"?C.then(W,W):(C.status="pending",C.then(function(k){C.status==="pending"&&(C.status="fulfilled",C.value=k)},function(k){C.status==="pending"&&(C.status="rejected",C.reason=k)})),C.status){case"fulfilled":return C.value;case"rejected":throw C.reason}}throw C}function S(C,k,X,re,ue){var ye=typeof C;(ye==="undefined"||ye==="boolean")&&(C=null);var Te=!1;if(C===null)Te=!0;else switch(ye){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(C.$$typeof){case n:case e:Te=!0;break;case p:return Te=C._init,S(Te(C._payload),k,X,re,ue)}}if(Te)return ue=ue(C),Te=re===""?"."+de(C,0):re,F(ue)?(X="",Te!=null&&(X=Te.replace(xe,"$&/")+"/"),S(ue,k,X,"",function(We){return We})):ue!=null&&(pe(ue)&&(ue=fe(ue,X+(ue.key==null||C&&C.key===ue.key?"":(""+ue.key).replace(xe,"$&/")+"/")+Te)),k.push(ue)),1;Te=0;var Me=re===""?".":re+":";if(F(C))for(var Be=0;Be<C.length;Be++)re=C[Be],ye=Me+de(re,Be),Te+=S(re,k,X,ye,ue);else if(Be=b(C),typeof Be=="function")for(C=Be.call(C),Be=0;!(re=C.next()).done;)re=re.value,ye=Me+de(re,Be++),Te+=S(re,k,X,ye,ue);else if(ye==="object"){if(typeof C.then=="function")return S(Xe(C),k,X,re,ue);throw k=String(C),Error("Objects are not valid as a React child (found: "+(k==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":k)+"). If you meant to render a collection of children, use an array instead.")}return Te}function I(C,k,X){if(C==null)return C;var re=[],ue=0;return S(C,re,"","",function(ye){return k.call(X,ye,ue++)}),re}function P(C){if(C._status===-1){var k=C._result;k=k(),k.then(function(X){(C._status===0||C._status===-1)&&(C._status=1,C._result=X)},function(X){(C._status===0||C._status===-1)&&(C._status=2,C._result=X)}),C._status===-1&&(C._status=0,C._result=k)}if(C._status===1)return C._result.default;throw C._result}var K=typeof reportError=="function"?reportError:function(C){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var k=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof C=="object"&&C!==null&&typeof C.message=="string"?String(C.message):String(C),error:C});if(!window.dispatchEvent(k))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",C);return}console.error(C)},G={map:I,forEach:function(C,k,X){I(C,function(){k.apply(this,arguments)},X)},count:function(C){var k=0;return I(C,function(){k++}),k},toArray:function(C){return I(C,function(k){return k})||[]},only:function(C){if(!pe(C))throw Error("React.Children.only expected to receive a single React element child.");return C}};return Ie.Activity=m,Ie.Children=G,Ie.Component=E,Ie.Fragment=t,Ie.Profiler=s,Ie.PureComponent=M,Ie.StrictMode=i,Ie.Suspense=f,Ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ee,Ie.__COMPILER_RUNTIME={__proto__:null,c:function(C){return ee.H.useMemoCache(C)}},Ie.cache=function(C){return function(){return C.apply(null,arguments)}},Ie.cacheSignal=function(){return null},Ie.cloneElement=function(C,k,X){if(C==null)throw Error("The argument must be a React element, but you passed "+C+".");var re=T({},C.props),ue=C.key;if(k!=null)for(ye in k.key!==void 0&&(ue=""+k.key),k)!ae.call(k,ye)||ye==="key"||ye==="__self"||ye==="__source"||ye==="ref"&&k.ref===void 0||(re[ye]=k[ye]);var ye=arguments.length-2;if(ye===1)re.children=X;else if(1<ye){for(var Te=Array(ye),Me=0;Me<ye;Me++)Te[Me]=arguments[Me+2];re.children=Te}return ne(C.type,ue,re)},Ie.createContext=function(C){return C={$$typeof:l,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null},C.Provider=C,C.Consumer={$$typeof:o,_context:C},C},Ie.createElement=function(C,k,X){var re,ue={},ye=null;if(k!=null)for(re in k.key!==void 0&&(ye=""+k.key),k)ae.call(k,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(ue[re]=k[re]);var Te=arguments.length-2;if(Te===1)ue.children=X;else if(1<Te){for(var Me=Array(Te),Be=0;Be<Te;Be++)Me[Be]=arguments[Be+2];ue.children=Me}if(C&&C.defaultProps)for(re in Te=C.defaultProps,Te)ue[re]===void 0&&(ue[re]=Te[re]);return ne(C,ye,ue)},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(C){return{$$typeof:c,render:C}},Ie.isValidElement=pe,Ie.lazy=function(C){return{$$typeof:p,_payload:{_status:-1,_result:C},_init:P}},Ie.memo=function(C,k){return{$$typeof:d,type:C,compare:k===void 0?null:k}},Ie.startTransition=function(C){var k=ee.T,X={};ee.T=X;try{var re=C(),ue=ee.S;ue!==null&&ue(X,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(W,K)}catch(ye){K(ye)}finally{k!==null&&X.types!==null&&(k.types=X.types),ee.T=k}},Ie.unstable_useCacheRefresh=function(){return ee.H.useCacheRefresh()},Ie.use=function(C){return ee.H.use(C)},Ie.useActionState=function(C,k,X){return ee.H.useActionState(C,k,X)},Ie.useCallback=function(C,k){return ee.H.useCallback(C,k)},Ie.useContext=function(C){return ee.H.useContext(C)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(C,k){return ee.H.useDeferredValue(C,k)},Ie.useEffect=function(C,k){return ee.H.useEffect(C,k)},Ie.useEffectEvent=function(C){return ee.H.useEffectEvent(C)},Ie.useId=function(){return ee.H.useId()},Ie.useImperativeHandle=function(C,k,X){return ee.H.useImperativeHandle(C,k,X)},Ie.useInsertionEffect=function(C,k){return ee.H.useInsertionEffect(C,k)},Ie.useLayoutEffect=function(C,k){return ee.H.useLayoutEffect(C,k)},Ie.useMemo=function(C,k){return ee.H.useMemo(C,k)},Ie.useOptimistic=function(C,k){return ee.H.useOptimistic(C,k)},Ie.useReducer=function(C,k,X){return ee.H.useReducer(C,k,X)},Ie.useRef=function(C){return ee.H.useRef(C)},Ie.useState=function(C){return ee.H.useState(C)},Ie.useSyncExternalStore=function(C,k,X){return ee.H.useSyncExternalStore(C,k,X)},Ie.useTransition=function(){return ee.H.useTransition()},Ie.version="19.2.4",Ie}var bb;function cg(){return bb||(bb=1,xd.exports=HA()),xd.exports}var Ce=cg();const jA=Px(Ce);var Td={exports:{}},Ra={},Sd={exports:{}},Ad={};var vb;function WA(){return vb||(vb=1,(function(n){function e(S,I){var P=S.length;S.push(I);e:for(;0<P;){var K=P-1>>>1,G=S[K];if(0<s(G,I))S[K]=I,S[P]=G,P=K;else break e}}function t(S){return S.length===0?null:S[0]}function i(S){if(S.length===0)return null;var I=S[0],P=S.pop();if(P!==I){S[0]=P;e:for(var K=0,G=S.length,C=G>>>1;K<C;){var k=2*(K+1)-1,X=S[k],re=k+1,ue=S[re];if(0>s(X,P))re<G&&0>s(ue,X)?(S[K]=ue,S[re]=P,K=re):(S[K]=X,S[k]=P,K=k);else if(re<G&&0>s(ue,P))S[K]=ue,S[re]=P,K=re;else break e}}return I}function s(S,I){var P=S.sortIndex-I.sortIndex;return P!==0?P:S.id-I.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var f=[],d=[],p=1,m=null,y=3,b=!1,x=!1,T=!1,R=!1,E=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function D(S){for(var I=t(d);I!==null;){if(I.callback===null)i(d);else if(I.startTime<=S)i(d),I.sortIndex=I.expirationTime,e(f,I);else break;I=t(d)}}function F(S){if(T=!1,D(S),!x)if(t(f)!==null)x=!0,W||(W=!0,ge());else{var I=t(d);I!==null&&Xe(F,I.startTime-S)}}var W=!1,ee=-1,ae=5,ne=-1;function fe(){return R?!0:!(n.unstable_now()-ne<ae)}function pe(){if(R=!1,W){var S=n.unstable_now();ne=S;var I=!0;try{e:{x=!1,T&&(T=!1,B(ee),ee=-1),b=!0;var P=y;try{t:{for(D(S),m=t(f);m!==null&&!(m.expirationTime>S&&fe());){var K=m.callback;if(typeof K=="function"){m.callback=null,y=m.priorityLevel;var G=K(m.expirationTime<=S);if(S=n.unstable_now(),typeof G=="function"){m.callback=G,D(S),I=!0;break t}m===t(f)&&i(f),D(S)}else i(f);m=t(f)}if(m!==null)I=!0;else{var C=t(d);C!==null&&Xe(F,C.startTime-S),I=!1}}break e}finally{m=null,y=P,b=!1}I=void 0}}finally{I?ge():W=!1}}}var ge;if(typeof M=="function")ge=function(){M(pe)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,de=xe.port2;xe.port1.onmessage=pe,ge=function(){de.postMessage(null)}}else ge=function(){E(pe,0)};function Xe(S,I){ee=E(function(){S(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(S){S.callback=null},n.unstable_forceFrameRate=function(S){0>S||125<S?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<S?Math.floor(1e3/S):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(S){switch(y){case 1:case 2:case 3:var I=3;break;default:I=y}var P=y;y=I;try{return S()}finally{y=P}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(S,I){switch(S){case 1:case 2:case 3:case 4:case 5:break;default:S=3}var P=y;y=S;try{return I()}finally{y=P}},n.unstable_scheduleCallback=function(S,I,P){var K=n.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?K+P:K):P=K,S){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=P+G,S={id:p++,callback:I,priorityLevel:S,startTime:P,expirationTime:G,sortIndex:-1},P>K?(S.sortIndex=P,e(d,S),t(f)===null&&S===t(d)&&(T?(B(ee),ee=-1):T=!0,Xe(F,P-K))):(S.sortIndex=G,e(f,S),x||b||(x=!0,W||(W=!0,ge()))),S},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(S){var I=y;return function(){var P=y;y=I;try{return S.apply(this,arguments)}finally{y=P}}}})(Ad)),Ad}var xb;function $A(){return xb||(xb=1,Sd.exports=WA()),Sd.exports}var wd={exports:{}},qt={};var Tb;function XA(){if(Tb)return qt;Tb=1;var n=cg();function e(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(f,d,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:f,containerInfo:d,implementation:p}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return qt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,qt.createPortal=function(f,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return o(f,d,null,p)},qt.flushSync=function(f){var d=l.T,p=i.p;try{if(l.T=null,i.p=2,f)return f()}finally{l.T=d,i.p=p,i.d.f()}},qt.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(f,d))},qt.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},qt.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var p=d.as,m=c(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,b=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:b}):p==="script"&&i.d.X(f,{crossOrigin:m,integrity:y,fetchPriority:b,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},qt.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=c(d.as,d.crossOrigin);i.d.M(f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(f)},qt.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,m=c(p,d.crossOrigin);i.d.L(f,p,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},qt.preloadModule=function(f,d){if(typeof f=="string")if(d){var p=c(d.as,d.crossOrigin);i.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(f)},qt.requestFormReset=function(f){i.d.r(f)},qt.unstable_batchedUpdates=function(f,d){return f(d)},qt.useFormState=function(f,d,p){return l.H.useFormState(f,d,p)},qt.useFormStatus=function(){return l.H.useHostTransitionStatus()},qt.version="19.2.4",qt}var Sb;function qA(){if(Sb)return wd.exports;Sb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),wd.exports=XA(),wd.exports}var Ab;function YA(){if(Ab)return Ra;Ab=1;var n=$A(),e=cg(),t=qA();function i(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,u=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(u=a.return),r=a.return;while(r)}return a.tag===3?u:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function c(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function f(r){if(o(r)!==r)throw Error(i(188))}function d(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(i(188));return a!==r?null:r}for(var u=r,h=a;;){var g=u.return;if(g===null)break;var _=g.alternate;if(_===null){if(h=g.return,h!==null){u=h;continue}break}if(g.child===_.child){for(_=g.child;_;){if(_===u)return f(g),r;if(_===h)return f(g),a;_=_.sibling}throw Error(i(188))}if(u.return!==h.return)u=g,h=_;else{for(var v=!1,A=g.child;A;){if(A===u){v=!0,u=g,h=_;break}if(A===h){v=!0,h=g,u=_;break}A=A.sibling}if(!v){for(A=_.child;A;){if(A===u){v=!0,u=_,h=g;break}if(A===h){v=!0,h=_,u=g;break}A=A.sibling}if(!v)throw Error(i(189))}}if(u.alternate!==h)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?r:a}function p(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=p(r),a!==null)return a;r=r.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),B=Symbol.for("react.consumer"),M=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),ae=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),fe=Symbol.for("react.memo_cache_sentinel"),pe=Symbol.iterator;function ge(r){return r===null||typeof r!="object"?null:(r=pe&&r[pe]||r["@@iterator"],typeof r=="function"?r:null)}var xe=Symbol.for("react.client.reference");function de(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===xe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case T:return"Fragment";case E:return"Profiler";case R:return"StrictMode";case F:return"Suspense";case W:return"SuspenseList";case ne:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case x:return"Portal";case M:return r.displayName||"Context";case B:return(r._context.displayName||"Context")+".Consumer";case D:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case ee:return a=r.displayName||null,a!==null?a:de(r.type)||"Memo";case ae:a=r._payload,r=r._init;try{return de(r(a))}catch{}}return null}var Xe=Array.isArray,S=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},K=[],G=-1;function C(r){return{current:r}}function k(r){0>G||(r.current=K[G],K[G]=null,G--)}function X(r,a){G++,K[G]=r.current,r.current=a}var re=C(null),ue=C(null),ye=C(null),Te=C(null);function Me(r,a){switch(X(ye,a),X(ue,r),X(re,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?F0(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=F0(a),r=z0(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}k(re),X(re,r)}function Be(){k(re),k(ue),k(ye)}function We(r){r.memoizedState!==null&&X(Te,r);var a=re.current,u=z0(a,r.type);a!==u&&(X(ue,r),X(re,u))}function Cn(r){ue.current===r&&(k(re),k(ue)),Te.current===r&&(k(Te),Ta._currentValue=P)}var $n,le;function be(r){if($n===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);$n=a&&a[1]||"",le=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+$n+r+le}var Se=!1;function we(r,a){if(!r||Se)return"";Se=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(a){var se=function(){throw Error()};if(Object.defineProperty(se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(se,[])}catch(Q){var Z=Q}Reflect.construct(r,[],se)}else{try{se.call()}catch(Q){Z=Q}r.call(se.prototype)}}else{try{throw Error()}catch(Q){Z=Q}(se=r())&&typeof se.catch=="function"&&se.catch(function(){})}}catch(Q){if(Q&&Z&&typeof Q.stack=="string")return[Q.stack,Z.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=h.DetermineComponentFrameRoot(),v=_[0],A=_[1];if(v&&A){var N=v.split(`
`),Y=A.split(`
`);for(g=h=0;h<N.length&&!N[h].includes("DetermineComponentFrameRoot");)h++;for(;g<Y.length&&!Y[g].includes("DetermineComponentFrameRoot");)g++;if(h===N.length||g===Y.length)for(h=N.length-1,g=Y.length-1;1<=h&&0<=g&&N[h]!==Y[g];)g--;for(;1<=h&&0<=g;h--,g--)if(N[h]!==Y[g]){if(h!==1||g!==1)do if(h--,g--,0>g||N[h]!==Y[g]){var J=`
`+N[h].replace(" at new "," at ");return r.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",r.displayName)),J}while(1<=h&&0<=g);break}}}finally{Se=!1,Error.prepareStackTrace=u}return(u=r?r.displayName||r.name:"")?be(u):""}function gi(r,a){switch(r.tag){case 26:case 27:case 5:return be(r.type);case 16:return be("Lazy");case 13:return r.child!==a&&a!==null?be("Suspense Fallback"):be("Suspense");case 19:return be("SuspenseList");case 0:case 15:return we(r.type,!1);case 11:return we(r.type.render,!1);case 1:return we(r.type,!0);case 31:return be("Activity");default:return""}}function rn(r){try{var a="",u=null;do a+=gi(r,u),u=r,r=r.return;while(r);return a}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var gn=Object.prototype.hasOwnProperty,en=n.unstable_scheduleCallback,$e=n.unstable_cancelCallback,on=n.unstable_shouldYield,Oe=n.unstable_requestPaint,ct=n.unstable_now,Ms=n.unstable_getCurrentPriorityLevel,No=n.unstable_ImmediatePriority,Pe=n.unstable_UserBlockingPriority,qe=n.unstable_NormalPriority,ut=n.unstable_LowPriority,mn=n.unstable_IdlePriority,Do=n.log,of=n.unstable_setDisableYieldValue,Nt=null,Xt=null;function dt(r){if(typeof Do=="function"&&of(r),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(Nt,r)}catch{}}var Dt=Math.clz32?Math.clz32:ET,af=Math.log,ml=Math.LN2;function ET(r){return r>>>=0,r===0?32:31-(af(r)/ml|0)|0}var _l=256,yl=262144,bl=4194304;function Os(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function vl(r,a,u){var h=r.pendingLanes;if(h===0)return 0;var g=0,_=r.suspendedLanes,v=r.pingedLanes;r=r.warmLanes;var A=h&134217727;return A!==0?(h=A&~_,h!==0?g=Os(h):(v&=A,v!==0?g=Os(v):u||(u=A&~r,u!==0&&(g=Os(u))))):(A=h&~_,A!==0?g=Os(A):v!==0?g=Os(v):u||(u=h&~r,u!==0&&(g=Os(u)))),g===0?0:a!==0&&a!==g&&(a&_)===0&&(_=g&-g,u=a&-a,_>=u||_===32&&(u&4194048)!==0)?a:g}function ko(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function RT(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vm(){var r=bl;return bl<<=1,(bl&62914560)===0&&(bl=4194304),r}function lf(r){for(var a=[],u=0;31>u;u++)a.push(r);return a}function Bo(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function CT(r,a,u,h,g,_){var v=r.pendingLanes;r.pendingLanes=u,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=u,r.entangledLanes&=u,r.errorRecoveryDisabledLanes&=u,r.shellSuspendCounter=0;var A=r.entanglements,N=r.expirationTimes,Y=r.hiddenUpdates;for(u=v&~u;0<u;){var J=31-Dt(u),se=1<<J;A[J]=0,N[J]=-1;var Z=Y[J];if(Z!==null)for(Y[J]=null,J=0;J<Z.length;J++){var Q=Z[J];Q!==null&&(Q.lane&=-536870913)}u&=~se}h!==0&&xm(r,h,0),_!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=_&~(v&~a))}function xm(r,a,u){r.pendingLanes|=a,r.suspendedLanes&=~a;var h=31-Dt(a);r.entangledLanes|=a,r.entanglements[h]=r.entanglements[h]|1073741824|u&261930}function Tm(r,a){var u=r.entangledLanes|=a;for(r=r.entanglements;u;){var h=31-Dt(u),g=1<<h;g&a|r[h]&a&&(r[h]|=a),u&=~g}}function Sm(r,a){var u=a&-a;return u=(u&42)!==0?1:cf(u),(u&(r.suspendedLanes|a))!==0?0:u}function cf(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function uf(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Am(){var r=I.p;return r!==0?r:(r=window.event,r===void 0?32:cb(r.type))}function wm(r,a){var u=I.p;try{return I.p=r,a()}finally{I.p=u}}var Xi=Math.random().toString(36).slice(2),Ft="__reactFiber$"+Xi,an="__reactProps$"+Xi,mr="__reactContainer$"+Xi,ff="__reactEvents$"+Xi,MT="__reactListeners$"+Xi,OT="__reactHandles$"+Xi,Em="__reactResources$"+Xi,Lo="__reactMarker$"+Xi;function hf(r){delete r[Ft],delete r[an],delete r[ff],delete r[MT],delete r[OT]}function _r(r){var a=r[Ft];if(a)return a;for(var u=r.parentNode;u;){if(a=u[mr]||u[Ft]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(r=q0(r);r!==null;){if(u=r[Ft])return u;r=q0(r)}return a}r=u,u=r.parentNode}return null}function yr(r){if(r=r[Ft]||r[mr]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function Uo(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(i(33))}function br(r){var a=r[Em];return a||(a=r[Em]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function kt(r){r[Lo]=!0}var Rm=new Set,Cm={};function Ps(r,a){vr(r,a),vr(r+"Capture",a)}function vr(r,a){for(Cm[r]=a,r=0;r<a.length;r++)Rm.add(a[r])}var PT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Mm={},Om={};function IT(r){return gn.call(Om,r)?!0:gn.call(Mm,r)?!1:PT.test(r)?Om[r]=!0:(Mm[r]=!0,!1)}function xl(r,a,u){if(IT(a))if(u===null)r.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var h=a.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+u)}}function Tl(r,a,u){if(u===null)r.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+u)}}function mi(r,a,u,h){if(h===null)r.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttributeNS(a,u,""+h)}}function Mn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Pm(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function NT(r,a,u){var h=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,_=h.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return g.call(this)},set:function(v){u=""+v,_.call(this,v)}}),Object.defineProperty(r,a,{enumerable:h.enumerable}),{getValue:function(){return u},setValue:function(v){u=""+v},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function df(r){if(!r._valueTracker){var a=Pm(r)?"checked":"value";r._valueTracker=NT(r,a,""+r[a])}}function Im(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var u=a.getValue(),h="";return r&&(h=Pm(r)?r.checked?"true":"false":r.value),r=h,r!==u?(a.setValue(r),!0):!1}function Sl(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var DT=/[\n"\\]/g;function On(r){return r.replace(DT,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function pf(r,a,u,h,g,_,v,A){r.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?r.type=v:r.removeAttribute("type"),a!=null?v==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+Mn(a)):r.value!==""+Mn(a)&&(r.value=""+Mn(a)):v!=="submit"&&v!=="reset"||r.removeAttribute("value"),a!=null?gf(r,v,Mn(a)):u!=null?gf(r,v,Mn(u)):h!=null&&r.removeAttribute("value"),g==null&&_!=null&&(r.defaultChecked=!!_),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?r.name=""+Mn(A):r.removeAttribute("name")}function Nm(r,a,u,h,g,_,v,A){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(r.type=_),a!=null||u!=null){if(!(_!=="submit"&&_!=="reset"||a!=null)){df(r);return}u=u!=null?""+Mn(u):"",a=a!=null?""+Mn(a):u,A||a===r.value||(r.value=a),r.defaultValue=a}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,r.checked=A?r.checked:!!h,r.defaultChecked=!!h,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(r.name=v),df(r)}function gf(r,a,u){a==="number"&&Sl(r.ownerDocument)===r||r.defaultValue===""+u||(r.defaultValue=""+u)}function xr(r,a,u,h){if(r=r.options,a){a={};for(var g=0;g<u.length;g++)a["$"+u[g]]=!0;for(u=0;u<r.length;u++)g=a.hasOwnProperty("$"+r[u].value),r[u].selected!==g&&(r[u].selected=g),g&&h&&(r[u].defaultSelected=!0)}else{for(u=""+Mn(u),a=null,g=0;g<r.length;g++){if(r[g].value===u){r[g].selected=!0,h&&(r[g].defaultSelected=!0);return}a!==null||r[g].disabled||(a=r[g])}a!==null&&(a.selected=!0)}}function Dm(r,a,u){if(a!=null&&(a=""+Mn(a),a!==r.value&&(r.value=a),u==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=u!=null?""+Mn(u):""}function km(r,a,u,h){if(a==null){if(h!=null){if(u!=null)throw Error(i(92));if(Xe(h)){if(1<h.length)throw Error(i(93));h=h[0]}u=h}u==null&&(u=""),a=u}u=Mn(a),r.defaultValue=u,h=r.textContent,h===u&&h!==""&&h!==null&&(r.value=h),df(r)}function Tr(r,a){if(a){var u=r.firstChild;if(u&&u===r.lastChild&&u.nodeType===3){u.nodeValue=a;return}}r.textContent=a}var kT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Bm(r,a,u){var h=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?h?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":h?r.setProperty(a,u):typeof u!="number"||u===0||kT.has(a)?a==="float"?r.cssFloat=u:r[a]=(""+u).trim():r[a]=u+"px"}function Lm(r,a,u){if(a!=null&&typeof a!="object")throw Error(i(62));if(r=r.style,u!=null){for(var h in u)!u.hasOwnProperty(h)||a!=null&&a.hasOwnProperty(h)||(h.indexOf("--")===0?r.setProperty(h,""):h==="float"?r.cssFloat="":r[h]="");for(var g in a)h=a[g],a.hasOwnProperty(g)&&u[g]!==h&&Bm(r,g,h)}else for(var _ in a)a.hasOwnProperty(_)&&Bm(r,_,a[_])}function mf(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var BT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),LT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Al(r){return LT.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function _i(){}var _f=null;function yf(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Sr=null,Ar=null;function Um(r){var a=yr(r);if(a&&(r=a.stateNode)){var u=r[an]||null;e:switch(r=a.stateNode,a.type){case"input":if(pf(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=r;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+On(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var h=u[a];if(h!==r&&h.form===r.form){var g=h[an]||null;if(!g)throw Error(i(90));pf(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(a=0;a<u.length;a++)h=u[a],h.form===r.form&&Im(h)}break e;case"textarea":Dm(r,u.value,u.defaultValue);break e;case"select":a=u.value,a!=null&&xr(r,!!u.multiple,a,!1)}}}var bf=!1;function Fm(r,a,u){if(bf)return r(a,u);bf=!0;try{var h=r(a);return h}finally{if(bf=!1,(Sr!==null||Ar!==null)&&(fc(),Sr&&(a=Sr,r=Ar,Ar=Sr=null,Um(a),r)))for(a=0;a<r.length;a++)Um(r[a])}}function Fo(r,a){var u=r.stateNode;if(u===null)return null;var h=u[an]||null;if(h===null)return null;u=h[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(r=r.type,h=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!h;break e;default:r=!1}if(r)return null;if(u&&typeof u!="function")throw Error(i(231,a,typeof u));return u}var yi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vf=!1;if(yi)try{var zo={};Object.defineProperty(zo,"passive",{get:function(){vf=!0}}),window.addEventListener("test",zo,zo),window.removeEventListener("test",zo,zo)}catch{vf=!1}var qi=null,xf=null,wl=null;function zm(){if(wl)return wl;var r,a=xf,u=a.length,h,g="value"in qi?qi.value:qi.textContent,_=g.length;for(r=0;r<u&&a[r]===g[r];r++);var v=u-r;for(h=1;h<=v&&a[u-h]===g[_-h];h++);return wl=g.slice(r,1<h?1-h:void 0)}function El(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function Rl(){return!0}function Vm(){return!1}function ln(r){function a(u,h,g,_,v){this._reactName=u,this._targetInst=g,this.type=h,this.nativeEvent=_,this.target=v,this.currentTarget=null;for(var A in r)r.hasOwnProperty(A)&&(u=r[A],this[A]=u?u(_):_[A]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Rl:Vm,this.isPropagationStopped=Vm,this}return m(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Rl)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Rl)},persist:function(){},isPersistent:Rl}),a}var Is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cl=ln(Is),Vo=m({},Is,{view:0,detail:0}),UT=ln(Vo),Tf,Sf,Ho,Ml=m({},Vo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wf,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ho&&(Ho&&r.type==="mousemove"?(Tf=r.screenX-Ho.screenX,Sf=r.screenY-Ho.screenY):Sf=Tf=0,Ho=r),Tf)},movementY:function(r){return"movementY"in r?r.movementY:Sf}}),Hm=ln(Ml),FT=m({},Ml,{dataTransfer:0}),zT=ln(FT),VT=m({},Vo,{relatedTarget:0}),Af=ln(VT),HT=m({},Is,{animationName:0,elapsedTime:0,pseudoElement:0}),jT=ln(HT),WT=m({},Is,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),$T=ln(WT),XT=m({},Is,{data:0}),jm=ln(XT),qT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},YT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ZT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function KT(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=ZT[r])?!!a[r]:!1}function wf(){return KT}var GT=m({},Vo,{key:function(r){if(r.key){var a=qT[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=El(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?YT[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wf,charCode:function(r){return r.type==="keypress"?El(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?El(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),QT=ln(GT),JT=m({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wm=ln(JT),eS=m({},Vo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wf}),tS=ln(eS),nS=m({},Is,{propertyName:0,elapsedTime:0,pseudoElement:0}),iS=ln(nS),sS=m({},Ml,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),rS=ln(sS),oS=m({},Is,{newState:0,oldState:0}),aS=ln(oS),lS=[9,13,27,32],Ef=yi&&"CompositionEvent"in window,jo=null;yi&&"documentMode"in document&&(jo=document.documentMode);var cS=yi&&"TextEvent"in window&&!jo,$m=yi&&(!Ef||jo&&8<jo&&11>=jo),Xm=" ",qm=!1;function Ym(r,a){switch(r){case"keyup":return lS.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zm(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var wr=!1;function uS(r,a){switch(r){case"compositionend":return Zm(a);case"keypress":return a.which!==32?null:(qm=!0,Xm);case"textInput":return r=a.data,r===Xm&&qm?null:r;default:return null}}function fS(r,a){if(wr)return r==="compositionend"||!Ef&&Ym(r,a)?(r=zm(),wl=xf=qi=null,wr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return $m&&a.locale!=="ko"?null:a.data;default:return null}}var hS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Km(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!hS[r.type]:a==="textarea"}function Gm(r,a,u,h){Sr?Ar?Ar.push(h):Ar=[h]:Sr=h,a=yc(a,"onChange"),0<a.length&&(u=new Cl("onChange","change",null,u,h),r.push({event:u,listeners:a}))}var Wo=null,$o=null;function dS(r){N0(r,0)}function Ol(r){var a=Uo(r);if(Im(a))return r}function Qm(r,a){if(r==="change")return a}var Jm=!1;if(yi){var Rf;if(yi){var Cf="oninput"in document;if(!Cf){var e_=document.createElement("div");e_.setAttribute("oninput","return;"),Cf=typeof e_.oninput=="function"}Rf=Cf}else Rf=!1;Jm=Rf&&(!document.documentMode||9<document.documentMode)}function t_(){Wo&&(Wo.detachEvent("onpropertychange",n_),$o=Wo=null)}function n_(r){if(r.propertyName==="value"&&Ol($o)){var a=[];Gm(a,$o,r,yf(r)),Fm(dS,a)}}function pS(r,a,u){r==="focusin"?(t_(),Wo=a,$o=u,Wo.attachEvent("onpropertychange",n_)):r==="focusout"&&t_()}function gS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ol($o)}function mS(r,a){if(r==="click")return Ol(a)}function _S(r,a){if(r==="input"||r==="change")return Ol(a)}function yS(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var _n=typeof Object.is=="function"?Object.is:yS;function Xo(r,a){if(_n(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var u=Object.keys(r),h=Object.keys(a);if(u.length!==h.length)return!1;for(h=0;h<u.length;h++){var g=u[h];if(!gn.call(a,g)||!_n(r[g],a[g]))return!1}return!0}function i_(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function s_(r,a){var u=i_(r);r=0;for(var h;u;){if(u.nodeType===3){if(h=r+u.textContent.length,r<=a&&h>=a)return{node:u,offset:a-r};r=h}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=i_(u)}}function r_(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?r_(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function o_(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=Sl(r.document);a instanceof r.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)r=a.contentWindow;else break;a=Sl(r.document)}return a}function Mf(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var bS=yi&&"documentMode"in document&&11>=document.documentMode,Er=null,Of=null,qo=null,Pf=!1;function a_(r,a,u){var h=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Pf||Er==null||Er!==Sl(h)||(h=Er,"selectionStart"in h&&Mf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),qo&&Xo(qo,h)||(qo=h,h=yc(Of,"onSelect"),0<h.length&&(a=new Cl("onSelect","select",null,a,u),r.push({event:a,listeners:h}),a.target=Er)))}function Ns(r,a){var u={};return u[r.toLowerCase()]=a.toLowerCase(),u["Webkit"+r]="webkit"+a,u["Moz"+r]="moz"+a,u}var Rr={animationend:Ns("Animation","AnimationEnd"),animationiteration:Ns("Animation","AnimationIteration"),animationstart:Ns("Animation","AnimationStart"),transitionrun:Ns("Transition","TransitionRun"),transitionstart:Ns("Transition","TransitionStart"),transitioncancel:Ns("Transition","TransitionCancel"),transitionend:Ns("Transition","TransitionEnd")},If={},l_={};yi&&(l_=document.createElement("div").style,"AnimationEvent"in window||(delete Rr.animationend.animation,delete Rr.animationiteration.animation,delete Rr.animationstart.animation),"TransitionEvent"in window||delete Rr.transitionend.transition);function Ds(r){if(If[r])return If[r];if(!Rr[r])return r;var a=Rr[r],u;for(u in a)if(a.hasOwnProperty(u)&&u in l_)return If[r]=a[u];return r}var c_=Ds("animationend"),u_=Ds("animationiteration"),f_=Ds("animationstart"),vS=Ds("transitionrun"),xS=Ds("transitionstart"),TS=Ds("transitioncancel"),h_=Ds("transitionend"),d_=new Map,Nf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nf.push("scrollEnd");function Xn(r,a){d_.set(r,a),Ps(a,[r])}var Pl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Pn=[],Cr=0,Df=0;function Il(){for(var r=Cr,a=Df=Cr=0;a<r;){var u=Pn[a];Pn[a++]=null;var h=Pn[a];Pn[a++]=null;var g=Pn[a];Pn[a++]=null;var _=Pn[a];if(Pn[a++]=null,h!==null&&g!==null){var v=h.pending;v===null?g.next=g:(g.next=v.next,v.next=g),h.pending=g}_!==0&&p_(u,g,_)}}function Nl(r,a,u,h){Pn[Cr++]=r,Pn[Cr++]=a,Pn[Cr++]=u,Pn[Cr++]=h,Df|=h,r.lanes|=h,r=r.alternate,r!==null&&(r.lanes|=h)}function kf(r,a,u,h){return Nl(r,a,u,h),Dl(r)}function ks(r,a){return Nl(r,null,null,a),Dl(r)}function p_(r,a,u){r.lanes|=u;var h=r.alternate;h!==null&&(h.lanes|=u);for(var g=!1,_=r.return;_!==null;)_.childLanes|=u,h=_.alternate,h!==null&&(h.childLanes|=u),_.tag===22&&(r=_.stateNode,r===null||r._visibility&1||(g=!0)),r=_,_=_.return;return r.tag===3?(_=r.stateNode,g&&a!==null&&(g=31-Dt(u),r=_.hiddenUpdates,h=r[g],h===null?r[g]=[a]:h.push(a),a.lane=u|536870912),_):null}function Dl(r){if(50<ga)throw ga=0,Wh=null,Error(i(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var Mr={};function SS(r,a,u,h){this.tag=r,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yn(r,a,u,h){return new SS(r,a,u,h)}function Bf(r){return r=r.prototype,!(!r||!r.isReactComponent)}function bi(r,a){var u=r.alternate;return u===null?(u=yn(r.tag,a,r.key,r.mode),u.elementType=r.elementType,u.type=r.type,u.stateNode=r.stateNode,u.alternate=r,r.alternate=u):(u.pendingProps=a,u.type=r.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=r.flags&65011712,u.childLanes=r.childLanes,u.lanes=r.lanes,u.child=r.child,u.memoizedProps=r.memoizedProps,u.memoizedState=r.memoizedState,u.updateQueue=r.updateQueue,a=r.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=r.sibling,u.index=r.index,u.ref=r.ref,u.refCleanup=r.refCleanup,u}function g_(r,a){r.flags&=65011714;var u=r.alternate;return u===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=u.childLanes,r.lanes=u.lanes,r.child=u.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=u.memoizedProps,r.memoizedState=u.memoizedState,r.updateQueue=u.updateQueue,r.type=u.type,a=u.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function kl(r,a,u,h,g,_){var v=0;if(h=r,typeof r=="function")Bf(r)&&(v=1);else if(typeof r=="string")v=CA(r,u,re.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ne:return r=yn(31,u,a,g),r.elementType=ne,r.lanes=_,r;case T:return Bs(u.children,g,_,a);case R:v=8,g|=24;break;case E:return r=yn(12,u,a,g|2),r.elementType=E,r.lanes=_,r;case F:return r=yn(13,u,a,g),r.elementType=F,r.lanes=_,r;case W:return r=yn(19,u,a,g),r.elementType=W,r.lanes=_,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case M:v=10;break e;case B:v=9;break e;case D:v=11;break e;case ee:v=14;break e;case ae:v=16,h=null;break e}v=29,u=Error(i(130,r===null?"null":typeof r,"")),h=null}return a=yn(v,u,a,g),a.elementType=r,a.type=h,a.lanes=_,a}function Bs(r,a,u,h){return r=yn(7,r,h,a),r.lanes=u,r}function Lf(r,a,u){return r=yn(6,r,null,a),r.lanes=u,r}function m_(r){var a=yn(18,null,null,0);return a.stateNode=r,a}function Uf(r,a,u){return a=yn(4,r.children!==null?r.children:[],r.key,a),a.lanes=u,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var __=new WeakMap;function In(r,a){if(typeof r=="object"&&r!==null){var u=__.get(r);return u!==void 0?u:(a={value:r,source:a,stack:rn(a)},__.set(r,a),a)}return{value:r,source:a,stack:rn(a)}}var Or=[],Pr=0,Bl=null,Yo=0,Nn=[],Dn=0,Yi=null,ti=1,ni="";function vi(r,a){Or[Pr++]=Yo,Or[Pr++]=Bl,Bl=r,Yo=a}function y_(r,a,u){Nn[Dn++]=ti,Nn[Dn++]=ni,Nn[Dn++]=Yi,Yi=r;var h=ti;r=ni;var g=32-Dt(h)-1;h&=~(1<<g),u+=1;var _=32-Dt(a)+g;if(30<_){var v=g-g%5;_=(h&(1<<v)-1).toString(32),h>>=v,g-=v,ti=1<<32-Dt(a)+g|u<<g|h,ni=_+r}else ti=1<<_|u<<g|h,ni=r}function Ff(r){r.return!==null&&(vi(r,1),y_(r,1,0))}function zf(r){for(;r===Bl;)Bl=Or[--Pr],Or[Pr]=null,Yo=Or[--Pr],Or[Pr]=null;for(;r===Yi;)Yi=Nn[--Dn],Nn[Dn]=null,ni=Nn[--Dn],Nn[Dn]=null,ti=Nn[--Dn],Nn[Dn]=null}function b_(r,a){Nn[Dn++]=ti,Nn[Dn++]=ni,Nn[Dn++]=Yi,ti=a.id,ni=a.overflow,Yi=r}var zt=null,ft=null,je=!1,Zi=null,kn=!1,Vf=Error(i(519));function Ki(r){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Zo(In(a,r)),Vf}function v_(r){var a=r.stateNode,u=r.type,h=r.memoizedProps;switch(a[Ft]=r,a[an]=h,u){case"dialog":Fe("cancel",a),Fe("close",a);break;case"iframe":case"object":case"embed":Fe("load",a);break;case"video":case"audio":for(u=0;u<_a.length;u++)Fe(_a[u],a);break;case"source":Fe("error",a);break;case"img":case"image":case"link":Fe("error",a),Fe("load",a);break;case"details":Fe("toggle",a);break;case"input":Fe("invalid",a),Nm(a,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":Fe("invalid",a);break;case"textarea":Fe("invalid",a),km(a,h.value,h.defaultValue,h.children)}u=h.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||h.suppressHydrationWarning===!0||L0(a.textContent,u)?(h.popover!=null&&(Fe("beforetoggle",a),Fe("toggle",a)),h.onScroll!=null&&Fe("scroll",a),h.onScrollEnd!=null&&Fe("scrollend",a),h.onClick!=null&&(a.onclick=_i),a=!0):a=!1,a||Ki(r,!0)}function x_(r){for(zt=r.return;zt;)switch(zt.tag){case 5:case 31:case 13:kn=!1;return;case 27:case 3:kn=!0;return;default:zt=zt.return}}function Ir(r){if(r!==zt)return!1;if(!je)return x_(r),je=!0,!1;var a=r.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=r.type,u=!(u!=="form"&&u!=="button")||rd(r.type,r.memoizedProps)),u=!u),u&&ft&&Ki(r),x_(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));ft=X0(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));ft=X0(r)}else a===27?(a=ft,us(r.type)?(r=ud,ud=null,ft=r):ft=a):ft=zt?Ln(r.stateNode.nextSibling):null;return!0}function Ls(){ft=zt=null,je=!1}function Hf(){var r=Zi;return r!==null&&(hn===null?hn=r:hn.push.apply(hn,r),Zi=null),r}function Zo(r){Zi===null?Zi=[r]:Zi.push(r)}var jf=C(null),Us=null,xi=null;function Gi(r,a,u){X(jf,a._currentValue),a._currentValue=u}function Ti(r){r._currentValue=jf.current,k(jf)}function Wf(r,a,u){for(;r!==null;){var h=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,h!==null&&(h.childLanes|=a)):h!==null&&(h.childLanes&a)!==a&&(h.childLanes|=a),r===u)break;r=r.return}}function $f(r,a,u,h){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var _=g.dependencies;if(_!==null){var v=g.child;_=_.firstContext;e:for(;_!==null;){var A=_;_=g;for(var N=0;N<a.length;N++)if(A.context===a[N]){_.lanes|=u,A=_.alternate,A!==null&&(A.lanes|=u),Wf(_.return,u,r),h||(v=null);break e}_=A.next}}else if(g.tag===18){if(v=g.return,v===null)throw Error(i(341));v.lanes|=u,_=v.alternate,_!==null&&(_.lanes|=u),Wf(v,u,r),v=null}else v=g.child;if(v!==null)v.return=g;else for(v=g;v!==null;){if(v===r){v=null;break}if(g=v.sibling,g!==null){g.return=v.return,v=g;break}v=v.return}g=v}}function Nr(r,a,u,h){r=null;for(var g=a,_=!1;g!==null;){if(!_){if((g.flags&524288)!==0)_=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var v=g.alternate;if(v===null)throw Error(i(387));if(v=v.memoizedProps,v!==null){var A=g.type;_n(g.pendingProps.value,v.value)||(r!==null?r.push(A):r=[A])}}else if(g===Te.current){if(v=g.alternate,v===null)throw Error(i(387));v.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(Ta):r=[Ta])}g=g.return}r!==null&&$f(a,r,u,h),a.flags|=262144}function Ll(r){for(r=r.firstContext;r!==null;){if(!_n(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Fs(r){Us=r,xi=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Vt(r){return T_(Us,r)}function Ul(r,a){return Us===null&&Fs(r),T_(r,a)}function T_(r,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},xi===null){if(r===null)throw Error(i(308));xi=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else xi=xi.next=a;return u}var AS=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(u,h){r.push(h)}};this.abort=function(){a.aborted=!0,r.forEach(function(u){return u()})}},wS=n.unstable_scheduleCallback,ES=n.unstable_NormalPriority,Tt={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xf(){return{controller:new AS,data:new Map,refCount:0}}function Ko(r){r.refCount--,r.refCount===0&&wS(ES,function(){r.controller.abort()})}var Go=null,qf=0,Dr=0,kr=null;function RS(r,a){if(Go===null){var u=Go=[];qf=0,Dr=Kh(),kr={status:"pending",value:void 0,then:function(h){u.push(h)}}}return qf++,a.then(S_,S_),a}function S_(){if(--qf===0&&Go!==null){kr!==null&&(kr.status="fulfilled");var r=Go;Go=null,Dr=0,kr=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function CS(r,a){var u=[],h={status:"pending",value:null,reason:null,then:function(g){u.push(g)}};return r.then(function(){h.status="fulfilled",h.value=a;for(var g=0;g<u.length;g++)(0,u[g])(a)},function(g){for(h.status="rejected",h.reason=g,g=0;g<u.length;g++)(0,u[g])(void 0)}),h}var A_=S.S;S.S=function(r,a){a0=ct(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&RS(r,a),A_!==null&&A_(r,a)};var zs=C(null);function Yf(){var r=zs.current;return r!==null?r:ot.pooledCache}function Fl(r,a){a===null?X(zs,zs.current):X(zs,a.pool)}function w_(){var r=Yf();return r===null?null:{parent:Tt._currentValue,pool:r}}var Br=Error(i(460)),Zf=Error(i(474)),zl=Error(i(542)),Vl={then:function(){}};function E_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function R_(r,a,u){switch(u=r[u],u===void 0?r.push(a):u!==a&&(a.then(_i,_i),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,M_(r),r;default:if(typeof a.status=="string")a.then(_i,_i);else{if(r=ot,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=a,r.status="pending",r.then(function(h){if(a.status==="pending"){var g=a;g.status="fulfilled",g.value=h}},function(h){if(a.status==="pending"){var g=a;g.status="rejected",g.reason=h}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,M_(r),r}throw Hs=a,Br}}function Vs(r){try{var a=r._init;return a(r._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(Hs=u,Br):u}}var Hs=null;function C_(){if(Hs===null)throw Error(i(459));var r=Hs;return Hs=null,r}function M_(r){if(r===Br||r===zl)throw Error(i(483))}var Lr=null,Qo=0;function Hl(r){var a=Qo;return Qo+=1,Lr===null&&(Lr=[]),R_(Lr,r,a)}function Jo(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function jl(r,a){throw a.$$typeof===y?Error(i(525)):(r=Object.prototype.toString.call(a),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function O_(r){function a(H,L){if(r){var q=H.deletions;q===null?(H.deletions=[L],H.flags|=16):q.push(L)}}function u(H,L){if(!r)return null;for(;L!==null;)a(H,L),L=L.sibling;return null}function h(H){for(var L=new Map;H!==null;)H.key!==null?L.set(H.key,H):L.set(H.index,H),H=H.sibling;return L}function g(H,L){return H=bi(H,L),H.index=0,H.sibling=null,H}function _(H,L,q){return H.index=q,r?(q=H.alternate,q!==null?(q=q.index,q<L?(H.flags|=67108866,L):q):(H.flags|=67108866,L)):(H.flags|=1048576,L)}function v(H){return r&&H.alternate===null&&(H.flags|=67108866),H}function A(H,L,q,te){return L===null||L.tag!==6?(L=Lf(q,H.mode,te),L.return=H,L):(L=g(L,q),L.return=H,L)}function N(H,L,q,te){var Ae=q.type;return Ae===T?J(H,L,q.props.children,te,q.key):L!==null&&(L.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===ae&&Vs(Ae)===L.type)?(L=g(L,q.props),Jo(L,q),L.return=H,L):(L=kl(q.type,q.key,q.props,null,H.mode,te),Jo(L,q),L.return=H,L)}function Y(H,L,q,te){return L===null||L.tag!==4||L.stateNode.containerInfo!==q.containerInfo||L.stateNode.implementation!==q.implementation?(L=Uf(q,H.mode,te),L.return=H,L):(L=g(L,q.children||[]),L.return=H,L)}function J(H,L,q,te,Ae){return L===null||L.tag!==7?(L=Bs(q,H.mode,te,Ae),L.return=H,L):(L=g(L,q),L.return=H,L)}function se(H,L,q){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return L=Lf(""+L,H.mode,q),L.return=H,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case b:return q=kl(L.type,L.key,L.props,null,H.mode,q),Jo(q,L),q.return=H,q;case x:return L=Uf(L,H.mode,q),L.return=H,L;case ae:return L=Vs(L),se(H,L,q)}if(Xe(L)||ge(L))return L=Bs(L,H.mode,q,null),L.return=H,L;if(typeof L.then=="function")return se(H,Hl(L),q);if(L.$$typeof===M)return se(H,Ul(H,L),q);jl(H,L)}return null}function Z(H,L,q,te){var Ae=L!==null?L.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return Ae!==null?null:A(H,L,""+q,te);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case b:return q.key===Ae?N(H,L,q,te):null;case x:return q.key===Ae?Y(H,L,q,te):null;case ae:return q=Vs(q),Z(H,L,q,te)}if(Xe(q)||ge(q))return Ae!==null?null:J(H,L,q,te,null);if(typeof q.then=="function")return Z(H,L,Hl(q),te);if(q.$$typeof===M)return Z(H,L,Ul(H,q),te);jl(H,q)}return null}function Q(H,L,q,te,Ae){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return H=H.get(q)||null,A(L,H,""+te,Ae);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case b:return H=H.get(te.key===null?q:te.key)||null,N(L,H,te,Ae);case x:return H=H.get(te.key===null?q:te.key)||null,Y(L,H,te,Ae);case ae:return te=Vs(te),Q(H,L,q,te,Ae)}if(Xe(te)||ge(te))return H=H.get(q)||null,J(L,H,te,Ae,null);if(typeof te.then=="function")return Q(H,L,q,Hl(te),Ae);if(te.$$typeof===M)return Q(H,L,q,Ul(L,te),Ae);jl(L,te)}return null}function _e(H,L,q,te){for(var Ae=null,Ye=null,ve=L,ke=L=0,Ve=null;ve!==null&&ke<q.length;ke++){ve.index>ke?(Ve=ve,ve=null):Ve=ve.sibling;var Ze=Z(H,ve,q[ke],te);if(Ze===null){ve===null&&(ve=Ve);break}r&&ve&&Ze.alternate===null&&a(H,ve),L=_(Ze,L,ke),Ye===null?Ae=Ze:Ye.sibling=Ze,Ye=Ze,ve=Ve}if(ke===q.length)return u(H,ve),je&&vi(H,ke),Ae;if(ve===null){for(;ke<q.length;ke++)ve=se(H,q[ke],te),ve!==null&&(L=_(ve,L,ke),Ye===null?Ae=ve:Ye.sibling=ve,Ye=ve);return je&&vi(H,ke),Ae}for(ve=h(ve);ke<q.length;ke++)Ve=Q(ve,H,ke,q[ke],te),Ve!==null&&(r&&Ve.alternate!==null&&ve.delete(Ve.key===null?ke:Ve.key),L=_(Ve,L,ke),Ye===null?Ae=Ve:Ye.sibling=Ve,Ye=Ve);return r&&ve.forEach(function(gs){return a(H,gs)}),je&&vi(H,ke),Ae}function Ee(H,L,q,te){if(q==null)throw Error(i(151));for(var Ae=null,Ye=null,ve=L,ke=L=0,Ve=null,Ze=q.next();ve!==null&&!Ze.done;ke++,Ze=q.next()){ve.index>ke?(Ve=ve,ve=null):Ve=ve.sibling;var gs=Z(H,ve,Ze.value,te);if(gs===null){ve===null&&(ve=Ve);break}r&&ve&&gs.alternate===null&&a(H,ve),L=_(gs,L,ke),Ye===null?Ae=gs:Ye.sibling=gs,Ye=gs,ve=Ve}if(Ze.done)return u(H,ve),je&&vi(H,ke),Ae;if(ve===null){for(;!Ze.done;ke++,Ze=q.next())Ze=se(H,Ze.value,te),Ze!==null&&(L=_(Ze,L,ke),Ye===null?Ae=Ze:Ye.sibling=Ze,Ye=Ze);return je&&vi(H,ke),Ae}for(ve=h(ve);!Ze.done;ke++,Ze=q.next())Ze=Q(ve,H,ke,Ze.value,te),Ze!==null&&(r&&Ze.alternate!==null&&ve.delete(Ze.key===null?ke:Ze.key),L=_(Ze,L,ke),Ye===null?Ae=Ze:Ye.sibling=Ze,Ye=Ze);return r&&ve.forEach(function(FA){return a(H,FA)}),je&&vi(H,ke),Ae}function it(H,L,q,te){if(typeof q=="object"&&q!==null&&q.type===T&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case b:e:{for(var Ae=q.key;L!==null;){if(L.key===Ae){if(Ae=q.type,Ae===T){if(L.tag===7){u(H,L.sibling),te=g(L,q.props.children),te.return=H,H=te;break e}}else if(L.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===ae&&Vs(Ae)===L.type){u(H,L.sibling),te=g(L,q.props),Jo(te,q),te.return=H,H=te;break e}u(H,L);break}else a(H,L);L=L.sibling}q.type===T?(te=Bs(q.props.children,H.mode,te,q.key),te.return=H,H=te):(te=kl(q.type,q.key,q.props,null,H.mode,te),Jo(te,q),te.return=H,H=te)}return v(H);case x:e:{for(Ae=q.key;L!==null;){if(L.key===Ae)if(L.tag===4&&L.stateNode.containerInfo===q.containerInfo&&L.stateNode.implementation===q.implementation){u(H,L.sibling),te=g(L,q.children||[]),te.return=H,H=te;break e}else{u(H,L);break}else a(H,L);L=L.sibling}te=Uf(q,H.mode,te),te.return=H,H=te}return v(H);case ae:return q=Vs(q),it(H,L,q,te)}if(Xe(q))return _e(H,L,q,te);if(ge(q)){if(Ae=ge(q),typeof Ae!="function")throw Error(i(150));return q=Ae.call(q),Ee(H,L,q,te)}if(typeof q.then=="function")return it(H,L,Hl(q),te);if(q.$$typeof===M)return it(H,L,Ul(H,q),te);jl(H,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,L!==null&&L.tag===6?(u(H,L.sibling),te=g(L,q),te.return=H,H=te):(u(H,L),te=Lf(q,H.mode,te),te.return=H,H=te),v(H)):u(H,L)}return function(H,L,q,te){try{Qo=0;var Ae=it(H,L,q,te);return Lr=null,Ae}catch(ve){if(ve===Br||ve===zl)throw ve;var Ye=yn(29,ve,null,H.mode);return Ye.lanes=te,Ye.return=H,Ye}}}var js=O_(!0),P_=O_(!1),Qi=!1;function Kf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gf(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ji(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function es(r,a,u){var h=r.updateQueue;if(h===null)return null;if(h=h.shared,(Ke&2)!==0){var g=h.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),h.pending=a,a=Dl(r),p_(r,null,u),a}return Nl(r,h,a,u),Dl(r)}function ea(r,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var h=a.lanes;h&=r.pendingLanes,u|=h,a.lanes=u,Tm(r,u)}}function Qf(r,a){var u=r.updateQueue,h=r.alternate;if(h!==null&&(h=h.updateQueue,u===h)){var g=null,_=null;if(u=u.firstBaseUpdate,u!==null){do{var v={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};_===null?g=_=v:_=_.next=v,u=u.next}while(u!==null);_===null?g=_=a:_=_.next=a}else g=_=a;u={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:_,shared:h.shared,callbacks:h.callbacks},r.updateQueue=u;return}r=u.lastBaseUpdate,r===null?u.firstBaseUpdate=a:r.next=a,u.lastBaseUpdate=a}var Jf=!1;function ta(){if(Jf){var r=kr;if(r!==null)throw r}}function na(r,a,u,h){Jf=!1;var g=r.updateQueue;Qi=!1;var _=g.firstBaseUpdate,v=g.lastBaseUpdate,A=g.shared.pending;if(A!==null){g.shared.pending=null;var N=A,Y=N.next;N.next=null,v===null?_=Y:v.next=Y,v=N;var J=r.alternate;J!==null&&(J=J.updateQueue,A=J.lastBaseUpdate,A!==v&&(A===null?J.firstBaseUpdate=Y:A.next=Y,J.lastBaseUpdate=N))}if(_!==null){var se=g.baseState;v=0,J=Y=N=null,A=_;do{var Z=A.lane&-536870913,Q=Z!==A.lane;if(Q?(ze&Z)===Z:(h&Z)===Z){Z!==0&&Z===Dr&&(Jf=!0),J!==null&&(J=J.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});e:{var _e=r,Ee=A;Z=a;var it=u;switch(Ee.tag){case 1:if(_e=Ee.payload,typeof _e=="function"){se=_e.call(it,se,Z);break e}se=_e;break e;case 3:_e.flags=_e.flags&-65537|128;case 0:if(_e=Ee.payload,Z=typeof _e=="function"?_e.call(it,se,Z):_e,Z==null)break e;se=m({},se,Z);break e;case 2:Qi=!0}}Z=A.callback,Z!==null&&(r.flags|=64,Q&&(r.flags|=8192),Q=g.callbacks,Q===null?g.callbacks=[Z]:Q.push(Z))}else Q={lane:Z,tag:A.tag,payload:A.payload,callback:A.callback,next:null},J===null?(Y=J=Q,N=se):J=J.next=Q,v|=Z;if(A=A.next,A===null){if(A=g.shared.pending,A===null)break;Q=A,A=Q.next,Q.next=null,g.lastBaseUpdate=Q,g.shared.pending=null}}while(!0);J===null&&(N=se),g.baseState=N,g.firstBaseUpdate=Y,g.lastBaseUpdate=J,_===null&&(g.shared.lanes=0),rs|=v,r.lanes=v,r.memoizedState=se}}function I_(r,a){if(typeof r!="function")throw Error(i(191,r));r.call(a)}function N_(r,a){var u=r.callbacks;if(u!==null)for(r.callbacks=null,r=0;r<u.length;r++)I_(u[r],a)}var Ur=C(null),Wl=C(0);function D_(r,a){r=Pi,X(Wl,r),X(Ur,a),Pi=r|a.baseLanes}function eh(){X(Wl,Pi),X(Ur,Ur.current)}function th(){Pi=Wl.current,k(Ur),k(Wl)}var bn=C(null),Bn=null;function ts(r){var a=r.alternate;X(vt,vt.current&1),X(bn,r),Bn===null&&(a===null||Ur.current!==null||a.memoizedState!==null)&&(Bn=r)}function nh(r){X(vt,vt.current),X(bn,r),Bn===null&&(Bn=r)}function k_(r){r.tag===22?(X(vt,vt.current),X(bn,r),Bn===null&&(Bn=r)):ns()}function ns(){X(vt,vt.current),X(bn,bn.current)}function vn(r){k(bn),Bn===r&&(Bn=null),k(vt)}var vt=C(0);function $l(r){for(var a=r;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||ld(u)||cd(u)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Si=0,De=null,tt=null,St=null,Xl=!1,Fr=!1,Ws=!1,ql=0,ia=0,zr=null,MS=0;function mt(){throw Error(i(321))}function ih(r,a){if(a===null)return!1;for(var u=0;u<a.length&&u<r.length;u++)if(!_n(r[u],a[u]))return!1;return!0}function sh(r,a,u,h,g,_){return Si=_,De=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,S.H=r===null||r.memoizedState===null?yy:bh,Ws=!1,_=u(h,g),Ws=!1,Fr&&(_=L_(a,u,h,g)),B_(r),_}function B_(r){S.H=oa;var a=tt!==null&&tt.next!==null;if(Si=0,St=tt=De=null,Xl=!1,ia=0,zr=null,a)throw Error(i(300));r===null||At||(r=r.dependencies,r!==null&&Ll(r)&&(At=!0))}function L_(r,a,u,h){De=r;var g=0;do{if(Fr&&(zr=null),ia=0,Fr=!1,25<=g)throw Error(i(301));if(g+=1,St=tt=null,r.updateQueue!=null){var _=r.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}S.H=by,_=a(u,h)}while(Fr);return _}function OS(){var r=S.H,a=r.useState()[0];return a=typeof a.then=="function"?sa(a):a,r=r.useState()[0],(tt!==null?tt.memoizedState:null)!==r&&(De.flags|=1024),a}function rh(){var r=ql!==0;return ql=0,r}function oh(r,a,u){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~u}function ah(r){if(Xl){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Xl=!1}Si=0,St=tt=De=null,Fr=!1,ia=ql=0,zr=null}function tn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return St===null?De.memoizedState=St=r:St=St.next=r,St}function xt(){if(tt===null){var r=De.alternate;r=r!==null?r.memoizedState:null}else r=tt.next;var a=St===null?De.memoizedState:St.next;if(a!==null)St=a,tt=r;else{if(r===null)throw De.alternate===null?Error(i(467)):Error(i(310));tt=r,r={memoizedState:tt.memoizedState,baseState:tt.baseState,baseQueue:tt.baseQueue,queue:tt.queue,next:null},St===null?De.memoizedState=St=r:St=St.next=r}return St}function Yl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sa(r){var a=ia;return ia+=1,zr===null&&(zr=[]),r=R_(zr,r,a),a=De,(St===null?a.memoizedState:St.next)===null&&(a=a.alternate,S.H=a===null||a.memoizedState===null?yy:bh),r}function Zl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return sa(r);if(r.$$typeof===M)return Vt(r)}throw Error(i(438,String(r)))}function lh(r){var a=null,u=De.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var h=De.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(a={data:h.data.map(function(g){return g.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=Yl(),De.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(r),h=0;h<r;h++)u[h]=fe;return a.index++,u}function Ai(r,a){return typeof a=="function"?a(r):a}function Kl(r){var a=xt();return ch(a,tt,r)}function ch(r,a,u){var h=r.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=u;var g=r.baseQueue,_=h.pending;if(_!==null){if(g!==null){var v=g.next;g.next=_.next,_.next=v}a.baseQueue=g=_,h.pending=null}if(_=r.baseState,g===null)r.memoizedState=_;else{a=g.next;var A=v=null,N=null,Y=a,J=!1;do{var se=Y.lane&-536870913;if(se!==Y.lane?(ze&se)===se:(Si&se)===se){var Z=Y.revertLane;if(Z===0)N!==null&&(N=N.next={lane:0,revertLane:0,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),se===Dr&&(J=!0);else if((Si&Z)===Z){Y=Y.next,Z===Dr&&(J=!0);continue}else se={lane:0,revertLane:Y.revertLane,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},N===null?(A=N=se,v=_):N=N.next=se,De.lanes|=Z,rs|=Z;se=Y.action,Ws&&u(_,se),_=Y.hasEagerState?Y.eagerState:u(_,se)}else Z={lane:se,revertLane:Y.revertLane,gesture:Y.gesture,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},N===null?(A=N=Z,v=_):N=N.next=Z,De.lanes|=se,rs|=se;Y=Y.next}while(Y!==null&&Y!==a);if(N===null?v=_:N.next=A,!_n(_,r.memoizedState)&&(At=!0,J&&(u=kr,u!==null)))throw u;r.memoizedState=_,r.baseState=v,r.baseQueue=N,h.lastRenderedState=_}return g===null&&(h.lanes=0),[r.memoizedState,h.dispatch]}function uh(r){var a=xt(),u=a.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=r;var h=u.dispatch,g=u.pending,_=a.memoizedState;if(g!==null){u.pending=null;var v=g=g.next;do _=r(_,v.action),v=v.next;while(v!==g);_n(_,a.memoizedState)||(At=!0),a.memoizedState=_,a.baseQueue===null&&(a.baseState=_),u.lastRenderedState=_}return[_,h]}function U_(r,a,u){var h=De,g=xt(),_=je;if(_){if(u===void 0)throw Error(i(407));u=u()}else u=a();var v=!_n((tt||g).memoizedState,u);if(v&&(g.memoizedState=u,At=!0),g=g.queue,dh(V_.bind(null,h,g,r),[r]),g.getSnapshot!==a||v||St!==null&&St.memoizedState.tag&1){if(h.flags|=2048,Vr(9,{destroy:void 0},z_.bind(null,h,g,u,a),null),ot===null)throw Error(i(349));_||(Si&127)!==0||F_(h,a,u)}return u}function F_(r,a,u){r.flags|=16384,r={getSnapshot:a,value:u},a=De.updateQueue,a===null?(a=Yl(),De.updateQueue=a,a.stores=[r]):(u=a.stores,u===null?a.stores=[r]:u.push(r))}function z_(r,a,u,h){a.value=u,a.getSnapshot=h,H_(a)&&j_(r)}function V_(r,a,u){return u(function(){H_(a)&&j_(r)})}function H_(r){var a=r.getSnapshot;r=r.value;try{var u=a();return!_n(r,u)}catch{return!0}}function j_(r){var a=ks(r,2);a!==null&&dn(a,r,2)}function fh(r){var a=tn();if(typeof r=="function"){var u=r;if(r=u(),Ws){dt(!0);try{u()}finally{dt(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ai,lastRenderedState:r},a}function W_(r,a,u,h){return r.baseState=u,ch(r,tt,typeof h=="function"?h:Ai)}function PS(r,a,u,h,g){if(Jl(r))throw Error(i(485));if(r=a.action,r!==null){var _={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){_.listeners.push(v)}};S.T!==null?u(!0):_.isTransition=!1,h(_),u=a.pending,u===null?(_.next=a.pending=_,$_(a,_)):(_.next=u.next,a.pending=u.next=_)}}function $_(r,a){var u=a.action,h=a.payload,g=r.state;if(a.isTransition){var _=S.T,v={};S.T=v;try{var A=u(g,h),N=S.S;N!==null&&N(v,A),X_(r,a,A)}catch(Y){hh(r,a,Y)}finally{_!==null&&v.types!==null&&(_.types=v.types),S.T=_}}else try{_=u(g,h),X_(r,a,_)}catch(Y){hh(r,a,Y)}}function X_(r,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(h){q_(r,a,h)},function(h){return hh(r,a,h)}):q_(r,a,u)}function q_(r,a,u){a.status="fulfilled",a.value=u,Y_(a),r.state=u,a=r.pending,a!==null&&(u=a.next,u===a?r.pending=null:(u=u.next,a.next=u,$_(r,u)))}function hh(r,a,u){var h=r.pending;if(r.pending=null,h!==null){h=h.next;do a.status="rejected",a.reason=u,Y_(a),a=a.next;while(a!==h)}r.action=null}function Y_(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function Z_(r,a){return a}function K_(r,a){if(je){var u=ot.formState;if(u!==null){e:{var h=De;if(je){if(ft){t:{for(var g=ft,_=kn;g.nodeType!==8;){if(!_){g=null;break t}if(g=Ln(g.nextSibling),g===null){g=null;break t}}_=g.data,g=_==="F!"||_==="F"?g:null}if(g){ft=Ln(g.nextSibling),h=g.data==="F!";break e}}Ki(h)}h=!1}h&&(a=u[0])}}return u=tn(),u.memoizedState=u.baseState=a,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Z_,lastRenderedState:a},u.queue=h,u=gy.bind(null,De,h),h.dispatch=u,h=fh(!1),_=yh.bind(null,De,!1,h.queue),h=tn(),g={state:a,dispatch:null,action:r,pending:null},h.queue=g,u=PS.bind(null,De,g,_,u),g.dispatch=u,h.memoizedState=r,[a,u,!1]}function G_(r){var a=xt();return Q_(a,tt,r)}function Q_(r,a,u){if(a=ch(r,a,Z_)[0],r=Kl(Ai)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var h=sa(a)}catch(v){throw v===Br?zl:v}else h=a;a=xt();var g=a.queue,_=g.dispatch;return u!==a.memoizedState&&(De.flags|=2048,Vr(9,{destroy:void 0},IS.bind(null,g,u),null)),[h,_,r]}function IS(r,a){r.action=a}function J_(r){var a=xt(),u=tt;if(u!==null)return Q_(a,u,r);xt(),a=a.memoizedState,u=xt();var h=u.queue.dispatch;return u.memoizedState=r,[a,h,!1]}function Vr(r,a,u,h){return r={tag:r,create:u,deps:h,inst:a,next:null},a=De.updateQueue,a===null&&(a=Yl(),De.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=r.next=r:(h=u.next,u.next=r,r.next=h,a.lastEffect=r),r}function ey(){return xt().memoizedState}function Gl(r,a,u,h){var g=tn();De.flags|=r,g.memoizedState=Vr(1|a,{destroy:void 0},u,h===void 0?null:h)}function Ql(r,a,u,h){var g=xt();h=h===void 0?null:h;var _=g.memoizedState.inst;tt!==null&&h!==null&&ih(h,tt.memoizedState.deps)?g.memoizedState=Vr(a,_,u,h):(De.flags|=r,g.memoizedState=Vr(1|a,_,u,h))}function ty(r,a){Gl(8390656,8,r,a)}function dh(r,a){Ql(2048,8,r,a)}function NS(r){De.flags|=4;var a=De.updateQueue;if(a===null)a=Yl(),De.updateQueue=a,a.events=[r];else{var u=a.events;u===null?a.events=[r]:u.push(r)}}function ny(r){var a=xt().memoizedState;return NS({ref:a,nextImpl:r}),function(){if((Ke&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function iy(r,a){return Ql(4,2,r,a)}function sy(r,a){return Ql(4,4,r,a)}function ry(r,a){if(typeof a=="function"){r=r();var u=a(r);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function oy(r,a,u){u=u!=null?u.concat([r]):null,Ql(4,4,ry.bind(null,a,r),u)}function ph(){}function ay(r,a){var u=xt();a=a===void 0?null:a;var h=u.memoizedState;return a!==null&&ih(a,h[1])?h[0]:(u.memoizedState=[r,a],r)}function ly(r,a){var u=xt();a=a===void 0?null:a;var h=u.memoizedState;if(a!==null&&ih(a,h[1]))return h[0];if(h=r(),Ws){dt(!0);try{r()}finally{dt(!1)}}return u.memoizedState=[h,a],h}function gh(r,a,u){return u===void 0||(Si&1073741824)!==0&&(ze&261930)===0?r.memoizedState=a:(r.memoizedState=u,r=c0(),De.lanes|=r,rs|=r,u)}function cy(r,a,u,h){return _n(u,a)?u:Ur.current!==null?(r=gh(r,u,h),_n(r,a)||(At=!0),r):(Si&42)===0||(Si&1073741824)!==0&&(ze&261930)===0?(At=!0,r.memoizedState=u):(r=c0(),De.lanes|=r,rs|=r,a)}function uy(r,a,u,h,g){var _=I.p;I.p=_!==0&&8>_?_:8;var v=S.T,A={};S.T=A,yh(r,!1,a,u);try{var N=g(),Y=S.S;if(Y!==null&&Y(A,N),N!==null&&typeof N=="object"&&typeof N.then=="function"){var J=CS(N,h);ra(r,a,J,Sn(r))}else ra(r,a,h,Sn(r))}catch(se){ra(r,a,{then:function(){},status:"rejected",reason:se},Sn())}finally{I.p=_,v!==null&&A.types!==null&&(v.types=A.types),S.T=v}}function DS(){}function mh(r,a,u,h){if(r.tag!==5)throw Error(i(476));var g=fy(r).queue;uy(r,g,a,P,u===null?DS:function(){return hy(r),u(h)})}function fy(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ai,lastRenderedState:P},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ai,lastRenderedState:u},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function hy(r){var a=fy(r);a.next===null&&(a=r.alternate.memoizedState),ra(r,a.next.queue,{},Sn())}function _h(){return Vt(Ta)}function dy(){return xt().memoizedState}function py(){return xt().memoizedState}function kS(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var u=Sn();r=Ji(u);var h=es(a,r,u);h!==null&&(dn(h,a,u),ea(h,a,u)),a={cache:Xf()},r.payload=a;return}a=a.return}}function BS(r,a,u){var h=Sn();u={lane:h,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Jl(r)?my(a,u):(u=kf(r,a,u,h),u!==null&&(dn(u,r,h),_y(u,a,h)))}function gy(r,a,u){var h=Sn();ra(r,a,u,h)}function ra(r,a,u,h){var g={lane:h,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Jl(r))my(a,g);else{var _=r.alternate;if(r.lanes===0&&(_===null||_.lanes===0)&&(_=a.lastRenderedReducer,_!==null))try{var v=a.lastRenderedState,A=_(v,u);if(g.hasEagerState=!0,g.eagerState=A,_n(A,v))return Nl(r,a,g,0),ot===null&&Il(),!1}catch{}if(u=kf(r,a,g,h),u!==null)return dn(u,r,h),_y(u,a,h),!0}return!1}function yh(r,a,u,h){if(h={lane:2,revertLane:Kh(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Jl(r)){if(a)throw Error(i(479))}else a=kf(r,u,h,2),a!==null&&dn(a,r,2)}function Jl(r){var a=r.alternate;return r===De||a!==null&&a===De}function my(r,a){Fr=Xl=!0;var u=r.pending;u===null?a.next=a:(a.next=u.next,u.next=a),r.pending=a}function _y(r,a,u){if((u&4194048)!==0){var h=a.lanes;h&=r.pendingLanes,u|=h,a.lanes=u,Tm(r,u)}}var oa={readContext:Vt,use:Zl,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useLayoutEffect:mt,useInsertionEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useSyncExternalStore:mt,useId:mt,useHostTransitionStatus:mt,useFormState:mt,useActionState:mt,useOptimistic:mt,useMemoCache:mt,useCacheRefresh:mt};oa.useEffectEvent=mt;var yy={readContext:Vt,use:Zl,useCallback:function(r,a){return tn().memoizedState=[r,a===void 0?null:a],r},useContext:Vt,useEffect:ty,useImperativeHandle:function(r,a,u){u=u!=null?u.concat([r]):null,Gl(4194308,4,ry.bind(null,a,r),u)},useLayoutEffect:function(r,a){return Gl(4194308,4,r,a)},useInsertionEffect:function(r,a){Gl(4,2,r,a)},useMemo:function(r,a){var u=tn();a=a===void 0?null:a;var h=r();if(Ws){dt(!0);try{r()}finally{dt(!1)}}return u.memoizedState=[h,a],h},useReducer:function(r,a,u){var h=tn();if(u!==void 0){var g=u(a);if(Ws){dt(!0);try{u(a)}finally{dt(!1)}}}else g=a;return h.memoizedState=h.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},h.queue=r,r=r.dispatch=BS.bind(null,De,r),[h.memoizedState,r]},useRef:function(r){var a=tn();return r={current:r},a.memoizedState=r},useState:function(r){r=fh(r);var a=r.queue,u=gy.bind(null,De,a);return a.dispatch=u,[r.memoizedState,u]},useDebugValue:ph,useDeferredValue:function(r,a){var u=tn();return gh(u,r,a)},useTransition:function(){var r=fh(!1);return r=uy.bind(null,De,r.queue,!0,!1),tn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,u){var h=De,g=tn();if(je){if(u===void 0)throw Error(i(407));u=u()}else{if(u=a(),ot===null)throw Error(i(349));(ze&127)!==0||F_(h,a,u)}g.memoizedState=u;var _={value:u,getSnapshot:a};return g.queue=_,ty(V_.bind(null,h,_,r),[r]),h.flags|=2048,Vr(9,{destroy:void 0},z_.bind(null,h,_,u,a),null),u},useId:function(){var r=tn(),a=ot.identifierPrefix;if(je){var u=ni,h=ti;u=(h&~(1<<32-Dt(h)-1)).toString(32)+u,a="_"+a+"R_"+u,u=ql++,0<u&&(a+="H"+u.toString(32)),a+="_"}else u=MS++,a="_"+a+"r_"+u.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:_h,useFormState:K_,useActionState:K_,useOptimistic:function(r){var a=tn();a.memoizedState=a.baseState=r;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=yh.bind(null,De,!0,u),u.dispatch=a,[r,a]},useMemoCache:lh,useCacheRefresh:function(){return tn().memoizedState=kS.bind(null,De)},useEffectEvent:function(r){var a=tn(),u={impl:r};return a.memoizedState=u,function(){if((Ke&2)!==0)throw Error(i(440));return u.impl.apply(void 0,arguments)}}},bh={readContext:Vt,use:Zl,useCallback:ay,useContext:Vt,useEffect:dh,useImperativeHandle:oy,useInsertionEffect:iy,useLayoutEffect:sy,useMemo:ly,useReducer:Kl,useRef:ey,useState:function(){return Kl(Ai)},useDebugValue:ph,useDeferredValue:function(r,a){var u=xt();return cy(u,tt.memoizedState,r,a)},useTransition:function(){var r=Kl(Ai)[0],a=xt().memoizedState;return[typeof r=="boolean"?r:sa(r),a]},useSyncExternalStore:U_,useId:dy,useHostTransitionStatus:_h,useFormState:G_,useActionState:G_,useOptimistic:function(r,a){var u=xt();return W_(u,tt,r,a)},useMemoCache:lh,useCacheRefresh:py};bh.useEffectEvent=ny;var by={readContext:Vt,use:Zl,useCallback:ay,useContext:Vt,useEffect:dh,useImperativeHandle:oy,useInsertionEffect:iy,useLayoutEffect:sy,useMemo:ly,useReducer:uh,useRef:ey,useState:function(){return uh(Ai)},useDebugValue:ph,useDeferredValue:function(r,a){var u=xt();return tt===null?gh(u,r,a):cy(u,tt.memoizedState,r,a)},useTransition:function(){var r=uh(Ai)[0],a=xt().memoizedState;return[typeof r=="boolean"?r:sa(r),a]},useSyncExternalStore:U_,useId:dy,useHostTransitionStatus:_h,useFormState:J_,useActionState:J_,useOptimistic:function(r,a){var u=xt();return tt!==null?W_(u,tt,r,a):(u.baseState=r,[r,u.queue.dispatch])},useMemoCache:lh,useCacheRefresh:py};by.useEffectEvent=ny;function vh(r,a,u,h){a=r.memoizedState,u=u(h,a),u=u==null?a:m({},a,u),r.memoizedState=u,r.lanes===0&&(r.updateQueue.baseState=u)}var xh={enqueueSetState:function(r,a,u){r=r._reactInternals;var h=Sn(),g=Ji(h);g.payload=a,u!=null&&(g.callback=u),a=es(r,g,h),a!==null&&(dn(a,r,h),ea(a,r,h))},enqueueReplaceState:function(r,a,u){r=r._reactInternals;var h=Sn(),g=Ji(h);g.tag=1,g.payload=a,u!=null&&(g.callback=u),a=es(r,g,h),a!==null&&(dn(a,r,h),ea(a,r,h))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var u=Sn(),h=Ji(u);h.tag=2,a!=null&&(h.callback=a),a=es(r,h,u),a!==null&&(dn(a,r,u),ea(a,r,u))}};function vy(r,a,u,h,g,_,v){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(h,_,v):a.prototype&&a.prototype.isPureReactComponent?!Xo(u,h)||!Xo(g,_):!0}function xy(r,a,u,h){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,h),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,h),a.state!==r&&xh.enqueueReplaceState(a,a.state,null)}function $s(r,a){var u=a;if("ref"in a){u={};for(var h in a)h!=="ref"&&(u[h]=a[h])}if(r=r.defaultProps){u===a&&(u=m({},u));for(var g in r)u[g]===void 0&&(u[g]=r[g])}return u}function Ty(r){Pl(r)}function Sy(r){console.error(r)}function Ay(r){Pl(r)}function ec(r,a){try{var u=r.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(h){setTimeout(function(){throw h})}}function wy(r,a,u){try{var h=r.onCaughtError;h(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Th(r,a,u){return u=Ji(u),u.tag=3,u.payload={element:null},u.callback=function(){ec(r,a)},u}function Ey(r){return r=Ji(r),r.tag=3,r}function Ry(r,a,u,h){var g=u.type.getDerivedStateFromError;if(typeof g=="function"){var _=h.value;r.payload=function(){return g(_)},r.callback=function(){wy(a,u,h)}}var v=u.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(r.callback=function(){wy(a,u,h),typeof g!="function"&&(os===null?os=new Set([this]):os.add(this));var A=h.stack;this.componentDidCatch(h.value,{componentStack:A!==null?A:""})})}function LS(r,a,u,h,g){if(u.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(a=u.alternate,a!==null&&Nr(a,u,g,!0),u=bn.current,u!==null){switch(u.tag){case 31:case 13:return Bn===null?hc():u.alternate===null&&_t===0&&(_t=3),u.flags&=-257,u.flags|=65536,u.lanes=g,h===Vl?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([h]):a.add(h),qh(r,h,g)),!1;case 22:return u.flags|=65536,h===Vl?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([h])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([h]):u.add(h)),qh(r,h,g)),!1}throw Error(i(435,u.tag))}return qh(r,h,g),hc(),!1}if(je)return a=bn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=g,h!==Vf&&(r=Error(i(422),{cause:h}),Zo(In(r,u)))):(h!==Vf&&(a=Error(i(423),{cause:h}),Zo(In(a,u))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,h=In(h,u),g=Th(r.stateNode,h,g),Qf(r,g),_t!==4&&(_t=2)),!1;var _=Error(i(520),{cause:h});if(_=In(_,u),pa===null?pa=[_]:pa.push(_),_t!==4&&(_t=2),a===null)return!0;h=In(h,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,r=g&-g,u.lanes|=r,r=Th(u.stateNode,h,r),Qf(u,r),!1;case 1:if(a=u.type,_=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(os===null||!os.has(_))))return u.flags|=65536,g&=-g,u.lanes|=g,g=Ey(g),Ry(g,r,u,h),Qf(u,g),!1}u=u.return}while(u!==null);return!1}var Sh=Error(i(461)),At=!1;function Ht(r,a,u,h){a.child=r===null?P_(a,null,u,h):js(a,r.child,u,h)}function Cy(r,a,u,h,g){u=u.render;var _=a.ref;if("ref"in h){var v={};for(var A in h)A!=="ref"&&(v[A]=h[A])}else v=h;return Fs(a),h=sh(r,a,u,v,_,g),A=rh(),r!==null&&!At?(oh(r,a,g),wi(r,a,g)):(je&&A&&Ff(a),a.flags|=1,Ht(r,a,h,g),a.child)}function My(r,a,u,h,g){if(r===null){var _=u.type;return typeof _=="function"&&!Bf(_)&&_.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=_,Oy(r,a,_,h,g)):(r=kl(u.type,null,h,a,a.mode,g),r.ref=a.ref,r.return=a,a.child=r)}if(_=r.child,!Ph(r,g)){var v=_.memoizedProps;if(u=u.compare,u=u!==null?u:Xo,u(v,h)&&r.ref===a.ref)return wi(r,a,g)}return a.flags|=1,r=bi(_,h),r.ref=a.ref,r.return=a,a.child=r}function Oy(r,a,u,h,g){if(r!==null){var _=r.memoizedProps;if(Xo(_,h)&&r.ref===a.ref)if(At=!1,a.pendingProps=h=_,Ph(r,g))(r.flags&131072)!==0&&(At=!0);else return a.lanes=r.lanes,wi(r,a,g)}return Ah(r,a,u,h,g)}function Py(r,a,u,h){var g=h.children,_=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((a.flags&128)!==0){if(_=_!==null?_.baseLanes|u:u,r!==null){for(h=a.child=r.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~_}else h=0,a.child=null;return Iy(r,a,_,u,h)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&Fl(a,_!==null?_.cachePool:null),_!==null?D_(a,_):eh(),k_(a);else return h=a.lanes=536870912,Iy(r,a,_!==null?_.baseLanes|u:u,u,h)}else _!==null?(Fl(a,_.cachePool),D_(a,_),ns(),a.memoizedState=null):(r!==null&&Fl(a,null),eh(),ns());return Ht(r,a,g,u),a.child}function aa(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Iy(r,a,u,h,g){var _=Yf();return _=_===null?null:{parent:Tt._currentValue,pool:_},a.memoizedState={baseLanes:u,cachePool:_},r!==null&&Fl(a,null),eh(),k_(a),r!==null&&Nr(r,a,h,!0),a.childLanes=g,null}function tc(r,a){return a=ic({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function Ny(r,a,u){return js(a,r.child,null,u),r=tc(a,a.pendingProps),r.flags|=2,vn(a),a.memoizedState=null,r}function US(r,a,u){var h=a.pendingProps,g=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(je){if(h.mode==="hidden")return r=tc(a,h),a.lanes=536870912,aa(null,r);if(nh(a),(r=ft)?(r=$0(r,kn),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Yi!==null?{id:ti,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},u=m_(r),u.return=a,a.child=u,zt=a,ft=null)):r=null,r===null)throw Ki(a);return a.lanes=536870912,null}return tc(a,h)}var _=r.memoizedState;if(_!==null){var v=_.dehydrated;if(nh(a),g)if(a.flags&256)a.flags&=-257,a=Ny(r,a,u);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(i(558));else if(At||Nr(r,a,u,!1),g=(u&r.childLanes)!==0,At||g){if(h=ot,h!==null&&(v=Sm(h,u),v!==0&&v!==_.retryLane))throw _.retryLane=v,ks(r,v),dn(h,r,v),Sh;hc(),a=Ny(r,a,u)}else r=_.treeContext,ft=Ln(v.nextSibling),zt=a,je=!0,Zi=null,kn=!1,r!==null&&b_(a,r),a=tc(a,h),a.flags|=4096;return a}return r=bi(r.child,{mode:h.mode,children:h.children}),r.ref=a.ref,a.child=r,r.return=a,r}function nc(r,a){var u=a.ref;if(u===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(r===null||r.ref!==u)&&(a.flags|=4194816)}}function Ah(r,a,u,h,g){return Fs(a),u=sh(r,a,u,h,void 0,g),h=rh(),r!==null&&!At?(oh(r,a,g),wi(r,a,g)):(je&&h&&Ff(a),a.flags|=1,Ht(r,a,u,g),a.child)}function Dy(r,a,u,h,g,_){return Fs(a),a.updateQueue=null,u=L_(a,h,u,g),B_(r),h=rh(),r!==null&&!At?(oh(r,a,_),wi(r,a,_)):(je&&h&&Ff(a),a.flags|=1,Ht(r,a,u,_),a.child)}function ky(r,a,u,h,g){if(Fs(a),a.stateNode===null){var _=Mr,v=u.contextType;typeof v=="object"&&v!==null&&(_=Vt(v)),_=new u(h,_),a.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=xh,a.stateNode=_,_._reactInternals=a,_=a.stateNode,_.props=h,_.state=a.memoizedState,_.refs={},Kf(a),v=u.contextType,_.context=typeof v=="object"&&v!==null?Vt(v):Mr,_.state=a.memoizedState,v=u.getDerivedStateFromProps,typeof v=="function"&&(vh(a,u,v,h),_.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(v=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),v!==_.state&&xh.enqueueReplaceState(_,_.state,null),na(a,h,_,g),ta(),_.state=a.memoizedState),typeof _.componentDidMount=="function"&&(a.flags|=4194308),h=!0}else if(r===null){_=a.stateNode;var A=a.memoizedProps,N=$s(u,A);_.props=N;var Y=_.context,J=u.contextType;v=Mr,typeof J=="object"&&J!==null&&(v=Vt(J));var se=u.getDerivedStateFromProps;J=typeof se=="function"||typeof _.getSnapshotBeforeUpdate=="function",A=a.pendingProps!==A,J||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(A||Y!==v)&&xy(a,_,h,v),Qi=!1;var Z=a.memoizedState;_.state=Z,na(a,h,_,g),ta(),Y=a.memoizedState,A||Z!==Y||Qi?(typeof se=="function"&&(vh(a,u,se,h),Y=a.memoizedState),(N=Qi||vy(a,u,N,h,Z,Y,v))?(J||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(a.flags|=4194308)):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=h,a.memoizedState=Y),_.props=h,_.state=Y,_.context=v,h=N):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),h=!1)}else{_=a.stateNode,Gf(r,a),v=a.memoizedProps,J=$s(u,v),_.props=J,se=a.pendingProps,Z=_.context,Y=u.contextType,N=Mr,typeof Y=="object"&&Y!==null&&(N=Vt(Y)),A=u.getDerivedStateFromProps,(Y=typeof A=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(v!==se||Z!==N)&&xy(a,_,h,N),Qi=!1,Z=a.memoizedState,_.state=Z,na(a,h,_,g),ta();var Q=a.memoizedState;v!==se||Z!==Q||Qi||r!==null&&r.dependencies!==null&&Ll(r.dependencies)?(typeof A=="function"&&(vh(a,u,A,h),Q=a.memoizedState),(J=Qi||vy(a,u,J,h,Z,Q,N)||r!==null&&r.dependencies!==null&&Ll(r.dependencies))?(Y||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(h,Q,N),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(h,Q,N)),typeof _.componentDidUpdate=="function"&&(a.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof _.componentDidUpdate!="function"||v===r.memoizedProps&&Z===r.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||v===r.memoizedProps&&Z===r.memoizedState||(a.flags|=1024),a.memoizedProps=h,a.memoizedState=Q),_.props=h,_.state=Q,_.context=N,h=J):(typeof _.componentDidUpdate!="function"||v===r.memoizedProps&&Z===r.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||v===r.memoizedProps&&Z===r.memoizedState||(a.flags|=1024),h=!1)}return _=h,nc(r,a),h=(a.flags&128)!==0,_||h?(_=a.stateNode,u=h&&typeof u.getDerivedStateFromError!="function"?null:_.render(),a.flags|=1,r!==null&&h?(a.child=js(a,r.child,null,g),a.child=js(a,null,u,g)):Ht(r,a,u,g),a.memoizedState=_.state,r=a.child):r=wi(r,a,g),r}function By(r,a,u,h){return Ls(),a.flags|=256,Ht(r,a,u,h),a.child}var wh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Eh(r){return{baseLanes:r,cachePool:w_()}}function Rh(r,a,u){return r=r!==null?r.childLanes&~u:0,a&&(r|=Tn),r}function Ly(r,a,u){var h=a.pendingProps,g=!1,_=(a.flags&128)!==0,v;if((v=_)||(v=r!==null&&r.memoizedState===null?!1:(vt.current&2)!==0),v&&(g=!0,a.flags&=-129),v=(a.flags&32)!==0,a.flags&=-33,r===null){if(je){if(g?ts(a):ns(),(r=ft)?(r=$0(r,kn),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Yi!==null?{id:ti,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},u=m_(r),u.return=a,a.child=u,zt=a,ft=null)):r=null,r===null)throw Ki(a);return cd(r)?a.lanes=32:a.lanes=536870912,null}var A=h.children;return h=h.fallback,g?(ns(),g=a.mode,A=ic({mode:"hidden",children:A},g),h=Bs(h,g,u,null),A.return=a,h.return=a,A.sibling=h,a.child=A,h=a.child,h.memoizedState=Eh(u),h.childLanes=Rh(r,v,u),a.memoizedState=wh,aa(null,h)):(ts(a),Ch(a,A))}var N=r.memoizedState;if(N!==null&&(A=N.dehydrated,A!==null)){if(_)a.flags&256?(ts(a),a.flags&=-257,a=Mh(r,a,u)):a.memoizedState!==null?(ns(),a.child=r.child,a.flags|=128,a=null):(ns(),A=h.fallback,g=a.mode,h=ic({mode:"visible",children:h.children},g),A=Bs(A,g,u,null),A.flags|=2,h.return=a,A.return=a,h.sibling=A,a.child=h,js(a,r.child,null,u),h=a.child,h.memoizedState=Eh(u),h.childLanes=Rh(r,v,u),a.memoizedState=wh,a=aa(null,h));else if(ts(a),cd(A)){if(v=A.nextSibling&&A.nextSibling.dataset,v)var Y=v.dgst;v=Y,h=Error(i(419)),h.stack="",h.digest=v,Zo({value:h,source:null,stack:null}),a=Mh(r,a,u)}else if(At||Nr(r,a,u,!1),v=(u&r.childLanes)!==0,At||v){if(v=ot,v!==null&&(h=Sm(v,u),h!==0&&h!==N.retryLane))throw N.retryLane=h,ks(r,h),dn(v,r,h),Sh;ld(A)||hc(),a=Mh(r,a,u)}else ld(A)?(a.flags|=192,a.child=r.child,a=null):(r=N.treeContext,ft=Ln(A.nextSibling),zt=a,je=!0,Zi=null,kn=!1,r!==null&&b_(a,r),a=Ch(a,h.children),a.flags|=4096);return a}return g?(ns(),A=h.fallback,g=a.mode,N=r.child,Y=N.sibling,h=bi(N,{mode:"hidden",children:h.children}),h.subtreeFlags=N.subtreeFlags&65011712,Y!==null?A=bi(Y,A):(A=Bs(A,g,u,null),A.flags|=2),A.return=a,h.return=a,h.sibling=A,a.child=h,aa(null,h),h=a.child,A=r.child.memoizedState,A===null?A=Eh(u):(g=A.cachePool,g!==null?(N=Tt._currentValue,g=g.parent!==N?{parent:N,pool:N}:g):g=w_(),A={baseLanes:A.baseLanes|u,cachePool:g}),h.memoizedState=A,h.childLanes=Rh(r,v,u),a.memoizedState=wh,aa(r.child,h)):(ts(a),u=r.child,r=u.sibling,u=bi(u,{mode:"visible",children:h.children}),u.return=a,u.sibling=null,r!==null&&(v=a.deletions,v===null?(a.deletions=[r],a.flags|=16):v.push(r)),a.child=u,a.memoizedState=null,u)}function Ch(r,a){return a=ic({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function ic(r,a){return r=yn(22,r,null,a),r.lanes=0,r}function Mh(r,a,u){return js(a,r.child,null,u),r=Ch(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function Uy(r,a,u){r.lanes|=a;var h=r.alternate;h!==null&&(h.lanes|=a),Wf(r.return,a,u)}function Oh(r,a,u,h,g,_){var v=r.memoizedState;v===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:h,tail:u,tailMode:g,treeForkCount:_}:(v.isBackwards=a,v.rendering=null,v.renderingStartTime=0,v.last=h,v.tail=u,v.tailMode=g,v.treeForkCount=_)}function Fy(r,a,u){var h=a.pendingProps,g=h.revealOrder,_=h.tail;h=h.children;var v=vt.current,A=(v&2)!==0;if(A?(v=v&1|2,a.flags|=128):v&=1,X(vt,v),Ht(r,a,h,u),h=je?Yo:0,!A&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Uy(r,u,a);else if(r.tag===19)Uy(r,u,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(g){case"forwards":for(u=a.child,g=null;u!==null;)r=u.alternate,r!==null&&$l(r)===null&&(g=u),u=u.sibling;u=g,u===null?(g=a.child,a.child=null):(g=u.sibling,u.sibling=null),Oh(a,!1,g,u,_,h);break;case"backwards":case"unstable_legacy-backwards":for(u=null,g=a.child,a.child=null;g!==null;){if(r=g.alternate,r!==null&&$l(r)===null){a.child=g;break}r=g.sibling,g.sibling=u,u=g,g=r}Oh(a,!0,u,null,_,h);break;case"together":Oh(a,!1,null,null,void 0,h);break;default:a.memoizedState=null}return a.child}function wi(r,a,u){if(r!==null&&(a.dependencies=r.dependencies),rs|=a.lanes,(u&a.childLanes)===0)if(r!==null){if(Nr(r,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(i(153));if(a.child!==null){for(r=a.child,u=bi(r,r.pendingProps),a.child=u,u.return=a;r.sibling!==null;)r=r.sibling,u=u.sibling=bi(r,r.pendingProps),u.return=a;u.sibling=null}return a.child}function Ph(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&Ll(r)))}function FS(r,a,u){switch(a.tag){case 3:Me(a,a.stateNode.containerInfo),Gi(a,Tt,r.memoizedState.cache),Ls();break;case 27:case 5:We(a);break;case 4:Me(a,a.stateNode.containerInfo);break;case 10:Gi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,nh(a),null;break;case 13:var h=a.memoizedState;if(h!==null)return h.dehydrated!==null?(ts(a),a.flags|=128,null):(u&a.child.childLanes)!==0?Ly(r,a,u):(ts(a),r=wi(r,a,u),r!==null?r.sibling:null);ts(a);break;case 19:var g=(r.flags&128)!==0;if(h=(u&a.childLanes)!==0,h||(Nr(r,a,u,!1),h=(u&a.childLanes)!==0),g){if(h)return Fy(r,a,u);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),X(vt,vt.current),h)break;return null;case 22:return a.lanes=0,Py(r,a,u,a.pendingProps);case 24:Gi(a,Tt,r.memoizedState.cache)}return wi(r,a,u)}function zy(r,a,u){if(r!==null)if(r.memoizedProps!==a.pendingProps)At=!0;else{if(!Ph(r,u)&&(a.flags&128)===0)return At=!1,FS(r,a,u);At=(r.flags&131072)!==0}else At=!1,je&&(a.flags&1048576)!==0&&y_(a,Yo,a.index);switch(a.lanes=0,a.tag){case 16:e:{var h=a.pendingProps;if(r=Vs(a.elementType),a.type=r,typeof r=="function")Bf(r)?(h=$s(r,h),a.tag=1,a=ky(null,a,r,h,u)):(a.tag=0,a=Ah(null,a,r,h,u));else{if(r!=null){var g=r.$$typeof;if(g===D){a.tag=11,a=Cy(null,a,r,h,u);break e}else if(g===ee){a.tag=14,a=My(null,a,r,h,u);break e}}throw a=de(r)||r,Error(i(306,a,""))}}return a;case 0:return Ah(r,a,a.type,a.pendingProps,u);case 1:return h=a.type,g=$s(h,a.pendingProps),ky(r,a,h,g,u);case 3:e:{if(Me(a,a.stateNode.containerInfo),r===null)throw Error(i(387));h=a.pendingProps;var _=a.memoizedState;g=_.element,Gf(r,a),na(a,h,null,u);var v=a.memoizedState;if(h=v.cache,Gi(a,Tt,h),h!==_.cache&&$f(a,[Tt],u,!0),ta(),h=v.element,_.isDehydrated)if(_={element:h,isDehydrated:!1,cache:v.cache},a.updateQueue.baseState=_,a.memoizedState=_,a.flags&256){a=By(r,a,h,u);break e}else if(h!==g){g=In(Error(i(424)),a),Zo(g),a=By(r,a,h,u);break e}else for(r=a.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,ft=Ln(r.firstChild),zt=a,je=!0,Zi=null,kn=!0,u=P_(a,null,h,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Ls(),h===g){a=wi(r,a,u);break e}Ht(r,a,h,u)}a=a.child}return a;case 26:return nc(r,a),r===null?(u=G0(a.type,null,a.pendingProps,null))?a.memoizedState=u:je||(u=a.type,r=a.pendingProps,h=bc(ye.current).createElement(u),h[Ft]=a,h[an]=r,jt(h,u,r),kt(h),a.stateNode=h):a.memoizedState=G0(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return We(a),r===null&&je&&(h=a.stateNode=Y0(a.type,a.pendingProps,ye.current),zt=a,kn=!0,g=ft,us(a.type)?(ud=g,ft=Ln(h.firstChild)):ft=g),Ht(r,a,a.pendingProps.children,u),nc(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&je&&((g=h=ft)&&(h=gA(h,a.type,a.pendingProps,kn),h!==null?(a.stateNode=h,zt=a,ft=Ln(h.firstChild),kn=!1,g=!0):g=!1),g||Ki(a)),We(a),g=a.type,_=a.pendingProps,v=r!==null?r.memoizedProps:null,h=_.children,rd(g,_)?h=null:v!==null&&rd(g,v)&&(a.flags|=32),a.memoizedState!==null&&(g=sh(r,a,OS,null,null,u),Ta._currentValue=g),nc(r,a),Ht(r,a,h,u),a.child;case 6:return r===null&&je&&((r=u=ft)&&(u=mA(u,a.pendingProps,kn),u!==null?(a.stateNode=u,zt=a,ft=null,r=!0):r=!1),r||Ki(a)),null;case 13:return Ly(r,a,u);case 4:return Me(a,a.stateNode.containerInfo),h=a.pendingProps,r===null?a.child=js(a,null,h,u):Ht(r,a,h,u),a.child;case 11:return Cy(r,a,a.type,a.pendingProps,u);case 7:return Ht(r,a,a.pendingProps,u),a.child;case 8:return Ht(r,a,a.pendingProps.children,u),a.child;case 12:return Ht(r,a,a.pendingProps.children,u),a.child;case 10:return h=a.pendingProps,Gi(a,a.type,h.value),Ht(r,a,h.children,u),a.child;case 9:return g=a.type._context,h=a.pendingProps.children,Fs(a),g=Vt(g),h=h(g),a.flags|=1,Ht(r,a,h,u),a.child;case 14:return My(r,a,a.type,a.pendingProps,u);case 15:return Oy(r,a,a.type,a.pendingProps,u);case 19:return Fy(r,a,u);case 31:return US(r,a,u);case 22:return Py(r,a,u,a.pendingProps);case 24:return Fs(a),h=Vt(Tt),r===null?(g=Yf(),g===null&&(g=ot,_=Xf(),g.pooledCache=_,_.refCount++,_!==null&&(g.pooledCacheLanes|=u),g=_),a.memoizedState={parent:h,cache:g},Kf(a),Gi(a,Tt,g)):((r.lanes&u)!==0&&(Gf(r,a),na(a,null,null,u),ta()),g=r.memoizedState,_=a.memoizedState,g.parent!==h?(g={parent:h,cache:h},a.memoizedState=g,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=g),Gi(a,Tt,h)):(h=_.cache,Gi(a,Tt,h),h!==g.cache&&$f(a,[Tt],u,!0))),Ht(r,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function Ei(r){r.flags|=4}function Ih(r,a,u,h,g){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(g&335544128)===g)if(r.stateNode.complete)r.flags|=8192;else if(d0())r.flags|=8192;else throw Hs=Vl,Zf}else r.flags&=-16777217}function Vy(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!nb(a))if(d0())r.flags|=8192;else throw Hs=Vl,Zf}function sc(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?vm():536870912,r.lanes|=a,$r|=a)}function la(r,a){if(!je)switch(r.tailMode){case"hidden":a=r.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?r.tail=null:u.sibling=null;break;case"collapsed":u=r.tail;for(var h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:h.sibling=null}}function ht(r){var a=r.alternate!==null&&r.alternate.child===r.child,u=0,h=0;if(a)for(var g=r.child;g!==null;)u|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)u|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=h,r.childLanes=u,a}function zS(r,a,u){var h=a.pendingProps;switch(zf(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ht(a),null;case 1:return ht(a),null;case 3:return u=a.stateNode,h=null,r!==null&&(h=r.memoizedState.cache),a.memoizedState.cache!==h&&(a.flags|=2048),Ti(Tt),Be(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&(Ir(a)?Ei(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Hf())),ht(a),null;case 26:var g=a.type,_=a.memoizedState;return r===null?(Ei(a),_!==null?(ht(a),Vy(a,_)):(ht(a),Ih(a,g,null,h,u))):_?_!==r.memoizedState?(Ei(a),ht(a),Vy(a,_)):(ht(a),a.flags&=-16777217):(r=r.memoizedProps,r!==h&&Ei(a),ht(a),Ih(a,g,r,h,u)),null;case 27:if(Cn(a),u=ye.current,g=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==h&&Ei(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return ht(a),null}r=re.current,Ir(a)?v_(a):(r=Y0(g,h,u),a.stateNode=r,Ei(a))}return ht(a),null;case 5:if(Cn(a),g=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==h&&Ei(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return ht(a),null}if(_=re.current,Ir(a))v_(a);else{var v=bc(ye.current);switch(_){case 1:_=v.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:_=v.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":_=v.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":_=v.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":_=v.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild);break;case"select":_=typeof h.is=="string"?v.createElement("select",{is:h.is}):v.createElement("select"),h.multiple?_.multiple=!0:h.size&&(_.size=h.size);break;default:_=typeof h.is=="string"?v.createElement(g,{is:h.is}):v.createElement(g)}}_[Ft]=a,_[an]=h;e:for(v=a.child;v!==null;){if(v.tag===5||v.tag===6)_.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===a)break e;for(;v.sibling===null;){if(v.return===null||v.return===a)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}a.stateNode=_;e:switch(jt(_,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&Ei(a)}}return ht(a),Ih(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,u),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==h&&Ei(a);else{if(typeof h!="string"&&a.stateNode===null)throw Error(i(166));if(r=ye.current,Ir(a)){if(r=a.stateNode,u=a.memoizedProps,h=null,g=zt,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}r[Ft]=a,r=!!(r.nodeValue===u||h!==null&&h.suppressHydrationWarning===!0||L0(r.nodeValue,u)),r||Ki(a,!0)}else r=bc(r).createTextNode(h),r[Ft]=a,a.stateNode=r}return ht(a),null;case 31:if(u=a.memoizedState,r===null||r.memoizedState!==null){if(h=Ir(a),u!==null){if(r===null){if(!h)throw Error(i(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[Ft]=a}else Ls(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ht(a),r=!1}else u=Hf(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=u),r=!0;if(!r)return a.flags&256?(vn(a),a):(vn(a),null);if((a.flags&128)!==0)throw Error(i(558))}return ht(a),null;case 13:if(h=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Ir(a),h!==null&&h.dehydrated!==null){if(r===null){if(!g)throw Error(i(318));if(g=a.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Ft]=a}else Ls(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ht(a),g=!1}else g=Hf(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return a.flags&256?(vn(a),a):(vn(a),null)}return vn(a),(a.flags&128)!==0?(a.lanes=u,a):(u=h!==null,r=r!==null&&r.memoizedState!==null,u&&(h=a.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),_=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(_=h.memoizedState.cachePool.pool),_!==g&&(h.flags|=2048)),u!==r&&u&&(a.child.flags|=8192),sc(a,a.updateQueue),ht(a),null);case 4:return Be(),r===null&&ed(a.stateNode.containerInfo),ht(a),null;case 10:return Ti(a.type),ht(a),null;case 19:if(k(vt),h=a.memoizedState,h===null)return ht(a),null;if(g=(a.flags&128)!==0,_=h.rendering,_===null)if(g)la(h,!1);else{if(_t!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(_=$l(r),_!==null){for(a.flags|=128,la(h,!1),r=_.updateQueue,a.updateQueue=r,sc(a,r),a.subtreeFlags=0,r=u,u=a.child;u!==null;)g_(u,r),u=u.sibling;return X(vt,vt.current&1|2),je&&vi(a,h.treeForkCount),a.child}r=r.sibling}h.tail!==null&&ct()>cc&&(a.flags|=128,g=!0,la(h,!1),a.lanes=4194304)}else{if(!g)if(r=$l(_),r!==null){if(a.flags|=128,g=!0,r=r.updateQueue,a.updateQueue=r,sc(a,r),la(h,!0),h.tail===null&&h.tailMode==="hidden"&&!_.alternate&&!je)return ht(a),null}else 2*ct()-h.renderingStartTime>cc&&u!==536870912&&(a.flags|=128,g=!0,la(h,!1),a.lanes=4194304);h.isBackwards?(_.sibling=a.child,a.child=_):(r=h.last,r!==null?r.sibling=_:a.child=_,h.last=_)}return h.tail!==null?(r=h.tail,h.rendering=r,h.tail=r.sibling,h.renderingStartTime=ct(),r.sibling=null,u=vt.current,X(vt,g?u&1|2:u&1),je&&vi(a,h.treeForkCount),r):(ht(a),null);case 22:case 23:return vn(a),th(),h=a.memoizedState!==null,r!==null?r.memoizedState!==null!==h&&(a.flags|=8192):h&&(a.flags|=8192),h?(u&536870912)!==0&&(a.flags&128)===0&&(ht(a),a.subtreeFlags&6&&(a.flags|=8192)):ht(a),u=a.updateQueue,u!==null&&sc(a,u.retryQueue),u=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),h=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),h!==u&&(a.flags|=2048),r!==null&&k(zs),null;case 24:return u=null,r!==null&&(u=r.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),Ti(Tt),ht(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function VS(r,a){switch(zf(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return Ti(Tt),Be(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return Cn(a),null;case 31:if(a.memoizedState!==null){if(vn(a),a.alternate===null)throw Error(i(340));Ls()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(vn(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Ls()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return k(vt),null;case 4:return Be(),null;case 10:return Ti(a.type),null;case 22:case 23:return vn(a),th(),r!==null&&k(zs),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return Ti(Tt),null;case 25:return null;default:return null}}function Hy(r,a){switch(zf(a),a.tag){case 3:Ti(Tt),Be();break;case 26:case 27:case 5:Cn(a);break;case 4:Be();break;case 31:a.memoizedState!==null&&vn(a);break;case 13:vn(a);break;case 19:k(vt);break;case 10:Ti(a.type);break;case 22:case 23:vn(a),th(),r!==null&&k(zs);break;case 24:Ti(Tt)}}function ca(r,a){try{var u=a.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var g=h.next;u=g;do{if((u.tag&r)===r){h=void 0;var _=u.create,v=u.inst;h=_(),v.destroy=h}u=u.next}while(u!==g)}}catch(A){et(a,a.return,A)}}function is(r,a,u){try{var h=a.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var _=g.next;h=_;do{if((h.tag&r)===r){var v=h.inst,A=v.destroy;if(A!==void 0){v.destroy=void 0,g=a;var N=u,Y=A;try{Y()}catch(J){et(g,N,J)}}}h=h.next}while(h!==_)}}catch(J){et(a,a.return,J)}}function jy(r){var a=r.updateQueue;if(a!==null){var u=r.stateNode;try{N_(a,u)}catch(h){et(r,r.return,h)}}}function Wy(r,a,u){u.props=$s(r.type,r.memoizedProps),u.state=r.memoizedState;try{u.componentWillUnmount()}catch(h){et(r,a,h)}}function ua(r,a){try{var u=r.ref;if(u!==null){switch(r.tag){case 26:case 27:case 5:var h=r.stateNode;break;case 30:h=r.stateNode;break;default:h=r.stateNode}typeof u=="function"?r.refCleanup=u(h):u.current=h}}catch(g){et(r,a,g)}}function ii(r,a){var u=r.ref,h=r.refCleanup;if(u!==null)if(typeof h=="function")try{h()}catch(g){et(r,a,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(g){et(r,a,g)}else u.current=null}function $y(r){var a=r.type,u=r.memoizedProps,h=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&h.focus();break e;case"img":u.src?h.src=u.src:u.srcSet&&(h.srcset=u.srcSet)}}catch(g){et(r,r.return,g)}}function Nh(r,a,u){try{var h=r.stateNode;cA(h,r.type,u,a),h[an]=a}catch(g){et(r,r.return,g)}}function Xy(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&us(r.type)||r.tag===4}function Dh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Xy(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&us(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function kh(r,a,u){var h=r.tag;if(h===5||h===6)r=r.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(r,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(r),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=_i));else if(h!==4&&(h===27&&us(r.type)&&(u=r.stateNode,a=null),r=r.child,r!==null))for(kh(r,a,u),r=r.sibling;r!==null;)kh(r,a,u),r=r.sibling}function rc(r,a,u){var h=r.tag;if(h===5||h===6)r=r.stateNode,a?u.insertBefore(r,a):u.appendChild(r);else if(h!==4&&(h===27&&us(r.type)&&(u=r.stateNode),r=r.child,r!==null))for(rc(r,a,u),r=r.sibling;r!==null;)rc(r,a,u),r=r.sibling}function qy(r){var a=r.stateNode,u=r.memoizedProps;try{for(var h=r.type,g=a.attributes;g.length;)a.removeAttributeNode(g[0]);jt(a,h,u),a[Ft]=r,a[an]=u}catch(_){et(r,r.return,_)}}var Ri=!1,wt=!1,Bh=!1,Yy=typeof WeakSet=="function"?WeakSet:Set,Bt=null;function HS(r,a){if(r=r.containerInfo,id=Ec,r=o_(r),Mf(r)){if("selectionStart"in r)var u={start:r.selectionStart,end:r.selectionEnd};else e:{u=(u=r.ownerDocument)&&u.defaultView||window;var h=u.getSelection&&u.getSelection();if(h&&h.rangeCount!==0){u=h.anchorNode;var g=h.anchorOffset,_=h.focusNode;h=h.focusOffset;try{u.nodeType,_.nodeType}catch{u=null;break e}var v=0,A=-1,N=-1,Y=0,J=0,se=r,Z=null;t:for(;;){for(var Q;se!==u||g!==0&&se.nodeType!==3||(A=v+g),se!==_||h!==0&&se.nodeType!==3||(N=v+h),se.nodeType===3&&(v+=se.nodeValue.length),(Q=se.firstChild)!==null;)Z=se,se=Q;for(;;){if(se===r)break t;if(Z===u&&++Y===g&&(A=v),Z===_&&++J===h&&(N=v),(Q=se.nextSibling)!==null)break;se=Z,Z=se.parentNode}se=Q}u=A===-1||N===-1?null:{start:A,end:N}}else u=null}u=u||{start:0,end:0}}else u=null;for(sd={focusedElem:r,selectionRange:u},Ec=!1,Bt=a;Bt!==null;)if(a=Bt,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,Bt=r;else for(;Bt!==null;){switch(a=Bt,_=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(u=0;u<r.length;u++)g=r[u],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&_!==null){r=void 0,u=a,g=_.memoizedProps,_=_.memoizedState,h=u.stateNode;try{var _e=$s(u.type,g);r=h.getSnapshotBeforeUpdate(_e,_),h.__reactInternalSnapshotBeforeUpdate=r}catch(Ee){et(u,u.return,Ee)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,u=r.nodeType,u===9)ad(r);else if(u===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":ad(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=a.sibling,r!==null){r.return=a.return,Bt=r;break}Bt=a.return}}function Zy(r,a,u){var h=u.flags;switch(u.tag){case 0:case 11:case 15:Mi(r,u),h&4&&ca(5,u);break;case 1:if(Mi(r,u),h&4)if(r=u.stateNode,a===null)try{r.componentDidMount()}catch(v){et(u,u.return,v)}else{var g=$s(u.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(g,a,r.__reactInternalSnapshotBeforeUpdate)}catch(v){et(u,u.return,v)}}h&64&&jy(u),h&512&&ua(u,u.return);break;case 3:if(Mi(r,u),h&64&&(r=u.updateQueue,r!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{N_(r,a)}catch(v){et(u,u.return,v)}}break;case 27:a===null&&h&4&&qy(u);case 26:case 5:Mi(r,u),a===null&&h&4&&$y(u),h&512&&ua(u,u.return);break;case 12:Mi(r,u);break;case 31:Mi(r,u),h&4&&Qy(r,u);break;case 13:Mi(r,u),h&4&&Jy(r,u),h&64&&(r=u.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(u=GS.bind(null,u),_A(r,u))));break;case 22:if(h=u.memoizedState!==null||Ri,!h){a=a!==null&&a.memoizedState!==null||wt,g=Ri;var _=wt;Ri=h,(wt=a)&&!_?Oi(r,u,(u.subtreeFlags&8772)!==0):Mi(r,u),Ri=g,wt=_}break;case 30:break;default:Mi(r,u)}}function Ky(r){var a=r.alternate;a!==null&&(r.alternate=null,Ky(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&hf(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var pt=null,cn=!1;function Ci(r,a,u){for(u=u.child;u!==null;)Gy(r,a,u),u=u.sibling}function Gy(r,a,u){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(Nt,u)}catch{}switch(u.tag){case 26:wt||ii(u,a),Ci(r,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:wt||ii(u,a);var h=pt,g=cn;us(u.type)&&(pt=u.stateNode,cn=!1),Ci(r,a,u),ba(u.stateNode),pt=h,cn=g;break;case 5:wt||ii(u,a);case 6:if(h=pt,g=cn,pt=null,Ci(r,a,u),pt=h,cn=g,pt!==null)if(cn)try{(pt.nodeType===9?pt.body:pt.nodeName==="HTML"?pt.ownerDocument.body:pt).removeChild(u.stateNode)}catch(_){et(u,a,_)}else try{pt.removeChild(u.stateNode)}catch(_){et(u,a,_)}break;case 18:pt!==null&&(cn?(r=pt,j0(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,u.stateNode),Jr(r)):j0(pt,u.stateNode));break;case 4:h=pt,g=cn,pt=u.stateNode.containerInfo,cn=!0,Ci(r,a,u),pt=h,cn=g;break;case 0:case 11:case 14:case 15:is(2,u,a),wt||is(4,u,a),Ci(r,a,u);break;case 1:wt||(ii(u,a),h=u.stateNode,typeof h.componentWillUnmount=="function"&&Wy(u,a,h)),Ci(r,a,u);break;case 21:Ci(r,a,u);break;case 22:wt=(h=wt)||u.memoizedState!==null,Ci(r,a,u),wt=h;break;default:Ci(r,a,u)}}function Qy(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Jr(r)}catch(u){et(a,a.return,u)}}}function Jy(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Jr(r)}catch(u){et(a,a.return,u)}}function jS(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new Yy),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new Yy),a;default:throw Error(i(435,r.tag))}}function oc(r,a){var u=jS(r);a.forEach(function(h){if(!u.has(h)){u.add(h);var g=QS.bind(null,r,h);h.then(g,g)}})}function un(r,a){var u=a.deletions;if(u!==null)for(var h=0;h<u.length;h++){var g=u[h],_=r,v=a,A=v;e:for(;A!==null;){switch(A.tag){case 27:if(us(A.type)){pt=A.stateNode,cn=!1;break e}break;case 5:pt=A.stateNode,cn=!1;break e;case 3:case 4:pt=A.stateNode.containerInfo,cn=!0;break e}A=A.return}if(pt===null)throw Error(i(160));Gy(_,v,g),pt=null,cn=!1,_=g.alternate,_!==null&&(_.return=null),g.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)e0(a,r),a=a.sibling}var qn=null;function e0(r,a){var u=r.alternate,h=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:un(a,r),fn(r),h&4&&(is(3,r,r.return),ca(3,r),is(5,r,r.return));break;case 1:un(a,r),fn(r),h&512&&(wt||u===null||ii(u,u.return)),h&64&&Ri&&(r=r.updateQueue,r!==null&&(h=r.callbacks,h!==null&&(u=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=u===null?h:u.concat(h))));break;case 26:var g=qn;if(un(a,r),fn(r),h&512&&(wt||u===null||ii(u,u.return)),h&4){var _=u!==null?u.memoizedState:null;if(h=r.memoizedState,u===null)if(h===null)if(r.stateNode===null){e:{h=r.type,u=r.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":_=g.getElementsByTagName("title")[0],(!_||_[Lo]||_[Ft]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=g.createElement(h),g.head.insertBefore(_,g.querySelector("head > title"))),jt(_,h,u),_[Ft]=r,kt(_),h=_;break e;case"link":var v=eb("link","href",g).get(h+(u.href||""));if(v){for(var A=0;A<v.length;A++)if(_=v[A],_.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&_.getAttribute("rel")===(u.rel==null?null:u.rel)&&_.getAttribute("title")===(u.title==null?null:u.title)&&_.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){v.splice(A,1);break t}}_=g.createElement(h),jt(_,h,u),g.head.appendChild(_);break;case"meta":if(v=eb("meta","content",g).get(h+(u.content||""))){for(A=0;A<v.length;A++)if(_=v[A],_.getAttribute("content")===(u.content==null?null:""+u.content)&&_.getAttribute("name")===(u.name==null?null:u.name)&&_.getAttribute("property")===(u.property==null?null:u.property)&&_.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&_.getAttribute("charset")===(u.charSet==null?null:u.charSet)){v.splice(A,1);break t}}_=g.createElement(h),jt(_,h,u),g.head.appendChild(_);break;default:throw Error(i(468,h))}_[Ft]=r,kt(_),h=_}r.stateNode=h}else tb(g,r.type,r.stateNode);else r.stateNode=J0(g,h,r.memoizedProps);else _!==h?(_===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):_.count--,h===null?tb(g,r.type,r.stateNode):J0(g,h,r.memoizedProps)):h===null&&r.stateNode!==null&&Nh(r,r.memoizedProps,u.memoizedProps)}break;case 27:un(a,r),fn(r),h&512&&(wt||u===null||ii(u,u.return)),u!==null&&h&4&&Nh(r,r.memoizedProps,u.memoizedProps);break;case 5:if(un(a,r),fn(r),h&512&&(wt||u===null||ii(u,u.return)),r.flags&32){g=r.stateNode;try{Tr(g,"")}catch(_e){et(r,r.return,_e)}}h&4&&r.stateNode!=null&&(g=r.memoizedProps,Nh(r,g,u!==null?u.memoizedProps:g)),h&1024&&(Bh=!0);break;case 6:if(un(a,r),fn(r),h&4){if(r.stateNode===null)throw Error(i(162));h=r.memoizedProps,u=r.stateNode;try{u.nodeValue=h}catch(_e){et(r,r.return,_e)}}break;case 3:if(Tc=null,g=qn,qn=vc(a.containerInfo),un(a,r),qn=g,fn(r),h&4&&u!==null&&u.memoizedState.isDehydrated)try{Jr(a.containerInfo)}catch(_e){et(r,r.return,_e)}Bh&&(Bh=!1,t0(r));break;case 4:h=qn,qn=vc(r.stateNode.containerInfo),un(a,r),fn(r),qn=h;break;case 12:un(a,r),fn(r);break;case 31:un(a,r),fn(r),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,oc(r,h)));break;case 13:un(a,r),fn(r),r.child.flags&8192&&r.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(lc=ct()),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,oc(r,h)));break;case 22:g=r.memoizedState!==null;var N=u!==null&&u.memoizedState!==null,Y=Ri,J=wt;if(Ri=Y||g,wt=J||N,un(a,r),wt=J,Ri=Y,fn(r),h&8192)e:for(a=r.stateNode,a._visibility=g?a._visibility&-2:a._visibility|1,g&&(u===null||N||Ri||wt||Xs(r)),u=null,a=r;;){if(a.tag===5||a.tag===26){if(u===null){N=u=a;try{if(_=N.stateNode,g)v=_.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{A=N.stateNode;var se=N.memoizedProps.style,Z=se!=null&&se.hasOwnProperty("display")?se.display:null;A.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(_e){et(N,N.return,_e)}}}else if(a.tag===6){if(u===null){N=a;try{N.stateNode.nodeValue=g?"":N.memoizedProps}catch(_e){et(N,N.return,_e)}}}else if(a.tag===18){if(u===null){N=a;try{var Q=N.stateNode;g?W0(Q,!0):W0(N.stateNode,!1)}catch(_e){et(N,N.return,_e)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}h&4&&(h=r.updateQueue,h!==null&&(u=h.retryQueue,u!==null&&(h.retryQueue=null,oc(r,u))));break;case 19:un(a,r),fn(r),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,oc(r,h)));break;case 30:break;case 21:break;default:un(a,r),fn(r)}}function fn(r){var a=r.flags;if(a&2){try{for(var u,h=r.return;h!==null;){if(Xy(h)){u=h;break}h=h.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var g=u.stateNode,_=Dh(r);rc(r,_,g);break;case 5:var v=u.stateNode;u.flags&32&&(Tr(v,""),u.flags&=-33);var A=Dh(r);rc(r,A,v);break;case 3:case 4:var N=u.stateNode.containerInfo,Y=Dh(r);kh(r,Y,N);break;default:throw Error(i(161))}}catch(J){et(r,r.return,J)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function t0(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;t0(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function Mi(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Zy(r,a.alternate,a),a=a.sibling}function Xs(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:is(4,a,a.return),Xs(a);break;case 1:ii(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&Wy(a,a.return,u),Xs(a);break;case 27:ba(a.stateNode);case 26:case 5:ii(a,a.return),Xs(a);break;case 22:a.memoizedState===null&&Xs(a);break;case 30:Xs(a);break;default:Xs(a)}r=r.sibling}}function Oi(r,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var h=a.alternate,g=r,_=a,v=_.flags;switch(_.tag){case 0:case 11:case 15:Oi(g,_,u),ca(4,_);break;case 1:if(Oi(g,_,u),h=_,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Y){et(h,h.return,Y)}if(h=_,g=h.updateQueue,g!==null){var A=h.stateNode;try{var N=g.shared.hiddenCallbacks;if(N!==null)for(g.shared.hiddenCallbacks=null,g=0;g<N.length;g++)I_(N[g],A)}catch(Y){et(h,h.return,Y)}}u&&v&64&&jy(_),ua(_,_.return);break;case 27:qy(_);case 26:case 5:Oi(g,_,u),u&&h===null&&v&4&&$y(_),ua(_,_.return);break;case 12:Oi(g,_,u);break;case 31:Oi(g,_,u),u&&v&4&&Qy(g,_);break;case 13:Oi(g,_,u),u&&v&4&&Jy(g,_);break;case 22:_.memoizedState===null&&Oi(g,_,u),ua(_,_.return);break;case 30:break;default:Oi(g,_,u)}a=a.sibling}}function Lh(r,a){var u=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==u&&(r!=null&&r.refCount++,u!=null&&Ko(u))}function Uh(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&Ko(r))}function Yn(r,a,u,h){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)n0(r,a,u,h),a=a.sibling}function n0(r,a,u,h){var g=a.flags;switch(a.tag){case 0:case 11:case 15:Yn(r,a,u,h),g&2048&&ca(9,a);break;case 1:Yn(r,a,u,h);break;case 3:Yn(r,a,u,h),g&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&Ko(r)));break;case 12:if(g&2048){Yn(r,a,u,h),r=a.stateNode;try{var _=a.memoizedProps,v=_.id,A=_.onPostCommit;typeof A=="function"&&A(v,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(N){et(a,a.return,N)}}else Yn(r,a,u,h);break;case 31:Yn(r,a,u,h);break;case 13:Yn(r,a,u,h);break;case 23:break;case 22:_=a.stateNode,v=a.alternate,a.memoizedState!==null?_._visibility&2?Yn(r,a,u,h):fa(r,a):_._visibility&2?Yn(r,a,u,h):(_._visibility|=2,Hr(r,a,u,h,(a.subtreeFlags&10256)!==0||!1)),g&2048&&Lh(v,a);break;case 24:Yn(r,a,u,h),g&2048&&Uh(a.alternate,a);break;default:Yn(r,a,u,h)}}function Hr(r,a,u,h,g){for(g=g&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var _=r,v=a,A=u,N=h,Y=v.flags;switch(v.tag){case 0:case 11:case 15:Hr(_,v,A,N,g),ca(8,v);break;case 23:break;case 22:var J=v.stateNode;v.memoizedState!==null?J._visibility&2?Hr(_,v,A,N,g):fa(_,v):(J._visibility|=2,Hr(_,v,A,N,g)),g&&Y&2048&&Lh(v.alternate,v);break;case 24:Hr(_,v,A,N,g),g&&Y&2048&&Uh(v.alternate,v);break;default:Hr(_,v,A,N,g)}a=a.sibling}}function fa(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=r,h=a,g=h.flags;switch(h.tag){case 22:fa(u,h),g&2048&&Lh(h.alternate,h);break;case 24:fa(u,h),g&2048&&Uh(h.alternate,h);break;default:fa(u,h)}a=a.sibling}}var ha=8192;function jr(r,a,u){if(r.subtreeFlags&ha)for(r=r.child;r!==null;)i0(r,a,u),r=r.sibling}function i0(r,a,u){switch(r.tag){case 26:jr(r,a,u),r.flags&ha&&r.memoizedState!==null&&MA(u,qn,r.memoizedState,r.memoizedProps);break;case 5:jr(r,a,u);break;case 3:case 4:var h=qn;qn=vc(r.stateNode.containerInfo),jr(r,a,u),qn=h;break;case 22:r.memoizedState===null&&(h=r.alternate,h!==null&&h.memoizedState!==null?(h=ha,ha=16777216,jr(r,a,u),ha=h):jr(r,a,u));break;default:jr(r,a,u)}}function s0(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function da(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var h=a[u];Bt=h,o0(h,r)}s0(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)r0(r),r=r.sibling}function r0(r){switch(r.tag){case 0:case 11:case 15:da(r),r.flags&2048&&is(9,r,r.return);break;case 3:da(r);break;case 12:da(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,ac(r)):da(r);break;default:da(r)}}function ac(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var h=a[u];Bt=h,o0(h,r)}s0(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:is(8,a,a.return),ac(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,ac(a));break;default:ac(a)}r=r.sibling}}function o0(r,a){for(;Bt!==null;){var u=Bt;switch(u.tag){case 0:case 11:case 15:is(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var h=u.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Ko(u.memoizedState.cache)}if(h=u.child,h!==null)h.return=u,Bt=h;else e:for(u=r;Bt!==null;){h=Bt;var g=h.sibling,_=h.return;if(Ky(h),h===u){Bt=null;break e}if(g!==null){g.return=_,Bt=g;break e}Bt=_}}}var WS={getCacheForType:function(r){var a=Vt(Tt),u=a.data.get(r);return u===void 0&&(u=r(),a.data.set(r,u)),u},cacheSignal:function(){return Vt(Tt).controller.signal}},$S=typeof WeakMap=="function"?WeakMap:Map,Ke=0,ot=null,Ue=null,ze=0,Je=0,xn=null,ss=!1,Wr=!1,Fh=!1,Pi=0,_t=0,rs=0,qs=0,zh=0,Tn=0,$r=0,pa=null,hn=null,Vh=!1,lc=0,a0=0,cc=1/0,uc=null,os=null,Mt=0,as=null,Xr=null,Ii=0,Hh=0,jh=null,l0=null,ga=0,Wh=null;function Sn(){return(Ke&2)!==0&&ze!==0?ze&-ze:S.T!==null?Kh():Am()}function c0(){if(Tn===0)if((ze&536870912)===0||je){var r=yl;yl<<=1,(yl&3932160)===0&&(yl=262144),Tn=r}else Tn=536870912;return r=bn.current,r!==null&&(r.flags|=32),Tn}function dn(r,a,u){(r===ot&&(Je===2||Je===9)||r.cancelPendingCommit!==null)&&(qr(r,0),ls(r,ze,Tn,!1)),Bo(r,u),((Ke&2)===0||r!==ot)&&(r===ot&&((Ke&2)===0&&(qs|=u),_t===4&&ls(r,ze,Tn,!1)),si(r))}function u0(r,a,u){if((Ke&6)!==0)throw Error(i(327));var h=!u&&(a&127)===0&&(a&r.expiredLanes)===0||ko(r,a),g=h?YS(r,a):Xh(r,a,!0),_=h;do{if(g===0){Wr&&!h&&ls(r,a,0,!1);break}else{if(u=r.current.alternate,_&&!XS(u)){g=Xh(r,a,!1),_=!1;continue}if(g===2){if(_=a,r.errorRecoveryDisabledLanes&_)var v=0;else v=r.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){a=v;e:{var A=r;g=pa;var N=A.current.memoizedState.isDehydrated;if(N&&(qr(A,v).flags|=256),v=Xh(A,v,!1),v!==2){if(Fh&&!N){A.errorRecoveryDisabledLanes|=_,qs|=_,g=4;break e}_=hn,hn=g,_!==null&&(hn===null?hn=_:hn.push.apply(hn,_))}g=v}if(_=!1,g!==2)continue}}if(g===1){qr(r,0),ls(r,a,0,!0);break}e:{switch(h=r,_=g,_){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:ls(h,a,Tn,!ss);break e;case 2:hn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(g=lc+300-ct(),10<g)){if(ls(h,a,Tn,!ss),vl(h,0,!0)!==0)break e;Ii=a,h.timeoutHandle=V0(f0.bind(null,h,u,hn,uc,Vh,a,Tn,qs,$r,ss,_,"Throttled",-0,0),g);break e}f0(h,u,hn,uc,Vh,a,Tn,qs,$r,ss,_,null,-0,0)}}break}while(!0);si(r)}function f0(r,a,u,h,g,_,v,A,N,Y,J,se,Z,Q){if(r.timeoutHandle=-1,se=a.subtreeFlags,se&8192||(se&16785408)===16785408){se={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:_i},i0(a,_,se);var _e=(_&62914560)===_?lc-ct():(_&4194048)===_?a0-ct():0;if(_e=OA(se,_e),_e!==null){Ii=_,r.cancelPendingCommit=_e(b0.bind(null,r,a,_,u,h,g,v,A,N,J,se,null,Z,Q)),ls(r,_,v,!Y);return}}b0(r,a,_,u,h,g,v,A,N)}function XS(r){for(var a=r;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var h=0;h<u.length;h++){var g=u[h],_=g.getSnapshot;g=g.value;try{if(!_n(_(),g))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ls(r,a,u,h){a&=~zh,a&=~qs,r.suspendedLanes|=a,r.pingedLanes&=~a,h&&(r.warmLanes|=a),h=r.expirationTimes;for(var g=a;0<g;){var _=31-Dt(g),v=1<<_;h[_]=-1,g&=~v}u!==0&&xm(r,u,a)}function fc(){return(Ke&6)===0?(ma(0),!1):!0}function $h(){if(Ue!==null){if(Je===0)var r=Ue.return;else r=Ue,xi=Us=null,ah(r),Lr=null,Qo=0,r=Ue;for(;r!==null;)Hy(r.alternate,r),r=r.return;Ue=null}}function qr(r,a){var u=r.timeoutHandle;u!==-1&&(r.timeoutHandle=-1,hA(u)),u=r.cancelPendingCommit,u!==null&&(r.cancelPendingCommit=null,u()),Ii=0,$h(),ot=r,Ue=u=bi(r.current,null),ze=a,Je=0,xn=null,ss=!1,Wr=ko(r,a),Fh=!1,$r=Tn=zh=qs=rs=_t=0,hn=pa=null,Vh=!1,(a&8)!==0&&(a|=a&32);var h=r.entangledLanes;if(h!==0)for(r=r.entanglements,h&=a;0<h;){var g=31-Dt(h),_=1<<g;a|=r[g],h&=~_}return Pi=a,Il(),u}function h0(r,a){De=null,S.H=oa,a===Br||a===zl?(a=C_(),Je=3):a===Zf?(a=C_(),Je=4):Je=a===Sh?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,xn=a,Ue===null&&(_t=1,ec(r,In(a,r.current)))}function d0(){var r=bn.current;return r===null?!0:(ze&4194048)===ze?Bn===null:(ze&62914560)===ze||(ze&536870912)!==0?r===Bn:!1}function p0(){var r=S.H;return S.H=oa,r===null?oa:r}function g0(){var r=S.A;return S.A=WS,r}function hc(){_t=4,ss||(ze&4194048)!==ze&&bn.current!==null||(Wr=!0),(rs&134217727)===0&&(qs&134217727)===0||ot===null||ls(ot,ze,Tn,!1)}function Xh(r,a,u){var h=Ke;Ke|=2;var g=p0(),_=g0();(ot!==r||ze!==a)&&(uc=null,qr(r,a)),a=!1;var v=_t;e:do try{if(Je!==0&&Ue!==null){var A=Ue,N=xn;switch(Je){case 8:$h(),v=6;break e;case 3:case 2:case 9:case 6:bn.current===null&&(a=!0);var Y=Je;if(Je=0,xn=null,Yr(r,A,N,Y),u&&Wr){v=0;break e}break;default:Y=Je,Je=0,xn=null,Yr(r,A,N,Y)}}qS(),v=_t;break}catch(J){h0(r,J)}while(!0);return a&&r.shellSuspendCounter++,xi=Us=null,Ke=h,S.H=g,S.A=_,Ue===null&&(ot=null,ze=0,Il()),v}function qS(){for(;Ue!==null;)m0(Ue)}function YS(r,a){var u=Ke;Ke|=2;var h=p0(),g=g0();ot!==r||ze!==a?(uc=null,cc=ct()+500,qr(r,a)):Wr=ko(r,a);e:do try{if(Je!==0&&Ue!==null){a=Ue;var _=xn;t:switch(Je){case 1:Je=0,xn=null,Yr(r,a,_,1);break;case 2:case 9:if(E_(_)){Je=0,xn=null,_0(a);break}a=function(){Je!==2&&Je!==9||ot!==r||(Je=7),si(r)},_.then(a,a);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:E_(_)?(Je=0,xn=null,_0(a)):(Je=0,xn=null,Yr(r,a,_,7));break;case 5:var v=null;switch(Ue.tag){case 26:v=Ue.memoizedState;case 5:case 27:var A=Ue;if(v?nb(v):A.stateNode.complete){Je=0,xn=null;var N=A.sibling;if(N!==null)Ue=N;else{var Y=A.return;Y!==null?(Ue=Y,dc(Y)):Ue=null}break t}}Je=0,xn=null,Yr(r,a,_,5);break;case 6:Je=0,xn=null,Yr(r,a,_,6);break;case 8:$h(),_t=6;break e;default:throw Error(i(462))}}ZS();break}catch(J){h0(r,J)}while(!0);return xi=Us=null,S.H=h,S.A=g,Ke=u,Ue!==null?0:(ot=null,ze=0,Il(),_t)}function ZS(){for(;Ue!==null&&!on();)m0(Ue)}function m0(r){var a=zy(r.alternate,r,Pi);r.memoizedProps=r.pendingProps,a===null?dc(r):Ue=a}function _0(r){var a=r,u=a.alternate;switch(a.tag){case 15:case 0:a=Dy(u,a,a.pendingProps,a.type,void 0,ze);break;case 11:a=Dy(u,a,a.pendingProps,a.type.render,a.ref,ze);break;case 5:ah(a);default:Hy(u,a),a=Ue=g_(a,Pi),a=zy(u,a,Pi)}r.memoizedProps=r.pendingProps,a===null?dc(r):Ue=a}function Yr(r,a,u,h){xi=Us=null,ah(a),Lr=null,Qo=0;var g=a.return;try{if(LS(r,g,a,u,ze)){_t=1,ec(r,In(u,r.current)),Ue=null;return}}catch(_){if(g!==null)throw Ue=g,_;_t=1,ec(r,In(u,r.current)),Ue=null;return}a.flags&32768?(je||h===1?r=!0:Wr||(ze&536870912)!==0?r=!1:(ss=r=!0,(h===2||h===9||h===3||h===6)&&(h=bn.current,h!==null&&h.tag===13&&(h.flags|=16384))),y0(a,r)):dc(a)}function dc(r){var a=r;do{if((a.flags&32768)!==0){y0(a,ss);return}r=a.return;var u=zS(a.alternate,a,Pi);if(u!==null){Ue=u;return}if(a=a.sibling,a!==null){Ue=a;return}Ue=a=r}while(a!==null);_t===0&&(_t=5)}function y0(r,a){do{var u=VS(r.alternate,r);if(u!==null){u.flags&=32767,Ue=u;return}if(u=r.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(r=r.sibling,r!==null)){Ue=r;return}Ue=r=u}while(r!==null);_t=6,Ue=null}function b0(r,a,u,h,g,_,v,A,N){r.cancelPendingCommit=null;do pc();while(Mt!==0);if((Ke&6)!==0)throw Error(i(327));if(a!==null){if(a===r.current)throw Error(i(177));if(_=a.lanes|a.childLanes,_|=Df,CT(r,u,_,v,A,N),r===ot&&(Ue=ot=null,ze=0),Xr=a,as=r,Ii=u,Hh=_,jh=g,l0=h,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,JS(qe,function(){return A0(),null})):(r.callbackNode=null,r.callbackPriority=0),h=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||h){h=S.T,S.T=null,g=I.p,I.p=2,v=Ke,Ke|=4;try{HS(r,a,u)}finally{Ke=v,I.p=g,S.T=h}}Mt=1,v0(),x0(),T0()}}function v0(){if(Mt===1){Mt=0;var r=as,a=Xr,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=S.T,S.T=null;var h=I.p;I.p=2;var g=Ke;Ke|=4;try{e0(a,r);var _=sd,v=o_(r.containerInfo),A=_.focusedElem,N=_.selectionRange;if(v!==A&&A&&A.ownerDocument&&r_(A.ownerDocument.documentElement,A)){if(N!==null&&Mf(A)){var Y=N.start,J=N.end;if(J===void 0&&(J=Y),"selectionStart"in A)A.selectionStart=Y,A.selectionEnd=Math.min(J,A.value.length);else{var se=A.ownerDocument||document,Z=se&&se.defaultView||window;if(Z.getSelection){var Q=Z.getSelection(),_e=A.textContent.length,Ee=Math.min(N.start,_e),it=N.end===void 0?Ee:Math.min(N.end,_e);!Q.extend&&Ee>it&&(v=it,it=Ee,Ee=v);var H=s_(A,Ee),L=s_(A,it);if(H&&L&&(Q.rangeCount!==1||Q.anchorNode!==H.node||Q.anchorOffset!==H.offset||Q.focusNode!==L.node||Q.focusOffset!==L.offset)){var q=se.createRange();q.setStart(H.node,H.offset),Q.removeAllRanges(),Ee>it?(Q.addRange(q),Q.extend(L.node,L.offset)):(q.setEnd(L.node,L.offset),Q.addRange(q))}}}}for(se=[],Q=A;Q=Q.parentNode;)Q.nodeType===1&&se.push({element:Q,left:Q.scrollLeft,top:Q.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<se.length;A++){var te=se[A];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}Ec=!!id,sd=id=null}finally{Ke=g,I.p=h,S.T=u}}r.current=a,Mt=2}}function x0(){if(Mt===2){Mt=0;var r=as,a=Xr,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=S.T,S.T=null;var h=I.p;I.p=2;var g=Ke;Ke|=4;try{Zy(r,a.alternate,a)}finally{Ke=g,I.p=h,S.T=u}}Mt=3}}function T0(){if(Mt===4||Mt===3){Mt=0,Oe();var r=as,a=Xr,u=Ii,h=l0;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Mt=5:(Mt=0,Xr=as=null,S0(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(os=null),uf(u),a=a.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(Nt,a,void 0,(a.current.flags&128)===128)}catch{}if(h!==null){a=S.T,g=I.p,I.p=2,S.T=null;try{for(var _=r.onRecoverableError,v=0;v<h.length;v++){var A=h[v];_(A.value,{componentStack:A.stack})}}finally{S.T=a,I.p=g}}(Ii&3)!==0&&pc(),si(r),g=r.pendingLanes,(u&261930)!==0&&(g&42)!==0?r===Wh?ga++:(ga=0,Wh=r):ga=0,ma(0)}}function S0(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,Ko(a)))}function pc(){return v0(),x0(),T0(),A0()}function A0(){if(Mt!==5)return!1;var r=as,a=Hh;Hh=0;var u=uf(Ii),h=S.T,g=I.p;try{I.p=32>u?32:u,S.T=null,u=jh,jh=null;var _=as,v=Ii;if(Mt=0,Xr=as=null,Ii=0,(Ke&6)!==0)throw Error(i(331));var A=Ke;if(Ke|=4,r0(_.current),n0(_,_.current,v,u),Ke=A,ma(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(Nt,_)}catch{}return!0}finally{I.p=g,S.T=h,S0(r,a)}}function w0(r,a,u){a=In(u,a),a=Th(r.stateNode,a,2),r=es(r,a,2),r!==null&&(Bo(r,2),si(r))}function et(r,a,u){if(r.tag===3)w0(r,r,u);else for(;a!==null;){if(a.tag===3){w0(a,r,u);break}else if(a.tag===1){var h=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(os===null||!os.has(h))){r=In(u,r),u=Ey(2),h=es(a,u,2),h!==null&&(Ry(u,h,a,r),Bo(h,2),si(h));break}}a=a.return}}function qh(r,a,u){var h=r.pingCache;if(h===null){h=r.pingCache=new $S;var g=new Set;h.set(a,g)}else g=h.get(a),g===void 0&&(g=new Set,h.set(a,g));g.has(u)||(Fh=!0,g.add(u),r=KS.bind(null,r,a,u),a.then(r,r))}function KS(r,a,u){var h=r.pingCache;h!==null&&h.delete(a),r.pingedLanes|=r.suspendedLanes&u,r.warmLanes&=~u,ot===r&&(ze&u)===u&&(_t===4||_t===3&&(ze&62914560)===ze&&300>ct()-lc?(Ke&2)===0&&qr(r,0):zh|=u,$r===ze&&($r=0)),si(r)}function E0(r,a){a===0&&(a=vm()),r=ks(r,a),r!==null&&(Bo(r,a),si(r))}function GS(r){var a=r.memoizedState,u=0;a!==null&&(u=a.retryLane),E0(r,u)}function QS(r,a){var u=0;switch(r.tag){case 31:case 13:var h=r.stateNode,g=r.memoizedState;g!==null&&(u=g.retryLane);break;case 19:h=r.stateNode;break;case 22:h=r.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(a),E0(r,u)}function JS(r,a){return en(r,a)}var gc=null,Zr=null,Yh=!1,mc=!1,Zh=!1,cs=0;function si(r){r!==Zr&&r.next===null&&(Zr===null?gc=Zr=r:Zr=Zr.next=r),mc=!0,Yh||(Yh=!0,tA())}function ma(r,a){if(!Zh&&mc){Zh=!0;do for(var u=!1,h=gc;h!==null;){if(r!==0){var g=h.pendingLanes;if(g===0)var _=0;else{var v=h.suspendedLanes,A=h.pingedLanes;_=(1<<31-Dt(42|r)+1)-1,_&=g&~(v&~A),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(u=!0,O0(h,_))}else _=ze,_=vl(h,h===ot?_:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(_&3)===0||ko(h,_)||(u=!0,O0(h,_));h=h.next}while(u);Zh=!1}}function eA(){R0()}function R0(){mc=Yh=!1;var r=0;cs!==0&&fA()&&(r=cs);for(var a=ct(),u=null,h=gc;h!==null;){var g=h.next,_=C0(h,a);_===0?(h.next=null,u===null?gc=g:u.next=g,g===null&&(Zr=u)):(u=h,(r!==0||(_&3)!==0)&&(mc=!0)),h=g}Mt!==0&&Mt!==5||ma(r),cs!==0&&(cs=0)}function C0(r,a){for(var u=r.suspendedLanes,h=r.pingedLanes,g=r.expirationTimes,_=r.pendingLanes&-62914561;0<_;){var v=31-Dt(_),A=1<<v,N=g[v];N===-1?((A&u)===0||(A&h)!==0)&&(g[v]=RT(A,a)):N<=a&&(r.expiredLanes|=A),_&=~A}if(a=ot,u=ze,u=vl(r,r===a?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),h=r.callbackNode,u===0||r===a&&(Je===2||Je===9)||r.cancelPendingCommit!==null)return h!==null&&h!==null&&$e(h),r.callbackNode=null,r.callbackPriority=0;if((u&3)===0||ko(r,u)){if(a=u&-u,a===r.callbackPriority)return a;switch(h!==null&&$e(h),uf(u)){case 2:case 8:u=Pe;break;case 32:u=qe;break;case 268435456:u=mn;break;default:u=qe}return h=M0.bind(null,r),u=en(u,h),r.callbackPriority=a,r.callbackNode=u,a}return h!==null&&h!==null&&$e(h),r.callbackPriority=2,r.callbackNode=null,2}function M0(r,a){if(Mt!==0&&Mt!==5)return r.callbackNode=null,r.callbackPriority=0,null;var u=r.callbackNode;if(pc()&&r.callbackNode!==u)return null;var h=ze;return h=vl(r,r===ot?h:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),h===0?null:(u0(r,h,a),C0(r,ct()),r.callbackNode!=null&&r.callbackNode===u?M0.bind(null,r):null)}function O0(r,a){if(pc())return null;u0(r,a,!0)}function tA(){dA(function(){(Ke&6)!==0?en(No,eA):R0()})}function Kh(){if(cs===0){var r=Dr;r===0&&(r=_l,_l<<=1,(_l&261888)===0&&(_l=256)),cs=r}return cs}function P0(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Al(""+r)}function I0(r,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,r.id&&u.setAttribute("form",r.id),a.parentNode.insertBefore(u,a),r=new FormData(r),u.parentNode.removeChild(u),r}function nA(r,a,u,h,g){if(a==="submit"&&u&&u.stateNode===g){var _=P0((g[an]||null).action),v=h.submitter;v&&(a=(a=v[an]||null)?P0(a.formAction):v.getAttribute("formAction"),a!==null&&(_=a,v=null));var A=new Cl("action","action",null,h,g);r.push({event:A,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(cs!==0){var N=v?I0(g,v):new FormData(g);mh(u,{pending:!0,data:N,method:g.method,action:_},null,N)}}else typeof _=="function"&&(A.preventDefault(),N=v?I0(g,v):new FormData(g),mh(u,{pending:!0,data:N,method:g.method,action:_},_,N))},currentTarget:g}]})}}for(var Gh=0;Gh<Nf.length;Gh++){var Qh=Nf[Gh],iA=Qh.toLowerCase(),sA=Qh[0].toUpperCase()+Qh.slice(1);Xn(iA,"on"+sA)}Xn(c_,"onAnimationEnd"),Xn(u_,"onAnimationIteration"),Xn(f_,"onAnimationStart"),Xn("dblclick","onDoubleClick"),Xn("focusin","onFocus"),Xn("focusout","onBlur"),Xn(vS,"onTransitionRun"),Xn(xS,"onTransitionStart"),Xn(TS,"onTransitionCancel"),Xn(h_,"onTransitionEnd"),vr("onMouseEnter",["mouseout","mouseover"]),vr("onMouseLeave",["mouseout","mouseover"]),vr("onPointerEnter",["pointerout","pointerover"]),vr("onPointerLeave",["pointerout","pointerover"]),Ps("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ps("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ps("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ps("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ps("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ps("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _a="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_a));function N0(r,a){a=(a&4)!==0;for(var u=0;u<r.length;u++){var h=r[u],g=h.event;h=h.listeners;e:{var _=void 0;if(a)for(var v=h.length-1;0<=v;v--){var A=h[v],N=A.instance,Y=A.currentTarget;if(A=A.listener,N!==_&&g.isPropagationStopped())break e;_=A,g.currentTarget=Y;try{_(g)}catch(J){Pl(J)}g.currentTarget=null,_=N}else for(v=0;v<h.length;v++){if(A=h[v],N=A.instance,Y=A.currentTarget,A=A.listener,N!==_&&g.isPropagationStopped())break e;_=A,g.currentTarget=Y;try{_(g)}catch(J){Pl(J)}g.currentTarget=null,_=N}}}}function Fe(r,a){var u=a[ff];u===void 0&&(u=a[ff]=new Set);var h=r+"__bubble";u.has(h)||(D0(a,r,2,!1),u.add(h))}function Jh(r,a,u){var h=0;a&&(h|=4),D0(u,r,h,a)}var _c="_reactListening"+Math.random().toString(36).slice(2);function ed(r){if(!r[_c]){r[_c]=!0,Rm.forEach(function(u){u!=="selectionchange"&&(rA.has(u)||Jh(u,!1,r),Jh(u,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[_c]||(a[_c]=!0,Jh("selectionchange",!1,a))}}function D0(r,a,u,h){switch(cb(a)){case 2:var g=NA;break;case 8:g=DA;break;default:g=gd}u=g.bind(null,a,u,r),g=void 0,!vf||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),h?g!==void 0?r.addEventListener(a,u,{capture:!0,passive:g}):r.addEventListener(a,u,!0):g!==void 0?r.addEventListener(a,u,{passive:g}):r.addEventListener(a,u,!1)}function td(r,a,u,h,g){var _=h;if((a&1)===0&&(a&2)===0&&h!==null)e:for(;;){if(h===null)return;var v=h.tag;if(v===3||v===4){var A=h.stateNode.containerInfo;if(A===g)break;if(v===4)for(v=h.return;v!==null;){var N=v.tag;if((N===3||N===4)&&v.stateNode.containerInfo===g)return;v=v.return}for(;A!==null;){if(v=_r(A),v===null)return;if(N=v.tag,N===5||N===6||N===26||N===27){h=_=v;continue e}A=A.parentNode}}h=h.return}Fm(function(){var Y=_,J=yf(u),se=[];e:{var Z=d_.get(r);if(Z!==void 0){var Q=Cl,_e=r;switch(r){case"keypress":if(El(u)===0)break e;case"keydown":case"keyup":Q=QT;break;case"focusin":_e="focus",Q=Af;break;case"focusout":_e="blur",Q=Af;break;case"beforeblur":case"afterblur":Q=Af;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=Hm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=zT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=tS;break;case c_:case u_:case f_:Q=jT;break;case h_:Q=iS;break;case"scroll":case"scrollend":Q=UT;break;case"wheel":Q=rS;break;case"copy":case"cut":case"paste":Q=$T;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=Wm;break;case"toggle":case"beforetoggle":Q=aS}var Ee=(a&4)!==0,it=!Ee&&(r==="scroll"||r==="scrollend"),H=Ee?Z!==null?Z+"Capture":null:Z;Ee=[];for(var L=Y,q;L!==null;){var te=L;if(q=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||q===null||H===null||(te=Fo(L,H),te!=null&&Ee.push(ya(L,te,q))),it)break;L=L.return}0<Ee.length&&(Z=new Q(Z,_e,null,u,J),se.push({event:Z,listeners:Ee}))}}if((a&7)===0){e:{if(Z=r==="mouseover"||r==="pointerover",Q=r==="mouseout"||r==="pointerout",Z&&u!==_f&&(_e=u.relatedTarget||u.fromElement)&&(_r(_e)||_e[mr]))break e;if((Q||Z)&&(Z=J.window===J?J:(Z=J.ownerDocument)?Z.defaultView||Z.parentWindow:window,Q?(_e=u.relatedTarget||u.toElement,Q=Y,_e=_e?_r(_e):null,_e!==null&&(it=o(_e),Ee=_e.tag,_e!==it||Ee!==5&&Ee!==27&&Ee!==6)&&(_e=null)):(Q=null,_e=Y),Q!==_e)){if(Ee=Hm,te="onMouseLeave",H="onMouseEnter",L="mouse",(r==="pointerout"||r==="pointerover")&&(Ee=Wm,te="onPointerLeave",H="onPointerEnter",L="pointer"),it=Q==null?Z:Uo(Q),q=_e==null?Z:Uo(_e),Z=new Ee(te,L+"leave",Q,u,J),Z.target=it,Z.relatedTarget=q,te=null,_r(J)===Y&&(Ee=new Ee(H,L+"enter",_e,u,J),Ee.target=q,Ee.relatedTarget=it,te=Ee),it=te,Q&&_e)t:{for(Ee=oA,H=Q,L=_e,q=0,te=H;te;te=Ee(te))q++;te=0;for(var Ae=L;Ae;Ae=Ee(Ae))te++;for(;0<q-te;)H=Ee(H),q--;for(;0<te-q;)L=Ee(L),te--;for(;q--;){if(H===L||L!==null&&H===L.alternate){Ee=H;break t}H=Ee(H),L=Ee(L)}Ee=null}else Ee=null;Q!==null&&k0(se,Z,Q,Ee,!1),_e!==null&&it!==null&&k0(se,it,_e,Ee,!0)}}e:{if(Z=Y?Uo(Y):window,Q=Z.nodeName&&Z.nodeName.toLowerCase(),Q==="select"||Q==="input"&&Z.type==="file")var Ye=Qm;else if(Km(Z))if(Jm)Ye=_S;else{Ye=gS;var ve=pS}else Q=Z.nodeName,!Q||Q.toLowerCase()!=="input"||Z.type!=="checkbox"&&Z.type!=="radio"?Y&&mf(Y.elementType)&&(Ye=Qm):Ye=mS;if(Ye&&(Ye=Ye(r,Y))){Gm(se,Ye,u,J);break e}ve&&ve(r,Z,Y),r==="focusout"&&Y&&Z.type==="number"&&Y.memoizedProps.value!=null&&gf(Z,"number",Z.value)}switch(ve=Y?Uo(Y):window,r){case"focusin":(Km(ve)||ve.contentEditable==="true")&&(Er=ve,Of=Y,qo=null);break;case"focusout":qo=Of=Er=null;break;case"mousedown":Pf=!0;break;case"contextmenu":case"mouseup":case"dragend":Pf=!1,a_(se,u,J);break;case"selectionchange":if(bS)break;case"keydown":case"keyup":a_(se,u,J)}var ke;if(Ef)e:{switch(r){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else wr?Ym(r,u)&&(Ve="onCompositionEnd"):r==="keydown"&&u.keyCode===229&&(Ve="onCompositionStart");Ve&&($m&&u.locale!=="ko"&&(wr||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&wr&&(ke=zm()):(qi=J,xf="value"in qi?qi.value:qi.textContent,wr=!0)),ve=yc(Y,Ve),0<ve.length&&(Ve=new jm(Ve,r,null,u,J),se.push({event:Ve,listeners:ve}),ke?Ve.data=ke:(ke=Zm(u),ke!==null&&(Ve.data=ke)))),(ke=cS?uS(r,u):fS(r,u))&&(Ve=yc(Y,"onBeforeInput"),0<Ve.length&&(ve=new jm("onBeforeInput","beforeinput",null,u,J),se.push({event:ve,listeners:Ve}),ve.data=ke)),nA(se,r,Y,u,J)}N0(se,a)})}function ya(r,a,u){return{instance:r,listener:a,currentTarget:u}}function yc(r,a){for(var u=a+"Capture",h=[];r!==null;){var g=r,_=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||_===null||(g=Fo(r,u),g!=null&&h.unshift(ya(r,g,_)),g=Fo(r,a),g!=null&&h.push(ya(r,g,_))),r.tag===3)return h;r=r.return}return[]}function oA(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function k0(r,a,u,h,g){for(var _=a._reactName,v=[];u!==null&&u!==h;){var A=u,N=A.alternate,Y=A.stateNode;if(A=A.tag,N!==null&&N===h)break;A!==5&&A!==26&&A!==27||Y===null||(N=Y,g?(Y=Fo(u,_),Y!=null&&v.unshift(ya(u,Y,N))):g||(Y=Fo(u,_),Y!=null&&v.push(ya(u,Y,N)))),u=u.return}v.length!==0&&r.push({event:a,listeners:v})}var aA=/\r\n?/g,lA=/\u0000|\uFFFD/g;function B0(r){return(typeof r=="string"?r:""+r).replace(aA,`
`).replace(lA,"")}function L0(r,a){return a=B0(a),B0(r)===a}function nt(r,a,u,h,g,_){switch(u){case"children":typeof h=="string"?a==="body"||a==="textarea"&&h===""||Tr(r,h):(typeof h=="number"||typeof h=="bigint")&&a!=="body"&&Tr(r,""+h);break;case"className":Tl(r,"class",h);break;case"tabIndex":Tl(r,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Tl(r,u,h);break;case"style":Lm(r,h,_);break;case"data":if(a!=="object"){Tl(r,"data",h);break}case"src":case"href":if(h===""&&(a!=="a"||u!=="href")){r.removeAttribute(u);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){r.removeAttribute(u);break}h=Al(""+h),r.setAttribute(u,h);break;case"action":case"formAction":if(typeof h=="function"){r.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(u==="formAction"?(a!=="input"&&nt(r,a,"name",g.name,g,null),nt(r,a,"formEncType",g.formEncType,g,null),nt(r,a,"formMethod",g.formMethod,g,null),nt(r,a,"formTarget",g.formTarget,g,null)):(nt(r,a,"encType",g.encType,g,null),nt(r,a,"method",g.method,g,null),nt(r,a,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){r.removeAttribute(u);break}h=Al(""+h),r.setAttribute(u,h);break;case"onClick":h!=null&&(r.onclick=_i);break;case"onScroll":h!=null&&Fe("scroll",r);break;case"onScrollEnd":h!=null&&Fe("scrollend",r);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=u}}break;case"multiple":r.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":r.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){r.removeAttribute("xlink:href");break}u=Al(""+h),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(u,""+h):r.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(u,""):r.removeAttribute(u);break;case"capture":case"download":h===!0?r.setAttribute(u,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(u,h):r.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?r.setAttribute(u,h):r.removeAttribute(u);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?r.removeAttribute(u):r.setAttribute(u,h);break;case"popover":Fe("beforetoggle",r),Fe("toggle",r),xl(r,"popover",h);break;case"xlinkActuate":mi(r,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":mi(r,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":mi(r,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":mi(r,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":mi(r,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":mi(r,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":mi(r,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":mi(r,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":mi(r,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":xl(r,"is",h);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=BT.get(u)||u,xl(r,u,h))}}function nd(r,a,u,h,g,_){switch(u){case"style":Lm(r,h,_);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=u}}break;case"children":typeof h=="string"?Tr(r,h):(typeof h=="number"||typeof h=="bigint")&&Tr(r,""+h);break;case"onScroll":h!=null&&Fe("scroll",r);break;case"onScrollEnd":h!=null&&Fe("scrollend",r);break;case"onClick":h!=null&&(r.onclick=_i);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Cm.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(g=u.endsWith("Capture"),a=u.slice(2,g?u.length-7:void 0),_=r[an]||null,_=_!=null?_[u]:null,typeof _=="function"&&r.removeEventListener(a,_,g),typeof h=="function")){typeof _!="function"&&_!==null&&(u in r?r[u]=null:r.hasAttribute(u)&&r.removeAttribute(u)),r.addEventListener(a,h,g);break e}u in r?r[u]=h:h===!0?r.setAttribute(u,""):xl(r,u,h)}}}function jt(r,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Fe("error",r),Fe("load",r);var h=!1,g=!1,_;for(_ in u)if(u.hasOwnProperty(_)){var v=u[_];if(v!=null)switch(_){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:nt(r,a,_,v,u,null)}}g&&nt(r,a,"srcSet",u.srcSet,u,null),h&&nt(r,a,"src",u.src,u,null);return;case"input":Fe("invalid",r);var A=_=v=g=null,N=null,Y=null;for(h in u)if(u.hasOwnProperty(h)){var J=u[h];if(J!=null)switch(h){case"name":g=J;break;case"type":v=J;break;case"checked":N=J;break;case"defaultChecked":Y=J;break;case"value":_=J;break;case"defaultValue":A=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(137,a));break;default:nt(r,a,h,J,u,null)}}Nm(r,_,A,N,Y,v,g,!1);return;case"select":Fe("invalid",r),h=v=_=null;for(g in u)if(u.hasOwnProperty(g)&&(A=u[g],A!=null))switch(g){case"value":_=A;break;case"defaultValue":v=A;break;case"multiple":h=A;default:nt(r,a,g,A,u,null)}a=_,u=v,r.multiple=!!h,a!=null?xr(r,!!h,a,!1):u!=null&&xr(r,!!h,u,!0);return;case"textarea":Fe("invalid",r),_=g=h=null;for(v in u)if(u.hasOwnProperty(v)&&(A=u[v],A!=null))switch(v){case"value":h=A;break;case"defaultValue":g=A;break;case"children":_=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(i(91));break;default:nt(r,a,v,A,u,null)}km(r,h,g,_);return;case"option":for(N in u)u.hasOwnProperty(N)&&(h=u[N],h!=null)&&(N==="selected"?r.selected=h&&typeof h!="function"&&typeof h!="symbol":nt(r,a,N,h,u,null));return;case"dialog":Fe("beforetoggle",r),Fe("toggle",r),Fe("cancel",r),Fe("close",r);break;case"iframe":case"object":Fe("load",r);break;case"video":case"audio":for(h=0;h<_a.length;h++)Fe(_a[h],r);break;case"image":Fe("error",r),Fe("load",r);break;case"details":Fe("toggle",r);break;case"embed":case"source":case"link":Fe("error",r),Fe("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in u)if(u.hasOwnProperty(Y)&&(h=u[Y],h!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:nt(r,a,Y,h,u,null)}return;default:if(mf(a)){for(J in u)u.hasOwnProperty(J)&&(h=u[J],h!==void 0&&nd(r,a,J,h,u,void 0));return}}for(A in u)u.hasOwnProperty(A)&&(h=u[A],h!=null&&nt(r,a,A,h,u,null))}function cA(r,a,u,h){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,_=null,v=null,A=null,N=null,Y=null,J=null;for(Q in u){var se=u[Q];if(u.hasOwnProperty(Q)&&se!=null)switch(Q){case"checked":break;case"value":break;case"defaultValue":N=se;default:h.hasOwnProperty(Q)||nt(r,a,Q,null,h,se)}}for(var Z in h){var Q=h[Z];if(se=u[Z],h.hasOwnProperty(Z)&&(Q!=null||se!=null))switch(Z){case"type":_=Q;break;case"name":g=Q;break;case"checked":Y=Q;break;case"defaultChecked":J=Q;break;case"value":v=Q;break;case"defaultValue":A=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,a));break;default:Q!==se&&nt(r,a,Z,Q,h,se)}}pf(r,v,A,N,Y,J,_,g);return;case"select":Q=v=A=Z=null;for(_ in u)if(N=u[_],u.hasOwnProperty(_)&&N!=null)switch(_){case"value":break;case"multiple":Q=N;default:h.hasOwnProperty(_)||nt(r,a,_,null,h,N)}for(g in h)if(_=h[g],N=u[g],h.hasOwnProperty(g)&&(_!=null||N!=null))switch(g){case"value":Z=_;break;case"defaultValue":A=_;break;case"multiple":v=_;default:_!==N&&nt(r,a,g,_,h,N)}a=A,u=v,h=Q,Z!=null?xr(r,!!u,Z,!1):!!h!=!!u&&(a!=null?xr(r,!!u,a,!0):xr(r,!!u,u?[]:"",!1));return;case"textarea":Q=Z=null;for(A in u)if(g=u[A],u.hasOwnProperty(A)&&g!=null&&!h.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:nt(r,a,A,null,h,g)}for(v in h)if(g=h[v],_=u[v],h.hasOwnProperty(v)&&(g!=null||_!=null))switch(v){case"value":Z=g;break;case"defaultValue":Q=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==_&&nt(r,a,v,g,h,_)}Dm(r,Z,Q);return;case"option":for(var _e in u)Z=u[_e],u.hasOwnProperty(_e)&&Z!=null&&!h.hasOwnProperty(_e)&&(_e==="selected"?r.selected=!1:nt(r,a,_e,null,h,Z));for(N in h)Z=h[N],Q=u[N],h.hasOwnProperty(N)&&Z!==Q&&(Z!=null||Q!=null)&&(N==="selected"?r.selected=Z&&typeof Z!="function"&&typeof Z!="symbol":nt(r,a,N,Z,h,Q));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in u)Z=u[Ee],u.hasOwnProperty(Ee)&&Z!=null&&!h.hasOwnProperty(Ee)&&nt(r,a,Ee,null,h,Z);for(Y in h)if(Z=h[Y],Q=u[Y],h.hasOwnProperty(Y)&&Z!==Q&&(Z!=null||Q!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,a));break;default:nt(r,a,Y,Z,h,Q)}return;default:if(mf(a)){for(var it in u)Z=u[it],u.hasOwnProperty(it)&&Z!==void 0&&!h.hasOwnProperty(it)&&nd(r,a,it,void 0,h,Z);for(J in h)Z=h[J],Q=u[J],!h.hasOwnProperty(J)||Z===Q||Z===void 0&&Q===void 0||nd(r,a,J,Z,h,Q);return}}for(var H in u)Z=u[H],u.hasOwnProperty(H)&&Z!=null&&!h.hasOwnProperty(H)&&nt(r,a,H,null,h,Z);for(se in h)Z=h[se],Q=u[se],!h.hasOwnProperty(se)||Z===Q||Z==null&&Q==null||nt(r,a,se,Z,h,Q)}function U0(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function uA(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,u=performance.getEntriesByType("resource"),h=0;h<u.length;h++){var g=u[h],_=g.transferSize,v=g.initiatorType,A=g.duration;if(_&&A&&U0(v)){for(v=0,A=g.responseEnd,h+=1;h<u.length;h++){var N=u[h],Y=N.startTime;if(Y>A)break;var J=N.transferSize,se=N.initiatorType;J&&U0(se)&&(N=N.responseEnd,v+=J*(N<A?1:(A-Y)/(N-Y)))}if(--h,a+=8*(_+v)/(g.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var id=null,sd=null;function bc(r){return r.nodeType===9?r:r.ownerDocument}function F0(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function z0(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function rd(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var od=null;function fA(){var r=window.event;return r&&r.type==="popstate"?r===od?!1:(od=r,!0):(od=null,!1)}var V0=typeof setTimeout=="function"?setTimeout:void 0,hA=typeof clearTimeout=="function"?clearTimeout:void 0,H0=typeof Promise=="function"?Promise:void 0,dA=typeof queueMicrotask=="function"?queueMicrotask:typeof H0<"u"?function(r){return H0.resolve(null).then(r).catch(pA)}:V0;function pA(r){setTimeout(function(){throw r})}function us(r){return r==="head"}function j0(r,a){var u=a,h=0;do{var g=u.nextSibling;if(r.removeChild(u),g&&g.nodeType===8)if(u=g.data,u==="/$"||u==="/&"){if(h===0){r.removeChild(g),Jr(a);return}h--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")h++;else if(u==="html")ba(r.ownerDocument.documentElement);else if(u==="head"){u=r.ownerDocument.head,ba(u);for(var _=u.firstChild;_;){var v=_.nextSibling,A=_.nodeName;_[Lo]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&_.rel.toLowerCase()==="stylesheet"||u.removeChild(_),_=v}}else u==="body"&&ba(r.ownerDocument.body);u=g}while(u);Jr(a)}function W0(r,a){var u=r;r=0;do{var h=u.nextSibling;if(u.nodeType===1?a?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(a?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),h&&h.nodeType===8)if(u=h.data,u==="/$"){if(r===0)break;r--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||r++;u=h}while(u)}function ad(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":ad(u),hf(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}r.removeChild(u)}}function gA(r,a,u,h){for(;r.nodeType===1;){var g=u;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!h&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(h){if(!r[Lo])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(_=r.getAttribute("rel"),_==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(_!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(_=r.getAttribute("src"),(_!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&_&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var _=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===_)return r}else return r;if(r=Ln(r.nextSibling),r===null)break}return null}function mA(r,a,u){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!u||(r=Ln(r.nextSibling),r===null))return null;return r}function $0(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=Ln(r.nextSibling),r===null))return null;return r}function ld(r){return r.data==="$?"||r.data==="$~"}function cd(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function _A(r,a){var u=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||u.readyState!=="loading")a();else{var h=function(){a(),u.removeEventListener("DOMContentLoaded",h)};u.addEventListener("DOMContentLoaded",h),r._reactRetry=h}}function Ln(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var ud=null;function X0(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var u=r.data;if(u==="/$"||u==="/&"){if(a===0)return Ln(r.nextSibling);a--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||a++}r=r.nextSibling}return null}function q0(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var u=r.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(a===0)return r;a--}else u!=="/$"&&u!=="/&"||a++}r=r.previousSibling}return null}function Y0(r,a,u){switch(a=bc(u),r){case"html":if(r=a.documentElement,!r)throw Error(i(452));return r;case"head":if(r=a.head,!r)throw Error(i(453));return r;case"body":if(r=a.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function ba(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);hf(r)}var Un=new Map,Z0=new Set;function vc(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ni=I.d;I.d={f:yA,r:bA,D:vA,C:xA,L:TA,m:SA,X:wA,S:AA,M:EA};function yA(){var r=Ni.f(),a=fc();return r||a}function bA(r){var a=yr(r);a!==null&&a.tag===5&&a.type==="form"?hy(a):Ni.r(r)}var Kr=typeof document>"u"?null:document;function K0(r,a,u){var h=Kr;if(h&&typeof a=="string"&&a){var g=On(a);g='link[rel="'+r+'"][href="'+g+'"]',typeof u=="string"&&(g+='[crossorigin="'+u+'"]'),Z0.has(g)||(Z0.add(g),r={rel:r,crossOrigin:u,href:a},h.querySelector(g)===null&&(a=h.createElement("link"),jt(a,"link",r),kt(a),h.head.appendChild(a)))}}function vA(r){Ni.D(r),K0("dns-prefetch",r,null)}function xA(r,a){Ni.C(r,a),K0("preconnect",r,a)}function TA(r,a,u){Ni.L(r,a,u);var h=Kr;if(h&&r&&a){var g='link[rel="preload"][as="'+On(a)+'"]';a==="image"&&u&&u.imageSrcSet?(g+='[imagesrcset="'+On(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(g+='[imagesizes="'+On(u.imageSizes)+'"]')):g+='[href="'+On(r)+'"]';var _=g;switch(a){case"style":_=Gr(r);break;case"script":_=Qr(r)}Un.has(_)||(r=m({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:r,as:a},u),Un.set(_,r),h.querySelector(g)!==null||a==="style"&&h.querySelector(va(_))||a==="script"&&h.querySelector(xa(_))||(a=h.createElement("link"),jt(a,"link",r),kt(a),h.head.appendChild(a)))}}function SA(r,a){Ni.m(r,a);var u=Kr;if(u&&r){var h=a&&typeof a.as=="string"?a.as:"script",g='link[rel="modulepreload"][as="'+On(h)+'"][href="'+On(r)+'"]',_=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=Qr(r)}if(!Un.has(_)&&(r=m({rel:"modulepreload",href:r},a),Un.set(_,r),u.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(xa(_)))return}h=u.createElement("link"),jt(h,"link",r),kt(h),u.head.appendChild(h)}}}function AA(r,a,u){Ni.S(r,a,u);var h=Kr;if(h&&r){var g=br(h).hoistableStyles,_=Gr(r);a=a||"default";var v=g.get(_);if(!v){var A={loading:0,preload:null};if(v=h.querySelector(va(_)))A.loading=5;else{r=m({rel:"stylesheet",href:r,"data-precedence":a},u),(u=Un.get(_))&&fd(r,u);var N=v=h.createElement("link");kt(N),jt(N,"link",r),N._p=new Promise(function(Y,J){N.onload=Y,N.onerror=J}),N.addEventListener("load",function(){A.loading|=1}),N.addEventListener("error",function(){A.loading|=2}),A.loading|=4,xc(v,a,h)}v={type:"stylesheet",instance:v,count:1,state:A},g.set(_,v)}}}function wA(r,a){Ni.X(r,a);var u=Kr;if(u&&r){var h=br(u).hoistableScripts,g=Qr(r),_=h.get(g);_||(_=u.querySelector(xa(g)),_||(r=m({src:r,async:!0},a),(a=Un.get(g))&&hd(r,a),_=u.createElement("script"),kt(_),jt(_,"link",r),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},h.set(g,_))}}function EA(r,a){Ni.M(r,a);var u=Kr;if(u&&r){var h=br(u).hoistableScripts,g=Qr(r),_=h.get(g);_||(_=u.querySelector(xa(g)),_||(r=m({src:r,async:!0,type:"module"},a),(a=Un.get(g))&&hd(r,a),_=u.createElement("script"),kt(_),jt(_,"link",r),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},h.set(g,_))}}function G0(r,a,u,h){var g=(g=ye.current)?vc(g):null;if(!g)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=Gr(u.href),u=br(g).hoistableStyles,h=u.get(a),h||(h={type:"style",instance:null,count:0,state:null},u.set(a,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){r=Gr(u.href);var _=br(g).hoistableStyles,v=_.get(r);if(v||(g=g.ownerDocument||g,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(r,v),(_=g.querySelector(va(r)))&&!_._p&&(v.instance=_,v.state.loading=5),Un.has(r)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Un.set(r,u),_||RA(g,r,u,v.state))),a&&h===null)throw Error(i(528,""));return v}if(a&&h!==null)throw Error(i(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Qr(u),u=br(g).hoistableScripts,h=u.get(a),h||(h={type:"script",instance:null,count:0,state:null},u.set(a,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Gr(r){return'href="'+On(r)+'"'}function va(r){return'link[rel="stylesheet"]['+r+"]"}function Q0(r){return m({},r,{"data-precedence":r.precedence,precedence:null})}function RA(r,a,u,h){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?h.loading=1:(a=r.createElement("link"),h.preload=a,a.addEventListener("load",function(){return h.loading|=1}),a.addEventListener("error",function(){return h.loading|=2}),jt(a,"link",u),kt(a),r.head.appendChild(a))}function Qr(r){return'[src="'+On(r)+'"]'}function xa(r){return"script[async]"+r}function J0(r,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var h=r.querySelector('style[data-href~="'+On(u.href)+'"]');if(h)return a.instance=h,kt(h),h;var g=m({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return h=(r.ownerDocument||r).createElement("style"),kt(h),jt(h,"style",g),xc(h,u.precedence,r),a.instance=h;case"stylesheet":g=Gr(u.href);var _=r.querySelector(va(g));if(_)return a.state.loading|=4,a.instance=_,kt(_),_;h=Q0(u),(g=Un.get(g))&&fd(h,g),_=(r.ownerDocument||r).createElement("link"),kt(_);var v=_;return v._p=new Promise(function(A,N){v.onload=A,v.onerror=N}),jt(_,"link",h),a.state.loading|=4,xc(_,u.precedence,r),a.instance=_;case"script":return _=Qr(u.src),(g=r.querySelector(xa(_)))?(a.instance=g,kt(g),g):(h=u,(g=Un.get(_))&&(h=m({},u),hd(h,g)),r=r.ownerDocument||r,g=r.createElement("script"),kt(g),jt(g,"link",h),r.head.appendChild(g),a.instance=g);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(h=a.instance,a.state.loading|=4,xc(h,u.precedence,r));return a.instance}function xc(r,a,u){for(var h=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,_=g,v=0;v<h.length;v++){var A=h[v];if(A.dataset.precedence===a)_=A;else if(_!==g)break}_?_.parentNode.insertBefore(r,_.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(r,a.firstChild))}function fd(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function hd(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Tc=null;function eb(r,a,u){if(Tc===null){var h=new Map,g=Tc=new Map;g.set(u,h)}else g=Tc,h=g.get(u),h||(h=new Map,g.set(u,h));if(h.has(r))return h;for(h.set(r,null),u=u.getElementsByTagName(r),g=0;g<u.length;g++){var _=u[g];if(!(_[Lo]||_[Ft]||r==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var v=_.getAttribute(a)||"";v=r+v;var A=h.get(v);A?A.push(_):h.set(v,[_])}}return h}function tb(r,a,u){r=r.ownerDocument||r,r.head.insertBefore(u,a==="title"?r.querySelector("head > title"):null)}function CA(r,a,u){if(u===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(r=a.disabled,typeof a.precedence=="string"&&r==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function nb(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function MA(r,a,u,h){if(u.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var g=Gr(h.href),_=a.querySelector(va(g));if(_){a=_._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=Sc.bind(r),a.then(r,r)),u.state.loading|=4,u.instance=_,kt(_);return}_=a.ownerDocument||a,h=Q0(h),(g=Un.get(g))&&fd(h,g),_=_.createElement("link"),kt(_);var v=_;v._p=new Promise(function(A,N){v.onload=A,v.onerror=N}),jt(_,"link",h),u.instance=_}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(r.count++,u=Sc.bind(r),a.addEventListener("load",u),a.addEventListener("error",u))}}var dd=0;function OA(r,a){return r.stylesheets&&r.count===0&&wc(r,r.stylesheets),0<r.count||0<r.imgCount?function(u){var h=setTimeout(function(){if(r.stylesheets&&wc(r,r.stylesheets),r.unsuspend){var _=r.unsuspend;r.unsuspend=null,_()}},6e4+a);0<r.imgBytes&&dd===0&&(dd=62500*uA());var g=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&wc(r,r.stylesheets),r.unsuspend)){var _=r.unsuspend;r.unsuspend=null,_()}},(r.imgBytes>dd?50:800)+a);return r.unsuspend=u,function(){r.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function Sc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)wc(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Ac=null;function wc(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Ac=new Map,a.forEach(PA,r),Ac=null,Sc.call(r))}function PA(r,a){if(!(a.state.loading&4)){var u=Ac.get(r);if(u)var h=u.get(null);else{u=new Map,Ac.set(r,u);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<g.length;_++){var v=g[_];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(u.set(v.dataset.precedence,v),h=v)}h&&u.set(null,h)}g=a.instance,v=g.getAttribute("data-precedence"),_=u.get(v)||h,_===h&&u.set(null,g),u.set(v,g),this.count++,h=Sc.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),_?_.parentNode.insertBefore(g,_.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),a.state.loading|=4}}var Ta={$$typeof:M,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function IA(r,a,u,h,g,_,v,A,N){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=lf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lf(0),this.hiddenUpdates=lf(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=_,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=N,this.incompleteTransitions=new Map}function ib(r,a,u,h,g,_,v,A,N,Y,J,se){return r=new IA(r,a,u,v,N,Y,J,se,A),a=1,_===!0&&(a|=24),_=yn(3,null,null,a),r.current=_,_.stateNode=r,a=Xf(),a.refCount++,r.pooledCache=a,a.refCount++,_.memoizedState={element:h,isDehydrated:u,cache:a},Kf(_),r}function sb(r){return r?(r=Mr,r):Mr}function rb(r,a,u,h,g,_){g=sb(g),h.context===null?h.context=g:h.pendingContext=g,h=Ji(a),h.payload={element:u},_=_===void 0?null:_,_!==null&&(h.callback=_),u=es(r,h,a),u!==null&&(dn(u,r,a),ea(u,r,a))}function ob(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var u=r.retryLane;r.retryLane=u!==0&&u<a?u:a}}function pd(r,a){ob(r,a),(r=r.alternate)&&ob(r,a)}function ab(r){if(r.tag===13||r.tag===31){var a=ks(r,67108864);a!==null&&dn(a,r,67108864),pd(r,67108864)}}function lb(r){if(r.tag===13||r.tag===31){var a=Sn();a=cf(a);var u=ks(r,a);u!==null&&dn(u,r,a),pd(r,a)}}var Ec=!0;function NA(r,a,u,h){var g=S.T;S.T=null;var _=I.p;try{I.p=2,gd(r,a,u,h)}finally{I.p=_,S.T=g}}function DA(r,a,u,h){var g=S.T;S.T=null;var _=I.p;try{I.p=8,gd(r,a,u,h)}finally{I.p=_,S.T=g}}function gd(r,a,u,h){if(Ec){var g=md(h);if(g===null)td(r,a,h,Rc,u),ub(r,h);else if(BA(g,r,a,u,h))h.stopPropagation();else if(ub(r,h),a&4&&-1<kA.indexOf(r)){for(;g!==null;){var _=yr(g);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var v=Os(_.pendingLanes);if(v!==0){var A=_;for(A.pendingLanes|=2,A.entangledLanes|=2;v;){var N=1<<31-Dt(v);A.entanglements[1]|=N,v&=~N}si(_),(Ke&6)===0&&(cc=ct()+500,ma(0))}}break;case 31:case 13:A=ks(_,2),A!==null&&dn(A,_,2),fc(),pd(_,2)}if(_=md(h),_===null&&td(r,a,h,Rc,u),_===g)break;g=_}g!==null&&h.stopPropagation()}else td(r,a,h,null,u)}}function md(r){return r=yf(r),_d(r)}var Rc=null;function _d(r){if(Rc=null,r=_r(r),r!==null){var a=o(r);if(a===null)r=null;else{var u=a.tag;if(u===13){if(r=l(a),r!==null)return r;r=null}else if(u===31){if(r=c(a),r!==null)return r;r=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return Rc=r,null}function cb(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ms()){case No:return 2;case Pe:return 8;case qe:case ut:return 32;case mn:return 268435456;default:return 32}default:return 32}}var yd=!1,fs=null,hs=null,ds=null,Sa=new Map,Aa=new Map,ps=[],kA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ub(r,a){switch(r){case"focusin":case"focusout":fs=null;break;case"dragenter":case"dragleave":hs=null;break;case"mouseover":case"mouseout":ds=null;break;case"pointerover":case"pointerout":Sa.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Aa.delete(a.pointerId)}}function wa(r,a,u,h,g,_){return r===null||r.nativeEvent!==_?(r={blockedOn:a,domEventName:u,eventSystemFlags:h,nativeEvent:_,targetContainers:[g]},a!==null&&(a=yr(a),a!==null&&ab(a)),r):(r.eventSystemFlags|=h,a=r.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),r)}function BA(r,a,u,h,g){switch(a){case"focusin":return fs=wa(fs,r,a,u,h,g),!0;case"dragenter":return hs=wa(hs,r,a,u,h,g),!0;case"mouseover":return ds=wa(ds,r,a,u,h,g),!0;case"pointerover":var _=g.pointerId;return Sa.set(_,wa(Sa.get(_)||null,r,a,u,h,g)),!0;case"gotpointercapture":return _=g.pointerId,Aa.set(_,wa(Aa.get(_)||null,r,a,u,h,g)),!0}return!1}function fb(r){var a=_r(r.target);if(a!==null){var u=o(a);if(u!==null){if(a=u.tag,a===13){if(a=l(u),a!==null){r.blockedOn=a,wm(r.priority,function(){lb(u)});return}}else if(a===31){if(a=c(u),a!==null){r.blockedOn=a,wm(r.priority,function(){lb(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){r.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Cc(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var u=md(r.nativeEvent);if(u===null){u=r.nativeEvent;var h=new u.constructor(u.type,u);_f=h,u.target.dispatchEvent(h),_f=null}else return a=yr(u),a!==null&&ab(a),r.blockedOn=u,!1;a.shift()}return!0}function hb(r,a,u){Cc(r)&&u.delete(a)}function LA(){yd=!1,fs!==null&&Cc(fs)&&(fs=null),hs!==null&&Cc(hs)&&(hs=null),ds!==null&&Cc(ds)&&(ds=null),Sa.forEach(hb),Aa.forEach(hb)}function Mc(r,a){r.blockedOn===a&&(r.blockedOn=null,yd||(yd=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,LA)))}var Oc=null;function db(r){Oc!==r&&(Oc=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Oc===r&&(Oc=null);for(var a=0;a<r.length;a+=3){var u=r[a],h=r[a+1],g=r[a+2];if(typeof h!="function"){if(_d(h||u)===null)continue;break}var _=yr(u);_!==null&&(r.splice(a,3),a-=3,mh(_,{pending:!0,data:g,method:u.method,action:h},h,g))}}))}function Jr(r){function a(N){return Mc(N,r)}fs!==null&&Mc(fs,r),hs!==null&&Mc(hs,r),ds!==null&&Mc(ds,r),Sa.forEach(a),Aa.forEach(a);for(var u=0;u<ps.length;u++){var h=ps[u];h.blockedOn===r&&(h.blockedOn=null)}for(;0<ps.length&&(u=ps[0],u.blockedOn===null);)fb(u),u.blockedOn===null&&ps.shift();if(u=(r.ownerDocument||r).$$reactFormReplay,u!=null)for(h=0;h<u.length;h+=3){var g=u[h],_=u[h+1],v=g[an]||null;if(typeof _=="function")v||db(u);else if(v){var A=null;if(_&&_.hasAttribute("formAction")){if(g=_,v=_[an]||null)A=v.formAction;else if(_d(g)!==null)continue}else A=v.action;typeof A=="function"?u[h+1]=A:(u.splice(h,3),h-=3),db(u)}}}function pb(){function r(_){_.canIntercept&&_.info==="react-transition"&&_.intercept({handler:function(){return new Promise(function(v){return g=v})},focusReset:"manual",scroll:"manual"})}function a(){g!==null&&(g(),g=null),h||setTimeout(u,20)}function u(){if(!h&&!navigation.transition){var _=navigation.currentEntry;_&&_.url!=null&&navigation.navigate(_.url,{state:_.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(u,100),function(){h=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),g!==null&&(g(),g=null)}}}function bd(r){this._internalRoot=r}Pc.prototype.render=bd.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(i(409));var u=a.current,h=Sn();rb(u,h,r,a,null,null)},Pc.prototype.unmount=bd.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;rb(r.current,2,null,r,null,null),fc(),a[mr]=null}};function Pc(r){this._internalRoot=r}Pc.prototype.unstable_scheduleHydration=function(r){if(r){var a=Am();r={blockedOn:null,target:r,priority:a};for(var u=0;u<ps.length&&a!==0&&a<ps[u].priority;u++);ps.splice(u,0,r),u===0&&fb(r)}};var gb=e.version;if(gb!=="19.2.4")throw Error(i(527,gb,"19.2.4"));I.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=d(a),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var UA={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:S,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ic.isDisabled&&Ic.supportsFiber)try{Nt=Ic.inject(UA),Xt=Ic}catch{}}return Ra.createRoot=function(r,a){if(!s(r))throw Error(i(299));var u=!1,h="",g=Ty,_=Sy,v=Ay;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(_=a.onCaughtError),a.onRecoverableError!==void 0&&(v=a.onRecoverableError)),a=ib(r,1,!1,null,null,u,h,null,g,_,v,pb),r[mr]=a.current,ed(r),new bd(a)},Ra.hydrateRoot=function(r,a,u){if(!s(r))throw Error(i(299));var h=!1,g="",_=Ty,v=Sy,A=Ay,N=null;return u!=null&&(u.unstable_strictMode===!0&&(h=!0),u.identifierPrefix!==void 0&&(g=u.identifierPrefix),u.onUncaughtError!==void 0&&(_=u.onUncaughtError),u.onCaughtError!==void 0&&(v=u.onCaughtError),u.onRecoverableError!==void 0&&(A=u.onRecoverableError),u.formState!==void 0&&(N=u.formState)),a=ib(r,1,!0,a,u??null,h,g,N,_,v,A,pb),a.context=sb(null),u=a.current,h=Sn(),h=cf(h),g=Ji(h),g.callback=null,es(u,g,h),u=h,a.current.lanes=u,Bo(a,u),si(a),r[mr]=a.current,ed(r),new Pc(a)},Ra.version="19.2.4",Ra}var wb;function ZA(){if(wb)return Td.exports;wb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Td.exports=YA(),Td.exports}var KA=ZA();function xu(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const ug=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Eb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Eb&&parseFloat(Eb[1]);const Rb=globalThis,Cb=globalThis.process||{},GA=globalThis.navigator||{};function Ix(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function dr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Ix()}function QA(n){return dr()?Ix()?"Electron":(GA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Nx="4.1.1";function fg(n,e){if(!n)throw new Error("Assertion failed")}function Dx(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return fg(Number.isFinite(e)&&e>=0),e}function JA(n){const{logLevel:e,message:t}=n;n.logLevel=Dx(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return fg(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}const ao=()=>{};class ew{constructor({level:e=0}={}){this.userData={},this._onceCache=new Set,this._level=e}set level(e){this.setLevel(e)}get level(){return this.getLevel()}setLevel(e){return this._level=e,this}getLevel(){return this._level}warn(e,...t){return this._log("warn",0,e,t,{once:!0})}error(e,...t){return this._log("error",0,e,t)}log(e,t,...i){return this._log("log",e,t,i)}info(e,t,...i){return this._log("info",e,t,i)}once(e,t,...i){return this._log("once",e,t,i,{once:!0})}_log(e,t,i,s,o={}){const l=JA({logLevel:t,message:i,args:this._buildArgs(t,i,s),opts:o});return this._createLogFunction(e,l,o)}_buildArgs(e,t,i){return[e,t,...i]}_createLogFunction(e,t,i){if(!this._shouldLog(t.logLevel))return ao;const s=this._getOnceTag(i.tag??t.tag??t.message);if((i.once||t.once)&&s!==void 0){if(this._onceCache.has(s))return ao;this._onceCache.add(s)}return this._emit(e,t)}_shouldLog(e){return this.getLevel()>=Dx(e)}_getOnceTag(e){if(e!==void 0)try{return typeof e=="string"?e:String(e)}catch{return}}}function tw(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class nw{constructor(e,t,i="sessionStorage"){this.storage=tw(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function iw(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function sw(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Tu;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Tu||(Tu={}));const rw=10;function Mb(n){return typeof n!="string"?n:(n=n.toUpperCase(),Tu[n]||Tu.WHITE)}function ow(n,e,t){return!dr&&typeof n=="string"&&(e&&(n=`\x1B[${Mb(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Mb(t)+rw}m${n}\x1B[49m`)),n}function aw(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const o of i){const l=s[o];typeof l=="function"&&(e.find(c=>o===c)||(s[o]=l.bind(n)))}}function Ca(){let n;if(dr()&&Rb.performance)n=Rb?.performance?.now?.();else if("hrtime"in Cb){const e=Cb?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const eo={debug:dr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ed={enabled:!0,level:0};class cl extends ew{constructor({id:e}={id:""}){super({level:0}),this.VERSION=Nx,this._startTs=Ca(),this._deltaTs=Ca(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new nw(`__probe-${this.id}__`,{[this.id]:Ed}),this.timeStamp(`${this.id} started`),aw(this),Object.seal(this)}isEnabled(){return this._getConfiguration().enabled}getLevel(){return this._getConfiguration().level}getTotal(){return Number((Ca()-this._startTs).toPrecision(10))}getDelta(){return Number((Ca()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._updateConfiguration({enabled:e}),this}setLevel(e){return this._updateConfiguration({level:e}),this}get(e){return this._getConfiguration()[e]}set(e,t){this._updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e,...t){return this._log("warn",0,e,t,{method:eo.warn,once:!0})}error(e,...t){return this._log("error",0,e,t,{method:eo.error})}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t,...i){return this._log("log",e,t,i,{method:eo.log,time:!0,once:!0})}log(e,t,...i){return this._log("log",e,t,i,{method:eo.debug})}info(e,t,...i){return this._log("info",e,t,i,{method:console.info})}once(e,t,...i){return this._log("once",e,t,i,{method:eo.debug||eo.info,once:!0})}table(e,t,i){return t?this._log("table",e,t,i&&[i]||[],{method:console.table||ao,tag:cw(t)}):ao}time(e,t){return this._log("time",e,t,[],{method:console.time?console.time:console.info})}timeEnd(e,t){return this._log("time",e,t,[],{method:console.timeEnd?console.timeEnd:console.info})}timeStamp(e,t){return this._log("time",e,t,[],{method:console.timeStamp||ao})}group(e,t,i={collapsed:!1}){const s=(i.collapsed?console.groupCollapsed:console.group)||console.info;return this._log("group",e,t,[],{method:s})}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._log("groupEnd",e,"",[],{method:console.groupEnd||ao})}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&super._shouldLog(e)}_emit(e,t){const i=t.method;fg(i),t.total=this.getTotal(),t.delta=this.getDelta(),this._deltaTs=Ca();const s=lw(this.id,t.message,t);return i.bind(console,s,...t.args)}_getConfiguration(){return this._storage.config[this.id]||this._updateConfiguration(Ed),this._storage.config[this.id]}_updateConfiguration(e){const t=this._storage.config[this.id]||{...Ed};this._storage.setConfiguration({[this.id]:{...t,...e}})}}cl.VERSION=Nx;function lw(n,e,t){if(typeof e=="string"){const i=t.time?sw(iw(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=ow(e,t.color,t.background)}return e}function cw(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Rd="4.3.3",uw=Rd[0]>="0"&&Rd[0]<="9"?`v${Rd}`:"";function fw(){const n=new cl({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=uw,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const hw=fw();function dw(n,e){return kx(n||{},e)}function kx(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?i[s]=kx(i[s]||{},e[s],t+1):i[s]=e[s];return i}const pw="latest";function gw(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const mw=gw();function Cs(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const er=typeof process!="object"||String(process)!=="[object process]"||process.browser,_w=typeof window<"u"&&typeof window.orientation<"u",Ob=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ob&&parseFloat(Ob[1]);class yw{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Cs(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Cs(this.isRunning),this.isRunning=!1,this._reject(e)}}class Cd{terminate(){}}const Md=new Map;function bw(n){Cs(n.source&&!n.url||!n.source&&n.url);let e=Md.get(n.source||n.url);return e||(n.url&&(e=vw(n.url),Md.set(n.url,e)),n.source&&(e=Bx(n.source),Md.set(n.source,e))),Cs(e),e}function vw(n){if(!n.startsWith("http"))return n;const e=xw(n);return Bx(e)}function Bx(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function xw(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Lx(n,e=!0,t){const i=t||new Set;if(n){if(Pb(n))i.add(n);else if(Pb(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)Lx(n[s],e,i)}}return t===void 0?Array.from(i):[]}function Pb(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Od=()=>{};class yp{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&er||typeof Cd<"u"&&!er}constructor(e){const{name:t,source:i,url:s}=e;Cs(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=Od,this.onError=o=>console.log(o),this.worker=er?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Od,this.onError=Od,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||Lx(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=bw({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Cd(i,{eval:!1})}else if(this.source)e=new Cd(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class Tw{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return yp.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,o,l)=>s.done(l),i=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new yw(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!er||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new yp({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return _w?this.maxMobileConcurrency:this.maxConcurrency}}const Sw={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class xs{props;workerPools=new Map;static _workerFarm;static isSupported(){return yp.isSupported()}static getWorkerFarm(e={}){return xs._workerFarm=xs._workerFarm||new xs({}),xs._workerFarm.setProps(e),xs._workerFarm}constructor(e){this.props={...Sw},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let o=this.workerPools.get(t);return o||(o=new Tw({name:t,source:i,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function Aw(n,e={}){const t=e[n.id]||{},i=er?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(er?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let o=n.version;o==="latest"&&(o=pw);const l=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return Cs(s),s}function ww(n,e=mw){Cs(n,"no worker provided");const t=n.version;return!(!e||!t)}function Ew(n,e){return!xs.isSupported()||!er&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function Rw(n,e,t,i,s){const o=n.id,l=Aw(n,t),f=xs.getWorkerFarm(t).getWorkerPool({name:o,url:l});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await f.startJob("process-on-worker",Cw.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function Cw(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:o,options:l}=i;try{const c=await n(o,l);e.postMessage("done",{id:s,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:s,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Mw(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0}function Ow(...n){return Pw(n)}function Pw(n){const e=n.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,l)=>o+l.byteLength,0),i=new Uint8Array(t);let s=0;for(const o of e)i.set(o,s),s+=o.byteLength;return i.buffer}async function Iw(n){const e=[];for await(const t of n)e.push(t);return Ow(...e)}function Ib(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Nb{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Ib(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Ib()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ul{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof Nb?s=e:s=new Nb(t,i),this.stats[t]=s),s}}const Nw="Queued Requests",Dw="Active Requests",kw="Cancelled Requests",Bw="Queued Requests Ever",Lw="Active Requests Ever",Uw={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Fw{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...Uw,...e},this.stats=new ul({id:this.props.id}),this.stats.get(Nw),this.stats.get(Dw),this.stats.get(kw),this.stats.get(Bw),this.stats.get(Lw)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:t},s=new Promise(o=>(i.resolve=o,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:i}=e;let s=!1;const o=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let zw="";const Db={};function Vw(n){for(const e in Db)if(n.startsWith(e)){const t=Db[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${zw}${n}`),n}function Hw(n){return n&&typeof n=="object"&&n.isBuffer}function Ux(n){if(Hw(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Fx(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function jw(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const Ww=n=>typeof n=="boolean",ja=n=>typeof n=="function",fl=n=>n!==null&&typeof n=="object",kb=n=>fl(n)&&n.constructor==={}.constructor,$w=n=>!!n&&typeof n[Symbol.iterator]=="function",Xw=n=>n&&typeof n[Symbol.asyncIterator]=="function",pr=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,gr=n=>typeof Blob<"u"&&n instanceof Blob,qw=n=>n&&typeof n=="object"&&n.isBuffer,Yw=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||fl(n)&&ja(n.tee)&&ja(n.cancel)&&ja(n.getReader),Zw=n=>fl(n)&&ja(n.read)&&ja(n.pipe)&&Ww(n.readable),zx=n=>Yw(n)||Zw(n);class Kw extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const Gw=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qw=/^([-\w.]+\/[-\w.+]+)/;function Bb(n,e){return n.toLowerCase()===e.toLowerCase()}function Jw(n){const e=Qw.exec(n);return e?e[1]:n}function Lb(n){const e=Gw.exec(n);return e?e[1]:""}const Vx=/\?.*/;function eE(n){const e=n.match(Vx);return e&&e[0]}function hg(n){return n.replace(Vx,"")}function tE(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function ju(n){return pr(n)?n.url:gr(n)?n.name||"":typeof n=="string"?n:""}function dg(n){if(pr(n)){const e=n,t=e.headers.get("content-type")||"",i=hg(e.url);return Jw(t)||Lb(i)}return gr(n)?n.type||"":typeof n=="string"?Lb(n):""}function nE(n){return pr(n)?n.headers["content-length"]||-1:gr(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Hx(n){if(pr(n))return n;const e={},t=nE(n);t>=0&&(e["content-length"]=String(t));const i=ju(n),s=dg(n);s&&(e["content-type"]=s);const o=await rE(n);o&&(e["x-first-bytes"]=o),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function iE(n){if(!n.ok)throw await sE(n)}async function sE(n){const e=tE(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&s?.includes("application/json")?await n.json():await n.text()}catch{}return new Kw(t,i)}async function rE(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=o=>i(o?.target?.result),s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${oE(t)}`}return null}function oE(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function aE(n){return!lE(n)&&!cE(n)}function lE(n){return n.startsWith("http:")||n.startsWith("https:")}function cE(n){return n.startsWith("data:")}async function Ub(n,e){if(typeof n=="string"){const t=Vw(n);return aE(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await Hx(n)}const Fb=new cl({id:"loaders.gl"});class uE{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class fE{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const jx={fetch:null,mimeType:void 0,nothrow:!1,log:new fE,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ug,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hE={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Wx(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function $x(){const n=Wx();return n.globalOptions=n.globalOptions||{...jx},n.globalOptions}function dE(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],pE(n,t),mE(e,n,i)}function pE(n,e){zb(n,null,jx,hE,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};zb(i,t.id,s,o,e)}}function zb(n,e,t,i,s){const o=e||"Top level",l=e?`${e}.`:"";for(const c in n){const f=!e&&fl(n[c]),d=c==="baseUri"&&!e,p=c==="workerUrl"&&e;if(!(c in t)&&!d&&!p){if(c in i)Fb.warn(`${o} loader option '${l}${c}' no longer supported, use '${i[c]}'`)();else if(!f){const m=gE(c,s);Fb.warn(`${o} loader option '${l}${c}' not recognized. ${m}`)()}}}}function gE(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const o in s.options){if(n===o)return`Did you mean '${s.id}.${o}'?`;const l=o.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(i=i||`Did you mean '${s.id}.${o}'?`)}return i}function mE(n,e,t){const s={...n.options||{}};return _E(s,t),s.log===null&&(s.log=new uE),Vb(s,$x()),Vb(s,e),s}function Vb(n,e){for(const t in e)if(t in e){const i=e[t];kb(i)&&kb(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function _E(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function pg(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function gg(n){xu(n,"null loader"),xu(pg(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Xx=()=>{const n=Wx();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function yE(n){const e=Xx();n=Array.isArray(n)?n:[n];for(const t of n){const i=gg(t);e.find(s=>i===s)||e.unshift(i)}}function bE(){return Xx()}const vE=/\.([^.]+)$/;async function xE(n,e=[],t,i){if(!qx(n))return null;let s=Hb(n,e,{...t,nothrow:!0},i);if(s)return s;if(gr(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Hb(n,e,t,i)),!s&&!t?.nothrow)throw new Error(Yx(n));return s}function Hb(n,e=[],t,i){if(!qx(n))return null;if(e&&!Array.isArray(e))return gg(e);let s=[];e&&(s=s.concat(e)),t?.ignoreRegisteredLoaders||s.push(...bE()),SE(s);const o=TE(n,s,t,i);if(!o&&!t?.nothrow)throw new Error(Yx(n));return o}function TE(n,e,t,i){const s=ju(n),o=dg(n),l=hg(s)||i?.url;let c=null,f="";return t?.mimeType&&(c=Pd(e,t?.mimeType),f=`match forced by supplied MIME type ${t?.mimeType}`),c=c||AE(e,l),f=f||(c?`matched url ${l}`:""),c=c||Pd(e,o),f=f||(c?`matched MIME type ${o}`:""),c=c||EE(e,n),f=f||(c?`matched initial data ${Zx(n)}`:""),t?.fallbackMimeType&&(c=c||Pd(e,t?.fallbackMimeType),f=f||(c?`matched fallback MIME type ${o}`:"")),f&&hw.log(1,`selectLoader selected ${c?.name}: ${f}.`),c}function qx(n){return!(n instanceof Response&&n.status===204)}function Yx(n){const e=ju(n),t=dg(n);let i="No valid loader found (";i+=e?`${Fx(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?Zx(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function SE(n){for(const e of n)gg(e)}function AE(n,e){const t=e&&vE.exec(e),i=t&&t[1];return i?wE(n,i):null}function wE(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function Pd(n,e){for(const t of n)if(t.mimeTypes?.some(i=>Bb(e,i))||Bb(e,`application/x.${t.id}`))return t;return null}function EE(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(RE(e,t))return t}else if(ArrayBuffer.isView(e)){if(jb(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&jb(e,0,t))return t;return null}function RE(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function jb(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>CE(n,e,t,s))}function CE(n,e,t,i){if(i instanceof ArrayBuffer)return Mw(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=bp(n,e,i.length);return i===s;default:return!1}}function Zx(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?bp(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?bp(n,0,e):""}function bp(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let o=0;o<t;o++)s+=String.fromCharCode(i.getUint8(e+o));return s}const ME=256*1024;function*OE(n,e){const t=e?.chunkSize||ME;let i=0;const s=new TextEncoder;for(;i<n.length;){const o=Math.min(n.length-i,t),l=n.slice(i,i+o);i+=o,yield s.encode(l)}}const PE=256*1024;function*IE(n,e={}){const{chunkSize:t=PE}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),o=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(o).set(l),i+=s,yield o}}const NE=1024*1024;async function*DE(n,e){const t=e?.chunkSize||NE;let i=0;for(;i<n.size;){const s=i+t,o=await n.slice(i,s).arrayBuffer();i=s,yield o}}function Wb(n,e){return ug?kE(n,e):BE(n)}async function*kE(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:o,value:l}=await s;if(o)return;yield Ux(l)}}catch{t.releaseLock()}}async function*BE(n,e){for await(const t of n)yield Ux(t)}function LE(n,e){if(typeof n=="string")return OE(n,e);if(n instanceof ArrayBuffer)return IE(n,e);if(gr(n))return DE(n,e);if(zx(n))return Wb(n,e);if(pr(n))return Wb(n.body,e);throw new Error("makeIterator")}const Kx="Cannot convert supplied data type";function UE(n,e,t){if(e.text&&typeof n=="string")return n;if(qw(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(Kx)}async function FE(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return UE(n,e);if(gr(n)&&(n=await Hx(n)),pr(n)){const s=n;return await iE(s),e.binary?await s.arrayBuffer():await s.text()}if(zx(n)&&(n=LE(n,t)),$w(n)||Xw(n))return Iw(n);throw new Error(Kx)}function Gx(n,e){const t=$x(),i=n||t;return typeof i.fetch=="function"?i.fetch:fl(i.fetch)?s=>Ub(s,i.fetch):e?.fetch?e?.fetch:Ub}function zE(n,e,t){if(t)return t;const i={fetch:Gx(e,n),...n};if(i.url){const s=hg(i.url);i.baseUrl=s,i.queryString=eE(i.url),i.filename=Fx(s),i.baseUrl=jw(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function VE(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function Su(n,e,t,i){e&&!Array.isArray(e)&&!pg(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=ju(n),l=VE(e,i),c=await xE(n,l,t);return c?(t=dE(t,c,l,s),i=zE({url:s,_parse:Su,loaders:l},t,i||null),await HE(c,n,t,i)):null}async function HE(n,e,t,i){if(ww(n),t=dw(n.options,t),pr(e)){const o=e,{ok:l,redirected:c,status:f,statusText:d,type:p,url:m}=o,y=Object.fromEntries(o.headers.entries());i.response={headers:y,ok:l,redirected:c,status:f,statusText:d,type:p,url:m}}e=await FE(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(Ew(n,t))return await Rw(n,e,t,i,Su);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw Cs(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Au(n,e,t,i){let s,o;!Array.isArray(e)&&!pg(e)?(s=[],o=e):(s=e,o=t);const l=Gx(o);let c=n;return typeof n=="string"&&(c=await l(n)),gr(n)&&(c=await l(n)),Array.isArray(s)?await Su(c,s,o):await Su(c,s,o)}const jE="4.3.3",WE=globalThis.loaders?.parseImageNode,vp=typeof Image<"u",xp=typeof ImageBitmap<"u",$E=!!WE,Tp=ug?!0:$E;function XE(n){switch(n){case"auto":return xp||vp||Tp;case"imagebitmap":return xp;case"image":return vp;case"data":return Tp;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function qE(){if(xp)return"imagebitmap";if(vp)return"image";if(Tp)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function YE(n){const e=KE(n);if(!e)throw new Error("Not an image");return e}function ZE(n){switch(YE(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function KE(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const GE=/^data:image\/svg\+xml/,QE=/\.svg((\?|#).*)?$/;function mg(n){return n&&(GE.test(n)||QE.test(n))}function JE(n,e){if(mg(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return Qx(n,e)}function Qx(n,e){if(mg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Jx(n,e,t){const i=JE(n,t),s=self.URL||self.webkitURL,o=typeof i!="string"&&s.createObjectURL(i);try{return await eR(o||i,e)}finally{o&&s.revokeObjectURL(o)}}async function eR(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=o=>{const l=o instanceof Error?o.message:"error";s(new Error(l))}}catch(o){s(o)}})}const tR={};let $b=!0;async function nR(n,e,t){let i;mg(t)?i=await Jx(n,e,t):i=Qx(n,t);const s=e&&e.imagebitmap;return await iR(i,s)}async function iR(n,e=null){if((sR(e)||!$b)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),$b=!1}return await createImageBitmap(n)}function sR(n){for(const e in n||tR)return!1;return!0}function rR(n){return!cR(n,"ftyp",4)||(n[8]&96)===0?null:oR(n)}function oR(n){switch(aR(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function aR(n,e,t){return String.fromCharCode(...n.slice(e,t))}function lR(n){return[...n].map(e=>e.charCodeAt(0))}function cR(n,e,t=0){const i=lR(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const ci=!1,Wa=!0;function e2(n){const e=hl(n);return fR(e)||pR(e)||hR(e)||dR(e)||uR(e)}function uR(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=rR(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function fR(n){const e=hl(n);return e.byteLength>=24&&e.getUint32(0,ci)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ci),height:e.getUint32(20,ci)}:null}function hR(n){const e=hl(n);return e.byteLength>=10&&e.getUint32(0,ci)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Wa),height:e.getUint16(8,Wa)}:null}function dR(n){const e=hl(n);return e.byteLength>=14&&e.getUint16(0,ci)===16973&&e.getUint32(2,Wa)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Wa),height:e.getUint32(22,Wa)}:null}function pR(n){const e=hl(n);if(!(e.byteLength>=3&&e.getUint16(0,ci)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=gR();let o=2;for(;o+9<e.byteLength;){const l=e.getUint16(o,ci);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(o+5,ci),width:e.getUint16(o+7,ci)};if(!i.has(l))return null;o+=2,o+=e.getUint16(o,ci)}return null}function gR(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function hl(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function mR(n,e){const{mimeType:t}=e2(n)||{},i=globalThis.loaders?.parseImageNode;return xu(i),await i(n,t)}async function _R(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:o}=t||{},l=yR(s);let c;switch(l){case"imagebitmap":c=await nR(n,e,o);break;case"image":c=await Jx(n,e,o);break;case"data":c=await mR(n);break;default:xu(!1)}return s==="data"&&(c=ZE(c)),c}function yR(n){switch(n){case"auto":case"data":return qE();default:return XE(n),n}}const bR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],vR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],xR={image:{type:"auto",decode:!0}},TR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:jE,mimeTypes:vR,extensions:bR,parse:_R,tests:[n=>!!e2(new DataView(n))],options:xR},Le=new cl({id:"deck"});let Sp={};function SR(n){Sp=n}function Qt(n,e,t,i){Le.level>0&&Sp[n]&&Sp[n].call(null,e,t,i)}function AR(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const wR={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:AR,parseTextSync:JSON.parse};function ER(){const n="9.2.9",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(Le.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Le,_registerLoggers:SR},yE([wR,[TR,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const RR=ER();function _g(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Id={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function CR(n){const e={};for(const[t,i]of Object.entries(n))e[t]=MR(i);return e}function MR(n){let e=Xb(n);if(e!=="object")return{value:n,...Id[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Id[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=Xb(n.value),{...n,...Id[e],type:e}):{type:"object",value:null};throw new Error("props")}function Xb(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const OR=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,PR=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,IR={vertex:OR,fragment:PR},qb=/void\s+main\s*\([^)]*\)\s*\{\n?/,Yb=/}\n?[^{}]*$/,Nd=[],au="__LUMA_INJECT_DECLARATIONS__";function NR(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=DR(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function DR(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function wu(n,e,t,i=!1){const s=e==="vertex";for(const o in t){const l=t[o];l.sort((f,d)=>f.order-d.order),Nd.length=l.length;for(let f=0,d=l.length;f<d;++f)Nd[f]=l[f].injection;const c=`${Nd.join(`
`)}
`;switch(o){case"vs:#decl":s&&(n=n.replace(au,c));break;case"vs:#main-start":s&&(n=n.replace(qb,f=>f+c));break;case"vs:#main-end":s&&(n=n.replace(Yb,f=>c+f));break;case"fs:#decl":s||(n=n.replace(au,c));break;case"fs:#main-start":s||(n=n.replace(qb,f=>f+c));break;case"fs:#main-end":s||(n=n.replace(Yb,f=>c+f));break;default:n=n.replace(o,f=>f+c)}}return n=n.replace(au,""),i&&(n=n.replace(/\}\s*$/,o=>o+IR[e])),n}function Eu(n){n.map(e=>kR(e))}function kR(n){if(n.instance)return;Eu(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:NR(i),parsedDeprecations:BR(t)};e&&(s.propValidators=CR(e)),n.instance=s;let o={};e&&(o=Object.entries(e).reduce((l,[c,f])=>{const d=f?.value;return d&&(l[c]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...o}}function t2(n,e,t){n.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function BR(n){return n.forEach(e=>{e.type==="function"?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),n}function yg(n){Eu(n);const e={},t={};n2({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,o)=>t[o]-t[s]).map(s=>e[s]);return Eu(i),i}function n2(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)i[o.name]=o,(s[o.name]===void 0||s[o.name]<t)&&(s[o.name]=t);for(const o of e)o.dependencies&&n2({modules:o.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function LR(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function UR(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=Zb(n,FR),n;case"fragment":return n=Zb(n,zR),n;default:throw new Error(e)}}const i2=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],FR=[...i2,[Ap("attribute"),"in $1"],[Ap("varying"),"out $1"]],zR=[...i2,[Ap("varying"),"in $1"]];function Zb(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function Ap(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function s2(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const o=e[i];o.sort((l,c)=>l.order-c.order);for(const l of o)t+=`  ${l.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function r2(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[o,l]=s.split(":"),c=s.replace(/\(.+/,""),f=Object.assign(i,{signature:l});switch(o){case"vs":e.vertex[c]=f;break;case"fs":e.fragment[c]=f;break;default:throw new Error(o)}}return e}function VR(n,e){return{name:HR(n,e),language:"glsl",version:jR(n)}}function HR(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function jR(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const o2=`

${au}
`,WR=`precision highp float;
`;function $R(n){const e=yg(n.modules||[]);return{source:qR(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:a2(e)}}function XR(n){const{vs:e,fs:t}=n,i=yg(n.modules||[]);return{vs:Kb(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:Kb(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:a2(i)}}function qR(n,e){const{source:t,stage:i,modules:s,hookFunctions:o=[],inject:l={},log:c}=e;_g(typeof t=="string","shader source must be a string");const f=t;let d="";const p=r2(o),m={},y={},b={};for(const T in l){const R=typeof l[T]=="string"?{injection:l[T],order:0}:l[T],E=/^(v|f)s:(#)?([\w-]+)$/.exec(T);if(E){const B=E[2],M=E[3];B?M==="decl"?y[T]=[R]:b[T]=[R]:m[T]=[R]}else b[T]=[R]}const x=s;for(const T of x){c&&t2(T,f,c);const R=l2(T,"wgsl");d+=R;const E=T.injections?.[i]||{};for(const B in E){const M=/^(v|f)s:#([\w-]+)$/.exec(B);if(M){const F=M[2]==="decl"?y:b;F[B]=F[B]||[],F[B].push(E[B])}else m[B]=m[B]||[],m[B].push(E[B])}}return d+=o2,d=wu(d,i,y),d+=s2(p[i],m),d+=f,d=wu(d,i,b),d}function Kb(n,e){const{source:t,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:c=[],inject:f={},prologue:d=!0,log:p}=e;_g(typeof t=="string","shader source must be a string");const m=s==="glsl"?VR(t).version:-1,y=n.shaderLanguageVersion,b=m===100?"#version 100":"#version 300 es",T=t.split(`
`).slice(1).join(`
`),R={};o.forEach(W=>{Object.assign(R,W.defines)}),Object.assign(R,l);let E="";switch(s){case"wgsl":break;case"glsl":E=d?`${b}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${LR(n)}
${i==="fragment"?WR:""}

// ----- APPLICATION DEFINES -------------------------

${YR(R)}

`:`${b}
`;break}const B=r2(c),M={},D={},F={};for(const W in f){const ee=typeof f[W]=="string"?{injection:f[W],order:0}:f[W],ae=/^(v|f)s:(#)?([\w-]+)$/.exec(W);if(ae){const ne=ae[2],fe=ae[3];ne?fe==="decl"?D[W]=[ee]:F[W]=[ee]:M[W]=[ee]}else F[W]=[ee]}for(const W of o){p&&t2(W,T,p);const ee=l2(W,i);E+=ee;const ae=W.instance?.normalizedInjections[i]||{};for(const ne in ae){const fe=/^(v|f)s:#([\w-]+)$/.exec(ne);if(fe){const ge=fe[2]==="decl"?D:F;ge[ne]=ge[ne]||[],ge[ne].push(ae[ne])}else M[ne]=M[ne]||[],M[ne].push(ae[ne])}}return E+="// ----- MAIN SHADER SOURCE -------------------------",E+=o2,E=wu(E,i,D),E+=s2(B[i],M),E+=T,E=wu(E,i,F),s==="glsl"&&m!==y&&(E=UR(E,i)),E.trim()}function a2(n){return function(t){const i={};for(const s of n){const o=s.getUniforms?.(t,i);Object.assign(i,o)}return i}}function YR(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function l2(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:_g(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const ZR=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,KR=/^\s*\#\s*endif\s*$/;function GR(n,e){const t=n.split(`
`),i=[];let s=!0,o=null;for(const l of t){const c=l.match(ZR),f=l.match(KR);c?(o=c[1],s=!!e?.defines?.[o]):f?s=!0:s&&i.push(l)}return i.join(`
`)}class Gs{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Gs.defaultShaderAssembler=Gs.defaultShaderAssembler||new Gs,Gs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:o}=$R({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?GR(s):s,getUniforms:o,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...XR({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let o=0,l=this._defaultModules.length;o<l;++o){const c=this._defaultModules[o],f=c.name;t[s++]=c,i[f]=!0}for(let o=0,l=e.length;o<l;++o){const c=e[o],f=c.name;i[f]||(t[s++]=c,i[f]=!0)}return t.length=s,Eu(t),t}}const QR=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,JR=`#version 300 es
${QR}`;function eC(n){const{input:e,inputChannels:t,output:i}={};if(!e)return JR;if(!t)throw new Error("inputChannels");const s=tC(t),o=nC(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${o};
}`}function tC(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function nC(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class iC{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ul({id:e})),this.stats.get(e)}}const c2=new iC,oe=new cl({id:"luma.gl"}),Dd={};function Wu(n="id"){Dd[n]=Dd[n]||1;const e=Dd[n]++;return`${n}-${e}`}let rt=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=sC(t,i);const s=this.props.id!=="undefined"?this.props.id:Wu(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function sC(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}class lt extends rt{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&lt.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array?i.indexType="uint16":t.data instanceof Uint8Array&&(i.indexType="uint8")),delete i.data,super(e,i,lt.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const s=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:i,lt.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):t===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(t,t+o)}static defaultProps={...rt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function u2(n){const[e,t,i]=xg[n],s=n.includes("norm"),o=!s&&!n.startsWith("float"),l=n.startsWith("s");return{signedType:e,primitiveType:t,byteLength:i,normalized:s,integer:o,signed:l}}function rC(n){const e=n;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function oC(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}function bg(n){const e=ArrayBuffer.isView(n)?n.constructor:n;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(xg).find(i=>e===i[4]);if(!t)throw new Error(e.name);return t[0]}function vg(n){const[,,,,e]=xg[n];return e}const xg={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Tg(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,o=i?parseInt(i):1,l=u2(s),c={type:s,components:o,byteLength:l.byteLength*o,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(c.webglOnly=!0),c}function aC(n,e,t){const i=t?rC(n):n;switch(i){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${i}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${i}x${e}`;default:return e===1?i:`${i}x${e}`}}function lC(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e,s=bg(n);return aC(s,i,t)}function cC(n){let e;switch(n.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return n.components<=2?"float16x2":"float16x4"}return n.components===1?e:`${e}x${n.components}`}const Yt="texture-compression-bc",st="texture-compression-astc",ri="texture-compression-etc2",uC="texture-compression-etc1-webgl",Nc="texture-compression-pvrtc-webgl",kd="texture-compression-atc-webgl",Dc="float32-renderable-webgl",Bd="float16-renderable-webgl",fC="rgb9e5ufloat-renderable-webgl",Ld="snorm8-renderable-webgl",Ma="norm16-renderable-webgl",Ud="snorm16-renderable-webgl",kc="float32-filterable",Gb="float16-filterable-webgl";function f2(n){const e=pC[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const hC={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Ld},rg8snorm:{render:Ld},"rgb8snorm-webgl":{},rgba8snorm:{render:Ld},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Ma},rg16unorm:{render:Ma},"rgb16unorm-webgl":{f:Ma},rgba16unorm:{render:Ma},r16snorm:{f:Ud},rg16snorm:{render:Ud},"rgb16snorm-webgl":{f:Ma},rgba16snorm:{render:Ud},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Bd,filter:"float16-filterable-webgl"},rg16float:{render:Bd,filter:Gb},rgba16float:{render:Bd,filter:Gb},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Dc,filter:kc},rg32float:{render:!1,filter:kc},"rgb32float-webgl":{render:Dc,filter:kc},rgba32float:{render:Dc,filter:kc},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:fC},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Dc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},dC={"bc1-rgb-unorm-webgl":{f:Yt},"bc1-rgb-unorm-srgb-webgl":{f:Yt},"bc1-rgba-unorm":{f:Yt},"bc1-rgba-unorm-srgb":{f:Yt},"bc2-rgba-unorm":{f:Yt},"bc2-rgba-unorm-srgb":{f:Yt},"bc3-rgba-unorm":{f:Yt},"bc3-rgba-unorm-srgb":{f:Yt},"bc4-r-unorm":{f:Yt},"bc4-r-snorm":{f:Yt},"bc5-rg-unorm":{f:Yt},"bc5-rg-snorm":{f:Yt},"bc6h-rgb-ufloat":{f:Yt},"bc6h-rgb-float":{f:Yt},"bc7-rgba-unorm":{f:Yt},"bc7-rgba-unorm-srgb":{f:Yt},"etc2-rgb8unorm":{f:ri},"etc2-rgb8unorm-srgb":{f:ri},"etc2-rgb8a1unorm":{f:ri},"etc2-rgb8a1unorm-srgb":{f:ri},"etc2-rgba8unorm":{f:ri},"etc2-rgba8unorm-srgb":{f:ri},"eac-r11unorm":{f:ri},"eac-r11snorm":{f:ri},"eac-rg11unorm":{f:ri},"eac-rg11snorm":{f:ri},"astc-4x4-unorm":{f:st},"astc-4x4-unorm-srgb":{f:st},"astc-5x4-unorm":{f:st},"astc-5x4-unorm-srgb":{f:st},"astc-5x5-unorm":{f:st},"astc-5x5-unorm-srgb":{f:st},"astc-6x5-unorm":{f:st},"astc-6x5-unorm-srgb":{f:st},"astc-6x6-unorm":{f:st},"astc-6x6-unorm-srgb":{f:st},"astc-8x5-unorm":{f:st},"astc-8x5-unorm-srgb":{f:st},"astc-8x6-unorm":{f:st},"astc-8x6-unorm-srgb":{f:st},"astc-8x8-unorm":{f:st},"astc-8x8-unorm-srgb":{f:st},"astc-10x5-unorm":{f:st},"astc-10x5-unorm-srgb":{f:st},"astc-10x6-unorm":{f:st},"astc-10x6-unorm-srgb":{f:st},"astc-10x8-unorm":{f:st},"astc-10x8-unorm-srgb":{f:st},"astc-10x10-unorm":{f:st},"astc-10x10-unorm-srgb":{f:st},"astc-12x10-unorm":{f:st},"astc-12x10-unorm-srgb":{f:st},"astc-12x12-unorm":{f:st},"astc-12x12-unorm-srgb":{f:st},"pvrtc-rgb4unorm-webgl":{f:Nc},"pvrtc-rgba4unorm-webgl":{f:Nc},"pvrtc-rbg2unorm-webgl":{f:Nc},"pvrtc-rgba2unorm-webgl":{f:Nc},"etc1-rbg-unorm-webgl":{f:uC},"atc-rgb-unorm-webgl":{f:kd},"atc-rgba-unorm-webgl":{f:kd},"atc-rgbai-unorm-webgl":{f:kd}},pC={...hC,...dC},gC=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],mC=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class _C{getInfo(e){return Qb(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return gC.some(t=>e.startsWith(t))}getCapabilities(e){const t=f2(e),i={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},s=Qb(e),o=e.startsWith("depth")||e.startsWith("stencil"),l=s?.signed,c=s?.integer,f=s?.webgl;return i.render&&=!l,i.filter&&=!o&&!l&&!c&&!f,i}}const yo=new _C;function Qb(n){let e=yC(n);if(yo.isCompressed(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=bC(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=mC.exec(n);if(t){const[,i,s,o,l,c]=t,f=`${o}${s}`,d=u2(f),p=d.byteLength*8,m=i.length,y=[p,m>=2?p:0,m>=3?p:0,m>=4?p:0];e={format:n,attachment:e.attachment,dataType:d.signedType,components:m,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function yC(n){const e=f2(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function bC(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function vC(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}function xC(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}class TC{}class SC{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class rr{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[i,s]=e.getDevicePixelSize();oe.log(1,`${e} resized => ${i}x${s}px`)()},onPositionChange:(e,t)=>{const[i,s]=e.getPosition();oe.log(1,`${e} repositioned => ${i},${s}`)()},onVisibilityChange:e=>oe.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>oe.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:oe.get("debug")||void 0,debugShaders:oe.get("debug-shaders")||void 0,debugFramebuffers:!!oe.get("debug-framebuffers"),debugFactories:!!oe.get("debug-factories"),debugWebGL:!!oe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=c2;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...rr.defaultProps,...e},this.id=this.props.id||Wu(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return Tg(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return yo.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const i=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(i),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,i=1){const s=Math.max(e,t,i);return 1+Math.floor(Math.log2(s))}isExternalImage(e){return vC(e)}getExternalImageSize(e){return xC(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return yo.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...i){return this.props.onError(e,t)?()=>{}:oe.error(e.message,t,...i)}debug(){if(this.props.debug)debugger;else oe.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=yo.getCapabilities(e),i=o=>(typeof o=="string"?this.features.has(o):o)??!0,s=i(t.create);return{format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&lt.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":e.data instanceof Uint8Array&&(t.data=new Uint16Array(e.data),t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const AC="set luma.log.level=1 (or higher) to trace rendering",Jb="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Ru{static defaultProps={...rr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=c2;log=oe;VERSION="9.2.6";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw oe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),oe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");oe.error("This version of luma.gl has already been initialized")()}oe.log(1,`${this.VERSION} - ${AC}`)(),globalThis.luma=this}async createDevice(e={}){const t={...Ru.defaultProps,...e},i=this.selectAdapter(t.type,t.adapters);if(!i)throw new Error(Jb);return t.waitForPageLoad&&await i.pageLoaded,await i.create(t)}async attachDevice(e,t){const i=this._getTypeFromHandle(e,t.adapters),s=i&&this.selectAdapter(i,t.adapters);if(!s)throw new Error(Jb);return await s?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],i=this._getAdapterMap(e);for(const s of t)if(i.get(s)?.isSupported?.())return s;return null}selectAdapter(e,t=[]){let i=e;e==="best-available"&&(i=this.getBestAvailableAdapterType(t));const s=this._getAdapterMap(t);return i&&s.get(i)||null}enforceWebGL2(e=!0,t=[]){const s=this._getAdapterMap(t).get("webgl");s||oe.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(Ru.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?oe.warn("WebGL1 is not supported",e)():oe.warn("Unknown handle type",e)(),null)}}const wp=new Ru;class wC{get pageLoaded(){return CC()}}const EC=dr()&&typeof document<"u",RC=()=>EC&&document.readyState==="complete";let Bc=null;function CC(){return Bc||(RC()||typeof window>"u"?Bc=Promise.resolve():Bc=new Promise(n=>window.addEventListener("load",()=>n()))),Bc}function MC(){let n,e;return{promise:new Promise((i,s)=>{n=i,e=s}),resolve:n,reject:e}}class Qs{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=MC();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Qs.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,dr()?e.canvas?typeof e.canvas=="string"?this.canvas=PC(e.canvas):this.canvas=e.canvas:this.canvas=IC(e):this.canvas={width:e.width||1,height:e.height||1},Qs.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Qs.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Qs.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,o]=this.getDrawingBufferSize();return NC(e,i,s,o,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(s=>s.target===this.canvas);if(!t)return;const i=t.isIntersecting;this.isVisible!==i&&(this.isVisible=i,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(f=>f.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const i=this.getDevicePixelSize(),s=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,o=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[l,c]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,l)),this.devicePixelHeight=Math.max(1,Math.min(o,c)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:i})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const s=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:s})}}}}function OC(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}return n||document.body}function PC(n){const e=document.getElementById(n);if(!Qs.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function IC(n){const{width:e,height:t}=n,i=document.createElement("canvas");i.id=Wu("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",n?.visible||(i.style.visibility="hidden");const s=OC(n?.container||null);return s.insertBefore(i,s.firstChild),i}function NC(n,e,t,i,s){const o=n,l=ev(o[0],e,t);let c=tv(o[1],e,i,s),f=ev(o[0]+1,e,t);const d=f===t-1?f:f-1;f=tv(o[1]+1,e,i,s);let p;return s?(f=f===0?f:f+1,p=c,c=f):p=f===i-1?f:f-1,{x:l,y:c,width:Math.max(d-l+1,1),height:Math.max(p-c+1,1)}}function ev(n,e,t){return Math.min(Math.round(n*e),t-1)}function tv(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class or extends rt{static defaultProps={...rt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=or.normalizeProps(e,t),super(e,t,or.defaultProps)}static normalizeProps(e,t){return t}}const DC={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class It extends rt{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=It.normalizeProps(e,t),super(e,t,It.defaultProps),this.dimension=this.props.dimension,this.baseDimension=DC[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const i=e.getExternalImageSize(t.data);this.width=i?.width||1,this.height=i?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&oe.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof or?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const i={...t},{width:s,height:o}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(i.height=Math.max(1,Math.ceil(o))),i}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:i,depth:s}=this,o={...It.defaultCopyDataOptions,width:t,height:i,depth:s,...e},l=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!l.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return o.bytesPerRow=e.bytesPerRow||t*(l.bytesPerPixel||4),o.rowsPerImage=e.rowsPerImage||i,o}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),i={...It.defaultCopyExternalImageOptions,...t,...e};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}static defaultProps={...rt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:It.TEXTURE|It.RENDER_ATTACHMENT|It.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class $u extends rt{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,$u.defaultProps)}static defaultProps={...rt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function kC(n,e,t){let i="";const s=e.split(/\r?\n/),o=n.slice().sort((l,c)=>l.lineNum-c.lineNum);switch(t?.showSourceCode||"no"){case"all":let l=0;for(let c=1;c<=s.length;c++)for(i+=h2(s[c-1],c,t);o.length>l&&o[l].lineNum===c;){const f=o[l++];i+=Fd(f,s,f.lineNum,{...t,inlineSource:!1})}for(;o.length>l;){const c=o[l++];i+=Fd(c,[],0,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const c of n)i+=Fd(c,s,c.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function Fd(n,e,t,i){if(i?.inlineSource){const o=BC(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${o}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function BC(n,e,t){let i="";for(let s=e-2;s<=e;s++){const o=n[s-1];o!==void 0&&(i+=h2(o,e,t))}return i}function h2(n,e,t){const i=t?.html?UC(n):n;return`${LC(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function LC(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function UC(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Xu extends rt{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:FC(t),...t},Xu.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const i=t,s=`${this.stage} shader "${i}"`;let o=kC(e,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),c.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}static defaultProps={...rt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function FC(n){return zC(n.source)||n.id||Wu(`unnamed ${n.stage}-shader`)}function zC(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}class qu extends rt{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,qu.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(s=>s.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||i!==this.width,this.width=i,this.height=s}t&&(oe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const s=this.createColorTexture(t,i);return this.attachResource(s),s.view}return t instanceof It?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof It?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:It.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:It.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}static defaultProps={...rt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class tr extends rt{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,tr.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...rt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Ks extends rt{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Ks.normalizeProps(e,t),super(e,t,Ks.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...rt.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ks.defaultClearColor,clearColors:void 0,clearDepth:Ks.defaultClearDepth,clearStencil:Ks.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class Cu extends rt{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,Cu.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...rt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Sg extends rt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Sg.defaultProps)}static defaultProps={...rt.defaultProps,measureExecutionTime:void 0}}class Ag extends rt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Ag.defaultProps)}static defaultProps={...rt.defaultProps}}function d2(n){return WC[n]}function VC(n){const[e,t]=jC[n],i=e==="i32"||e==="u32",s=e!=="u32",o=HC[e]*t;return{primitiveType:e,components:t,byteLength:o,integer:i,signed:s}}const HC={f32:4,f16:2,i32:4,u32:4},jC={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},WC={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function p2(n,e){const t={};for(const i of n.attributes){const s=XC(n,e,i.name);s&&(t[i.name]=s)}return t}function $C(n,e,t=16){const i=p2(n,e),s=new Array(t).fill(null);for(const o of Object.values(i))s[o.location]=o;return s}function XC(n,e,t){const i=qC(n,t),s=YC(e,t);if(!i)return null;const o=VC(i.type),l=cC(o),c=s?.vertexFormat||l,f=Tg(c);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,primitiveType:o.primitiveType,shaderComponents:o.components,vertexFormat:c,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:o.integer,stepMode:s?.stepMode||i.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function qC(n,e){const t=n.attributes.find(i=>i.name===e);return t||oe.warn(`shader layout attribute "${e}" not present in shader`),t||null}function YC(n,e){ZC(n);let t=KC(n,e);return t||(t=GC(n,e),t)?t:(oe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function ZC(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&oe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function KC(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function GC(n,e){for(const t of n){let i=t.byteStride;if(typeof t.byteStride!="number")for(const o of t.attributes||[]){const l=Tg(o.format);i+=l.byteLength}const s=t.attributes?.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}class wg extends rt{static defaultProps={...rt.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,wg.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=$C(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class Eg extends rt{static defaultProps={...rt.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Eg.defaultProps)}}class Rg extends rt{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Rg.defaultProps)}static defaultProps={...rt.defaultProps,type:void 0,count:void 0}}let Lc;function g2(n){return(!Lc||Lc.byteLength<n)&&(Lc=new ArrayBuffer(n)),Lc}function QC(n,e){const t=g2(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function JC(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Mu(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":JC(n)}const eM=1024;class tM{layout={};byteLength;constructor(e,t={}){let i=0;for(const[o,l]of Object.entries(e)){const c=d2(l),{type:f,components:d}=c,p=d*(t?.[o]??1);i=oC(i,p);const m=i;i+=p,this.layout[o]={type:f,size:p,offset:m}}i+=(4-i%4)%4;const s=i*4;this.byteLength=Math.max(s,eM)}getData(e){const t=g2(this.byteLength),i={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){oe.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:c,size:f,offset:d}=l,p=i[c];if(f===1){if(typeof o!="number"&&typeof o!="boolean"){oe.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}p[d]=Number(o)}else{if(!Mu(o)){oe.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}p.set(o,d)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function nM(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!Mu(i))return!1;if(Mu(s)&&i.length===s.length){for(let o=0;o<i.length;++o)if(s[o]!==i[o])return!1}return!0}function iM(n){return Mu(n)?n.slice():n}class sM{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){nM(this.uniforms[e],t)||(this.uniforms[e]=iM(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class rM{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const s=t,o=new tM(i.uniformTypes??{},i.uniformSizes??{});this.uniformBufferLayouts.set(s,o);const l=new sM({name:t});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:lt.UNIFORM|lt.COPY_DST,byteLength:s}),l=this.getUniformBufferData(t);return o.write(l),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:lt.UNIFORM|lt.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&oe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&t?.needsRedraw){s||=t.needsRedraw;const o=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(o);const l=this.uniformBlocks.get(e)?.getAllUniforms();oe.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return s}}class zn{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class nv{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ts extends zn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ws extends zn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Ep extends zn{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class ar extends zn{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var vs;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(vs||(vs={}));class Uc{constructor(e,t,i,s,o,l,c){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=o,this.resourceType=l,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class oM{constructor(e,t){this.name=e,this.type=t}}class aM{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}}let iv=class{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}};class lM{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}class cM{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class uM{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class fM{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function hM(n){var e=(32768&n)>>15,t=(31744&n)>>10,i=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const m2=new Float32Array(1),dM=new Int32Array(m2.buffer),Zt=new Uint16Array(1);function pM(n){m2[0]=n;const e=dM[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return Zt[0]=t<<15|31744|(s!==0?512:0),Zt[0];if(i===0){if(s===0)return Zt[0]=t<<15,Zt[0];s|=8388608;let o=113;for(;!(8388608&s);)s<<=1,o--;return i=127-o,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Zt[0]=t<<15|i<<10|s>>13,Zt[0]):(Zt[0]=t<<15,Zt[0])}return i=i-127+15,i>=31?(Zt[0]=t<<15|31744,Zt[0]):i<=0?i<-10?(Zt[0]=t<<15,Zt[0]):(s=(8388608|s)>>1-i,Zt[0]=t<<15|s>>13,Zt[0]):(s>>=13,Zt[0]=t<<15|i<<10|s,Zt[0])}const Cg=new Uint32Array(1),_2=new Float32Array(Cg.buffer,0,1);function sv(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return Cg[0]=e,_2[0]}function gM(n,e,t,i,s,o,l,c,f){const d=i*(l>>=s)*(o>>=s)+t*l+e*c;switch(f){case"r8unorm":return[Ge(n,d,"8unorm",1)[0]];case"r8snorm":return[Ge(n,d,"8snorm",1)[0]];case"r8uint":return[Ge(n,d,"8uint",1)[0]];case"r8sint":return[Ge(n,d,"8sint",1)[0]];case"rg8unorm":{const p=Ge(n,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=Ge(n,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=Ge(n,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=Ge(n,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=Ge(n,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=Ge(n,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=Ge(n,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=Ge(n,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=Ge(n,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[Ge(n,d,"16uint",1)[0]];case"r16sint":return[Ge(n,d,"16sint",1)[0]];case"r16float":return[Ge(n,d,"16float",1)[0]];case"rg16uint":{const p=Ge(n,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=Ge(n,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=Ge(n,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=Ge(n,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=Ge(n,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=Ge(n,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[Ge(n,d,"32uint",1)[0]];case"r32sint":return[Ge(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ge(n,d,"32float",1)[0]];case"rg32uint":{const p=Ge(n,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=Ge(n,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=Ge(n,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=Ge(n,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=Ge(n,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=Ge(n,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,d,1)[0],m=(4192256&p)>>11,y=(4290772992&p)>>22;return[sv(2047&p),sv(m),(function(b){const x=112+(b>>5&31)<<23|(31&b)<<18;return Cg[0]=x,_2[0]})(y),1]}}return null}function Ge(n,e,t,i){const s=[0,0,0,0];for(let o=0;o<i;++o)switch(t){case"8unorm":s[o]=n[e]/255,e++;break;case"8snorm":s[o]=n[e]/255*2-1,e++;break;case"8uint":s[o]=n[e],e++;break;case"8sint":s[o]=n[e]-127,e++;break;case"16uint":s[o]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[o]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[o]=hM(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":s[o]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[o]=new Float32Array(n.buffer,e,1)[0],e+=4}return s}function Qe(n,e,t,i,s){for(let o=0;o<i;++o)switch(t){case"8unorm":n[e]=255*s[o],e++;break;case"8snorm":n[e]=.5*(s[o]+1)*255,e++;break;case"8uint":n[e]=s[o],e++;break;case"8sint":n[e]=s[o]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[o],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[o],e+=2;break;case"16float":{const l=pM(s[o]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[o],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[o],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[o],e+=4}return s}const zd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Wn{constructor(){this.id=Wn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Ou.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(Pu.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Wn._id=0;class Ou extends Wn{}Ou.instance=new Ou;class Pu extends Wn{}Pu.instance=new Pu;const y2=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class gt extends Wn{constructor(){super()}}let el=class extends gt{constructor(e,t,i,s,o,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=o,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}};class mM extends gt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class b2 extends gt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Rp extends gt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}let v2=class extends gt{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}};class Ui extends gt{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Mg extends gt{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class $a extends gt{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class lu extends gt{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var lo,Ba,$,z;(n=>{n.increment="++",n.decrement="--"})(lo||(lo={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(lo||(lo={}));class x2 extends gt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Ba||(Ba={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Ba||(Ba={}));class T2 extends gt{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Og extends gt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return y2.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class S2 extends gt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class A2 extends gt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class w2 extends gt{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class E2 extends gt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class _M extends gt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class yM extends gt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class R2 extends gt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Pg extends gt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class bM extends gt{constructor(){super()}get astNodeType(){return"discard"}}class C2 extends gt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class M2 extends gt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ie extends gt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=ie._priority.get(t.name);ie._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?ie.i32:t}getTypeName(){return this.name}}ie.x32=new ie("x32"),ie.f32=new ie("f32"),ie.i32=new ie("i32"),ie.u32=new ie("u32"),ie.f16=new ie("f16"),ie.bool=new ie("bool"),ie.void=new ie("void"),ie._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class rv extends ie{constructor(e){super(e)}}class Bi extends ie{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class j extends ie{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}j.vec2f=new j("vec2",ie.f32,null),j.vec3f=new j("vec3",ie.f32,null),j.vec4f=new j("vec4",ie.f32,null),j.vec2i=new j("vec2",ie.i32,null),j.vec3i=new j("vec3",ie.i32,null),j.vec4i=new j("vec4",ie.i32,null),j.vec2u=new j("vec2",ie.u32,null),j.vec3u=new j("vec3",ie.u32,null),j.vec4u=new j("vec4",ie.u32,null),j.vec2h=new j("vec2",ie.f16,null),j.vec3h=new j("vec3",ie.f16,null),j.vec4h=new j("vec4",ie.f16,null),j.vec2b=new j("vec2",ie.bool,null),j.vec3b=new j("vec3",ie.bool,null),j.vec4b=new j("vec4",ie.bool,null),j.mat2x2f=new j("mat2x2",ie.f32,null),j.mat2x3f=new j("mat2x3",ie.f32,null),j.mat2x4f=new j("mat2x4",ie.f32,null),j.mat3x2f=new j("mat3x2",ie.f32,null),j.mat3x3f=new j("mat3x3",ie.f32,null),j.mat3x4f=new j("mat3x4",ie.f32,null),j.mat4x2f=new j("mat4x2",ie.f32,null),j.mat4x3f=new j("mat4x3",ie.f32,null),j.mat4x4f=new j("mat4x4",ie.f32,null),j.mat2x2h=new j("mat2x2",ie.f16,null),j.mat2x3h=new j("mat2x3",ie.f16,null),j.mat2x4h=new j("mat2x4",ie.f16,null),j.mat3x2h=new j("mat3x2",ie.f16,null),j.mat3x3h=new j("mat3x3",ie.f16,null),j.mat3x4h=new j("mat3x4",ie.f16,null),j.mat4x2h=new j("mat4x2",ie.f16,null),j.mat4x3h=new j("mat4x3",ie.f16,null),j.mat4x4h=new j("mat4x4",ie.f16,null),j.mat2x2i=new j("mat2x2",ie.i32,null),j.mat2x3i=new j("mat2x3",ie.i32,null),j.mat2x4i=new j("mat2x4",ie.i32,null),j.mat3x2i=new j("mat3x2",ie.i32,null),j.mat3x3i=new j("mat3x3",ie.i32,null),j.mat3x4i=new j("mat3x4",ie.i32,null),j.mat4x2i=new j("mat4x2",ie.i32,null),j.mat4x3i=new j("mat4x3",ie.i32,null),j.mat4x4i=new j("mat4x4",ie.i32,null),j.mat2x2u=new j("mat2x2",ie.u32,null),j.mat2x3u=new j("mat2x3",ie.u32,null),j.mat2x4u=new j("mat2x4",ie.u32,null),j.mat3x2u=new j("mat3x2",ie.u32,null),j.mat3x3u=new j("mat3x3",ie.u32,null),j.mat3x4u=new j("mat3x4",ie.u32,null),j.mat4x2u=new j("mat4x2",ie.u32,null),j.mat4x3u=new j("mat4x3",ie.u32,null),j.mat4x4u=new j("mat4x4",ie.u32,null);class cu extends ie{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class Xa extends ie{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class La extends ie{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class ei extends Wn{constructor(){super(),this.postfix=null}}class lr extends ei{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class li extends ei{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Ig extends ei{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return y2.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class En extends ei{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class O2 extends ei{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class Ot extends ei{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof U}get isVector(){return this.value instanceof O||this.value instanceof Re}get scalarValue(){return this.value instanceof U?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof O||this.value instanceof Re?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class P2 extends ei{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class To extends ei{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class I2 extends ei{constructor(){super()}}class Rt extends I2{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Kn extends I2{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?ie.f32:e.name==="u32"||t.name==="u32"?ie.u32:ie.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class N2 extends Wn{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class uu extends ei{constructor(){super()}get astNodeType(){return"default"}}class D2 extends N2{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class k2 extends N2{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class ov extends Wn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class vM extends Wn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class av extends Wn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class B2 extends Wn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class jn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=jn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}jn._id=0;class Cp extends jn{constructor(){super(new zn("void",null),null)}toString(){return"void"}}Cp.void=new Cp;class to extends jn{constructor(e){super(new Ep("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class U extends jn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new U(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new U(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new U(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof U))return void console.error("SetDataValue: Invalid value",t);let o=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function xM(n,e,t){const i=e.length;return i===2?t==="f32"?new O(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new O(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new O(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new O(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new O(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new O(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new O(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new O(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new O(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new O(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new O(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new O(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class O extends jn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new O(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new O(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new O(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof lr?console.error("TODO: Set vector postfix"):t instanceof O?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof ar)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let o=this;for(;t!==null&&o!==null;){if(t instanceof To){const l=t.index;let c=-1;if(l instanceof Ot){if(!(l.value instanceof U))return console.error(`GetSubData: Invalid array index ${l.value}`),null;c=l.value.value}else{const f=e.evalExpression(l,i);if(!(f instanceof U))return console.error("GetSubData: Unknown index type",l),null;c=f.value}if(c<0||c>=o.data.length)return console.error("GetSubData: Index out of range",c),null;if(o.data instanceof Float32Array){const f=new Float32Array(o.data.buffer,o.data.byteOffset+4*c,1);return new U(f,s)}if(o.data instanceof Int32Array){const f=new Int32Array(o.data.buffer,o.data.byteOffset+4*c,1);return new U(f,s)}if(o.data instanceof Uint32Array){const f=new Uint32Array(o.data.buffer,o.data.byteOffset+4*c,1);return new U(f,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof lr))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;f=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new U(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new U(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new U(d,s,this)}}const c=[];for(const f of l)f==="x"||f==="r"?c.push(this.data[0]):f==="y"||f==="g"?c.push(this.data[1]):f==="z"||f==="b"?c.push(this.data[2]):f==="w"||f==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);o=xM(e,c,s.name)}t=t.postfix}return o}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Re extends jn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Re(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof lr?console.error("TODO: Set matrix postfix"):t instanceof Re?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof ar)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof To){const o=t.index;let l=-1;if(o instanceof Ot){if(!(o.value instanceof U))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;l=o.value.value}else{const d=e.evalExpression(o,i);if(!(d instanceof U))return console.error("GetDataValue: Unknown index type",o),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const c=s.endsWith("h")?"h":"f";let f;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")f=new O(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${c}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")f=new O(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${c}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;f=new O(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${c}`))}return t.postfix?f.getSubData(e,t.postfix,i):f}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class bt extends jn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new bt(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let o=this.offset,l=this.typeInfo;for(;i;){if(i instanceof To)if(l instanceof ws){const c=i.index;if(c instanceof Ot){if(!(c.value instanceof U))return void console.error(`SetDataValue: Invalid index type ${c.value}`);o+=c.value.value*l.stride}else{const f=e.evalExpression(c,s);if(!(f instanceof U))return void console.error("SetDataValue: Unknown index type",c);o+=f.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof lr))return void console.error("SetDataValue: Unknown postfix type",i);{const c=i.value;if(l instanceof Ts){let f=!1;for(const d of l.members)if(d.name===c){o+=d.offset,l=d.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${c} not found`)}else if(l instanceof zn){const f=l.getTypeName();let d=0;if(c==="x"||c==="r")d=0;else if(c==="y"||c==="g")d=1;else if(c==="z"||c==="b")d=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);d=3}if(!(t instanceof U))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return f==="vec2f"?void(new Float32Array(this.buffer,o,2)[d]=p):f==="vec3f"?void(new Float32Array(this.buffer,o,3)[d]=p):f==="vec4f"?void(new Float32Array(this.buffer,o,4)[d]=p):f==="vec2i"?void(new Int32Array(this.buffer,o,2)[d]=p):f==="vec3i"?void(new Int32Array(this.buffer,o,3)[d]=p):f==="vec4i"?void(new Int32Array(this.buffer,o,4)[d]=p):f==="vec2u"?void(new Uint32Array(this.buffer,o,2)[d]=p):f==="vec3u"?void(new Uint32Array(this.buffer,o,3)[d]=p):f==="vec4u"?void(new Uint32Array(this.buffer,o,4)[d]=p):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}i=i.postfix}this.setData(e,t,l,o,s)}setData(e,t,i,s,o){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool"){if(l==="vec2f"||l==="vec2h"){const c=new Float32Array(this.buffer,s,2);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1]))}if(l==="vec3f"||l==="vec3h"){const c=new Float32Array(this.buffer,s,3);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2]))}if(l==="vec4f"||l==="vec4h"){const c=new Float32Array(this.buffer,s,4);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3]))}if(l==="vec2i"){const c=new Int32Array(this.buffer,s,2);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1]))}if(l==="vec3i"){const c=new Int32Array(this.buffer,s,3);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2]))}if(l==="vec4i"){const c=new Int32Array(this.buffer,s,4);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3]))}if(l==="vec2u"){const c=new Uint32Array(this.buffer,s,2);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1]))}if(l==="vec3u"){const c=new Uint32Array(this.buffer,s,3);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2]))}if(l==="vec4u"){const c=new Uint32Array(this.buffer,s,4);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3]))}if(l==="vec2b"){const c=new Uint32Array(this.buffer,s,2);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1]))}if(l==="vec3b"){const c=new Uint32Array(this.buffer,s,3);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2]))}if(l==="vec4b"){const c=new Uint32Array(this.buffer,s,4);return void(t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3]))}if(l==="mat2x2f"||l==="mat2x2h"){const c=new Float32Array(this.buffer,s,4);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3]))}if(l==="mat2x3f"||l==="mat2x3h"){const c=new Float32Array(this.buffer,s,6);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5]))}if(l==="mat2x4f"||l==="mat2x4h"){const c=new Float32Array(this.buffer,s,8);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7]))}if(l==="mat3x2f"||l==="mat3x2h"){const c=new Float32Array(this.buffer,s,6);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5]))}if(l==="mat3x3f"||l==="mat3x3h"){const c=new Float32Array(this.buffer,s,9);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8]))}if(l==="mat3x4f"||l==="mat3x4h"){const c=new Float32Array(this.buffer,s,12);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11]))}if(l==="mat4x2f"||l==="mat4x2h"){const c=new Float32Array(this.buffer,s,8);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7]))}if(l==="mat4x3f"||l==="mat4x3h"){const c=new Float32Array(this.buffer,s,12);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11]))}if(l==="mat4x4f"||l==="mat4x4h"){const c=new Float32Array(this.buffer,s,16);return void(t instanceof Re?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11],c[12]=t.data[12],c[13]=t.data[13],c[14]=t.data[14],c[15]=t.data[15]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11],c[12]=t[12],c[13]=t[13],c[14]=t[14],c[15]=t[15]))}if(t instanceof bt){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`)}else t instanceof U&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,o,l;if(t===null)return this;let c=this.offset,f=this.typeInfo;for(;t;){if(t instanceof To){const p=t.index,m=p instanceof ei?e.evalExpression(p,i):p;let y=0;if(m instanceof U?y=m.value:typeof m=="number"?y=m:console.error("GetDataValue: Invalid index type",p),f instanceof ws)c+=y*f.stride,f=f.format;else{const b=f.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(c+=16*y,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(t instanceof lr))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(f instanceof Ts){let m=!1;for(const y of f.members)if(y.name===p){c+=y.offset,f=y.type,m=!0;break}if(!m)return console.error(`GetDataValue: Member ${p} not found`),null}else if(f instanceof zn){const m=f.getTypeName();if(m==="vec2f"||m==="vec3f"||m==="vec4f"||m==="vec2i"||m==="vec3i"||m==="vec4i"||m==="vec2u"||m==="vec3u"||m==="vec4u"||m==="vec2b"||m==="vec3b"||m==="vec4b"||m==="vec2h"||m==="vec3h"||m==="vec4h"||m==="vec2"||m==="vec3"||m==="vec4"){if(p.length>0&&p.length<5){let y="f";const b=[];for(let x=0;x<p.length;++x){const T=p[x].toLowerCase();let R=0;if(T==="x"||T==="r")R=0;else if(T==="y"||T==="g")R=1;else if(T==="z"||T==="b")R=2;else{if(T!=="w"&&T!=="a")return console.error(`Unknown member ${p}`),null;R=3}if(p.length===1){if(m.endsWith("f"))return this.buffer.byteLength<c+4*R+4?(console.log("Insufficient buffer data"),null):new U(new Float32Array(this.buffer,c+4*R,1),e.getTypeInfo("f32"),this);if(m.endsWith("h"))return new U(new Float32Array(this.buffer,c+4*R,1),e.getTypeInfo("f16"),this);if(m.endsWith("i"))return new U(new Int32Array(this.buffer,c+4*R,1),e.getTypeInfo("i32"),this);if(m.endsWith("b"))return new U(new Int32Array(this.buffer,c+4*R,1),e.getTypeInfo("bool"),this);if(m.endsWith("u"))return new U(new Uint32Array(this.buffer,c+4*R,1),e.getTypeInfo("i32"),this)}if(m==="vec2f")b.push(new Float32Array(this.buffer,c,2)[R]);else if(m==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const E=new Float32Array(this.buffer,c,3);b.push(E[R])}else if(m==="vec4f")b.push(new Float32Array(this.buffer,c,4)[R]);else if(m==="vec2i")y="i",b.push(new Int32Array(this.buffer,c,2)[R]);else if(m==="vec3i")y="i",b.push(new Int32Array(this.buffer,c,3)[R]);else if(m==="vec4i")y="i",b.push(new Int32Array(this.buffer,c,4)[R]);else if(m==="vec2u"){y="u";const E=new Uint32Array(this.buffer,c,2);b.push(E[R])}else m==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,c,3)[R])):m==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,c,4)[R]))}return b.length===2?f=e.getTypeInfo(`vec2${y}`):b.length===3?f=e.getTypeInfo(`vec3${y}`):b.length===4?f=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new O(b,f,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${m} is not a struct`),null}}}t=t.postfix}const d=f.getTypeName();return d==="f32"?new U(new Float32Array(this.buffer,c,1),f,this):d==="i32"?new U(new Int32Array(this.buffer,c,1),f,this):d==="u32"?new U(new Uint32Array(this.buffer,c,1),f,this):d==="vec2f"?new O(new Float32Array(this.buffer,c,2),f,this):d==="vec3f"?new O(new Float32Array(this.buffer,c,3),f,this):d==="vec4f"?new O(new Float32Array(this.buffer,c,4),f,this):d==="vec2i"?new O(new Int32Array(this.buffer,c,2),f,this):d==="vec3i"?new O(new Int32Array(this.buffer,c,3),f,this):d==="vec4i"?new O(new Int32Array(this.buffer,c,4),f,this):d==="vec2u"?new O(new Uint32Array(this.buffer,c,2),f,this):d==="vec3u"?new O(new Uint32Array(this.buffer,c,3),f,this):d==="vec4u"?new O(new Uint32Array(this.buffer,c,4),f,this):f instanceof ar&&f.name==="atomic"?((s=f.format)===null||s===void 0?void 0:s.name)==="u32"?new U(new Uint32Array(this.buffer,c,1)[0],f.format,this):((o=f.format)===null||o===void 0?void 0:o.name)==="i32"?new U(new Int32Array(this.buffer,c,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=f.format)===null||l===void 0?void 0:l.name}`),null):new bt(this.buffer,f,c,this)}toString(){let e="";if(this.typeInfo instanceof ws)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof Ts?e+="{...}":e="[...]";return e}}class Li extends jn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new Li(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=zd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=zd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=zd[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,o=this.depthOrArrayLayers,l=this.dimension;return i/t.blockWidth*(l==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*o}getPixel(e,t,i=0,s=0){const o=this.texelByteSize,l=this.bytesPerRow,c=this.height,f=this.data[s];return gM(new Uint8Array(f),e,t,i,s,c,l,o,this.format)}setPixel(e,t,i,s,o){const l=this.texelByteSize,c=this.bytesPerRow,f=this.height,d=this.data[s];(function(p,m,y,b,x,T,R,E,B,M){const D=b*(R>>=x)*(T>>=x)+y*R+m*E;switch(B){case"r8unorm":return void Qe(p,D,"8unorm",1,M);case"r8snorm":return void Qe(p,D,"8snorm",1,M);case"r8uint":return void Qe(p,D,"8uint",1,M);case"r8sint":return void Qe(p,D,"8sint",1,M);case"rg8unorm":return void Qe(p,D,"8unorm",2,M);case"rg8snorm":return void Qe(p,D,"8snorm",2,M);case"rg8uint":return void Qe(p,D,"8uint",2,M);case"rg8sint":return void Qe(p,D,"8sint",2,M);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Qe(p,D,"8unorm",4,M);case"rgba8snorm":return void Qe(p,D,"8snorm",4,M);case"rgba8uint":return void Qe(p,D,"8uint",4,M);case"rgba8sint":return void Qe(p,D,"8sint",4,M);case"r16uint":return void Qe(p,D,"16uint",1,M);case"r16sint":return void Qe(p,D,"16sint",1,M);case"r16float":return void Qe(p,D,"16float",1,M);case"rg16uint":return void Qe(p,D,"16uint",2,M);case"rg16sint":return void Qe(p,D,"16sint",2,M);case"rg16float":return void Qe(p,D,"16float",2,M);case"rgba16uint":return void Qe(p,D,"16uint",4,M);case"rgba16sint":return void Qe(p,D,"16sint",4,M);case"rgba16float":return void Qe(p,D,"16float",4,M);case"r32uint":return void Qe(p,D,"32uint",1,M);case"r32sint":return void Qe(p,D,"32sint",1,M);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Qe(p,D,"32float",1,M);case"rg32uint":return void Qe(p,D,"32uint",2,M);case"rg32sint":return void Qe(p,D,"32sint",2,M);case"rg32float":return void Qe(p,D,"32float",2,M);case"rgba32uint":return void Qe(p,D,"32uint",4,M);case"rgba32sint":return void Qe(p,D,"32sint",4,M);case"rgba32float":return void Qe(p,D,"32float",4,M);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,f,c,l,this.format,o)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(z||(z={}));class V{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class w{}$=w,w.none=new V("",z.reserved,""),w.eof=new V("EOF",z.token,""),w.reserved={asm:new V("asm",z.reserved,"asm"),bf16:new V("bf16",z.reserved,"bf16"),do:new V("do",z.reserved,"do"),enum:new V("enum",z.reserved,"enum"),f16:new V("f16",z.reserved,"f16"),f64:new V("f64",z.reserved,"f64"),handle:new V("handle",z.reserved,"handle"),i8:new V("i8",z.reserved,"i8"),i16:new V("i16",z.reserved,"i16"),i64:new V("i64",z.reserved,"i64"),mat:new V("mat",z.reserved,"mat"),premerge:new V("premerge",z.reserved,"premerge"),regardless:new V("regardless",z.reserved,"regardless"),typedef:new V("typedef",z.reserved,"typedef"),u8:new V("u8",z.reserved,"u8"),u16:new V("u16",z.reserved,"u16"),u64:new V("u64",z.reserved,"u64"),unless:new V("unless",z.reserved,"unless"),using:new V("using",z.reserved,"using"),vec:new V("vec",z.reserved,"vec"),void:new V("void",z.reserved,"void")},w.keywords={array:new V("array",z.keyword,"array"),atomic:new V("atomic",z.keyword,"atomic"),bool:new V("bool",z.keyword,"bool"),f32:new V("f32",z.keyword,"f32"),i32:new V("i32",z.keyword,"i32"),mat2x2:new V("mat2x2",z.keyword,"mat2x2"),mat2x3:new V("mat2x3",z.keyword,"mat2x3"),mat2x4:new V("mat2x4",z.keyword,"mat2x4"),mat3x2:new V("mat3x2",z.keyword,"mat3x2"),mat3x3:new V("mat3x3",z.keyword,"mat3x3"),mat3x4:new V("mat3x4",z.keyword,"mat3x4"),mat4x2:new V("mat4x2",z.keyword,"mat4x2"),mat4x3:new V("mat4x3",z.keyword,"mat4x3"),mat4x4:new V("mat4x4",z.keyword,"mat4x4"),ptr:new V("ptr",z.keyword,"ptr"),sampler:new V("sampler",z.keyword,"sampler"),sampler_comparison:new V("sampler_comparison",z.keyword,"sampler_comparison"),struct:new V("struct",z.keyword,"struct"),texture_1d:new V("texture_1d",z.keyword,"texture_1d"),texture_2d:new V("texture_2d",z.keyword,"texture_2d"),texture_2d_array:new V("texture_2d_array",z.keyword,"texture_2d_array"),texture_3d:new V("texture_3d",z.keyword,"texture_3d"),texture_cube:new V("texture_cube",z.keyword,"texture_cube"),texture_cube_array:new V("texture_cube_array",z.keyword,"texture_cube_array"),texture_multisampled_2d:new V("texture_multisampled_2d",z.keyword,"texture_multisampled_2d"),texture_storage_1d:new V("texture_storage_1d",z.keyword,"texture_storage_1d"),texture_storage_2d:new V("texture_storage_2d",z.keyword,"texture_storage_2d"),texture_storage_2d_array:new V("texture_storage_2d_array",z.keyword,"texture_storage_2d_array"),texture_storage_3d:new V("texture_storage_3d",z.keyword,"texture_storage_3d"),texture_depth_2d:new V("texture_depth_2d",z.keyword,"texture_depth_2d"),texture_depth_2d_array:new V("texture_depth_2d_array",z.keyword,"texture_depth_2d_array"),texture_depth_cube:new V("texture_depth_cube",z.keyword,"texture_depth_cube"),texture_depth_cube_array:new V("texture_depth_cube_array",z.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new V("texture_depth_multisampled_2d",z.keyword,"texture_depth_multisampled_2d"),texture_external:new V("texture_external",z.keyword,"texture_external"),u32:new V("u32",z.keyword,"u32"),vec2:new V("vec2",z.keyword,"vec2"),vec3:new V("vec3",z.keyword,"vec3"),vec4:new V("vec4",z.keyword,"vec4"),bitcast:new V("bitcast",z.keyword,"bitcast"),block:new V("block",z.keyword,"block"),break:new V("break",z.keyword,"break"),case:new V("case",z.keyword,"case"),continue:new V("continue",z.keyword,"continue"),continuing:new V("continuing",z.keyword,"continuing"),default:new V("default",z.keyword,"default"),diagnostic:new V("diagnostic",z.keyword,"diagnostic"),discard:new V("discard",z.keyword,"discard"),else:new V("else",z.keyword,"else"),enable:new V("enable",z.keyword,"enable"),fallthrough:new V("fallthrough",z.keyword,"fallthrough"),false:new V("false",z.keyword,"false"),fn:new V("fn",z.keyword,"fn"),for:new V("for",z.keyword,"for"),function:new V("function",z.keyword,"function"),if:new V("if",z.keyword,"if"),let:new V("let",z.keyword,"let"),const:new V("const",z.keyword,"const"),loop:new V("loop",z.keyword,"loop"),while:new V("while",z.keyword,"while"),private:new V("private",z.keyword,"private"),read:new V("read",z.keyword,"read"),read_write:new V("read_write",z.keyword,"read_write"),return:new V("return",z.keyword,"return"),requires:new V("requires",z.keyword,"requires"),storage:new V("storage",z.keyword,"storage"),switch:new V("switch",z.keyword,"switch"),true:new V("true",z.keyword,"true"),alias:new V("alias",z.keyword,"alias"),type:new V("type",z.keyword,"type"),uniform:new V("uniform",z.keyword,"uniform"),var:new V("var",z.keyword,"var"),override:new V("override",z.keyword,"override"),workgroup:new V("workgroup",z.keyword,"workgroup"),write:new V("write",z.keyword,"write"),r8unorm:new V("r8unorm",z.keyword,"r8unorm"),r8snorm:new V("r8snorm",z.keyword,"r8snorm"),r8uint:new V("r8uint",z.keyword,"r8uint"),r8sint:new V("r8sint",z.keyword,"r8sint"),r16uint:new V("r16uint",z.keyword,"r16uint"),r16sint:new V("r16sint",z.keyword,"r16sint"),r16float:new V("r16float",z.keyword,"r16float"),rg8unorm:new V("rg8unorm",z.keyword,"rg8unorm"),rg8snorm:new V("rg8snorm",z.keyword,"rg8snorm"),rg8uint:new V("rg8uint",z.keyword,"rg8uint"),rg8sint:new V("rg8sint",z.keyword,"rg8sint"),r32uint:new V("r32uint",z.keyword,"r32uint"),r32sint:new V("r32sint",z.keyword,"r32sint"),r32float:new V("r32float",z.keyword,"r32float"),rg16uint:new V("rg16uint",z.keyword,"rg16uint"),rg16sint:new V("rg16sint",z.keyword,"rg16sint"),rg16float:new V("rg16float",z.keyword,"rg16float"),rgba8unorm:new V("rgba8unorm",z.keyword,"rgba8unorm"),rgba8unorm_srgb:new V("rgba8unorm_srgb",z.keyword,"rgba8unorm_srgb"),rgba8snorm:new V("rgba8snorm",z.keyword,"rgba8snorm"),rgba8uint:new V("rgba8uint",z.keyword,"rgba8uint"),rgba8sint:new V("rgba8sint",z.keyword,"rgba8sint"),bgra8unorm:new V("bgra8unorm",z.keyword,"bgra8unorm"),bgra8unorm_srgb:new V("bgra8unorm_srgb",z.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new V("rgb10a2unorm",z.keyword,"rgb10a2unorm"),rg11b10float:new V("rg11b10float",z.keyword,"rg11b10float"),rg32uint:new V("rg32uint",z.keyword,"rg32uint"),rg32sint:new V("rg32sint",z.keyword,"rg32sint"),rg32float:new V("rg32float",z.keyword,"rg32float"),rgba16uint:new V("rgba16uint",z.keyword,"rgba16uint"),rgba16sint:new V("rgba16sint",z.keyword,"rgba16sint"),rgba16float:new V("rgba16float",z.keyword,"rgba16float"),rgba32uint:new V("rgba32uint",z.keyword,"rgba32uint"),rgba32sint:new V("rgba32sint",z.keyword,"rgba32sint"),rgba32float:new V("rgba32float",z.keyword,"rgba32float"),static_assert:new V("static_assert",z.keyword,"static_assert")},w.tokens={decimal_float_literal:new V("decimal_float_literal",z.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new V("hex_float_literal",z.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new V("int_literal",z.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new V("uint_literal",z.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new V("name",z.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new V("ident",z.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new V("and",z.token,"&"),and_and:new V("and_and",z.token,"&&"),arrow:new V("arrow ",z.token,"->"),attr:new V("attr",z.token,"@"),forward_slash:new V("forward_slash",z.token,"/"),bang:new V("bang",z.token,"!"),bracket_left:new V("bracket_left",z.token,"["),bracket_right:new V("bracket_right",z.token,"]"),brace_left:new V("brace_left",z.token,"{"),brace_right:new V("brace_right",z.token,"}"),colon:new V("colon",z.token,":"),comma:new V("comma",z.token,","),equal:new V("equal",z.token,"="),equal_equal:new V("equal_equal",z.token,"=="),not_equal:new V("not_equal",z.token,"!="),greater_than:new V("greater_than",z.token,">"),greater_than_equal:new V("greater_than_equal",z.token,">="),shift_right:new V("shift_right",z.token,">>"),less_than:new V("less_than",z.token,"<"),less_than_equal:new V("less_than_equal",z.token,"<="),shift_left:new V("shift_left",z.token,"<<"),modulo:new V("modulo",z.token,"%"),minus:new V("minus",z.token,"-"),minus_minus:new V("minus_minus",z.token,"--"),period:new V("period",z.token,"."),plus:new V("plus",z.token,"+"),plus_plus:new V("plus_plus",z.token,"++"),or:new V("or",z.token,"|"),or_or:new V("or_or",z.token,"||"),paren_left:new V("paren_left",z.token,"("),paren_right:new V("paren_right",z.token,")"),semicolon:new V("semicolon",z.token,";"),star:new V("star",z.token,"*"),tilde:new V("tilde",z.token,"~"),underscore:new V("underscore",z.token,"_"),xor:new V("xor",z.token,"^"),plus_equal:new V("plus_equal",z.token,"+="),minus_equal:new V("minus_equal",z.token,"-="),times_equal:new V("times_equal",z.token,"*="),division_equal:new V("division_equal",z.token,"/="),modulo_equal:new V("modulo_equal",z.token,"%="),and_equal:new V("and_equal",z.token,"&="),or_equal:new V("or_equal",z.token,"|="),xor_equal:new V("xor_equal",z.token,"^="),shift_right_equal:new V("shift_right_equal",z.token,">>="),shift_left_equal:new V("shift_left_equal",z.token,"<<=")},w.simpleTokens={"@":$.tokens.attr,"{":$.tokens.brace_left,"}":$.tokens.brace_right,":":$.tokens.colon,",":$.tokens.comma,"(":$.tokens.paren_left,")":$.tokens.paren_right,";":$.tokens.semicolon},w.literalTokens={"&":$.tokens.and,"&&":$.tokens.and_and,"->":$.tokens.arrow,"/":$.tokens.forward_slash,"!":$.tokens.bang,"[":$.tokens.bracket_left,"]":$.tokens.bracket_right,"=":$.tokens.equal,"==":$.tokens.equal_equal,"!=":$.tokens.not_equal,">":$.tokens.greater_than,">=":$.tokens.greater_than_equal,">>":$.tokens.shift_right,"<":$.tokens.less_than,"<=":$.tokens.less_than_equal,"<<":$.tokens.shift_left,"%":$.tokens.modulo,"-":$.tokens.minus,"--":$.tokens.minus_minus,".":$.tokens.period,"+":$.tokens.plus,"++":$.tokens.plus_plus,"|":$.tokens.or,"||":$.tokens.or_or,"*":$.tokens.star,"~":$.tokens.tilde,_:$.tokens.underscore,"^":$.tokens.xor,"+=":$.tokens.plus_equal,"-=":$.tokens.minus_equal,"*=":$.tokens.times_equal,"/=":$.tokens.division_equal,"%=":$.tokens.modulo_equal,"&=":$.tokens.and_equal,"|=":$.tokens.or_equal,"^=":$.tokens.xor_equal,">>=":$.tokens.shift_right_equal,"<<=":$.tokens.shift_left_equal},w.regexTokens={decimal_float_literal:$.tokens.decimal_float_literal,hex_float_literal:$.tokens.hex_float_literal,int_literal:$.tokens.int_literal,uint_literal:$.tokens.uint_literal,ident:$.tokens.ident},w.storage_class=[$.keywords.function,$.keywords.private,$.keywords.workgroup,$.keywords.uniform,$.keywords.storage],w.access_mode=[$.keywords.read,$.keywords.write,$.keywords.read_write],w.sampler_type=[$.keywords.sampler,$.keywords.sampler_comparison],w.sampled_texture_type=[$.keywords.texture_1d,$.keywords.texture_2d,$.keywords.texture_2d_array,$.keywords.texture_3d,$.keywords.texture_cube,$.keywords.texture_cube_array],w.multisampled_texture_type=[$.keywords.texture_multisampled_2d],w.storage_texture_type=[$.keywords.texture_storage_1d,$.keywords.texture_storage_2d,$.keywords.texture_storage_2d_array,$.keywords.texture_storage_3d],w.depth_texture_type=[$.keywords.texture_depth_2d,$.keywords.texture_depth_2d_array,$.keywords.texture_depth_cube,$.keywords.texture_depth_cube_array,$.keywords.texture_depth_multisampled_2d],w.texture_external_type=[$.keywords.texture_external],w.any_texture_type=[...$.sampled_texture_type,...$.multisampled_texture_type,...$.storage_texture_type,...$.depth_texture_type,...$.texture_external_type],w.texel_format=[$.keywords.r8unorm,$.keywords.r8snorm,$.keywords.r8uint,$.keywords.r8sint,$.keywords.r16uint,$.keywords.r16sint,$.keywords.r16float,$.keywords.rg8unorm,$.keywords.rg8snorm,$.keywords.rg8uint,$.keywords.rg8sint,$.keywords.r32uint,$.keywords.r32sint,$.keywords.r32float,$.keywords.rg16uint,$.keywords.rg16sint,$.keywords.rg16float,$.keywords.rgba8unorm,$.keywords.rgba8unorm_srgb,$.keywords.rgba8snorm,$.keywords.rgba8uint,$.keywords.rgba8sint,$.keywords.bgra8unorm,$.keywords.bgra8unorm_srgb,$.keywords.rgb10a2unorm,$.keywords.rg11b10float,$.keywords.rg32uint,$.keywords.rg32sint,$.keywords.rg32float,$.keywords.rgba16uint,$.keywords.rgba16sint,$.keywords.rgba16float,$.keywords.rgba32uint,$.keywords.rgba32sint,$.keywords.rgba32float],w.const_literal=[$.tokens.int_literal,$.tokens.uint_literal,$.tokens.decimal_float_literal,$.tokens.hex_float_literal,$.keywords.true,$.keywords.false],w.literal_or_ident=[$.tokens.ident,$.tokens.int_literal,$.tokens.uint_literal,$.tokens.decimal_float_literal,$.tokens.hex_float_literal,$.tokens.name],w.element_count_expression=[$.tokens.int_literal,$.tokens.uint_literal,$.tokens.ident],w.template_types=[$.keywords.vec2,$.keywords.vec3,$.keywords.vec4,$.keywords.mat2x2,$.keywords.mat2x3,$.keywords.mat2x4,$.keywords.mat3x2,$.keywords.mat3x3,$.keywords.mat3x4,$.keywords.mat4x2,$.keywords.mat4x3,$.keywords.mat4x4,$.keywords.atomic,$.keywords.bitcast,...$.any_texture_type],w.attribute_name=[$.tokens.ident,$.keywords.block,$.keywords.diagnostic],w.assignment_operators=[$.tokens.equal,$.tokens.plus_equal,$.tokens.minus_equal,$.tokens.times_equal,$.tokens.division_equal,$.tokens.modulo_equal,$.tokens.and_equal,$.tokens.or_equal,$.tokens.xor_equal,$.tokens.shift_right_equal,$.tokens.shift_left_equal],w.increment_operators=[$.tokens.plus_plus,$.tokens.minus_minus];class lv{constructor(e,t,i,s,o){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=o}toString(){return this.lexeme}isTemplateType(){return w.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==w.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class TM{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new lv(w.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=w.simpleTokens[e];if(t)return this._addToken(t),!0;let i=w.none;const s=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(s){const l=w.keywords[e];if(l)return this._addToken(l),!0}if(s||o)return this._addToken(w.tokens.ident),!0;for(;;){let l=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(w.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(w.tokens.minus_minus),!0;const f=this._tokens.length-1;if((w.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==w.tokens.paren_right)&&c!=">")return this._addToken(l),!0}if(e==">"&&(c==">"||c=="=")){let f=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&w.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===w.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===w.none){let f=e,d=0;const p=2;for(let m=0;m<p;++m)if(f+=this._peekAhead(m),l=this._findType(f),l!==w.none){d=m;break}if(l===w.none)return i!==w.none&&(this._current--,this._addToken(i),!0);e=f,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==w.none&&(this._addToken(i),!0)}_findType(e){for(const i in w.regexTokens){const s=w.regexTokens[i];if(this._match(e,s.rule))return s}return w.literalTokens[e]||w.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new lv(e,t,this._line,this._start,this._current))}}function he(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const Iu=new Float32Array(1),SM=new Uint32Array(Iu.buffer),AM=new Uint32Array(Iu.buffer),Nu=new Int32Array(1),wM=new Float32Array(Nu.buffer),EM=new Uint32Array(Nu.buffer),Du=new Uint32Array(1),RM=new Float32Array(Du.buffer),CM=new Int32Array(Du.buffer);function cv(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return Iu[0]=n,SM[0];if(t==="u32")return Iu[0]=n,AM[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Nu[0]=n,wM[0];if(t==="u32")return Nu[0]=n,EM[0]}else if(e==="u32"){if(t==="f32")return Du[0]=n,RM[0];if(t==="i32"||t==="x32")return Du[0]=n,CM[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class MM{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Fc{constructor(e,t){this.align=e,this.size=t}}class ui{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new fM,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof el&&this._functions.set(t.name,new MM(t));for(const t of e)if(t instanceof Bi){const i=this.getTypeInfo(t,null);i instanceof Ts&&this.structs.push(i)}for(const t of e)if(t instanceof Pg)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Mg){const i=t,s=this._getAttributeNum(i.attributes,"id",0),o=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new lM(i.name,o,i.attributes,s));continue}if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new Uc(i.name,l,s,o,i.attributes,vs.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c);continue}if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new Uc(i.name,l,s,o,i.attributes,c?vs.StorageTexture:vs.Storage,i.access);f.access||(f.access="read"),this.storage.push(f);continue}if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new Uc(i.name,l,s,o,i.attributes,c?vs.StorageTexture:vs.Texture,i.access);f.access||(f.access="read"),c?this.storage.push(f):this.textures.push(f);continue}if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new Uc(i.name,l,s,o,i.attributes,vs.Sampler,i.access);this.samplers.push(c);continue}}for(const t of e)if(t instanceof el){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),o=this._getAttribute(t,"compute"),l=i||s||o,c=new uM(t.name,l?.name,t.attributes);c.attributes=t.attributes,c.startLine=t.startLine,c.endLine=t.endLine,this.functions.push(c),this._functions.get(t.name).info=c,l&&(this._functions.get(t.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(t,!!l),c.inputs=this._getInputs(t.args),c.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(c)),c.arguments=t.args.map(f=>new cM(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),c.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,o,l;if(i instanceof B2){if(i.value)if(he(i.value))for(const c of i.value)for(const f of this.overrides)c===f.name&&((s=t.info)===null||s===void 0||s.overrides.push(f));else for(const c of this.overrides)i.value===c.name&&((o=t.info)===null||o===void 0||o.overrides.push(c))}else if(i instanceof En)for(const c of this.overrides)i.name===c.name&&((l=t.info)===null||l===void 0||l.overrides.push(c))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const o=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;o&&t.add(o)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}for(const s of this.entry.vertex)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}for(const s of this.entry.fragment)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,o=[];return e.search(l=>{if(l instanceof Ou)o.push({});else if(l instanceof Pu)o.pop();else if(l instanceof Ui){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(l instanceof li){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(l instanceof $a){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(l instanceof En){const c=l;if(o.length>0&&o[o.length-1][c.name])return;const f=s._findResource(c.name);f&&i.push(f)}else if(l instanceof Ig){const c=l,f=s._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,t)),i.push(...f.resources))}else if(l instanceof Og){const c=l,f=s._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,t)),i.push(...f.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Bi)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof Bi)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const o=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),c=new iv(i.name,o,s.name,l);t.push(c)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new iv("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof Bi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof Bi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),l=new aM(e.name,s,t.name,o);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new oM(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof cu){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,o=new Ep(e.name,s,t);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Xa){const s=e,o=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new ws(s.name,t);return l.format=o,l.count=s.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof Bi){const s=e,o=new Ts(s.name,t);o.startLine=s.startLine,o.endLine=s.endLine;for(const l of s.members){const c=this.getTypeInfo(l.type,l.attributes);o.members.push(new nv(l.name,c,l.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof La){const s=e,o=s.format instanceof ie,l=s.format?o?this.getTypeInfo(s.format,null):new zn(s.format,null):null,c=new ar(s.name,l,t,s.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof j){const s=e,o=s.format?this.getTypeInfo(s.format,null):null,l=new ar(s.name,o,t,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new zn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const o=this._getTypeSize(e);if(e.size=(t=o?.size)!==null&&t!==void 0?t:0,e instanceof ws&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l?.size)!==null&&i!==void 0?i:0,(s=l?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof Ep&&this._updateTypeInfo(e.format),e instanceof Ts&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,o=0,l=0;for(let c=0,f=e.members.length;c<f;++c){const d=e.members[c],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const m=p.align,y=p.size;i=this._roundUp(m,i+s),s=y,o=i,l=Math.max(l,m),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,o+s),e.align=l}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof nv&&(e=e.type),e instanceof zn){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=ui._typeInfo[e.name];if(l!==void 0){const c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Fc(Math.max(o,l.align/c),Math.max(s,l.size/c))}}{const l=ui._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const c=e.name[e.name.length-1]==="h"?2:1;return new Fc(Math.max(o,l.align/c),Math.max(s,l.size/c))}}if(e instanceof ws){let l=e,c=8,f=8;const d=this._getTypeSize(l.format);return d!==null&&(f=d.size,c=d.align),f=l.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,f)),s&&(f=s),new Fc(Math.max(o,c),Math.max(s,f))}if(e instanceof Ts){let l=0,c=0,f=0,d=0,p=0;for(const m of e.members){const y=this._getTypeSize(m.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+d),d=y.size,p=f)}return c=this._roundUp(l,p+d),new Fc(Math.max(o,l),Math.max(s,c))}return null}_isUniformVar(e){return e instanceof Ui&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ui&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ui&&e.type!==null&&ui._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ui&&e.type!==null&&ui._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let o of s)if(o.name==t)return o;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let o=s!==null&&s.value!==null?s.value:i;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}ui._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ui._textureTypes=w.any_texture_type.map(n=>n.name),ui._samplerTypes=w.sampler_type.map(n=>n.name);let Ng=0;class Dg{constructor(e,t,i){this.id=Ng++,this.name=e,this.value=t,this.node=i}clone(){return new Dg(this.name,this.value,this.node)}}class kg{constructor(e){this.id=Ng++,this.name=e.name,this.node=e}clone(){return new kg(this.node)}}class Bg{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Ng++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new Dg(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new Bg(this)}}class OM{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class PM{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof O)return i.data.forEach(o=>{o||(s=!1)}),new U(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O){const s=i.data.some(o=>o);return new U(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof U))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof bt&&s.typeInfo.size===0){const o=s.typeInfo,l=s.buffer.byteLength/o.stride;return new U(l,this.getTypeInfo("u32"))}return new U(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.abs(o)),i.typeInfo);const s=i;return new U(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.acos(o)),i.typeInfo);const s=i;return new U(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.acosh(o)),i.typeInfo);const s=i;return new U(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.asin(o)),i.typeInfo);const s=i;return new U(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.asinh(o)),i.typeInfo);const s=i;return new U(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.atan(o)),i.typeInfo);const s=i;return new U(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.atanh(o)),i.typeInfo);const s=i;return new U(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O)return new O(i.data.map((c,f)=>Math.atan2(c,s.data[f])),i.typeInfo);const o=i,l=s;return new U(Math.atan2(o.value,l.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.ceil(o)),i.typeInfo);const s=i;return new U(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof O&&s instanceof O&&o instanceof O)return new O(i.data.map((d,p)=>this._clamp(d,s.data[p],o.data[p])),i.typeInfo);const l=i,c=s,f=o;return new U(this._clamp(l.value,c.value,f.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.cos(o)),i.typeInfo);const s=i;return new U(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.cosh(o)),i.typeInfo);const s=i;return new U(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.clz32(o)),i.typeInfo);const s=i;return new U(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>this._countOneBits(o)),i.typeInfo);const s=i;return new U(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>this._countTrailingZeros(o)),i.typeInfo);const s=i;return new U(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const o=i.data,l=s.data;return new O([o[1]*l[2]-l[1]*o[2],o[2]*l[0]-l[2]*o[0],o[0]*l[1]-l[0]*o[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof O?new O(i.data.map(o=>o*s),i.typeInfo):new U(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Re){const s=i.data,o=i.typeInfo.getTypeName(),l=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new U(s[0]*s[3]-s[1]*s[2],l);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new U(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new U(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O){let c=0;for(let f=0;f<i.data.length;++f)c+=(i.data[f]-s.data[f])*(i.data[f]-s.data[f]);return new U(Math.sqrt(c),this.getTypeInfo("f32"))}const o=i,l=s;return new U(Math.abs(o.value-l.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof O&&s instanceof O?new U(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.exp(o)),i.typeInfo);const s=i;return new U(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.pow(2,o)),i.typeInfo);const s=i;return new U(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=s.value,c=o.value;if(i instanceof O)return new O(i.data.map(d=>d>>l&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=i.value;return new U(f>>l&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof O&&s instanceof O&&o instanceof O){const l=this._dot(s.data,o.data);return new O(l<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>this._firstLeadingBit(o)),i.typeInfo);const s=i;return new U(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>this._firstTrailingBit(o)),i.typeInfo);const s=i;return new U(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.floor(o)),i.typeInfo);const s=i;return new U(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof O&&s instanceof O&&o instanceof O)return i.data.length!==s.data.length||i.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new O(i.data.map((d,p)=>d*s.data[p]+o.data[p]),i.typeInfo);const l=i,c=s,f=o;return new U(l.value*c.value+f.value,l.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>o-Math.floor(o)),i.typeInfo);const s=i;return new U(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const c=o.value,f=(1<<l.value)-1<<c,d=~f;if(i instanceof O&&s instanceof O)return new O(i.data.map((y,b)=>y&d|s.data[b]<<c&f),i.typeInfo);const p=i.value,m=s.value;return new U(p&d|m<<c&f,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>1/Math.sqrt(o)),i.typeInfo);const s=i;return new U(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O){let o=0;return i.data.forEach(l=>{o+=l*l}),new U(Math.sqrt(o),this.getTypeInfo("f32"))}const s=i;return new U(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.log(o)),i.typeInfo);const s=i;return new U(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.log2(o)),i.typeInfo);const s=i;return new U(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O)return new O(i.data.map((c,f)=>Math.max(c,s.data[f])),i.typeInfo);const o=i,l=s;return new U(Math.max(o.value,l.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O)return new O(i.data.map((c,f)=>Math.min(c,s.data[f])),i.typeInfo);const o=i,l=s;return new U(Math.min(o.value,l.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof O&&s instanceof O&&o instanceof O)return new O(i.data.map((f,d)=>i.data[d]*(1-o.data[d])+s.data[d]*o.data[d]),i.typeInfo);const l=s,c=o;return new U(i.value*(1-c.value)+l.value*c.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O)return new O(i.data.map((l,c)=>l%s.data[c]),i.typeInfo);const o=s;return new U(i.value%o.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O){const s=this.Length(e,t).value;return new O(i.data.map(o=>o/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O)return new O(i.data.map((c,f)=>Math.pow(c,s.data[f])),i.typeInfo);const o=i,l=s;return new U(Math.pow(o.value,l.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof O?new O(i.data.map(s=>s),i.typeInfo):new U(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof O?new O(i.data.map(s=>s*Math.PI/180),i.typeInfo):new U(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O){const o=this._dot(i.data,s.data);return new O(i.data.map((l,c)=>l-2*o*s.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof O&&s instanceof O&&o instanceof U){const l=this._dot(s.data,i.data);return new O(i.data.map((c,f)=>{const d=1-o.value*o.value*(1-l*l);if(d<0)return 0;const p=Math.sqrt(d);return o.value*c-(o.value*l+p)*s.data[f]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.round(o)),i.typeInfo);const s=i;return new U(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.min(Math.max(o,0),1)),i.typeInfo);const s=i;return new U(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.sign(o)),i.typeInfo);const s=i;return new U(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.sin(o)),i.typeInfo);const s=i;return new U(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.sinh(o)),i.typeInfo);const s=i;return new U(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(o instanceof O&&i instanceof O&&s instanceof O)return new O(o.data.map((d,p)=>this._smoothstep(i.data[p],s.data[p],d)),o.typeInfo);const l=i,c=s,f=o;return new U(this._smoothstep(l.value,c.value,f.value),o.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.sqrt(o)),i.typeInfo);const s=i;return new U(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O)return new O(s.data.map((l,c)=>l<i.data[c]?0:1),s.typeInfo);const o=i;return new U(s.value<o.value?0:1,o.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.tan(o)),i.typeInfo);const s=i;return new U(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.tanh(o)),i.typeInfo);const s=i;return new U(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof Re))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const o=i.data;return new Re([o[0],o[2],o[1],o[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const o=i.data;return new Re([o[0],o[3],o[6],o[1],o[4],o[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const o=i.data;return new Re([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const o=i.data;return new Re([o[0],o[3],o[1],o[4],o[2],o[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const o=i.data;return new Re([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const o=i.data;return new Re([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const o=i.data;return new Re([o[0],o[4],o[1],o[5],o[2],o[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const o=i.data;return new Re([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const o=i.data;return new Re([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof O)return new O(i.data.map(o=>Math.trunc(o)),i.typeInfo);const s=i;return new U(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof En){const o=i.name,l=t.getVariableValue(o);if(l instanceof Li){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const c=l.getMipLevelSize(s),f=l.dimension;return f==="1d"?new U(c[0],this.getTypeInfo("u32")):f==="3d"?new O(c,this.getTypeInfo("vec3u")):f==="2d"?new O(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),o=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof O)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof En){const l=i.name,c=t.getVariableValue(l);if(c instanceof Li){const f=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(f<0||f>=c.width||d<0||d>=c.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=c.getPixel(f,d,0,o);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new O(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof En){const s=i.name,o=t.getVariableValue(s);return o instanceof Li?new U(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof En){const s=i.name,o=t.getVariableValue(s);return o instanceof Li?new U(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof En){const s=i.name,o=t.getVariableValue(s);return o instanceof Li?new U(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),o=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof O)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof En){const c=i.name,f=t.getVariableValue(c);if(f instanceof Li){const d=f.getMipLevelSize(0),p=Math.floor(s.data[0]),m=Math.floor(s.data[1]);return p<0||p>=d[0]||m<0||m>=d[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(f.setPixel(p,m,0,o,Array.from(l)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t);return f instanceof U&&c instanceof U&&(f.value=c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value+=c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value-=c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=Math.max(f.value,c.value)),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=Math.min(f.value,c.value)),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=f.value&c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=f.value|c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=f.value^c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof Rt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=c.value),o.value instanceof bt&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Vd={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},nn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Gt extends OM{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new ui,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new Bg,this.builtins=new PM(this),this.typeInfo={bool:this.getTypeInfo(ie.bool),i32:this.getTypeInfo(ie.i32),u32:this.getTypeInfo(ie.u32),f32:this.getTypeInfo(ie.f32),f16:this.getTypeInfo(ie.f16),vec2f:this.getTypeInfo(j.vec2f),vec2u:this.getTypeInfo(j.vec2u),vec2i:this.getTypeInfo(j.vec2i),vec2h:this.getTypeInfo(j.vec2h),vec3f:this.getTypeInfo(j.vec3f),vec3u:this.getTypeInfo(j.vec3u),vec3i:this.getTypeInfo(j.vec3i),vec3h:this.getTypeInfo(j.vec3h),vec4f:this.getTypeInfo(j.vec4f),vec4u:this.getTypeInfo(j.vec4u),vec4i:this.getTypeInfo(j.vec4i),vec4h:this.getTypeInfo(j.vec4h),mat2x2f:this.getTypeInfo(j.mat2x2f),mat2x3f:this.getTypeInfo(j.mat2x3f),mat2x4f:this.getTypeInfo(j.mat2x4f),mat3x2f:this.getTypeInfo(j.mat3x2f),mat3x3f:this.getTypeInfo(j.mat3x3f),mat3x4f:this.getTypeInfo(j.mat3x4f),mat4x2f:this.getTypeInfo(j.mat4x2f),mat4x3f:this.getTypeInfo(j.mat4x3f),mat4x4f:this.getTypeInfo(j.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof U)return s.value;if(s instanceof O||s instanceof Re)return Array.from(s.data);if(s instanceof bt&&s.typeInfo instanceof ws){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const o=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,o),this._execStatements(this.ast,o);const l=o.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const c=t[0],f=t[1],d=t[2],p=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new O(t,p));const m=this.reflection.getFunctionInfo(e);m===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const b in i[y]){const x=i[y][b];o.variables.forEach(T=>{var R;const E=T.node;if(E?.attributes){let B=null,M=null;for(const D of E.attributes)D.name==="binding"?B=D.value:D.name==="group"&&(M=D.value);if(b==B&&y==M){let D=!1;for(const F of m.resources)if(F.name===T.name&&F.group===parseInt(y)&&F.binding===parseInt(b)){D=!0;break}if(D)if(x.texture!==void 0&&x.descriptor!==void 0){const F=new Li(x.texture,this.getTypeInfo(E.type),x.descriptor,(R=x.texture.view)!==null&&R!==void 0?R:null);T.value=F}else x.uniform!==void 0?T.value=new bt(x.uniform,this.getTypeInfo(E.type)):T.value=new bt(x,this.getTypeInfo(E.type))}}})}for(let y=0;y<d;++y)for(let b=0;b<f;++b)for(let x=0;x<c;++x)o.setVariable("@workgroup_id",new O([x,b,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[x,b,y],o)}execStatement(e,t){if(e instanceof E2)return this.evalExpression(e.value,t);if(e instanceof C2){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof U))throw new Error("Invalid break-if condition");if(!i.value)return null}return Gt._breakObj}if(e instanceof M2)return Gt._continueObj;if(e instanceof $a)this._let(e,t);else if(e instanceof Ui)this._var(e,t);else if(e instanceof lu)this._const(e,t);else if(e instanceof el)this._function(e,t);else{if(e instanceof w2)return this._if(e,t);if(e instanceof A2)return this._switch(e,t);if(e instanceof v2)return this._for(e,t);if(e instanceof b2)return this._while(e,t);if(e instanceof S2)return this._loop(e,t);if(e instanceof Rp){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof T2)this._assign(e,t);else if(e instanceof x2)this._increment(e,t);else{if(e instanceof Bi)return null;if(e instanceof Mg){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new U(0,this.getTypeInfo("u32")))}else if(e instanceof Og)this._call(e,t);else{if(e instanceof R2||e instanceof Pg)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Kn?this._evalBinaryOp(e,t):e instanceof Ot?this._evalLiteral(e,t):e instanceof En?this._evalVariable(e,t):e instanceof Ig?this._evalCall(e,t):e instanceof li?this._evalCreate(e,t):e instanceof O2?this._evalConst(e,t):e instanceof P2?this._evalBitcast(e,t):e instanceof Rt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof ie){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],o=this.reflection.getOverrideInfo(i);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?t.setVariable(i,new U(s,o.type)):o.type.name==="bool"?t.setVariable(i,new U(s?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?t.setVariable(i,new O(s,o.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const m=i.getVariableValue(p.value[0]);s[0]=m instanceof U?m.value:parseInt(p.value[0])}if(p.value.length>1){const m=i.getVariableValue(p.value[1]);s[1]=m instanceof U?m.value:parseInt(p.value[1])}if(p.value.length>2){const m=i.getVariableValue(p.value[2]);s[2]=m instanceof U?m.value:parseInt(p.value[2])}}const o=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new O(s,o));const c=s[0],f=s[1],d=s[2];for(let p=0,m=0;p<d;++p)for(let y=0;y<f;++y)for(let b=0;b<c;++b,++m){const x=[b,y,p],T=[b+t[0]*s[0],y+t[1]*s[1],p+t[2]*s[2]];i.setVariable("@local_invocation_id",new O(x,o)),i.setVariable("@global_invocation_id",new O(T,o)),i.setVariable("@local_invocation_index",new U(m,l)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const o=`@${s.value}`,l=t.getVariable(o);l!==void 0&&t.variables.set(i.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Rt;)e=e.right;return e instanceof En?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const o=t.clone(),l=this._execStatements(i,o);if(l)return l;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let o=0;o<s.node.args.length;++o){const l=s.node.args[o],c=this.evalExpression(e.args[o],i);i.setVariable(l.name,c,l)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof U?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof U?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof En){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof Rt){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof to?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new to(i)}}return null}_assign(e,t){let i=null,s="<var>",o=null;if(e.variable instanceof Rt){const f=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(f instanceof U||f instanceof O||f instanceof Re){if(d instanceof U||d instanceof O||d instanceof Re&&f.data.length===d.data.length)return void f.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof bt&&d instanceof bt&&f.buffer.byteLength-f.offset>=d.buffer.byteLength-d.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return f instanceof U||f instanceof O||f instanceof Re?d instanceof U||d instanceof O||d instanceof Re?void f.data.set(d.data.map((m,y)=>f.data[y]+m)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(f instanceof U||f instanceof O||f instanceof Re)&&(d instanceof U||d instanceof O||d instanceof Re)?void f.data.set(d.data.map((m,y)=>f.data[y]-m)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Rt){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const f=t.getVariable(s);if(!(f&&f.value instanceof to))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=f.value.reference;let d=e.variable.postfix;if(!d){let p=e.variable.right;for(;p instanceof Rt;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(i=i.getSubData(this,d,t))}}else{o=e.variable.postfix,s=this.getVariableName(e.variable,t);const f=t.getVariable(s);if(f===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=f.value}if(i instanceof to&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),c=e.operator;if(c!=="="){const f=i.getSubData(this,o,t);if(f instanceof O&&l instanceof U){const d=f.data,p=l.value;if(c==="+=")for(let m=0;m<d.length;++m)d[m]+=p;else if(c==="-=")for(let m=0;m<d.length;++m)d[m]-=p;else if(c==="*=")for(let m=0;m<d.length;++m)d[m]*=p;else if(c==="/=")for(let m=0;m<d.length;++m)d[m]/=p;else if(c==="%=")for(let m=0;m<d.length;++m)d[m]%=p;else if(c==="&=")for(let m=0;m<d.length;++m)d[m]&=p;else if(c==="|=")for(let m=0;m<d.length;++m)d[m]|=p;else if(c==="^=")for(let m=0;m<d.length;++m)d[m]^=p;else if(c==="<<=")for(let m=0;m<d.length;++m)d[m]<<=p;else if(c===">>=")for(let m=0;m<d.length;++m)d[m]>>=p;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(f instanceof O&&l instanceof O){const d=f.data,p=l.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let m=0;m<d.length;++m)d[m]+=p[m];else if(c==="-=")for(let m=0;m<d.length;++m)d[m]-=p[m];else if(c==="*=")for(let m=0;m<d.length;++m)d[m]*=p[m];else if(c==="/=")for(let m=0;m<d.length;++m)d[m]/=p[m];else if(c==="%=")for(let m=0;m<d.length;++m)d[m]%=p[m];else if(c==="&=")for(let m=0;m<d.length;++m)d[m]&=p[m];else if(c==="|=")for(let m=0;m<d.length;++m)d[m]|=p[m];else if(c==="^=")for(let m=0;m<d.length;++m)d[m]^=p[m];else if(c==="<<=")for(let m=0;m<d.length;++m)d[m]<<=p[m];else if(c===">>=")for(let m=0;m<d.length;++m)d[m]>>=p[m];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(f instanceof U&&l instanceof U))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?f.value+=l.value:c==="-="?f.value-=l.value:c==="*="?f.value*=l.value:c==="/="?f.value/=l.value:c==="%="?f.value%=l.value:c==="&="?f.value&=l.value:c==="|="?f.value|=l.value:c==="^="?f.value^=l.value:c==="<<="?f.value<<=l.value:c===">>="?f.value>>=l.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}return void(i instanceof bt&&i.setDataValue(this,f,o,t))}if(i instanceof bt)i.setDataValue(this,l,o,t);else if(o){if(!(i instanceof O||i instanceof Re))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(o instanceof To){const f=this.evalExpression(o.index,t).value;if(i instanceof O){if(!(l instanceof U))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[f]=l.value}else{if(!(i instanceof Re))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(o.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l instanceof O))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(o instanceof lr){const f=o.value;if(!(i instanceof O))return void console.error(`Invalid assignment to ${f}. Variable ${s} is not a vector. Line ${e.line}`);if(l instanceof U){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);if(f==="x")i.data[0]=l.value;else if(f==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[1]=l.value}else if(f==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[2]=l.value}else if(f==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof O))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(f.length!==l.data.length)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);for(let d=0;d<f.length;++d){const p=f[d];if(p==="x"||p==="r")i.data[0]=l.data[d];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[1]=l.data[d]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[2]=l.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[3]=l.data[d]}}}}}else i instanceof U&&l instanceof U?i.value=l.value:i instanceof O&&l instanceof O||i instanceof Re&&l instanceof Re?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`)}_function(e,t){const i=new kg(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Rt||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const o=new li(e.type,[]);i=this._evalCreate(o,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Rt||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Xa||e.type instanceof Bi||e.type instanceof j){const o=new li(e.type,[]);i=this._evalCreate(o,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const o of e.cases)if(o instanceof D2)for(const l of o.selectors){if(l instanceof uu){s=o;continue}const c=this.evalExpression(l,t);if(!(c instanceof U))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===i.value)return this._execStatements(o.body,t)}else o instanceof k2&&(s=o);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const o=this.evalExpression(s.condition,t);if(!(o instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof U?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Gt._breakObj)break;if(i!==null&&i!==Gt._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===Gt._breakObj)break;if(i===Gt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Gt._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Gt._breakObj)break;if(i!==Gt._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof U){const o=cv(i.value,i.typeInfo.name,s.name);return new U(o,this.getTypeInfo(s))}if(i instanceof O){const o=i.typeInfo.getTypeName();let l="";if(o.endsWith("f"))l="f32";else if(o.endsWith("i"))l="i32";else if(o.endsWith("u"))l="u32";else if(o.endsWith("b"))l="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;l="f16"}const c=s.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const d=(function(p,m,y){if(m===y)return p;const b=new Array(p.length);for(let x=0;x<p.length;x++)b[x]=cv(p[x],m,y);return b})(Array.from(i.data),l,f);return new O(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof li){if(e.type===null)return Cp.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof li?e.type.name:e.name,o=e instanceof li?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(o.size===0)return null;const l=new bt(new ArrayBuffer(o.size),o,0);if(o instanceof Ts){if(e.args)for(let c=0;c<e.args.length;++c){const f=o.members[c],d=e.args[c],p=this.evalExpression(d,t);l.setData(this,p,f.type,f.offset,t)}}else if(o instanceof ws){let c=0;if(e.args)for(let f=0;f<e.args.length;++f){const d=e.args[f],p=this.evalExpression(d,t);o.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=p.typeInfo),l.setData(this,p,o.format,c,t),c+=o.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof li?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new U(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=Gt._priority.get(t.name);Gt._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new to(i);if(e.operator==="*")return i instanceof to?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof U?i.value:i instanceof O?Array.from(i.data):null;switch(e.operator){case"+":{if(he(s)){const c=s.map((f,d)=>+f);return new O(c,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(+o,l)}case"-":{if(he(s)){const c=s.map((f,d)=>-f);return new O(c,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(-o,l)}case"!":{if(he(s)){const c=s.map((f,d)=>f?0:1);return new O(c,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(o?0:1,l)}case"~":{if(he(s)){const c=s.map((f,d)=>~f);return new O(c,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(~o,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),o=i instanceof U?i.value:i instanceof O||i instanceof Re?Array.from(i.data):null,l=s instanceof U?s.value:s instanceof O||s instanceof Re?Array.from(s.data):null;switch(e.operator){case"+":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b+m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y+p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p+y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c+f,d)}case"-":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b-m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y-p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p-y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c-f,d)}case"*":{if(he(o)&&he(l)){const p=o,m=l;if(i instanceof Re&&s instanceof Re){const y=(function(R,E,B,M){if(nn[E.name]===void 0||nn[M.name]===void 0)return null;const D=nn[E.name][0],F=nn[E.name][1],W=nn[M.name][0];if(D!==nn[M.name][1])return null;const ee=new Array(W*F);for(let ae=0;ae<F;ae++)for(let ne=0;ne<W;ne++){let fe=0;for(let pe=0;pe<D;pe++)fe+=R[pe*F+ae]*B[ne*D+pe];ee[ae*W+ne]=fe}return ee})(p,i.typeInfo,m,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=nn[s.typeInfo.name][0],x=nn[i.typeInfo.name][1],T=this.getTypeInfo(`mat${b}x${x}f`);return new Re(y,T)}if(i instanceof Re&&s instanceof O){const y=(function(b,x,T,R){if(nn[x.name]===void 0||Vd[R.name]===void 0)return null;const E=nn[x.name][0],B=nn[x.name][1];if(E!==T.length)return null;const M=new Array(B);for(let D=0;D<B;D++){let F=0;for(let W=0;W<E;W++)F+=b[W*B+D]*T[W];M[D]=F}return M})(p,i.typeInfo,m,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new O(y,s.typeInfo)}if(i instanceof O&&s instanceof Re){const y=(function(b,x,T,R){if(Vd[x.name]===void 0||nn[R.name]===void 0)return null;const E=nn[R.name][0],B=nn[R.name][1];if(B!==b.length)return null;const M=[];for(let D=0;D<E;D++){let F=0;for(let W=0;W<B;W++)F+=b[W]*T[W*E+D];M[D]=F}return M})(p,i.typeInfo,m,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new O(y,i.typeInfo)}{if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b*m[x]);return new O(y,i.typeInfo)}}if(he(o)){const p=l,m=o.map((y,b)=>y*p);return i instanceof Re?new Re(m,i.typeInfo):new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p*y);return s instanceof Re?new Re(m,s.typeInfo):new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c*f,d)}case"%":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b%m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y%p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p%y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c%f,d)}case"/":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b/m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y/p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p/y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c/f,d)}case"&":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b&m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y&p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p&y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c&f,d)}case"|":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b|m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y|p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p|y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c|f,d)}case"^":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b^m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y^p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p^y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c^f,d)}case"<<":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b<<m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y<<p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p<<y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c<<f,d)}case">>":{if(he(o)&&he(l)){const p=o,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b>>m[x]);return new O(y,i.typeInfo)}if(he(o)){const p=l,m=o.map((y,b)=>y>>p);return new O(m,i.typeInfo)}if(he(l)){const p=o,m=l.map((y,b)=>p>>y);return new O(m,s.typeInfo)}const c=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c>>f,d)}case">":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p>f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d>c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c>d?1:0);return new O(f,s.typeInfo)}return new U(o>l?1:0,this.getTypeInfo("bool"));case"<":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p<f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d<c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c<d?1:0);return new O(f,s.typeInfo)}return new U(o<l?1:0,this.getTypeInfo("bool"));case"==":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p===f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d==c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c==d?1:0);return new O(f,s.typeInfo)}return new U(o===l?1:0,this.getTypeInfo("bool"));case"!=":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p!==f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d!==c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c!==d?1:0);return new O(f,s.typeInfo)}return new U(o!==l?1:0,this.getTypeInfo("bool"));case">=":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p>=f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d>=c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c>=d?1:0);return new O(f,s.typeInfo)}return new U(o>=l?1:0,this.getTypeInfo("bool"));case"<=":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p<=f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d<=c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c<=d?1:0);return new O(f,s.typeInfo)}return new U(o<=l?1:0,this.getTypeInfo("bool"));case"&&":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p&&f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d&&c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c&&d?1:0);return new O(f,s.typeInfo)}return new U(o&&l?1:0,this.getTypeInfo("bool"));case"||":if(he(o)&&he(l)){const c=o,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((p,m)=>p||f[m]?1:0);return new O(d,i.typeInfo)}if(he(o)){const c=l,f=o.map((d,p)=>d||c?1:0);return new O(f,i.typeInfo)}if(he(l)){const c=o,f=l.map((d,p)=>c||d?1:0);return new O(f,s.typeInfo)}return new U(o||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<s.node.args.length;++o){const l=s.node.args[o],c=this.evalExpression(e.args[o],i);i.createVariable(l.name,c,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let o=0;o<i.node.args.length;++o){const l=i.node.args[o],c=this.evalExpression(e.args[o],s);s.setVariable(l.name,c,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new U(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),o=Vd[s];if(o===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof Ot)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,t);if(f instanceof O){const d=f.data;for(let p=0;p<d.length;++p){let m=d[p];l.push(m)}}else if(f instanceof U){let d=f.value;l.push(d)}}if(e.type instanceof j&&e.type.format===null&&(e.type.format=j.f32),l.length===0){const c=new Array(o).fill(0);return new O(c,i).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<o;)l.push(l[0]);return l.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new O(l.length>o?l.slice(0,o):l,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),o=nn[s];if(o===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof Ot)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,t);f instanceof O?l.push(...f.data):f instanceof U?l.push(f.value):f instanceof Re&&l.push(...f.data)}if(i instanceof ar&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const c=new Array(o[2]).fill(0);return new Re(c,i).getSubData(this,e.postfix,t)}return l.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Re(l,i).getSubData(this,e.postfix,t)}}Gt._breakObj=new jn(new zn("BREAK",null),null),Gt._continueObj=new jn(new zn("CONTINUE",null),null),Gt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class IM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class NM{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new IM,this._exec=new Gt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,o=i.countNode;if(o instanceof En){const l=o.name,c=this._context.constants.get(l);if(c)try{const f=c.constEvaluate(this._exec);s.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof av||s instanceof cu?s.type=this._forwardType(s.type):s instanceof Xa?s.format=this._forwardType(s.format):s instanceof Ui||s instanceof $a||s instanceof lu?s.type=this._forwardType(s.type):s instanceof el?s.returnType=this._forwardType(s.returnType):s instanceof ov&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof rv){const t=this._getType(e.name);if(t)return t}else e instanceof cu?e.type=this._forwardType(e.type):e instanceof Xa&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new TM(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==w.eof}_match(e){if(e instanceof V)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const o of e){if(i===o)return!0;o===w.tokens.name&&(s=!0)}if(s){const o=w.tokens.name.rule.exec(t.lexeme);if(o&&o.index==0&&o[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===w.tokens.name){const i=w.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._match(w.keywords.alias)){const t=this._type_alias();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.diagnostic)){const t=this._diagnostic();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.requires)){const t=this._requires_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.enable)){const t=this._enable_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(w.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(w.keywords.fn))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected function name.").toString();this._consume(w.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(w.tokens.paren_right))do{if(this._check(w.tokens.paren_right))break;const c=this._attribute(),f=this._consume(w.tokens.name,"Expected argument name.").toString();this._consume(w.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(this._updateNode(new ov(f,p,c))))}while(this._match(w.tokens.comma));this._consume(w.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(w.tokens.arrow)){const c=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=c)}const o=this._compound_statement(),l=this._currentLine;return this._updateNode(new el(t,i,s,o,e,l),e)}_compound_statement(){const e=[];for(this._consume(w.tokens.brace_left,"Expected '{' for block.");!this._check(w.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(w.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._check(w.tokens.attr)&&this._attribute(),this._check(w.keywords.if))return this._if_statement();if(this._check(w.keywords.switch))return this._switch_statement();if(this._check(w.keywords.loop))return this._loop_statement();if(this._check(w.keywords.for))return this._for_statement();if(this._check(w.keywords.while))return this._while_statement();if(this._check(w.keywords.continuing))return this._continuing_statement();if(this._check(w.keywords.static_assert))return this._static_assert_statement();if(this._check(w.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(w.keywords.return))e=this._return_statement();else if(this._check([w.keywords.var,w.keywords.let,w.keywords.const]))e=this._variable_statement();else if(this._match(w.keywords.discard))e=this._updateNode(new bM);else if(this._match(w.keywords.break)){const t=this._updateNode(new C2);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(w.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(w.keywords.continue)){const t=this._updateNode(new M2);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(w.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(w.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new mM(t),e)}_while_statement(){if(!this._match(w.keywords.while))return null;const e=this._updateNode(new b2(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(w.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new Rp(i,e),t)}_for_statement(){if(!this._match(w.keywords.for))return null;this._consume(w.tokens.paren_left,"Expected '('.");const e=this._updateNode(new v2(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(w.tokens.semicolon)?null:this._for_init(),this._consume(w.tokens.semicolon,"Expected ';'."),e.condition=this._check(w.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(w.tokens.semicolon,"Expected ';'."),e.increment=this._check(w.tokens.paren_right)?null:this._for_increment(),this._consume(w.tokens.paren_right,"Expected ')'."),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(w.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(w.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Ui(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(w.keywords.let)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(w.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(w.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new $a(t,i,null,null,s),e)}if(this._match(w.keywords.const)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(w.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(w.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof Ot&&(i=s.type),this._updateNode(new lu(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(w.increment_operators))return this._current=e,null;const i=this._consume(w.increment_operators,"Expected increment operator");return this._updateNode(new x2(i.type===w.tokens.plus_plus?lo.increment:lo.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(w.tokens.brace_right))return null;let i=this._match(w.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(w.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new T2(Ba.parse(s.lexeme),e,o),t)}_func_call_statement(){if(!this._check(w.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(w.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new Og(i.lexeme,s),e)}_loop_statement(){if(!this._match(w.keywords.loop))return null;this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new S2([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof Rp){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(w.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(w.keywords.switch))return null;const e=this._updateNode(new A2(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(w.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([w.keywords.default,w.keywords.case]);){if(this._match(w.keywords.case)){const i=this._case_selectors();for(const o of i)if(o instanceof uu){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new D2(i,s)))}if(this._match(w.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new k2(i)))}}return e}_case_selectors(){const e=[];for(this._match(w.keywords.default)?e.push(this._updateNode(new uu)):e.push(this._shift_expression());this._match(w.tokens.comma);)this._match(w.keywords.default)?e.push(this._updateNode(new uu)):e.push(this._shift_expression());return e}_case_body(){if(this._match(w.keywords.fallthrough))return this._consume(w.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(w.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let o=null;return this._match(w.keywords.else)&&(this._check(w.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new w2(t,i,s,o),e)}_match_elseif(){return this._tokens[this._current].type===w.keywords.else&&this._tokens[this._current+1].type===w.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new vM(t,i))),this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(w.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new E2(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(w.tokens.or_or);)e=this._updateNode(new Kn(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(w.tokens.and_and);)e=this._updateNode(new Kn(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(w.tokens.or);)e=this._updateNode(new Kn(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(w.tokens.xor);)e=this._updateNode(new Kn(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(w.tokens.and);)e=this._updateNode(new Kn(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([w.tokens.equal_equal,w.tokens.not_equal])?this._updateNode(new Kn(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([w.tokens.less_than,w.tokens.greater_than,w.tokens.less_than_equal,w.tokens.greater_than_equal]);)e=this._updateNode(new Kn(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([w.tokens.shift_left,w.tokens.shift_right]);)e=this._updateNode(new Kn(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([w.tokens.plus,w.tokens.minus]);)e=this._updateNode(new Kn(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([w.tokens.star,w.tokens.forward_slash,w.tokens.modulo]);)e=this._updateNode(new Kn(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([w.tokens.minus,w.tokens.bang,w.tokens.tilde,w.tokens.star,w.tokens.and])?this._updateNode(new Rt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(w.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(w.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new To(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(w.tokens.period)){const e=this._consume(w.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new lr(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return ie.void;case"bool":return ie.bool;case"i32":return ie.i32;case"u32":return ie.u32;case"f32":return ie.f32;case"f16":return ie.f16;case"vec2f":return j.vec2f;case"vec3f":return j.vec3f;case"vec4f":return j.vec4f;case"vec2i":return j.vec2i;case"vec3i":return j.vec3i;case"vec4i":return j.vec4i;case"vec2u":return j.vec2u;case"vec3u":return j.vec3u;case"vec4u":return j.vec4u;case"vec2h":return j.vec2h;case"vec3h":return j.vec3h;case"vec4h":return j.vec4h;case"mat2x2f":return j.mat2x2f;case"mat2x3f":return j.mat2x3f;case"mat2x4f":return j.mat2x4f;case"mat3x2f":return j.mat3x2f;case"mat3x3f":return j.mat3x3f;case"mat3x4f":return j.mat3x4f;case"mat4x2f":return j.mat4x2f;case"mat4x3f":return j.mat4x3f;case"mat4x4f":return j.mat4x4f;case"mat2x2h":return j.mat2x2h;case"mat2x3h":return j.mat2x3h;case"mat2x4h":return j.mat2x4h;case"mat3x2h":return j.mat3x2h;case"mat3x3h":return j.mat3x3h;case"mat3x4h":return j.mat3x4h;case"mat4x2h":return j.mat4x2h;case"mat4x3h":return j.mat4x3h;case"mat4x4h":return j.mat4x4h;case"mat2x2i":return j.mat2x2i;case"mat2x3i":return j.mat2x3i;case"mat2x4i":return j.mat2x4i;case"mat3x2i":return j.mat3x2i;case"mat3x3i":return j.mat3x3i;case"mat3x4i":return j.mat3x4i;case"mat4x2i":return j.mat4x2i;case"mat4x3i":return j.mat4x3i;case"mat4x4i":return j.mat4x4i;case"mat2x2u":return j.mat2x2u;case"mat2x3u":return j.mat2x3u;case"mat2x4u":return j.mat2x4u;case"mat3x2u":return j.mat3x2u;case"mat3x3u":return j.mat3x3u;case"mat3x4u":return j.mat3x4u;case"mat4x2u":return j.mat4x2u;case"mat4x3u":return j.mat4x3u;case"mat4x4u":return j.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(w.tokens.ident)){const i=this._previous().toString();if(this._check(w.tokens.paren_left)){const s=this._argument_expression_list(),o=this._getType(i);return o!==null?this._updateNode(new li(o,s)):this._updateNode(new Ig(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new O2(i,s.value))}return this._updateNode(new En(i))}if(this._match(w.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?ie.i32:i.endsWith("u")||i.endsWith("U")?ie.u32:ie.x32;const o=parseInt(i);return this._validateTypeRange(o,s),this._updateNode(new Ot(new U(o,this._exec.getTypeInfo(s)),s))}if(this._match(w.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,ie.u32),this._updateNode(new Ot(new U(i,this._exec.getTypeInfo(ie.u32)),ie.u32))}if(this._match([w.tokens.decimal_float_literal,w.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const o=parseFloat(i);this._validateTypeRange(o,s?ie.f16:ie.f32);const l=s?ie.f16:ie.f32;return this._updateNode(new Ot(new U(o,this._exec.getTypeInfo(l)),l))}if(this._match([w.keywords.true,w.keywords.false])){let i=this._previous().toString()===w.keywords.true.rule;return this._updateNode(new Ot(new U(i?1:0,this._exec.getTypeInfo(ie.bool)),ie.bool))}if(this._check(w.tokens.paren_left))return this._paren_expression();if(this._match(w.keywords.bitcast)){this._consume(w.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(w.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new P2(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new li(e,t))}_argument_expression_list(){if(!this._match(w.tokens.paren_left))return null;const e=[];do{if(this._check(w.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(w.tokens.comma));return this._consume(w.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(w.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(w.tokens.paren_right),e}_paren_expression(){this._consume(w.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(w.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(w.keywords.struct))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected name for struct.").toString();this._consume(w.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(w.tokens.brace_right);){const l=this._attribute(),c=this._consume(w.tokens.name,"Expected variable name.").toString();this._consume(w.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=f),this._check(w.tokens.brace_right)?this._match(w.tokens.comma):this._consume(w.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new av(c,d,l)))}this._consume(w.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,o=this._updateNode(new Bi(t,i,e,s),e);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(w.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Ot){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Ot&&(e.type=e.value.type.name==="x32"?ie.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(w.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(w.keywords.const))return null;const t=this._consume(w.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(w.tokens.colon)){const f=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=f)}let o=null;this._consume(w.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let f=[ie.f32],d=l.constEvaluate(this._exec,f);d instanceof U&&this._validateTypeRange(d.value,f[0]),f[0]instanceof j&&f[0].format===null&&d.typeInfo instanceof ar&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?f[0].format=ie.f16:d.typeInfo.format.name==="f32"?f[0].format=ie.f32:d.typeInfo.format.name==="i32"?f[0].format=ie.i32:d.typeInfo.format.name==="u32"?f[0].format=ie.u32:d.typeInfo.format.name==="bool"?f[0].format=ie.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),o=this._updateNode(new Ot(d,f[0])),this._exec.context.setVariable(t.toString(),d)}catch{o=l}if(s!==null&&o instanceof Ot){if(o.type.name!=="x32"&&s.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${s.name}. Line:${this._currentLine}`);o.type=s,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else s===null&&o instanceof Ot&&(s=(e=o?.type)!==null&&e!==void 0?e:ie.f32,s===ie.x32&&(s=ie.i32));const c=this._updateNode(new lu(t.toString(),s,"","",o),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(w.keywords.let))return null;const e=this._currentLine,t=this._consume(w.tokens.name,"Expected variable name");let i=null;if(this._match(w.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let s=null;if(this._match(w.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof Ot){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof Ot&&(i=s.type.name==="x32"?ie.i32:s.type);return s instanceof Ot&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new $a(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(w.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(w.tokens.less_than)&&(t=this._consume(w.storage_class,"Expected storage_class.").toString(),this._match(w.tokens.comma)&&(i=this._consume(w.access_mode,"Expected access_mode.").toString()),this._consume(w.tokens.greater_than,"Expected '>'."));const s=this._consume(w.tokens.name,"Expected variable name");let o=null;if(this._match(w.tokens.colon)){const l=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=l)}return this._updateNode(new Ui(s.toString(),o,t,i,null),e)}_override_decl(){if(!this._match(w.keywords.override))return null;const e=this._consume(w.tokens.name,"Expected variable name");let t=null;if(this._match(w.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new Mg(e.toString(),t,null))}_diagnostic(){this._consume(w.tokens.paren_left,"Expected '('");const e=this._consume(w.tokens.ident,"Expected severity control name.");this._consume(w.tokens.comma,"Expected ','");let t=this._consume(w.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(w.tokens.period)&&(t+=`.${this._consume(w.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(w.tokens.paren_right,"Expected ')'"),this._updateNode(new R2(e.toString(),t))}_enable_directive(){const e=this._consume(w.tokens.ident,"identity expected.");return this._updateNode(new _M(e.toString()))}_requires_directive(){const e=[this._consume(w.tokens.ident,"identity expected.").toString()];for(;this._match(w.tokens.comma);){const t=this._consume(w.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new yM(e))}_type_alias(){const e=this._consume(w.tokens.ident,"identity expected.");this._consume(w.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new Pg(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([w.tokens.ident,...w.texel_format,w.keywords.bool,w.keywords.f32,w.keywords.i32,w.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new rv(i));return this._forwardTypeCount++,s}return this._updateNode(new ie(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(w.template_types)){let i=this._advance().toString(),s=null,o=null;return this._match(w.tokens.less_than)&&(s=this._type_decl(),o=null,this._match(w.tokens.comma)&&(o=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new j(i,s,o))}if(this._match(w.keywords.ptr)){let i=this._previous().toString();this._consume(w.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(w.storage_class,"Expected storage_class for pointer");this._consume(w.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let l=null;return this._match(w.tokens.comma)&&(l=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new cu(i,s.toString(),o,l))}const t=this._attribute();if(this._match(w.keywords.array)){let i=null,s=-1;const o=this._previous();let l=null;if(this._match(w.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let f="";if(this._match(w.tokens.comma)){l=this._shift_expression();try{f=l.constEvaluate(this._exec).toString(),l=null}catch{f="1"}}this._consume(w.tokens.greater_than,"Expected '>' for array."),s=f?parseInt(f):0}const c=this._updateNode(new Xa(o.toString(),t,i,s));return l&&this._deferArrayCountEval.push({arrayType:c,countNode:l}),c}return null}_texture_sampler_types(){if(this._match(w.sampler_type))return this._updateNode(new La(this._previous().toString(),null,null));if(this._match(w.depth_texture_type))return this._updateNode(new La(this._previous().toString(),null,null));if(this._match(w.sampled_texture_type)||this._match(w.multisampled_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new La(e.toString(),t,null))}if(this._match(w.storage_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(w.texel_format,"Invalid texel format.").toString();this._consume(w.tokens.comma,"Expected ',' after texel format.");const i=this._consume(w.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new La(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(w.tokens.attr);){const t=this._consume(w.attribute_name,"Expected attribute name"),i=this._updateNode(new B2(t.toString(),null));if(this._match(w.tokens.paren_left)){if(i.value=this._consume(w.literal_or_ident,"Expected attribute value").toString(),this._check(w.tokens.comma)){this._advance();do{const s=this._consume(w.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(w.tokens.comma))}this._consume(w.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class DM extends ui{constructor(e){super(),e&&this.update(e)}update(e){const t=new NM().parse(e);this.updateAST(t)}}function kM(n){const e={attributes:[],bindings:[]};let t;try{t=BM(n)}catch(o){return oe.error(o.message)(),e}for(const o of t.uniforms){const l=[];for(const c of o.type?.members||[])l.push({name:c.name,type:uv(c.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const i=t.entry.vertex[0],s=i?.inputs.length||0;for(let o=0;o<s;o++){const l=i.inputs[o];if(l.locationType==="location"){const c=uv(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:c})}}return e}function uv(n){return n?.format?`${n.name}<${n.format.name}>`:n.name}function BM(n){try{return new DM(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const LM={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...LM}};const pn=globalThis.mathgl.config;function UM(n,{precision:e=pn.precision}={}){return n=FM(n),`${parseFloat(n.toPrecision(e))}`}function cr(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function fi(n,e,t){return VM(n,i=>Math.max(e,Math.min(t,i)))}function Es(n,e,t){return cr(n)?n.map((i,s)=>Es(i,e[s],t)):t*e+(1-t)*n}function zi(n,e,t){const i=pn.EPSILON;try{if(n===e)return!0;if(cr(n)&&cr(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!zi(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=pn.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{pn.EPSILON=i}}function FM(n){return Math.round(n/pn.EPSILON)*pn.EPSILON}function zM(n){return n.clone?n.clone():new Array(n.length)}function VM(n,e,t){if(cr(n)){const i=n;t=t||zM(i);for(let s=0;s<t.length&&s<i.length;++s){const o=typeof n=="number"?n:n[s];t[s]=e(o,s,t)}return t}return e(n)}class Lg extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:cr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(pn)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+UM(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!zi(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const o=e[s],l=typeof t=="number"?t:t[s];this[s]=o+i*(l-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(pn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function HM(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function at(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function qa(n,e,t=""){if(pn.debug&&!HM(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function tl(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class L2 extends Lg{get x(){return this[0]}set x(e){this[0]=at(e)}get y(){return this[1]}set y(e){this[1]=at(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return at(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return at(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return tl(e>=0&&e<this.ELEMENTS,"index is out of range"),at(this[e])}setComponent(e,t){return tl(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Ya=1e-6;let Jn=typeof Float32Array<"u"?Float32Array:Array;function jM(){const n=new Jn(2);return Jn!=Float32Array&&(n[0]=0,n[1]=0),n}function Mp(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function WM(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function $M(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function XM(n){const e=n[0],t=n[1];return Math.sqrt(e*e+t*t)}function qM(n,e){return n[0]=-e[0],n[1]=-e[1],n}function U2(n,e,t,i){const s=e[0],o=e[1];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n}function YM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[3]*s+t[6],n[1]=t[1]*i+t[4]*s+t[7],n}function ZM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}const KM=WM;(function(){const n=jM();return function(e,t,i,s,o,l){let c,f;for(t||(t=2),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,c=i;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],o(n,n,l),e[c]=n[0],e[c+1]=n[1];return e}})();function GM(n,e,t){const i=e[0],s=e[1],o=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/o,n[1]=(t[1]*i+t[5]*s)/o,n}function F2(n,e,t){const i=e[0],s=e[1],o=e[2],l=t[3]*i+t[7]*s+t[11]*o||1;return n[0]=(t[0]*i+t[4]*s+t[8]*o)/l,n[1]=(t[1]*i+t[5]*s+t[9]*o)/l,n[2]=(t[2]*i+t[6]*s+t[10]*o)/l,n}function QM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function JM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n[3]=e[3],n}function z2(n,e,t){const i=e[0],s=e[1],o=e[2];return n[0]=t[0]*i+t[3]*s+t[6]*o,n[1]=t[1]*i+t[4]*s+t[7]*o,n[2]=t[2]*i+t[5]*s+t[8]*o,n[3]=e[3],n}function V2(){const n=new Jn(3);return Jn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function eO(n){const e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function fv(n,e,t){const i=new Jn(3);return i[0]=n,i[1]=e,i[2]=t,i}function tO(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function nO(n){const e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function iO(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function sO(n,e){const t=e[0],i=e[1],s=e[2];let o=t*t+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n}function H2(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function fu(n,e,t){const i=e[0],s=e[1],o=e[2],l=t[0],c=t[1],f=t[2];return n[0]=s*f-o*c,n[1]=o*l-i*f,n[2]=i*c-s*l,n}function rO(n,e,t,i){const s=e[0],o=e[1],l=e[2];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n[2]=l+i*(t[2]-l),n}function Ug(n,e,t){const i=e[0],s=e[1],o=e[2];let l=t[3]*i+t[7]*s+t[11]*o+t[15];return l=l||1,n[0]=(t[0]*i+t[4]*s+t[8]*o+t[12])/l,n[1]=(t[1]*i+t[5]*s+t[9]*o+t[13])/l,n[2]=(t[2]*i+t[6]*s+t[10]*o+t[14])/l,n}function j2(n,e,t){const i=e[0],s=e[1],o=e[2];return n[0]=i*t[0]+s*t[3]+o*t[6],n[1]=i*t[1]+s*t[4]+o*t[7],n[2]=i*t[2]+s*t[5]+o*t[8],n}function W2(n,e,t){const i=t[0],s=t[1],o=t[2],l=t[3],c=e[0],f=e[1],d=e[2];let p=s*d-o*f,m=o*c-i*d,y=i*f-s*c,b=s*y-o*m,x=o*p-i*y,T=i*m-s*p;const R=l*2;return p*=R,m*=R,y*=R,b*=2,x*=2,T*=2,n[0]=c+p+b,n[1]=f+m+x,n[2]=d+y+T,n}function oO(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0],o[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),o[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function aO(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),o[1]=s[1],o[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function lO(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function cO(n,e){const t=n[0],i=n[1],s=n[2],o=e[0],l=e[1],c=e[2],f=Math.sqrt((t*t+i*i+s*s)*(o*o+l*l+c*c)),d=f&&H2(n,e)/f;return Math.acos(Math.min(Math.max(d,-1),1))}const $2=tO,X2=eO,Hd=nO;(function(){const n=V2();return function(e,t,i,s,o,l){let c,f;for(t||(t=3),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,c=i;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],o(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2];return e}})();const jd=[0,0,0];let zc;class me extends L2{static get ZERO(){return zc||(zc=new me(0,0,0),Object.freeze(zc)),zc}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&cr(e)?this.copy(e):(pn.debug&&(at(e),at(t),at(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return pn.debug&&(at(e.x),at(e.y),at(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=at(e)}angle(e){return cO(this,e)}cross(e){return fu(this,this,e),this.check()}rotateX({radians:e,origin:t=jd}){return oO(this,this,t,e),this.check()}rotateY({radians:e,origin:t=jd}){return aO(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=jd}){return lO(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ug(this,this,e),this.check()}transformAsVector(e){return F2(this,this,e),this.check()}transformByMatrix3(e){return j2(this,this,e),this.check()}transformByMatrix2(e){return QM(this,this,e),this.check()}transformByQuaternion(e){return W2(this,this,e),this.check()}}let Vc;class Fg extends L2{static get ZERO(){return Vc||(Vc=new Fg(0,0,0,0),Object.freeze(Vc)),Vc}constructor(e=0,t=0,i=0,s=0){super(-0,-0,-0,-0),cr(e)&&arguments.length===1?this.copy(e):(pn.debug&&(at(e),at(t),at(i),at(s)),this[0]=e,this[1]=t,this[2]=i,this[3]=s)}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return pn.debug&&(at(e.x),at(e.y),at(e.z),at(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=at(e)}get w(){return this[3]}set w(e){this[3]=at(e)}transform(e){return Ug(this,this,e),this.check()}transformByMatrix3(e){return z2(this,this,e),this.check()}transformByMatrix2(e){return JM(this,this,e),this.check()}transformByQuaternion(e){return W2(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class q2 extends Lg{toString(){let e="[";if(pn.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=at(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function uO(){const n=new Jn(9);return Jn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function fO(n,e){if(n===e){const t=e[1],i=e[2],s=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=i,n[7]=s}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function hO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],c=e[5],f=e[6],d=e[7],p=e[8],m=p*l-c*d,y=-p*o+c*f,b=d*o-l*f;let x=t*m+i*y+s*b;return x?(x=1/x,n[0]=m*x,n[1]=(-p*i+s*d)*x,n[2]=(c*i-s*l)*x,n[3]=y*x,n[4]=(p*t-s*f)*x,n[5]=(-c*t+s*o)*x,n[6]=b*x,n[7]=(-d*t+i*f)*x,n[8]=(l*t-i*o)*x,n):null}function dO(n){const e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],l=n[5],c=n[6],f=n[7],d=n[8];return e*(d*o-l*f)+t*(-d*s+l*c)+i*(f*s-o*c)}function hv(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],c=e[4],f=e[5],d=e[6],p=e[7],m=e[8],y=t[0],b=t[1],x=t[2],T=t[3],R=t[4],E=t[5],B=t[6],M=t[7],D=t[8];return n[0]=y*i+b*l+x*d,n[1]=y*s+b*c+x*p,n[2]=y*o+b*f+x*m,n[3]=T*i+R*l+E*d,n[4]=T*s+R*c+E*p,n[5]=T*o+R*f+E*m,n[6]=B*i+M*l+D*d,n[7]=B*s+M*c+D*p,n[8]=B*o+M*f+D*m,n}function pO(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],c=e[4],f=e[5],d=e[6],p=e[7],m=e[8],y=t[0],b=t[1];return n[0]=i,n[1]=s,n[2]=o,n[3]=l,n[4]=c,n[5]=f,n[6]=y*i+b*l+d,n[7]=y*s+b*c+p,n[8]=y*o+b*f+m,n}function gO(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],c=e[4],f=e[5],d=e[6],p=e[7],m=e[8],y=Math.sin(t),b=Math.cos(t);return n[0]=b*i+y*l,n[1]=b*s+y*c,n[2]=b*o+y*f,n[3]=b*l-y*i,n[4]=b*c-y*s,n[5]=b*f-y*o,n[6]=d,n[7]=p,n[8]=m,n}function dv(n,e,t){const i=t[0],s=t[1];return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function mO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=t+t,c=i+i,f=s+s,d=t*l,p=i*l,m=i*c,y=s*l,b=s*c,x=s*f,T=o*l,R=o*c,E=o*f;return n[0]=1-m-x,n[3]=p-E,n[6]=y+R,n[1]=p+E,n[4]=1-d-x,n[7]=b-T,n[2]=y-R,n[5]=b+T,n[8]=1-d-m,n}var Op;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Op||(Op={}));const _O=Object.freeze([1,0,0,0,1,0,0,0,1]);class $t extends q2{static get IDENTITY(){return bO()}static get ZERO(){return yO()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Op}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(_O)}fromObject(e){return this.check()}fromQuaternion(e){return mO(this,e),this.check()}set(e,t,i,s,o,l,c,f,d){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=l,this[6]=c,this[7]=f,this[8]=d,this.check()}setRowMajor(e,t,i,s,o,l,c,f,d){return this[0]=e,this[1]=s,this[2]=c,this[3]=t,this[4]=o,this[5]=f,this[6]=i,this[7]=l,this[8]=d,this.check()}determinant(){return dO(this)}transpose(){return fO(this,this),this.check()}invert(){return hO(this,this),this.check()}multiplyLeft(e){return hv(this,e,this),this.check()}multiplyRight(e){return hv(this,this,e),this.check()}rotate(e){return gO(this,this,e),this.check()}scale(e){return Array.isArray(e)?dv(this,this,e):dv(this,this,[e,e]),this.check()}translate(e){return pO(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=YM(t||[-0,-0],e,this);break;case 3:i=j2(t||[-0,-0,-0],e,this);break;case 4:i=z2(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qa(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Hc,jc=null;function yO(){return Hc||(Hc=new $t([0,0,0,0,0,0,0,0,0]),Object.freeze(Hc)),Hc}function bO(){return jc||(jc=new $t,Object.freeze(jc)),jc}function vO(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xO(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],o=e[6],l=e[7],c=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=o,n[11]=e[14],n[12]=s,n[13]=l,n[14]=c}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Pp(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],c=e[5],f=e[6],d=e[7],p=e[8],m=e[9],y=e[10],b=e[11],x=e[12],T=e[13],R=e[14],E=e[15],B=t*c-i*l,M=t*f-s*l,D=t*d-o*l,F=i*f-s*c,W=i*d-o*c,ee=s*d-o*f,ae=p*T-m*x,ne=p*R-y*x,fe=p*E-b*x,pe=m*R-y*T,ge=m*E-b*T,xe=y*E-b*R;let de=B*xe-M*ge+D*pe+F*fe-W*ne+ee*ae;return de?(de=1/de,n[0]=(c*xe-f*ge+d*pe)*de,n[1]=(s*ge-i*xe-o*pe)*de,n[2]=(T*ee-R*W+E*F)*de,n[3]=(y*W-m*ee-b*F)*de,n[4]=(f*fe-l*xe-d*ne)*de,n[5]=(t*xe-s*fe+o*ne)*de,n[6]=(R*D-x*ee-E*M)*de,n[7]=(p*ee-y*D+b*M)*de,n[8]=(l*ge-c*fe+d*ae)*de,n[9]=(i*fe-t*ge-o*ae)*de,n[10]=(x*W-T*D+E*B)*de,n[11]=(m*D-p*W-b*B)*de,n[12]=(c*ne-l*pe-f*ae)*de,n[13]=(t*pe-i*ne+s*ae)*de,n[14]=(T*M-x*F-R*B)*de,n[15]=(p*F-m*M+y*B)*de,n):null}function TO(n){const e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],l=n[5],c=n[6],f=n[7],d=n[8],p=n[9],m=n[10],y=n[11],b=n[12],x=n[13],T=n[14],R=n[15],E=e*l-t*o,B=e*c-i*o,M=t*c-i*l,D=d*x-p*b,F=d*T-m*b,W=p*T-m*x,ee=e*W-t*F+i*D,ae=o*W-l*F+c*D,ne=d*M-p*B+m*E,fe=b*M-x*B+T*E;return f*ee-s*ae+R*ne-y*fe}function nr(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],c=e[4],f=e[5],d=e[6],p=e[7],m=e[8],y=e[9],b=e[10],x=e[11],T=e[12],R=e[13],E=e[14],B=e[15];let M=t[0],D=t[1],F=t[2],W=t[3];return n[0]=M*i+D*c+F*m+W*T,n[1]=M*s+D*f+F*y+W*R,n[2]=M*o+D*d+F*b+W*E,n[3]=M*l+D*p+F*x+W*B,M=t[4],D=t[5],F=t[6],W=t[7],n[4]=M*i+D*c+F*m+W*T,n[5]=M*s+D*f+F*y+W*R,n[6]=M*o+D*d+F*b+W*E,n[7]=M*l+D*p+F*x+W*B,M=t[8],D=t[9],F=t[10],W=t[11],n[8]=M*i+D*c+F*m+W*T,n[9]=M*s+D*f+F*y+W*R,n[10]=M*o+D*d+F*b+W*E,n[11]=M*l+D*p+F*x+W*B,M=t[12],D=t[13],F=t[14],W=t[15],n[12]=M*i+D*c+F*m+W*T,n[13]=M*s+D*f+F*y+W*R,n[14]=M*o+D*d+F*b+W*E,n[15]=M*l+D*p+F*x+W*B,n}function ku(n,e,t){const i=t[0],s=t[1],o=t[2];let l,c,f,d,p,m,y,b,x,T,R,E;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*o+e[12],n[13]=e[1]*i+e[5]*s+e[9]*o+e[13],n[14]=e[2]*i+e[6]*s+e[10]*o+e[14],n[15]=e[3]*i+e[7]*s+e[11]*o+e[15]):(l=e[0],c=e[1],f=e[2],d=e[3],p=e[4],m=e[5],y=e[6],b=e[7],x=e[8],T=e[9],R=e[10],E=e[11],n[0]=l,n[1]=c,n[2]=f,n[3]=d,n[4]=p,n[5]=m,n[6]=y,n[7]=b,n[8]=x,n[9]=T,n[10]=R,n[11]=E,n[12]=l*i+p*s+x*o+e[12],n[13]=c*i+m*s+T*o+e[13],n[14]=f*i+y*s+R*o+e[14],n[15]=d*i+b*s+E*o+e[15]),n}function zg(n,e,t){const i=t[0],s=t[1],o=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function SO(n,e,t,i){let s=i[0],o=i[1],l=i[2],c=Math.sqrt(s*s+o*o+l*l),f,d,p,m,y,b,x,T,R,E,B,M,D,F,W,ee,ae,ne,fe,pe,ge,xe,de,Xe;return c<Ya?null:(c=1/c,s*=c,o*=c,l*=c,d=Math.sin(t),f=Math.cos(t),p=1-f,m=e[0],y=e[1],b=e[2],x=e[3],T=e[4],R=e[5],E=e[6],B=e[7],M=e[8],D=e[9],F=e[10],W=e[11],ee=s*s*p+f,ae=o*s*p+l*d,ne=l*s*p-o*d,fe=s*o*p-l*d,pe=o*o*p+f,ge=l*o*p+s*d,xe=s*l*p+o*d,de=o*l*p-s*d,Xe=l*l*p+f,n[0]=m*ee+T*ae+M*ne,n[1]=y*ee+R*ae+D*ne,n[2]=b*ee+E*ae+F*ne,n[3]=x*ee+B*ae+W*ne,n[4]=m*fe+T*pe+M*ge,n[5]=y*fe+R*pe+D*ge,n[6]=b*fe+E*pe+F*ge,n[7]=x*fe+B*pe+W*ge,n[8]=m*xe+T*de+M*Xe,n[9]=y*xe+R*de+D*Xe,n[10]=b*xe+E*de+F*Xe,n[11]=x*xe+B*de+W*Xe,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function Y2(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[4],l=e[5],c=e[6],f=e[7],d=e[8],p=e[9],m=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*s+d*i,n[5]=l*s+p*i,n[6]=c*s+m*i,n[7]=f*s+y*i,n[8]=d*s-o*i,n[9]=p*s-l*i,n[10]=m*s-c*i,n[11]=y*s-f*i,n}function AO(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[0],l=e[1],c=e[2],f=e[3],d=e[8],p=e[9],m=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s-d*i,n[1]=l*s-p*i,n[2]=c*s-m*i,n[3]=f*s-y*i,n[8]=o*i+d*s,n[9]=l*i+p*s,n[10]=c*i+m*s,n[11]=f*i+y*s,n}function Z2(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[0],l=e[1],c=e[2],f=e[3],d=e[4],p=e[5],m=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s+d*i,n[1]=l*s+p*i,n[2]=c*s+m*i,n[3]=f*s+y*i,n[4]=d*s-o*i,n[5]=p*s-l*i,n[6]=m*s-c*i,n[7]=y*s-f*i,n}function wO(n,e){const t=e[0],i=e[1],s=e[2],o=e[4],l=e[5],c=e[6],f=e[8],d=e[9],p=e[10];return n[0]=Math.sqrt(t*t+i*i+s*s),n[1]=Math.sqrt(o*o+l*l+c*c),n[2]=Math.sqrt(f*f+d*d+p*p),n}function EO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=t+t,c=i+i,f=s+s,d=t*l,p=i*l,m=i*c,y=s*l,b=s*c,x=s*f,T=o*l,R=o*c,E=o*f;return n[0]=1-m-x,n[1]=p+E,n[2]=y-R,n[3]=0,n[4]=p-E,n[5]=1-d-x,n[6]=b+T,n[7]=0,n[8]=y+R,n[9]=b-T,n[10]=1-d-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function RO(n,e,t,i,s,o,l){const c=1/(t-e),f=1/(s-i),d=1/(o-l);return n[0]=o*2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*f,n[6]=0,n[7]=0,n[8]=(t+e)*c,n[9]=(s+i)*f,n[10]=(l+o)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*o*2*d,n[15]=0,n}function CO(n,e,t,i,s){const o=1/Math.tan(e/2);if(n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const MO=CO;function OO(n,e,t,i,s,o,l){const c=1/(e-t),f=1/(i-s),d=1/(o-l);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*c,n[13]=(s+i)*f,n[14]=(l+o)*d,n[15]=1,n}const PO=OO;function IO(n,e,t,i){let s,o,l,c,f,d,p,m,y,b;const x=e[0],T=e[1],R=e[2],E=i[0],B=i[1],M=i[2],D=t[0],F=t[1],W=t[2];return Math.abs(x-D)<Ya&&Math.abs(T-F)<Ya&&Math.abs(R-W)<Ya?vO(n):(m=x-D,y=T-F,b=R-W,s=1/Math.sqrt(m*m+y*y+b*b),m*=s,y*=s,b*=s,o=B*b-M*y,l=M*m-E*b,c=E*y-B*m,s=Math.sqrt(o*o+l*l+c*c),s?(s=1/s,o*=s,l*=s,c*=s):(o=0,l=0,c=0),f=y*c-b*l,d=b*o-m*c,p=m*l-y*o,s=Math.sqrt(f*f+d*d+p*p),s?(s=1/s,f*=s,d*=s,p*=s):(f=0,d=0,p=0),n[0]=o,n[1]=f,n[2]=m,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=c,n[9]=p,n[10]=b,n[11]=0,n[12]=-(o*x+l*T+c*R),n[13]=-(f*x+d*T+p*R),n[14]=-(m*x+y*T+b*R),n[15]=1,n)}function NO(){const n=new Jn(4);return Jn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function DO(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function Vg(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function kO(n){const e=n[0],t=n[1],i=n[2],s=n[3];return Math.sqrt(e*e+t*t+i*i+s*s)}function BO(n){const e=n[0],t=n[1],i=n[2],s=n[3];return e*e+t*t+i*i+s*s}function LO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3];let l=t*t+i*i+s*s+o*o;return l>0&&(l=1/Math.sqrt(l)),n[0]=t*l,n[1]=i*l,n[2]=s*l,n[3]=o*l,n}function UO(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function FO(n,e,t,i){const s=e[0],o=e[1],l=e[2],c=e[3];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n[2]=l+i*(t[2]-l),n[3]=c+i*(t[3]-c),n}function Co(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*o+t[12]*l,n[1]=t[1]*i+t[5]*s+t[9]*o+t[13]*l,n[2]=t[2]*i+t[6]*s+t[10]*o+t[14]*l,n[3]=t[3]*i+t[7]*s+t[11]*o+t[15]*l,n}function zO(n,e,t){const i=e[0],s=e[1],o=e[2],l=t[0],c=t[1],f=t[2],d=t[3],p=d*i+c*o-f*s,m=d*s+f*i-l*o,y=d*o+l*s-c*i,b=-l*i-c*s-f*o;return n[0]=p*d+b*-l+m*-f-y*-c,n[1]=m*d+b*-c+y*-l-p*-f,n[2]=y*d+b*-f+p*-c-m*-l,n[3]=e[3],n}(function(){const n=NO();return function(e,t,i,s,o,l){let c,f;for(t||(t=4),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,c=i;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],n[3]=e[c+3],o(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2],e[c+3]=n[3];return e}})();var Ip;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Ip||(Ip={}));const VO=45*Math.PI/180,HO=1,Wd=.1,$d=500,jO=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Wt extends q2{static get IDENTITY(){return $O()}static get ZERO(){return WO()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ip}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,o,l,c,f,d,p,m,y,b,x,T,R){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=l,this[6]=c,this[7]=f,this[8]=d,this[9]=p,this[10]=m,this[11]=y,this[12]=b,this[13]=x,this[14]=T,this[15]=R,this.check()}setRowMajor(e,t,i,s,o,l,c,f,d,p,m,y,b,x,T,R){return this[0]=e,this[1]=o,this[2]=d,this[3]=b,this[4]=t,this[5]=l,this[6]=p,this[7]=x,this[8]=i,this[9]=c,this[10]=m,this[11]=T,this[12]=s,this[13]=f,this[14]=y,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(jO)}fromObject(e){return this.check()}fromQuaternion(e){return EO(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:o,near:l=Wd,far:c=$d}=e;return c===1/0?XO(this,t,i,s,o,l):RO(this,t,i,s,o,l,c),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return IO(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:o,near:l=Wd,far:c=$d}=e;return PO(this,t,i,s,o,l,c),this.check()}orthographic(e){const{fovy:t=VO,aspect:i=HO,focalDistance:s=1,near:o=Wd,far:l=$d}=e;pv(t);const c=t/2,f=s*Math.tan(c),d=f*i;return this.ortho({left:-d,right:d,bottom:-f,top:f,near:o,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:o=500}=e;return pv(t),MO(this,t,i,s,o),this.check()}determinant(){return TO(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],o=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*o,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*o,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],o=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*o,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*o,e[8]=this[10]*l,e}transpose(){return xO(this,this),this.check()}invert(){return Pp(this,this),this.check()}multiplyLeft(e){return nr(this,e,this),this.check()}multiplyRight(e){return nr(this,this,e),this.check()}rotateX(e){return Y2(this,this,e),this.check()}rotateY(e){return AO(this,this,e),this.check()}rotateZ(e){return Z2(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return SO(this,this,e,t),this.check()}scale(e){return zg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ku(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Co(t||[-0,-0,-0,-0],e,this),qa(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=ZM(t||[-0,-0],e,this);break;case 3:s=Ug(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qa(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=GM(t||[-0,-0],e,this);break;case 3:i=F2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qa(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let Wc,$c;function WO(){return Wc||(Wc=new Wt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Wc)),Wc}function $O(){return $c||($c=new Wt,Object.freeze($c)),$c}function pv(n){if(n>Math.PI*2)throw Error("expected radians")}function XO(n,e,t,i,s,o){const l=2*o/(t-e),c=2*o/(s-i),f=(t+e)/(t-e),d=(s+i)/(s-i),p=-1,m=-1,y=-2*o;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=f,n[9]=d,n[10]=p,n[11]=m,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function gv(){const n=new Jn(4);return Jn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function qO(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function K2(n,e,t){t=t*.5;const i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function mv(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],c=t[0],f=t[1],d=t[2],p=t[3];return n[0]=i*p+l*c+s*d-o*f,n[1]=s*p+l*f+o*c-i*d,n[2]=o*p+l*d+i*f-s*c,n[3]=l*p-i*c-s*f-o*d,n}function YO(n,e,t){t*=.5;const i=e[0],s=e[1],o=e[2],l=e[3],c=Math.sin(t),f=Math.cos(t);return n[0]=i*f+l*c,n[1]=s*f+o*c,n[2]=o*f-s*c,n[3]=l*f-i*c,n}function ZO(n,e,t){t*=.5;const i=e[0],s=e[1],o=e[2],l=e[3],c=Math.sin(t),f=Math.cos(t);return n[0]=i*f-o*c,n[1]=s*f+l*c,n[2]=o*f+i*c,n[3]=l*f-s*c,n}function KO(n,e,t){t*=.5;const i=e[0],s=e[1],o=e[2],l=e[3],c=Math.sin(t),f=Math.cos(t);return n[0]=i*f+s*c,n[1]=s*f-i*c,n[2]=o*f+l*c,n[3]=l*f-o*c,n}function GO(n,e){const t=e[0],i=e[1],s=e[2];return n[0]=t,n[1]=i,n[2]=s,n[3]=Math.sqrt(Math.abs(1-t*t-i*i-s*s)),n}function hu(n,e,t,i){const s=e[0],o=e[1],l=e[2],c=e[3];let f=t[0],d=t[1],p=t[2],m=t[3],y,b,x,T,R;return y=s*f+o*d+l*p+c*m,y<0&&(y=-y,f=-f,d=-d,p=-p,m=-m),1-y>Ya?(b=Math.acos(y),R=Math.sin(b),x=Math.sin((1-i)*b)/R,T=Math.sin(i*b)/R):(x=1-i,T=i),n[0]=x*s+T*f,n[1]=x*o+T*d,n[2]=x*l+T*p,n[3]=x*c+T*m,n}function QO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=t*t+i*i+s*s+o*o,c=l?1/l:0;return n[0]=-t*c,n[1]=-i*c,n[2]=-s*c,n[3]=o*c,n}function JO(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function G2(n,e){const t=e[0]+e[4]+e[8];let i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[l*3+l]+1),n[s]=.5*i,i=.5/i,n[3]=(e[o*3+l]-e[l*3+o])*i,n[o]=(e[o*3+s]+e[s*3+o])*i,n[l]=(e[l*3+s]+e[s*3+l])*i}return n}const eP=DO,tP=Vg,nP=UO,iP=FO,sP=kO,rP=BO,Q2=LO,oP=(function(){const n=V2(),e=fv(1,0,0),t=fv(0,1,0);return function(i,s,o){const l=H2(s,o);return l<-.999999?(fu(n,e,s),X2(n)<1e-6&&fu(n,t,s),sO(n,n),K2(i,n,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(fu(n,s,o),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+l,Q2(i,i))}})();(function(){const n=gv(),e=gv();return function(t,i,s,o,l,c){return hu(n,i,l,c),hu(e,s,o,c),hu(t,n,e,2*c*(1-c)),t}})();(function(){const n=uO();return function(e,t,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Q2(e,G2(e,n))}})();const aP=[0,0,0,1];class _v extends Lg{constructor(e=0,t=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return G2(this,e),this.check()}fromAxisRotation(e,t){return K2(this,e,t),this.check()}identity(){return qO(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=at(e)}get y(){return this[1]}set y(e){this[1]=at(e)}get z(){return this[2]}set z(e){this[2]=at(e)}get w(){return this[3]}set w(e){this[3]=at(e)}len(){return sP(this)}lengthSquared(){return rP(this)}dot(e){return nP(this,e)}rotationTo(e,t){return oP(this,e,t),this.check()}add(e){return eP(this,this,e),this.check()}calculateW(){return GO(this,this),this.check()}conjugate(){return JO(this,this),this.check()}invert(){return QO(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):(iP(this,e,t,i),this.check())}multiplyRight(e){return mv(this,this,e),this.check()}multiplyLeft(e){return mv(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return YO(this,this,e),this.check()}rotateY(e){return ZO(this,this,e),this.check()}rotateZ(e){return KO(this,this,e),this.check()}scale(e){return tP(this,this,e),this.check()}slerp(e,t,i){let s,o,l;switch(arguments.length){case 1:({start:s=aP,target:o,ratio:l}=e);break;case 2:s=this,o=e,l=t;break;default:s=e,o=t,l=i}return hu(this,s,o,l),this.check()}transformVector4(e,t=new Fg){return zO(t,e,this),qa(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const lP=1e-15,cP=1e-20;function J2(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function uP(n){return n-Math.fround(n)}function fP(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;J2(n[i*4+t],e,s*2)}return e}const hP=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,dP={name:"fp32",vs:hP},pP=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,gP={ONE:1},mP={name:"fp64arithmetic",vs:pP,defaultUniforms:gP,uniformTypes:{ONE:"f32"},fp64ify:J2,fp64LowPart:uP,fp64ifyMatrix4:fP},_P=[0,1,1,1],yP=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,bP=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,yv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:_P},vs:yP,fs:bP,getUniforms:vP};function vP(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const bv=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,xP=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,TP=5,SP=255;var nl;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(nl||(nl={}));const du={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:nl.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:xP,vs:bv,fs:bv,getUniforms:AP};function AP(n,e={}){if(n=n&&{...n},!n)return{...du.defaultUniforms};n.lights&&(n={...n,...EP(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:s}=n||{};if(!(t||i&&i.length>0||s&&s.length>0))return{...du.defaultUniforms,enabled:0};const l={...du.defaultUniforms,...e,...wP({ambientLight:t,pointLights:i,directionalLights:s})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function wP({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientColor=Xd(n);let s=0;for(const o of e){i.lightType=nl.POINT;const l=s;i[`lightColor${l}`]=Xd(o),i[`lightPosition${l}`]=o.position,i[`lightAttenuation${l}`]=o.attenuation||[1,0,0],s++}for(const o of t){i.lightType=nl.DIRECTIONAL;const l=s;i[`lightColor${l}`]=Xd(o),i[`lightDirection${l}`]=o.direction,s++}return s>TP&&oe.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function EP(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function Xd(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/SP)}const RP=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,CP=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,MP=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,e3={props:{},name:"gouraudMaterial",vs:CP.replace("phongMaterial","gouraudMaterial"),fs:RP.replace("phongMaterial","gouraudMaterial"),source:MP.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[du],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...e3.defaultUniforms,...e}}},vv=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,OP={name:"layer",vs:vv,fs:vv,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},PP=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,IP={name:"color",dependencies:[],source:PP,getUniforms:n=>({}),uniformTypes:{opacity:"f32"}},NP=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,t3="#define SMOOTH_EDGE_RADIUS 0.5",DP=`${t3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,kP=`${t3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,n3={name:"geometry",source:NP,vs:DP,fs:kP},BP=25;var Ct;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(Ct||(Ct={}));var Pt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Pt||(Pt={}));var Ne;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Ne||(Ne={}));const LP="compute",UP="auto",Np="manipulation",pu="none",Dp="pan-x",kp="pan-y";function FP(n){if(n.includes(pu))return pu;const e=n.includes(Dp),t=n.includes(kp);return e&&t?pu:e||t?e?Dp:kp:n.includes(Np)?Np:UP}class zP{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===LP&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return FP(e.join(" "))}}function Bu(n){return n.trim().split(/\s+/g)}function qd(n,e,t){if(n)for(const i of Bu(e))n.addEventListener(i,t,!1)}function Yd(n,e,t){if(n)for(const i of Bu(e))n.removeEventListener(i,t,!1)}function xv(n){return(n.ownerDocument||n).defaultView}function VP(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function i3(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function Tv(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:i3(e),deltaX:n.deltaX,deltaY:n.deltaY}}function s3(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function Sv(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function HP(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function Av(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function r3(n,e){return n===e?Pt.None:Math.abs(n)>=Math.abs(e)?n<0?Pt.Left:Pt.Right:e<0?Pt.Up:Pt.Down}function jP(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const o=n.prevInput;return(e.eventType===Ct.Start||o?.eventType===Ct.End)&&(s=n.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function o3(n,e,t){return{x:e/n||0,y:t/n||0}}function WP(n,e){return Sv(e[0],e[1])/Sv(n[0],n[1])}function $P(n,e){return Av(e[1],e[0])-Av(n[1],n[0])}function XP(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,o,l,c;if(e.eventType!==Ct.Cancel&&(i>BP||t.velocity===void 0)){const f=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=o3(i,f,d);o=p.x,l=p.y,s=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,c=r3(f,d),n.lastInterval=e}else s=t.velocity,o=t.velocityX,l=t.velocityY,c=t.direction;e.velocity=s,e.velocityX=o,e.velocityY=l,e.direction=c}function qP(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=Tv(e)),s>1&&!t.firstMultiple?t.firstMultiple=Tv(e):s===1&&(t.firstMultiple=!1);const{firstInput:o,firstMultiple:l}=t,c=l?l.center:o.center,f=e.center=i3(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=HP(c,f),e.distance=s3(c,f);const{deltaX:d,deltaY:p}=jP(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=r3(e.deltaX,e.deltaY);const m=o3(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=l?WP(l.pointers,i):1,e.rotation=l?$P(l.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return VP(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,XP(t,e),e}function YP(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,o=e&Ct.Start&&i-s===0,l=e&(Ct.End|Ct.Cancel)&&i-s===0;t.isFirst=!!o,t.isFinal=!!l,o&&(n.session={}),t.eventType=e;const c=qP(n,t);n.emit("hammer.input",c),n.recognize(c),n.session.prevInput=c}let ZP=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){YP(this.manager,e,t)}init(){qd(this.element,this.evEl,this.domHandler),qd(this.target,this.evTarget,this.domHandler),qd(xv(this.element),this.evWin,this.domHandler)}destroy(){Yd(this.element,this.evEl,this.domHandler),Yd(this.target,this.evTarget,this.domHandler),Yd(xv(this.element),this.evWin,this.domHandler)}};const KP={pointerdown:Ct.Start,pointermove:Ct.Move,pointerup:Ct.End,pointercancel:Ct.Cancel,pointerout:Ct.Cancel},GP="pointerdown",QP="pointermove pointerup pointercancel";class JP extends ZP{constructor(e){super(e),this.evEl=GP,this.evWin=QP,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=KP[e.type],o=e.pointerType,l=o==="touch";let c=t.findIndex(f=>f.pointerId===e.pointerId);s&Ct.Start&&(e.buttons||l)?c<0&&(t.push(e),c=t.length-1):s&(Ct.End|Ct.Cancel)&&(i=!0),!(c<0)&&(t[c]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:o,srcEvent:e}),i&&t.splice(c,1))}}const eI=["","webkit","Moz","MS","ms","o"];function tI(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of eI){const s=i?i+t:e;if(s in n)return s}}const nI=1,wv=2,Ev={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class iI{constructor(e,t){this.options={...Ev,...t,cssProps:{...Ev.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new JP(this),this.touchAction=new zP(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?wv:nI}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:o}=t;(!o||o&&o.state&Ne.Recognized)&&(o=t.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],t.stopped!==wv&&(!o||i===o||i.canRecognizeWith(o))?i.recognize(e):i.reset(),!o&&i.state&(Ne.Began|Ne.Changed|Ne.Ended)&&(o=t.curRecognizer=i),l++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of Bu(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of Bu(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let o=0;for(;o<i.length;)i[o](s),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const o=tI(t.style,i);e?(this.oldCssProps[o]=t.style[o],t.style[o]=s):t.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}}let sI=1;function rI(){return sI++}function Rv(n){return n&Ne.Cancelled?"cancel":n&Ne.Ended?"end":n&Ne.Changed?"move":n&Ne.Began?"start":""}class a3{constructor(e){this.options=e,this.id=rI(),this.state=Ne.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ne.Ended&&this.manager.emit(this.options.event+Rv(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ne.Ended&&this.manager.emit(this.options.event+Rv(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ne.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ne.Failed|Ne.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ne.Failed;return}this.state&(Ne.Recognized|Ne.Cancelled|Ne.Failed)&&(this.state=Ne.Possible),this.state=this.process(t),this.state&(Ne.Began|Ne.Changed|Ne.Ended|Ne.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class l3 extends a3{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(Ne.Began|Ne.Changed),o=this.attrTest(e);return s&&(i&Ct.Cancel||!o)?t|Ne.Cancelled:s||o?i&Ct.End?t|Ne.Ended:t&Ne.Began?t|Ne.Changed:Ne.Began:Ne.Failed}}class Cv extends a3{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Np]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&Ct.Start&&this.count===0)return this.failTimeout();if(s&&o&&i){if(e.eventType!==Ct.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,c=!this.pCenter||s3(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ne.Recognized,this.tryEmit(this._input)},t.interval),Ne.Began):Ne.Recognized}return Ne.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ne.Failed},this.options.interval),Ne.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ne.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const oI=["","start","move","end","cancel","up","down","left","right"];class Mv extends l3{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Pt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Pt.Horizontal&&t.push(kp),e&Pt.Vertical&&t.push(Dp),t}getEventNames(){return oI.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:o}=e;const l=e.deltaX,c=e.deltaY;return o&t.direction||(t.direction&Pt.Horizontal?(o=l===0?Pt.None:l<0?Pt.Left:Pt.Right,i=l!==this.pX,s=Math.abs(e.deltaX)):(o=c===0?Pt.None:c<0?Pt.Up:Pt.Down,i=c!==this.pY,s=Math.abs(e.deltaY))),e.direction=o,i&&s>t.threshold&&!!(o&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ne.Began)||!(this.state&Ne.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Pt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const aI=["","start","move","end","cancel","in","out"];class lI extends l3{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[pu]}getEventNames(){return aI.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ne.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Yu{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const cI=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",uI=cI.indexOf("firefox")!==-1,Ov=4.000244140625,fI=40,hI=.25;class dI extends Yu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let o=s.deltaY;globalThis.WheelEvent&&(uI&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=fI)),o!==0&&o%Ov===0&&(o=Math.floor(o/Ov)),s.shiftKey&&o&&(o=o*hI),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-o,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Pv=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class pI extends Yu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Pv.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){Pv.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Iv=["keydown","keyup"];class gI extends Yu{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const o=s.target||s.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Iv.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Iv.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class mI extends Yu{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const Nv=1,Bp=2,Dv=4,_I={pointerdown:Nv,pointermove:Bp,pointerup:Dv,mousedown:Nv,mousemove:Bp,mouseup:Dv},yI=0,bI=1,vI=2,xI=1,TI=2,SI=4;function AI(n){const e=_I[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,o=!1,l=!1;return e===Bp?(s=!!(t&xI),o=!!(t&SI),l=!!(t&TI)):(s=i===yI,o=i===bI,l=i===vI),{leftButton:s,middleButton:o,rightButton:l}}function wI(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,l={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/o};return{center:t,offsetCenter:l}}const EI={srcElement:"root",priority:0};class RI{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let o=i.srcEvent.target;for(;o&&o!==s.rootElement;){if(this._emit(s,o),s.handled)return;o=o.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,o=!1){const{handlers:l,handlersByElement:c}=this,f={...EI,...i};let d=c.get(f.srcElement);d||(d=[],c.set(f.srcElement,d));const p={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};s&&(p.once=!0),o&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let m=d.length-1;for(;m>=0&&!(d[m].priority>=p.priority);)m--;d.splice(m+1,0,p)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.type===e&&l.handler===t){i.splice(o,1);const c=s.get(l.srcElement);c.splice(c.indexOf(l),1),c.length===0&&s.delete(l.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const o=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},c=[];for(let f=0;f<i.length;f++){const{type:d,handler:p,once:m}=i[f];if(p({...e,type:d,stopPropagation:o,stopImmediatePropagation:l}),m&&c.push(i[f]),s)break}for(let f=0;f<c.length;f++){const{type:d,handler:p}=c[f];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...AI(e),...wI(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function CI(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class MI{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new iI(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:o,requireFailure:l}=CI(i);this.manager.add(s),o&&s.recognizeWith(o),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new dI(e,this._onOtherEvent,{enable:!1}),this.moveInput=new pI(e,this._onOtherEvent,{enable:!1}),this.keyInput=new gI(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new mI(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,s,o){if(typeof e!="string"){i=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,i,s,o);return}const{manager:l,events:c}=this;if(!l)return;let f=c.get(e);if(!f){const d=this._getRecognizerName(e)||e;f=new RI(this,d),c.set(e,f),l&&l.on(e,f.handleEvent)}f.add(e,t,i,s,o),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[o,l]of Object.entries(e))this._removeEventHandler(o,l);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:o}=s;let l=!1;for(const c of i.values())if(c.recognizerName===o&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const He={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(He,"IDENTITY",{get:()=>(Le.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Rn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Hi={common:0,meters:1,pixels:2},Lp={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},kv={multipan:[Mv,{threshold:10,direction:Pt.Vertical,pointers:2}],pinch:[lI,{},null,["multipan"]],pan:[Mv,{threshold:1},["pinch"],["multipan"]],dblclick:[Cv,{event:"dblclick",taps:2}],click:[Cv,{event:"click"},null,["dblclick"]]};function OI(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function dl(n){let e={},t;return i=>{for(const s in i)if(!OI(i[s],e[s])){t=n(i),e=i;break}return t}}const Bv=[0,0,0,0],PI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],c3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],II=[0,0,0],u3=[0,0,0],NI=dl(BI);function f3(n,e,t=u3){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,o=!0;switch(e===He.LNGLAT_OFFSETS||e===He.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Rn.WEB_MERCATOR:(e===He.LNGLAT||e===He.CARTESIAN)&&(s=[0,0,0],o=!1);break;case Rn.WEB_MERCATOR_AUTO_OFFSET:e===He.LNGLAT?i=s:e===He.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Rn.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case Rn.GLOBE:o=!1,s=null;break;default:o=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:o}}function DI(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:o,viewProjectionMatrix:l}=n,c=Bv,f=Bv,d=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:m,offsetMode:y}=f3(n,e,t);return y&&(f=n.projectPosition(p||m),d=[d[0]-f[0],d[1]-f[1],d[2]-f[2]],f[3]=1,c=Co([],f,l),o=i||o,l=nr([],s,o),l=nr([],l,PI)),{viewMatrix:o,viewProjectionMatrix:l,projectionCenter:c,originCommon:f,cameraPosCommon:d,shaderCoordinateOrigin:m,geospatialOrigin:p}}function kI({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=He.DEFAULT,coordinateOrigin:s=u3,autoWrapLongitude:o=!1}){i===He.DEFAULT&&(i=n.isGeospatial?He.LNGLAT:He.CARTESIAN);const l=NI({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=o,l.modelMatrix=t||c3,l}function BI({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:o,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:d}=DI(n,t,i),p=n.getDistanceScales(),m=[n.width*e,n.height*e],y=Co([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,b={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:II,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:c3,cameraPosition:c};if(d){const x=n.getDistanceScales(d);switch(t){case He.METER_OFFSETS:b.commonUnitsPerWorldUnit=x.unitsPerMeter,b.commonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case He.LNGLAT:case He.LNGLAT_OFFSETS:n._pseudoMeters||(b.commonUnitsPerMeter=x.unitsPerMeter),b.commonUnitsPerWorldUnit=x.unitsPerDegree,b.commonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case He.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return b}const LI=Object.keys(He).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${He[n]};`).join(""),UI=Object.keys(Rn).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Rn[n]};`).join(""),FI=Object.keys(Hi).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Hi[n]};`).join(""),zI=`${LI}
${UI}
${FI}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,VI=`${zI}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,HI=Object.keys(He).map(n=>`const int COORDINATE_SYSTEM_${n} = ${He[n]};`).join(""),jI=Object.keys(Rn).map(n=>`const int PROJECTION_MODE_${n} = ${Rn[n]};`).join(""),WI=Object.keys(Hi).map(n=>`const int UNIT_${n.toUpperCase()} = ${Hi[n]};`).join(""),$I=`${HI}
${jI}
${WI}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,XI={};function qI(n=XI){return"viewport"in n?kI(n):{}}const Hg={name:"project",dependencies:[dP,n3],source:VI,vs:$I,getUniforms:qI,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},YI=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,ZI=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Mo={name:"project32",dependencies:[Hg],source:YI,vs:ZI};function KI(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bo(n,e){const t=Co([],e,n);return Vg(t,t,1/t[3]),t}function Lv(n,e){const t=n%e;return t<0?e+t:t}function GI(n,e,t){return t*e+(1-t)*n}function Up(n,e,t){return n<e?e:n>t?t:n}function QI(n){return Math.log(n)*Math.LOG2E}const jg=Math.log2||QI;function ji(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Gn=Math.PI,h3=Gn/4,Vn=Gn/180,Fp=180/Gn,So=512,Lu=4003e4,hi=85.051129,JI=1.5;function Uv(n){return Math.pow(2,n)}function d3(n){return jg(n)}function di(n){const[e,t]=n;ji(Number.isFinite(e)),ji(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*Vn,s=t*Vn,o=So*(i+Gn)/(2*Gn),l=So*(Gn+Math.log(Math.tan(h3+s*.5)))/(2*Gn);return[o,l]}function ur(n){const[e,t]=n,i=e/So*(2*Gn)-Gn,s=2*(Math.atan(Math.exp(t/So*(2*Gn)-Gn))-h3);return[i*Fp,s*Fp]}function e4(n){const{latitude:e}=n;ji(Number.isFinite(e));const t=Math.cos(e*Vn);return d3(Lu*t)-9}function Zd(n){const e=Math.cos(n*Vn);return So/Lu/e}function zp(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;ji(Number.isFinite(e)&&Number.isFinite(t));const s=So,o=Math.cos(e*Vn),l=s/360,c=l/o,f=s/Lu/o,d={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,c,f],degreesPerUnit:[1/l,1/c,1/f]};if(i){const p=Vn*Math.tan(e*Vn)/o,m=l*p/2,y=s/Lu*p,b=y/c*f;d.unitsPerDegree2=[0,m,y],d.unitsPerMeter2=[b,0,b]}return d}function p3(n,e){const[t,i,s]=n,[o,l,c]=e,{unitsPerMeter:f,unitsPerMeter2:d}=zp({longitude:t,latitude:i,highPrecision:!0}),p=di(n);p[0]+=o*(f[0]+d[0]*l),p[1]+=l*(f[1]+d[1]*l);const m=ur(p),y=(s||0)+(c||0);return Number.isFinite(s)||Number.isFinite(c)?[m[0],m[1],y]:m}function t4(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:o,center:l}=n,c=KI();ku(c,c,[0,0,-s]),Y2(c,c,-t*Vn),Z2(c,c,i*Vn);const f=o/e;return zg(c,c,[f,f,f]),l&&ku(c,c,iO([],l)),c}function n4(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:o,center:l,scale:c,nearZMultiplier:f=1,farZMultiplier:d=1}=n;let{fovy:p=il(JI)}=n;i!==void 0&&(p=il(i));const m=p*Vn,y=s*Vn,b=Wg(p);let x=b;l&&(x+=l[2]*c/Math.cos(y)/t);const T=m*(.5+(o?o[1]:0)/t),R=Math.sin(T)*x/Math.sin(Up(Math.PI/2-y-T,.01,Math.PI-.01)),E=Math.sin(y)*R+x,B=x*10,M=Math.min(E*d,B);return{fov:m,aspect:e/t,focalDistance:b,near:f,far:M}}function il(n){return 2*Math.atan(.5/n)*Fp}function Wg(n){return .5/Math.tan(.5*n*Vn)}function g3(n,e){const[t,i,s=0]=n;return ji(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),bo(e,[t,i,s,1])}function $g(n,e,t=0){const[i,s,o]=n;if(ji(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(o))return bo(e,[i,s,o,1]);const l=bo(e,[i,s,0,1]),c=bo(e,[i,s,1,1]),f=l[2],d=c[2],p=f===d?0:((t||0)-f)/(d-f);return U2([],l,c,p)}function i4(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:o=24,offset:l=[0,0]}=n,[[c,f],[d,p]]=i,m=s4(n.padding),y=di([c,Up(p,-hi,hi)]),b=di([d,Up(f,-hi,hi)]),x=[Math.max(Math.abs(b[0]-y[0]),s),Math.max(Math.abs(b[1]-y[1]),s)],T=[e-m.left-m.right-Math.abs(l[0])*2,t-m.top-m.bottom-Math.abs(l[1])*2];ji(T[0]>0&&T[1]>0);const R=T[0]/x[0],E=T[1]/x[1],B=(m.right-m.left)/2/R,M=(m.top-m.bottom)/2/E,D=[(b[0]+y[0])/2+B,(b[1]+y[1])/2+M],F=ur(D),W=Math.min(o,jg(Math.abs(Math.min(R,E))));return ji(Number.isFinite(W)),{longitude:F[0],latitude:F[1],zoom:W}}function s4(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(ji(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Fv=Math.PI/180;function r4(n,e=0){const{width:t,height:i,unproject:s}=n,o={targetZ:e},l=s([0,i],o),c=s([t,i],o);let f,d;const p=n.fovy?.5*n.fovy*Fv:Math.atan(.5/n.altitude),m=(90-n.pitch)*Fv;return p>m-.01?(f=zv(n,0,e),d=zv(n,t,e)):(f=s([0,0],o),d=s([t,0],o)),[l,c,d,f]}function zv(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=bo(i,[e,0,1,1]),o=bo(i,[e,n.height,1,1]),c=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(o[2]-s[2]),f=U2([],s,o,c),d=ur(f);return d.push(t),d}const Vv=512;function o4(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:o,zoom:l,bearing:c=0}=n;(s<-180||s>180)&&(s=Lv(s+180,360)-180),(c<-180||c>180)&&(c=Lv(c+180,360)-180);const f=jg(t/Vv);if(l<=f)l=f,o=0;else{const d=t/2/Math.pow(2,l),p=ur([0,d])[1];if(o<p)o=p;else{const m=ur([0,Vv-d])[1];o>m&&(o=m)}}return{width:e,height:t,longitude:s,latitude:o,zoom:l,pitch:i,bearing:c}}const m3=.01,a4=["longitude","latitude","zoom"],_3={curve:1.414,speed:1.2};function l4(n,e,t,i){const{startZoom:s,startCenterXY:o,uDelta:l,w0:c,u1:f,S:d,rho:p,rho2:m,r0:y}=y3(n,e,i);if(f<m3){const D={};for(const F of a4){const W=n[F],ee=e[F];D[F]=GI(W,ee,t)}return D}const b=t*d,x=Math.cosh(y)/Math.cosh(y+p*b),T=c*((Math.cosh(y)*Math.tanh(y+p*b)-Math.sinh(y))/m)/f,R=1/x,E=s+d3(R),B=$M([],l,T);Mp(B,B,o);const M=ur(B);return{longitude:M[0],latitude:M[1],zoom:E}}function c4(n,e,t){const i={..._3,...t},{screenSpeed:s,speed:o,maxDuration:l}=i,{S:c,rho:f}=y3(n,e,i),d=1e3*c;let p;return Number.isFinite(s)?p=d/(s/f):p=d/o,Number.isFinite(l)&&p>l?0:p}function y3(n,e,t){t=Object.assign({},_3,t);const i=t.curve,s=n.zoom,o=[n.longitude,n.latitude],l=Uv(s),c=e.zoom,f=[e.longitude,e.latitude],d=Uv(c-s),p=di(o),m=di(f),y=KM([],m,p),b=Math.max(n.width,n.height),x=b/d,T=XM(y)*l,R=Math.max(T,m3),E=i*i,B=(x*x-b*b+E*E*R*R)/(2*b*E*R),M=(x*x-b*b-E*E*R*R)/(2*x*E*R),D=Math.log(Math.sqrt(B*B+1)-B),F=Math.log(Math.sqrt(M*M+1)-M),W=(F-D)/i;return{startZoom:s,startCenterXY:p,uDelta:y,w0:b,u1:T,S:W,rho:i,rho2:E,r0:D,r1:F}}const b3=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,u4=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,f4=`
${b3}
${u4}
`,h4=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,d4=`
${b3}
${h4}
`,p4=dl(b4),g4=dl(v4),m4=[0,0,0,1],_4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function y4(n,e){const[t,i,s]=n,o=$g([t,i,s],e);return Number.isFinite(s)?o:[o[0],o[1],0]}function b4({viewport:n,center:e}){return new Wt(n.viewProjectionMatrix).invert().transform(e)}function v4({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,o=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>y4(l,i));for(const l of e){const c=l.clone().translate(new me(n.center).negate()),f=o.map(p=>c.transform(p)),d=new Wt().ortho({left:Math.min(...f.map(p=>p[0])),right:Math.max(...f.map(p=>p[0])),bottom:Math.min(...f.map(p=>p[1])),top:Math.max(...f.map(p=>p[1])),near:Math.min(...f.map(p=>-p[2])),far:Math.max(...f.map(p=>-p[2]))});t.push(d.multiplyRight(l))}return t}function x4(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=Hg.getUniforms(t),s=p4({viewport:t.viewport,center:i.center}),o=[],l=g4({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<n.shadowMatrices.length;f++){const d=l[f],p=d.clone().translate(new me(t.viewport.center).negate());i.coordinateSystem===He.LNGLAT&&i.projectionMode===Rn.WEB_MERCATOR?(l[f]=p,o[f]=s):(l[f]=d.clone().multiplyRight(_4),o[f]=p.transform(s))}const c={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||m4,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let f=0;f<l.length;f++)c[`viewProjectionMatrix${f}`]=l[f],c[`projectCenter${f}`]=o[f];for(let f=0;f<2;f++)c[`shadow_uShadowMap${f}`]=n.shadowMaps&&n.shadowMaps[f]||n.dummyShadowMap;return c}const Hv={name:"shadow",dependencies:[Hg],vs:f4,fs:d4,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:x4,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Oo={...yv,defaultUniforms:{...yv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},T4=[n3],S4=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],A4=[];function w4(n){const e=Gs.getDefaultShaderAssembler();for(const i of T4)e.addDefaultModule(i);e._hookFunctions.length=0;const t=n==="glsl"?S4:A4;for(const i of t)e.addShaderHook(i);return e}const E4=[255,255,255],R4=1;let C4=0;class M4{constructor(e={}){this.type="ambient";const{color:t=E4}=e,{intensity:i=R4}=e;this.id=e.id||`ambient-${C4++}`,this.color=t,this.intensity=i}}const O4=[255,255,255],P4=1,I4=[0,0,-1];let N4=0;class jv{constructor(e={}){this.type="directional";const{color:t=O4}=e,{intensity:i=P4}=e,{direction:s=I4}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${N4++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new me(s).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class D4{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Xg extends D4{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,o=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,c=s?0:!1,f=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=f),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:o,clearDepth:l,clearStencil:c});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:o,views:l,onViewportActive:c,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const d=[];for(const p of o){const m=l&&l[p.id];c?.(p);const y=this._getDrawLayerParams(p,t),b=p.subViewports||[p];for(const x of b){const T=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:x,view:m,pass:t.pass,layers:t.layers},y);d.push(T)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:o,cullRect:l,effects:c,shaderModuleProps:f},d=!1){const p=[],m=v3(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:l},b={};for(let x=0;x<t.length;x++){const T=t[x],R=this._shouldDrawLayer(T,y,o,b),E={shouldDrawLayer:R};R&&!d&&(E.shouldDrawLayer=!0,E.layerRenderIndex=m(T,R),E.shaderModuleProps=this._getShaderModuleProps(T,c,i,f),E.layerParameters={...T.context.deck?.props.parameters,...this.getLayerParameters(T,x,e)}),p[x]=E}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:o,viewport:l,view:c},f){const d=k4(this.device,{shaderModuleProps:i,target:o,viewport:l});if(c){const{clear:m,clearColor:y,clearDepth:b,clearStencil:x}=c.props;if(m){let T=[0,0,0,0],R=1,E=0;Array.isArray(y)?T=[...y.slice(0,3),y[3]||255].map(M=>M/255):y===!1&&(T=!1),b!==void 0&&(R=b),x!==void 0&&(E=x),this.device.beginRenderPass({framebuffer:o,parameters:{viewport:d,scissorRect:d},clearColor:T,clearDepth:R,clearStencil:E}).end()}}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let m=0;m<t.length;m++){const y=t[m],b=f[m],{shouldDrawLayer:x}=b;if(x&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:T,shaderModuleProps:R,layerParameters:E}=b;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,T),R.project&&(R.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:R,uniforms:{layerIndex:T},parameters:E})}catch(B){y.raiseError(B,`drawing ${y} to ${s}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(i){const c=t.layer.id;if(c in s||(s[c]=i(t)),!s[c])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){const o=this.device.canvasContext.cssToDeviceRatio(),l=e.internalState?.propsInTransition||e.props,c={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const f of t)Wv(c,f.getShaderModuleProps?.(e,c));return Wv(c,this.getShaderModuleProps(e,t,c),s)}}function v3(n=0,e={}){const t={},i=(s,o)=>{const l=s.props._offset,c=s.id,f=s.parent&&s.parent.id;let d;if(f&&!(f in e)&&i(s.parent,!1),f in t){const p=t[f]=t[f]||v3(e[f],e);d=p(s,o),t[c]=p}else Number.isFinite(l)?(d=l+(e[f]||0),t[c]=null):d=n;return o&&d>=n&&(n=d+1),e[c]=d,d};return i}function k4(n,{shaderModuleProps:e,target:t,viewport:i}){const s=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,o]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:o,c=i;return[c.x*s,l-(c.y+c.height)*s,c.width*s,c.height*s]}function Wv(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class B4 extends Xg{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],o=s.width*i,l=s.height*i,c=[1,1,1,1];(o!==t.width||l!==t.height)&&t.resize({width:o,height:l}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const L4={color:[255,255,255],intensity:1},$v=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],U4=[0,0,0,200/255];class x3{constructor(e={}){this.id="lighting-effect",this.shadowColor=U4,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(Hv),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:o,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:i,lighting:s,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Hv))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Wt().lookAt({eye:new me(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new B4(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new M4(L4),this.directionalLights.push(new jv($v[0]),new jv($v[1])))}}class F4{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:o=0,copy:l=!1,initialize:c=!1,maxCount:f}){const d=s||e&&e.constructor||Float32Array,p=t*i+o;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let m=1/0;f&&(m=f*i+o);const y=this._allocate(d,p,c,m);return e&&l?y.set(e):c||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>s&&(o=s);const l=this._pool,c=e.BYTES_PER_ELEMENT*o,f=l.findIndex(d=>d.byteLength>=c);if(f>=0){const d=new e(l.splice(f,1)[0],0,o);return i&&d.fill(0),d}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,o=t.findIndex(l=>l.byteLength>=s);o<0?t.push(i):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,i),t.length>this.opts.poolSize&&t.shift()}}const Ao=new F4;function Ua(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function z4(n,e){const t=n%e;return t<0?e+t:t}function V4(n){return[n[12],n[13],n[14]]}function H4(n){return{left:no(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:no(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:no(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:no(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:no(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:no(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Xv=new me;function no(n,e,t,i){Xv.set(n,e,t);const s=Xv.len();return{distance:i/s,normal:new me(-n/s,-e/s,-t/s)}}function j4(n){return n-Math.fround(n)}let Oa;function Kd(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,o=(s-i)/t;Oa=Ao.allocate(Oa,o,{type:Float32Array,size:t*2});let l=i,c=0;for(;l<s;){for(let f=0;f<t;f++){const d=n[l++];Oa[c+f]=d,Oa[c+f+t]=j4(d)}c+=t*2}return Oa.subarray(0,o*t*2)}function W4(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const $4=Math.PI/180,X4=Ua(),qv=[0,0,0],q4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Y4({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:o,near:l,far:c}){const f=n/e,d=t?new Wt().orthographic({fovy:i,aspect:f,focalDistance:s,near:l,far:c}):new Wt().perspective({fovy:i,aspect:f,near:l,far:c});if(o){const{left:p=0,right:m=0,top:y=0,bottom:b=0}=o,x=fi((p+n-m)/2,0,n)-n/2,T=fi((y+e-b)/2,0,e)-e/2;d[8]-=x*2/n,d[9]+=T*2/e}return d}class Po{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||q4,this.focalDistance=e.focalDistance||1,this.position=e.position||qv,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Rn.WEB_MERCATOR:Rn.WEB_MERCATOR_AUTO_OFFSET:Rn.IDENTITY}equals(e){return e instanceof Po?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&zi(e.projectionMatrix,this.projectionMatrix)&&zi(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=g3(i,this.pixelProjectionMatrix),[o,l]=s,c=t?l:this.height-l;return e.length===2?[o,c]:[o,c,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,o,l]=e,c=t?o:this.height-o,f=i&&i*this.distanceScales.unitsPerMeter[2],d=$g([s,c,l],this.pixelUnprojectionMatrix,f),[p,m,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=di(e);return t[1]=fi(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ur(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],o[0],l[0]),Math.min(i[1],s[1],o[1],l[1]),Math.max(i[0],s[0],o[0],l[0]),Math.max(i[1],s[1],o[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?zp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,H4(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t,i){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=e4({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||zp({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:o,modelMatrix:l}=e;let c=qv;if(o&&(c=l?new Wt(l).transformAsVector(o,[]):o),this.isGeospatial){const f=this.projectPosition([t,i,0]);this.center=new me(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:t=X4,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:o,fovy:l=75,near:c=.1,far:f=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Wt().multiplyRight(t).translate(new me(this.center).negate()),this.projectionMatrix=i||Y4({width:this.width,height:this.height,orthographic:s,fovyRadians:o||l*$4,focalDistance:p,padding:d,near:c,far:f});const m=Ua();nr(m,m,this.projectionMatrix),nr(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=Pp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=V4(this.viewMatrixInverse);const y=Ua(),b=Ua();zg(y,y,[this.width/2,-this.height/2,1]),ku(y,y,[1,-1,0]),nr(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=Pp(Ua(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Le.warn("Pixel project matrix not invertible")()}}Po.displayName="Viewport";class Wi extends Po{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:o=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:d,farZ:p,orthographic:m=!1,projectionMatrix:y,repeat:b=!1,worldOffset:x=0,position:T,padding:R,legacyMeterSizes:E=!1}=e;let{width:B,height:M,altitude:D=1.5}=e;const F=Math.pow(2,s);B=B||1,M=M||1;let W,ee=null;if(y)D=y[5]/2,W=il(D);else{e.fovy?(W=e.fovy,D=Wg(W)):W=il(D);let ne;if(R){const{top:fe=0,bottom:pe=0}=R;ne=[0,fi((fe+M-pe)/2,0,M)-M/2]}ee=n4({width:B,height:M,scale:F,center:T&&[0,0,T[2]*Zd(t)],offset:ne,pitch:o,fovy:W,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(d)&&(ee.near=d),Number.isFinite(p)&&(ee.far=p)}let ae=t4({height:M,pitch:o,bearing:l,scale:F,altitude:D});x&&(ae=new Wt().translate([512*x,0,0]).multiplyLeft(ae)),super({...e,width:B,height:M,viewMatrix:ae,longitude:i,latitude:t,zoom:s,...ee,fovy:W,focalDistance:D}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=o,this.bearing=l,this.altitude=D,this.fovy=W,this.orthographic=m,this._subViewports=b?[]:null,this._pseudoMeters=E,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const o=s?new Wi({...this,worldOffset:s}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*Zd(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/Zd(i);return[t,i,s]}addMetersToLngLat(e,t){return p3(e,t)}panByPosition(e,t,i){const s=$g(t,this.pixelUnprojectionMatrix),o=this.projectFlat(e),l=Mp([],o,qM([],s)),c=Mp([],this.center,l),[f,d]=this.unprojectFlat(c);return{longitude:f,latitude:d}}getBounds(e={}){const t=r4(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:o,latitude:l,zoom:c}=i4({width:i,height:s,bounds:e,...t});return new Wi({width:i,height:s,longitude:o,latitude:l,zoom:c})}}Wi.displayName="WebMercatorViewport";const Yv=[0,0,0];function Gd(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof Wi){const[s,o,l=0]=n,c=e.getDistanceScales([s,o]);i[2]=l*c.unitsPerMeter[2]}return i}function Z4(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=n;return s===He.DEFAULT&&(s=e.isGeospatial?He.LNGLAT:He.CARTESIAN),o===void 0&&(o=s),l===void 0&&(l=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:l}}function T3(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:o}){let[l,c,f=0]=n;switch(t&&([l,c,f]=Co([],[l,c,f,1],t)),i){case He.LNGLAT:return Gd([l,c,f],e,o);case He.LNGLAT_OFFSETS:return Gd([l+s[0],c+s[1],f+(s[2]||0)],e,o);case He.METER_OFFSETS:return Gd(p3(s,[l,c,f]),e,o);case He.CARTESIAN:default:return e.isGeospatial?[l+s[0],c+s[1],f+s[2]]:e.projectPosition([l,c,f])}}function K4(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:o,fromCoordinateSystem:l,fromCoordinateOrigin:c}=Z4(e),{autoOffset:f=!0}=e,{geospatialOrigin:d=Yv,shaderCoordinateOrigin:p=Yv,offsetMode:m=!1}=f?f3(t,i,s):{},y=T3(n,{viewport:t,modelMatrix:o,coordinateSystem:l,coordinateOrigin:c,offsetMode:m});if(m){const b=t.projectPosition(d||p);$2(y,y,b)}return y}let G4=1,Q4=1;class S3{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:o=1}=e,l=G4++,c={time:0,delay:t,duration:i,rate:s,repeat:o};return this._setChannelTime(c,this.time),this.channels.set(l,c),l}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:o,channel:l}=s;o.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=Q4++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function J4(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function eN(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let tN=0;class qg{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:wp.stats.get(`animation-loop-${tN++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...qg.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new ul({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=J4(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(eN(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,i=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let i=1;const s=this.device?.getDefaultCanvasContext().canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Qd={};function pl(n="id"){Qd[n]=Qd[n]||1;const e=Qd[n]++;return`${n}-${e}`}class Zv{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||pl("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&lt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function nN(n,e){if(e instanceof Zv)return e;const t=iN(n,e),{attributes:i,bufferLayout:s}=sN(n,e);return new Zv({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function iN(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:lt.INDEX,data:t})}function sN(n,e){const t=[],i={};for(const[o,l]of Object.entries(e.attributes)){let c=o;switch(o){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(l){i[c]=n.createBuffer({data:l.value,id:`${o}-buffer`});const{value:f,size:d,normalized:p}=l;t.push({name:c,format:lC(f,d,p)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}class Yg{static defaultProps={...tr.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Yg(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...tr.defaultProps,...e},i=this._renderPipelineCache,s=this._hashRenderPipeline(t);let o=i[s]?.pipeline;return o?(i[s].useCount++,this.debug&&oe.log(3,`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${e.id})`)()):(o=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:pl("unnamed-cached")}),o.hash=s,i[s]={pipeline:o,useCount:1},this.debug&&oe.log(3,`${this}: ${o} created, count=${i[s].useCount}`)()),o}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...Cu.defaultProps,...e},i=this._computePipelineCache,s=this._hashComputePipeline(t);let o=i[s]?.pipeline;return o?(i[s].useCount++,this.debug&&oe.log(3,`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${e.id})`)()):(o=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),o.hash=s,i[s]={pipeline:o,useCount:1},this.debug&&oe.log(3,`${this}: ${o} created, count=${i[s].useCount}`)()),o}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),i=e.hash;t[i].useCount--,t[i].useCount===0?(this._destroyPipeline(e),this.debug&&oe.log(3,`${this}: ${e} released and destroyed`)()):t[i].useCount<0?(oe.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[i].useCount=0):this.debug&&oe.log(3,`${this}: ${e} released, count=${t[i].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Cu&&(t=this._computePipelineCache),e instanceof tr&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,i=this._getHash(e.shader.source);return`${t}/C/${i}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",o=this._getHash(JSON.stringify(e.bufferLayout)),{type:l}=this.device;if(l==="webgl")return`${l}/R/${t}/${i}V${s}BL${o}`;{const c=this._getHash(JSON.stringify(e.parameters));return`${l}/R/${t}/${i}V${s}T${e.topology}P${c}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Zg{static defaultProps={...Xu.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Zg(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let i=this._cache[t];if(i)i.useCount++,this.debug&&oe.log(3,`${this}: Reusing shader ${i.shader.id} count=${i.useCount}`)();else{const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:1},this.debug&&oe.log(3,`${this}: Created new shader ${s.id}`)()}return i.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),i=this._cache[t];if(i)if(i.useCount--,i.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy(),this.debug&&oe.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(i.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&oe.log(3,`${this}: Releasing shader ${e.id} count=${i.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function rN(n,e){const t={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of n.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;t[`in ${o}`]={[i]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const o=`${s.location} ${s.name}`;t[`out ${o}`]={[i]:JSON.stringify(s)}}return t}let Lt=null,Jd=null;function oN(n,{id:e,minimap:t,opaque:i,top:s="0",left:o="0",rgbaScale:l=1}){Lt||(Lt=document.createElement("canvas"),Lt.id=e,Lt.title=e,Lt.style.zIndex="100",Lt.style.position="absolute",Lt.style.top=s,Lt.style.left=o,Lt.style.border="blue 5px solid",Lt.style.transform="scaleY(-1)",document.body.appendChild(Lt),Jd=Lt.getContext("2d")),(Lt.width!==n.width||Lt.height!==n.height)&&(Lt.width=n.width/2,Lt.height=n.height/2,Lt.style.width="400px",Lt.style.height="400px");const c=n.device.readPixelsToArrayWebGL(n),f=Jd?.createImageData(n.width,n.height);if(f){for(let p=0;p<c.length;p+=4)f.data[0+p+0]=c[p+0]*l,f.data[0+p+1]=c[p+1]*l,f.data[0+p+2]=c[p+2]*l,f.data[0+p+3]=i?255:c[p+3]*l;Jd?.putImageData(f,0,0)}}function Vp(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Vp(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!Vp(n[o],e[o],t-1))return!1;return!0}return!1}class ep{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const o=i.findIndex(l=>l.name===s.name);o<0?i.push(s):i[o]=s}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&oe.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function aN(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=e.slice();return i.sort((s,o)=>{const l=s.attributes?s.attributes.map(p=>p.attribute):[s.name],c=o.attributes?o.attributes.map(p=>p.attribute):[o.name],f=Math.min(...l.map(p=>t[p])),d=Math.min(...c.map(p=>t[p]));return f-d}),i}function lN(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function cN(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function uN(n){return lN(n)||cN(n)}function fN(n){return uN(n)||typeof n=="number"||typeof n=="boolean"}function hN(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];fN(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class dN{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=yg(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;oe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,o]of Object.entries(e))this._addModule(o),o.name&&s!==o.name&&!this.options.disableWarnings&&oe.warn(`Module name: ${s} vs ${o.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||oe.warn(`Module ${t} not found`)();continue}const l=this.moduleUniforms[i],c=this.moduleBindings[i],f=o.getUniforms?.(s,l)||s,{uniforms:d,bindings:p}=hN(f);this.moduleUniforms[i]={...l,...d},this.moduleBindings[i]={...c,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${t}.${s}`]={type:this.modules[t].uniformTypes?.[s],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let pN="";async function gN(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:pN+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const mN=["+X","-X","+Y","-Y","+Z","-Z"],_N=["+X","-X","+Y","-Y","+Z","-Z"];class Za{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const i=pl("async-texture");this.props={...Za.defaultProps,id:i,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=gN(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((s,o)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=o}),this.initAsync(t)}async initAsync(e){const t=e.data,i=await A3(t).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(i);if(!s)throw new Error("Texture size could not be determined");const o={...s,...e,data:void 0,mipLevels:1},l=this.device.getMipLevelCount(o.width,o.height);if(o.mipLevels=this.props.mipLevels==="auto"?l:Math.min(l,this.props.mipLevels),this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,i);break;case"2d":this._setTexture2DData(i);break;case"3d":this._setTexture3DData(this.texture,i);break;case"2d-array":this._setTextureArrayData(this.texture,i);break;case"cube":this._setTextureCubeData(this.texture,i);break;case"cube-array":this._setTextureCubeArrayData(this.texture,i);break}this.props.mipmaps&&this.generateMipmaps(),oe.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof or?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const i=this._normalizeTextureData(e);i.length>1&&this.props.mipmaps!==!1&&oe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this.device.isExternalImage(o)?this.texture.copyExternalImage({image:o,depth:t,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:o.data,mipLevel:s})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[i,s]of Object.entries(t)){const o=_N.indexOf(i);this._setTexture2DData(s,o)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,i,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&oe.warn(`${this.id} has mipmap and multiple LODs.`)();const o=mN.indexOf(i);this._setTexture2DData(t,o)}_normalizeTextureData(e){const t=this.texture;let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static defaultProps={...It.defaultProps,data:null,mipmaps:!1}}async function A3(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(A3));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let o=0;o<i.length;o++)s[i[o]]=t[o];return s}return n}const Ys=2,yN=1e4;class Hn{static defaultProps={...tr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Gs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Hn.defaultProps,...t},t=this.props,this.id=t.id||pl("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(f=>[f.name,f])||[]),s=t.shaderInputs||new dN(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const o=vN(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:f,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:l});this.source=f,this._getModuleUniforms=d,this.props.shaderLayout||=kM(this.source)}else{const{vs:f,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:l});this.vs=f,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Yg.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Zg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return oe.info(Ys,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings});const{indexBuffer:o}=this.vertexArray,l=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&nN(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new ep(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ep(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Vp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new rM(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(bN(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&oe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=aN(this.pipeline.shaderLayout,this.bufferLayout);const s=new ep(this.bufferLayout);for(const[o,l]of Object.entries(e)){const c=s.getBufferLayout(o);if(!c){i||oe.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const f=s.getAttributeNamesForBuffer(c);let d=!1;for(const p of f){const m=this._attributeInfos[p];if(m){const y=this.device.type==="webgpu"?s.getBufferIndex(m.bufferName):m.location;this.vertexArray.setBuffer(y,l),d=!0}}!d&&!i&&oe.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const o=this._attributeInfos[i];o?this.vertexArray.setConstantWebGL(o.location,s):(t?.disableWarnings??this.props.disableWarnings)||oe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Za&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Za?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof $u?e=Math.max(e,t.texture.updateTimestamp):t instanceof lt||t instanceof It?e=Math.max(e,t.updateTimestamp):t instanceof Za?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof or||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(oe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=p2(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=oe.level>3?0:yN;oe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,oe.group(Ys,`>>> DRAWING MODEL ${this.id}`,{collapsed:oe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=rN(this.pipeline.shaderLayout,this.id);oe.table(Ys,e)();const t=this.shaderInputs.getDebugTable();oe.table(Ys,t)();const i=this._getAttributeDebugTable();oe.table(Ys,this._attributeInfos)(),oe.table(Ys,i)(),oe.groupEnd(Ys)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&oN(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=vg(t);return(e instanceof lt?new i(e.debugData):e).toString()}}function bN(n){return!!(n.uniformTypes&&!xN(n.uniformTypes))}function vN(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function xN(n){for(const e in n)return!1;return!0}class wo{device;model;transformFeedback;static defaultProps={...Hn.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=wo.defaultProps){if(!wo.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Hn(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||eC(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof lt)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:o=i.byteLength}=t;return i.readAsync(s,o)}}class Eo{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||pl("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[o,l]of Object.entries(t)){const c=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!c.size&&(c.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[o]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:o,size:l,constant:c}=s;!c&&o&&l!==void 0&&l>=1&&(i=Math.min(i,o.length/l))}return i}}const TN={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class w3 extends Xg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,pickingFBO:l,deviceRect:{x:c,y:f,width:d,height:p},cullRect:m,effects:y,pass:b="picking",pickZ:x,shaderModuleProps:T}){this.pickZ=x;const R=this._resetColorEncoder(x),E=[c,f,d,p],B=super.render({target:l,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,cullRect:m,effects:y?.filter(D=>D.useInPicking),pass:b,isPicking:!0,shaderModuleProps:T,clearColor:[0,0,0,0],colorMask:15,scissorRect:E});return this._colorEncoderState=null,{decodePickingColor:R&&AN.bind(null,R),stats:B}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:o,operation:l}=e.props;return this._colorEncoderState?o&&l.includes("draw")?(Object.assign(s,TN),s.blend=!0,s.blendColor=SN(this._colorEncoderState,e,i)):l.includes("terrain")&&(s.blend=!1):s.blend=!1,s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function SN(n,e,t){const{byLayer:i,byAlpha:s}=n;let o,l=i.get(e);return l?(l.viewports.push(t),o=l.a):(o=i.size+1,o<=255?(l={a:o,layer:e,viewports:[t]},i.set(e,l),s[o]=l):(Le.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function AN(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const oo={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Uu=Symbol.for("component"),Rs=Symbol.for("propTypes"),tp=Symbol.for("deprecatedProps"),vo=Symbol.for("asyncPropDefaults"),fr=Symbol.for("asyncPropOriginal"),Ss=Symbol.for("asyncPropResolved");function Zu(n,e=()=>!0){return Array.isArray(n)?E3(n,e,[]):e(n)?[n]:[]}function E3(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?E3(s,e,t):e(s)&&t.push(s)}return t}function wN({target:n,source:e,start:t=0,count:i=1}){const s=e.length,o=i*s;let l=0;for(let c=t;l<s;l++)n[c++]=e[l];for(;l<o;)l<o-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+o-l),l=o);return n}class EN{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=Au(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class RN{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let o=this._resources[e];o?o.setData(t,i):(o=new EN(e,t,this._context),this._resources[e]=o),o.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],o=this._resources[s.resourceId];o&&o.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:o,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=o[e];if(this._track(i,s,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const o=this._consumers,l=o[e]=o[e]||{};let c=l[t];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),i&&(c?(c.onChange=s,c.resourceId=i.id):c={onChange:s,resourceId:i.id},l[t]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const CN="layerManager.setLayers",MN="layerManager.activateViewport";class ON{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{Qt(MN,this,c),c&&(this.context.viewport=c)};const{deck:i,stats:s,viewport:o,timeline:l}=t||{};this.layers=[],this.resourceManager=new RN({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:w4(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[OP],renderPass:void 0,stats:s||new ul({id:"deck.gl"}),viewport:o||new Po({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new S3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Qt(CN,this,t,e),this._lastRenderedLayers=e;const i=Zu(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const l of e)i[l.id]?Le.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let o=!1;for(const l of s)if(l.hasUniformTransition()){o=`Uniform transition in ${l}`;break}this._needsUpdate=o,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const o=t[s.id];o===null&&Le.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let l=null;try{this._debug&&o!==s&&s.validateProps(),o?(this._transferLayerState(o,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(c){this._handleError("matching",c,s)}l&&this._updateSublayersRecursively(l,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=oo.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=oo.MATCHED,t!==e&&(e.lifecycle=oo.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=oo.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=oo.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Fn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Fn(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!Fn(n[o],e[o],t-1))return!1;return!0}return!1}class PN{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){const l=i[o];if(l.containsPixel(s)){const c=e.slice();return c[0]-=l.x,c[1]-=l.y,l.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Zu(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Fn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Le.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(e.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(e,t,i,s){const o=e.controller;if(o&&i){const l={...t,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==o.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const o=e[s],l=this.getViewState(o),c=o.makeViewport({viewState:l,width:this.width,height:this.height});let f=t[o.id];const d=!!o.controller;d&&!f&&(i=!0),(i||!d)&&f&&(f.finalize(),f=null),this.controllers[o.id]=this._updateController(o,l,c,f),c&&this._viewports.unshift(c)}for(const s in t){const o=t[s];o&&!this.controllers[s]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const IN=/^(?:\d+\.?\d*|\.\d+)$/;function ms(n){switch(typeof n){case"number":if(!Number.isFinite(n))throw new Error(`Could not parse position string ${n}`);return{type:"literal",value:n};case"string":try{const e=NN(n);return new DN(e).parseExpression()}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`Could not parse position string ${n}: ${t}`)}default:throw new Error(`Could not parse position string ${n}`)}}function Hp(n,e){switch(n.type){case"literal":return n.value;case"percentage":return Math.round(n.value*e);case"binary":const t=Hp(n.left,e),i=Hp(n.right,e);return n.operator==="+"?t+i:t-i;default:throw new Error("Unknown layout expression type")}}function _s(n,e){return Hp(n,e)}function NN(n){const e=[];let t=0;for(;t<n.length;){const i=n[t];if(/\s/.test(i)){t++;continue}if(i==="+"||i==="-"||i==="("||i===")"||i==="%"){e.push({type:"symbol",value:i}),t++;continue}if(Kv(i)||i==="."){const s=t;let o=i===".";for(t++;t<n.length;){const c=n[t];if(Kv(c)){t++;continue}if(c==="."&&!o){o=!0,t++;continue}break}const l=n.slice(s,t);if(!IN.test(l))throw new Error("Invalid number token");e.push({type:"number",value:parseFloat(l)});continue}if(Gv(i)){const s=t;for(;t<n.length&&Gv(n[t]);)t++;const o=n.slice(s,t).toLowerCase();e.push({type:"word",value:o});continue}throw new Error("Invalid token in position string")}return e}class DN{constructor(e){this.index=0,this.tokens=e}parseExpression(){const e=this.parseBinaryExpression();if(this.index<this.tokens.length)throw new Error("Unexpected token at end of expression");return e}parseBinaryExpression(){let e=this.parseFactor(),t=this.peek();for(;kN(t);){this.index++;const i=this.parseFactor();e={type:"binary",operator:t.value,left:e,right:i},t=this.peek()}return e}parseFactor(){const e=this.peek();if(!e)throw new Error("Unexpected end of expression");if(e.type==="symbol"&&e.value==="+")return this.index++,this.parseFactor();if(e.type==="symbol"&&e.value==="-"){this.index++;const t=this.parseFactor();return{type:"binary",operator:"-",left:{type:"literal",value:0},right:t}}if(e.type==="symbol"&&e.value==="("){this.index++;const t=this.parseBinaryExpression();if(!this.consumeSymbol(")"))throw new Error("Missing closing parenthesis");return t}if(e.type==="word"&&e.value==="calc"){if(this.index++,!this.consumeSymbol("("))throw new Error("Missing opening parenthesis after calc");const t=this.parseBinaryExpression();if(!this.consumeSymbol(")"))throw new Error("Missing closing parenthesis");return t}if(e.type==="number"){this.index++;const t=e.value,i=this.peek();return i&&i.type==="symbol"&&i.value==="%"?(this.index++,{type:"percentage",value:t/100}):i&&i.type==="word"&&i.value==="px"?(this.index++,{type:"literal",value:t}):{type:"literal",value:t}}throw new Error("Unexpected token in expression")}consumeSymbol(e){const t=this.peek();return t&&t.type==="symbol"&&t.value===e?(this.index++,!0):!1}peek(){return this.tokens[this.index]||null}}function Kv(n){return n>="0"&&n<="9"}function Gv(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}function kN(n){return!!(n&&n.type==="symbol"&&(n.value==="+"||n.value==="-"))}class hr{constructor(e){const{id:t,x:i=0,y:s=0,width:o="100%",height:l="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ms(i),this._y=ms(s),this._width=ms(o),this._height=ms(l),this._padding=c&&{left:ms(c.left||0),right:ms(c.right||0),top:ms(c.top||0),bottom:ms(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Fn(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const o=this.getViewportType(i);return new o({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:_s(this._x,e),y:_s(this._y,t),width:_s(this._width,e),height:_s(this._height,t)};return this._padding&&(i.padding={left:_s(this._padding.left,e),top:_s(this._padding.top,t),right:_s(this._padding.right,e),bottom:_s(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ku{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Qv=()=>{},jp={BREAK:1,SNAP_TO_END:2,IGNORE:3},BN=n=>n,LN=jp.BREAK;class UN{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:o,endProps:l,duration:c,easing:f}}=t,d=f(i/c),p=s.interpolateProps(o,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ku(e.timeline),this.onViewStateChange=e.onViewStateChange||Qv,this.onStateChange=e.onStateChange||Qv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:o,endProps:l}=this.transition.settings;s={...i,...o===jp.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===jp.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),o=t.transitionInterpolator,l=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(l===0)return;const c=o.initializeProps(e,s);this.propsInTransition={};const f={duration:l,easing:t.transitionEasing||BN,interpolator:o,interruption:t.transitionInterruption||LN,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Ut(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class R3{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!zi(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const o of this._propsToExtract)(o in e||o in t)&&(i[o]=e[o],s[o]=t[o]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];Ut(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const Xc=Math.PI/180,Jv=180/Math.PI,gu=6370972,co=256;function FN(){const n=co/gu,e=Math.PI/180*co;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class Gu extends Po{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:s=.5,farZMultiplier:o=1,resolution:l=10}=e;let{latitude:c=0,height:f,altitude:d=1.5,fovy:p}=e;c=Math.max(Math.min(c,hi),-hi),f=f||1,p?d=Wg(p):p=il(d);const m=Math.pow(2,i-uo(c)),y=e.nearZ??s,b=e.farZ??(d+co*2*m/f)*o,x=new Wt().lookAt({eye:[0,-d,0],up:[0,0,1]});x.rotateX(c*Xc),x.rotateZ(-t*Xc),x.scale(m/f),super({...e,height:f,viewMatrix:x,longitude:t,latitude:c,zoom:i,distanceScales:FN(),fovy:p,focalDistance:d,near:y,far:b}),this.scale=m,this.latitude=c,this.longitude=t,this.fovy=p,this.resolution=l}get projectionMode(){return Rn.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),o=this.unproject([this.width,this.height/2],t),l=this.unproject([this.width/2,this.height],t);return o[0]<this.longitude&&(o[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],o[0],s[0],l[0]),Math.min(i[1],o[1],s[1],l[1]),Math.max(i[0],o[0],s[0],l[0]),Math.max(i[1],o[1],s[1],l[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,o,l]=e,c=t?o:this.height-o,{pixelUnprojectionMatrix:f}=this;let d;if(Number.isFinite(l))d=np(f,[s,c,l,1]);else{const b=np(f,[s,c,-1,1]),x=np(f,[s,c,1,1]),T=((i||0)/gu+1)*co,R=Hd($2([],b,x)),E=Hd(b),B=Hd(x),D=4*((4*E*B-(R-E-B)**2)/16)/R,F=Math.sqrt(E-D),W=Math.sqrt(Math.max(0,T*T-D)),ee=(F-W)/Math.sqrt(R);d=rO([],b,x,ee)}const[p,m,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[t,i,s=0]=e,o=t*Xc,l=i*Xc,c=Math.cos(l),f=(s/gu+1)*co;return[Math.sin(o)*c*f,-Math.cos(o)*c*f,Math.sin(l)*f]}unprojectPosition(e){const[t,i,s]=e,o=X2(e),l=Math.asin(s/o),f=Math.atan2(t,-i)*Jv,d=l*Jv,p=(o/co-1)*gu;return[f,d,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition([e,t,i],s,o){const c=.25/Math.pow(2,this.zoom-uo(this.latitude)),f=e+c*(o[0]-s[0]);let d=t-c*(o[1]-s[1]);d=Math.max(Math.min(d,hi),-hi);const p={longitude:f,latitude:d,zoom:i-uo(t)};return p.zoom+=uo(p.latitude),p}}Gu.displayName="GlobeViewport";function uo(n){const e=Math.PI*Math.cos(n*Math.PI/180);return Math.log2(e)}function np(n,e){const t=Co([],e,n);return Vg(t,t,1/t[3]),t}const zN=["longitude","latitude","zoom","bearing","pitch"],VN=["longitude","latitude","zoom"];class Kg extends R3{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:zN,required:VN},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:o}=this.opts;if(s&&o)if(s(e)instanceof Gu)Le.warn("around not supported in GlobeView")();else{const c=s(e),f=s(t),d=c.unproject(o);i.start.around=o,Object.assign(i.end,{around:f.project(d),aroundPosition:d,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const o of this._propsToExtract)s[o]=Es(e[o]||0,t[o]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...s});Object.assign(s,o.panByPosition(t.aroundPosition,Es(e.around,t.around,i)))}return s}}const Di={transitionDuration:0},HN=300,qc=n=>1-(1-n)*(1-n),io={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Zs={};class C3{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new UN({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?HN:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:o=!0,doubleClickZoom:l=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(io.WHEEL,p&&i),this.toggleEvents(io.PAN,p),this.toggleEvents(io.PINCH,p&&(c||f)),this.toggleEvents(io.MULTI_PAN,p&&f),this.toggleEvents(io.DOUBLE_CLICK,p&&l),this.toggleEvents(io.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=o,this.doubleClickZoom=l,this.touchZoom=c,this.touchRotate=f,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,Di,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Di,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:qc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Di,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:qc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let l=2/(1+Math.exp(-Math.abs(o*i)));o<0&&l!==0&&(l=1/l);const c=s?{...this._getTransitionProps({around:t}),transitionDuration:250}:Di,f=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(f,c,{isZooming:!0,isPanning:!0}),s||this._setInteractionState({isZooming:!1,isPanning:!1}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Di,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Di,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:s});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:qc},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Zs._startPinchRotation=e.rotation,Zs._lastPinchEvent=e,this.updateViewport(i,Di,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Zs._startPinchRotation-i})}return this.updateViewport(t,Di,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Zs._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Zs;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let o=this.controllerState.rotateEnd();const l=Math.log2(e.scale),c=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,l+c*t/2);o=o.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:qc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Zs._startPinchRotation=null,Zs._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:o,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const d={};switch(e.srcEvent.code){case"Minus":f=t?c.zoomOut(i).zoomOut(i):c.zoomOut(i),d.isZooming=!0;break;case"Equal":f=t?c.zoomIn(i).zoomIn(i):c.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(f=c.rotateLeft(o),d.isRotating=!0):(f=c.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(f=c.rotateRight(o),d.isRotating=!0):(f=c.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(f=c.rotateUp(l),d.isRotating=!0):(f=c.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(f=c.rotateDown(l),d.isRotating=!0):(f=c.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Di:e?{...t,transitionInterpolator:new Kg({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class jN{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const e1=5,WN=1.2;class M3 extends jN{constructor(e){const{width:t,height:i,latitude:s,longitude:o,zoom:l,bearing:c=0,pitch:f=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:m=20,minZoom:y=0,maxPitch:b=60,minPitch:x=0,startPanLngLat:T,startZoomLngLat:R,startRotatePos:E,startBearing:B,startPitch:M,startZoom:D,normalize:F=!0}=e;Ut(Number.isFinite(o)),Ut(Number.isFinite(s)),Ut(Number.isFinite(l)),super({width:t,height:i,latitude:s,longitude:o,zoom:l,bearing:c,pitch:f,altitude:d,maxZoom:m,minZoom:y,maxPitch:b,minPitch:x,normalize:F,position:p},{startPanLngLat:T,startZoomLngLat:R,startRotatePos:E,startBearing:B,startPitch:M,startZoom:D}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:o,startPitch:l}=this.getState();if(!s||o===void 0||l===void 0)return this;let c;return e?c=this._getNewRotation(e,s,l,o):c={bearing:o+t,pitch:l+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:o}=this.getState();if(o||(s=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:l,minZoom:c}=this.getViewportProps();let f=s+Math.log2(i);f=fi(f,c,l);const d=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...d.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:o}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(o-t.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=fi(s,i,t);const{maxPitch:o,minPitch:l,pitch:c}=e;e.pitch=fi(c,l,o);const{normalize:f=!0}=e;return f&&Object.assign(e,o4(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const o=e[0]-t[0],l=e[1]-t[1],c=e[1],f=t[1],{width:d,height:p}=this.getViewportProps(),m=o/d;let y=0;l>0?Math.abs(p-f)>e1&&(y=l/(f-p)*WN):l<0&&f>e1&&(y=1-c/f),y=fi(y,-1,1);const{minPitch:b,maxPitch:x}=this.getViewportProps(),T=s+180*m;let R=i;return y>0?R=i+y*(x-i):y<0&&(R=i-y*(b-i)),{pitch:R,bearing:T}}}class $N extends C3{constructor(){super(...arguments),this.ControllerState=M3,this.transition={transitionDuration:300,transitionInterpolator:new Kg({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class O3 extends hr{constructor(e={}){super(e)}getViewportType(){return Wi}get ControllerType(){return $N}}O3.displayName="MapView";const XN=new x3;function qN(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class YN{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>qN(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Fn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const o=t[s.id];let l=s;o&&o!==s?o.setProps?(o.setProps(s.props),l=o):o.cleanup(this._context):o||s.setup(this._context),i.push(l),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof x3)||this._resolvedEffects.push(XN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class ZN extends Xg{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const KN="deckRenderer.renderLayers";class GN{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new ZN(e),this.pickLayersPass=new w3(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const o=t.render({...i,target:s});i.effects&&(this.lastPostProcessEffect&&(i.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(i.effects,i)),this.renderCount++,Qt(KN,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[i,s]=t;e.length===0&&[0,1].map(o=>{const l=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:i,height:s});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${o}`,colorAttachments:[l]}))});for(const o of e)o.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const o of e)if(o.postRender){s.target=o.id===this.lastPostProcessEffect?t.target:void 0;const l=o.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const QN={pickedColor:null,pickedObjectIndex:-1};function t1({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:o}){const{x:l,y:c,width:f,height:d}=o;let p=s*s,m=-1,y=0;for(let b=0;b<d;b++){const x=b+c-i,T=x*x;if(T>p)y+=4*f;else for(let R=0;R<f;R++){if(n[y+3]-1>=0){const B=R+l-t,M=B*B+T;M<=p&&(p=M,m=y)}y+=4}}if(m>=0){const b=n.slice(m,m+4),x=e(b);if(x){const T=Math.floor(m/4/f),R=m/4-T*f;return{...x,pickedColor:b,pickedX:l+R,pickedY:c+T}}Le.error("Picked non-existent layer. Is picking buffer corrupt?")()}return QN}function n1({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const o=n.slice(i,i+4),l=o.join(",");if(!t.has(l)){const c=e(o);c?t.set(l,{...c,color:o}):Le.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function Wp({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:o}){let l=e[0];e.length>1&&(l=JN(n?.pickedViewports||e,{x:i,y:s}));let c;if(l){const f=[i-l.x,s-l.y];o!==void 0&&(f[2]=o),c=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:c,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function i1(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:o,pickedLayer:l,pickedObjectIndex:c}=e,f=l?[l]:[];if(i==="hover"){const m=t.index,y=t.layerId,b=l?l.props.id:null;if(b!==y||c!==m){if(b!==y){const x=s.find(T=>T.props.id===y);x&&f.unshift(x)}t.layerId=b,t.index=c,t.info=null}}const d=Wp(n),p=new Map;return p.set(null,d),f.forEach(m=>{let y={...d};m===l&&(y.color=o,y.index=c,y.picked=!0),y=$p({layer:m,info:y,mode:i});const b=y.layer;m===l&&i==="hover"&&(t.info=y),p.set(b.id,y),i==="hover"&&b.updateAutoHighlight(y)}),p}function $p({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function JN(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class eD{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new w3(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},o=this.lastPickedInfo.info){const l=o&&o.layer&&o.layer.id,c=o&&o.viewport&&o.viewport.id,f=l?i.find(y=>y.id===l):null,d=c&&s.find(y=>y.id===c)||s[0],p=d&&d.unproject([e-d.x,t-d.y]);return{...o,...{x:e,y:t,viewport:d,coordinate:p,layer:f}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:i,x:s,y:o,radius:l=0,depth:c=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||i.length===0)return{result:[],emptyInfo:Wp({viewports:i,x:s,y:o,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,o],!0),T=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],R=Math.round(l*y),{width:E,height:B}=this.pickingFBO,M=this._getPickingRect({deviceX:T[0],deviceY:T[1],deviceRadius:R,deviceWidth:E,deviceHeight:B}),D={x:s-l,y:o-l,width:l*2+1,height:l*2+1};let F;const W=[],ee=new Set;for(let ae=0;ae<c;ae++){let ne;if(M){const pe=this._drawAndSample({layers:b,views:t,viewports:i,onViewportActive:p,deviceRect:M,cullRect:D,effects:m,pass:`picking:${f}`});ne=t1({...pe,deviceX:T[0],deviceY:T[1],deviceRadius:R,deviceRect:M})}else ne={pickedColor:null,pickedObjectIndex:-1};let fe;if(ne.pickedLayer&&d&&this.depthFBO){const{pickedColors:pe}=this._drawAndSample({layers:[ne.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:ne.pickedX,y:ne.pickedY,width:1,height:1},cullRect:D,effects:m,pass:`picking:${f}:z`},!0);pe[3]&&(fe=pe[0])}ne.pickedLayer&&ae+1<c&&(ee.add(ne.pickedLayer),ne.pickedLayer.disablePickingIndex(ne.pickedObjectIndex)),F=i1({pickInfo:ne,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:i,x:s,y:o,z:fe,pixelRatio:y});for(const pe of F.values())pe.layer&&W.push(pe);if(!ne.pickedColor)break}for(const ae of ee)ae.restorePickingColors();return{result:W,emptyInfo:F.get(null)}}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:o,radius:l=0,depth:c=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||i.length===0)return{result:[],emptyInfo:Wp({viewports:i,x:s,y:o,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,o],!0),T=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],R=Math.round(l*y),{width:E,height:B}=this.pickingFBO,M=this._getPickingRect({deviceX:T[0],deviceY:T[1],deviceRadius:R,deviceWidth:E,deviceHeight:B}),D={x:s-l,y:o-l,width:l*2+1,height:l*2+1};let F;const W=[],ee=new Set;for(let ae=0;ae<c;ae++){let ne;if(M){const pe=this._drawAndSample({layers:b,views:t,viewports:i,onViewportActive:p,deviceRect:M,cullRect:D,effects:m,pass:`picking:${f}`});ne=t1({...pe,deviceX:T[0],deviceY:T[1],deviceRadius:R,deviceRect:M})}else ne={pickedColor:null,pickedObjectIndex:-1};let fe;if(ne.pickedLayer&&d&&this.depthFBO){const{pickedColors:pe}=this._drawAndSample({layers:[ne.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:ne.pickedX,y:ne.pickedY,width:1,height:1},cullRect:D,effects:m,pass:`picking:${f}:z`},!0);pe[3]&&(fe=pe[0])}ne.pickedLayer&&ae+1<c&&(ee.add(ne.pickedLayer),ne.pickedLayer.disablePickingIndex(ne.pickedObjectIndex)),F=i1({pickInfo:ne,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:i,x:s,y:o,z:fe,pixelRatio:y});for(const pe of F.values())pe.layer&&W.push(pe);if(!ne.pickedColor)break}for(const ae of ee)ae.restorePickingColors();return{result:W,emptyInfo:F.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:i,x:s,y:o,width:l=1,height:c=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:m}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,o],!0),T=x.x,R=x.y+x.height,E=this.device.canvasContext.cssToDevicePixels([s+l,o+c],!0),B=E.x+E.width,M=E.y,D={x:T,y:M,width:B-T,height:R-M},F=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:D,cullRect:{x:s,y:o,width:l,height:c},effects:m,pass:`picking:${f}`}),W=n1(F),ee=new Map,ae=[],ne=Number.isFinite(d);for(let fe=0;fe<W.length&&!(ne&&ae.length>=d);fe++){const pe=W[fe];let ge={color:pe.pickedColor,layer:null,index:pe.pickedObjectIndex,picked:!0,x:s,y:o,pixelRatio:b};ge=$p({layer:pe.pickedLayer,info:ge,mode:f});const xe=ge.layer.id;ee.has(xe)||ee.set(xe,new Set);const de=ee.get(xe),Xe=ge.object??ge.index;de.has(Xe)||(de.add(Xe),ae.push(ge))}return ae}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:o,width:l=1,height:c=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:m}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,o],!0),T=x.x,R=x.y+x.height,E=this.device.canvasContext.cssToDevicePixels([s+l,o+c],!0),B=E.x+E.width,M=E.y,D={x:T,y:M,width:B-T,height:R-M},F=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:D,cullRect:{x:s,y:o,width:l,height:c},effects:m,pass:`picking:${f}`}),W=n1(F),ee=new Map,ae=[],ne=Number.isFinite(d);for(let fe=0;fe<W.length&&!(ne&&ae.length>=d);fe++){const pe=W[fe];let ge={color:pe.pickedColor,layer:null,index:pe.pickedObjectIndex,picked:!0,x:s,y:o,pixelRatio:b};ge=$p({layer:pe.pickedLayer,info:ge,mode:f});const xe=ge.layer.id;ee.has(xe)||ee.set(xe,new Set);const de=ee.get(xe),Xe=ge.object??ge.index;de.has(Xe)||(de.add(Xe),ae.push(ge))}return ae}async _drawAndSampleAsync({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:o,cullRect:l,effects:c,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:o,cullRect:l,effects:c,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const B of c)B.useInPicking&&(m.preRenderStats[B.id]=B.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:b,y:x,width:T,height:R}=o,E=new(d?Float32Array:Uint8Array)(T*R*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:b,sourceY:x,sourceWidth:T,sourceHeight:R,target:E}),{pickedColors:E,decodePickingColor:y}}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:o,cullRect:l,effects:c,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:o,cullRect:l,effects:c,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const B of c)B.useInPicking&&(m.preRenderStats[B.id]=B.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:b,y:x,width:T,height:R}=o,E=new(d?Float32Array:Uint8Array)(T*R*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:b,sourceY:x,sourceWidth:T,sourceHeight:R,target:E}),{pickedColors:E,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:o}){const l=Math.max(0,e-i),c=Math.max(0,t-i),f=Math.min(s,e+i+1)-l,d=Math.min(o,t+i+1)-c;return f<=0||d<=0?null:{x:l,y:c,width:f,height:d}}}const tD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},nD="top-left",s1="root";class iD{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!Fn(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const i=e.reduce((s,o)=>(s[o.id]=o,s),{});for(const s of this.getWidgets()){const{viewId:o}=s;if(o){const l=i[o];l&&(s.onViewportChange&&s.onViewportChange(l),s.onRedraw?.({viewports:[l],layers:t}))}else{if(s.onViewportChange)for(const l of e)s.onViewportChange(l);s.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=Lp[t.type];if(i)for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===e.viewport?.id)&&s[i]?.(e,t)}}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._removeWidget(s),this._addWidget(i)):i!==s&&(s.setProps(i.props),i=s):this._addWidget(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._removeWidget(s)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:i=nD}=e,s=e.props._container??t;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(s,i).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){if(e&&typeof e!="string")return e;const i=e||s1;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let o=s.querySelector(`.${t}`);return o||(o=globalThis.document.createElement("div"),o.className=t,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,tD[t]),s.append(o)),o}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,o=i===s1||s,l=this.containers[i];o?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:t}px`):l.style.display="none"}}}function r1(n,e){e&&Object.entries(e).map(([t,i])=>{t.startsWith("--")?n.style.setProperty(t,i):n.style[t]=i})}function sD(n,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?n.style.removeProperty(t):n.style[t]=""})}class Gg{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,i=this.rootElement;i&&t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),i&&!Fn(t.style,e.style,1)&&(sD(i,t.style),r1(i,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(i=>typeof i=="string"&&i.length>0).forEach(i=>t.classList.add(i)),r1(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Gg.defaultProps={id:"widget",style:{},_container:null,className:""};const rD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class P3 extends Gg{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,rD),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.rootElement;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}P3.defaultProps={...Gg.defaultProps};const oD="modulepreload",aD=function(n){return"/"+n},o1={},Xp=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let f=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");s=f(t.map(d=>{if(d=aD(d),d in o1)return;o1[d]=!0;const p=d.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":oD,p||(y.as="script"),y.crossOrigin="",y.href=d,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((b,x)=>{y.addEventListener("load",b),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};var fo;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(fo||(fo={}));const lD={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},cD=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),uD=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),fD=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function hD(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&dD(s),s}return this.originalGetContext(t,i)}}function dD(n){n.getExtension("EXT_color_buffer_float");const e={...lD,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:cD(n),OES_vertex_array_object:uD(n),ANGLE_instanced_arrays:fD(n)},t=n.getExtension;n.getExtension=function(s){const o=t.call(n,s);return o||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(e))}}async function I3(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,o)=>{i.onload=s,i.onerror=l=>o(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(i)})}const pD=1;let An=null,a1=!1;const Qg={debugSpectorJS:oe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function gD(n){if(!globalThis.SPECTOR)try{await I3(n.debugSpectorJSUrl||Qg.debugSpectorJSUrl)}catch(e){oe.warn(String(e))}}function mD(n){if(n={...Qg,...n},!n.debugSpectorJS)return null;if(!An&&globalThis.SPECTOR&&!globalThis.luma?.spector){oe.probe(pD,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;An=new e,globalThis.luma&&(globalThis.luma.spector=An)}if(!An)return null;if(a1||(a1=!0,An.spyCanvases(),An?.onCaptureStarted.add(e=>oe.info("Spector capture started:",e)()),An?.onCapture.add(e=>{oe.info("Spector capture complete:",e)(),An?.getResultUI(),An?.resultView.display(),An?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;An?.startCapture(n.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{oe.info("Spector capture stopped after 2 seconds")(),An?.stopCapture()})}return An}const _D="https://unpkg.com/webgl-debug@2.0.1/index.js";function N3(n){return n.luma=n.luma||{},n.luma}async function yD(){dr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await I3(_D))}function bD(n,e={}){return e.debugWebGL||e.traceWebGL?xD(n,e):vD(n)}function vD(n){const e=N3(n);return e.realContext?e.realContext:n}function xD(n,e){if(!globalThis.WebGLDebugUtils)return oe.warn("webgl-debug not loaded")(),n;const t=N3(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...fo,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,TD.bind(null,e),SD.bind(null,e));for(const l in fo)!(l in i)&&typeof fo[l]=="number"&&(i[l]=fo[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const o=Object.create(s);return t.realContext=n,t.debugContext=o,o.debug=!0,o}function l1(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function TD(n,e,t,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);const s=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),l=`${s} in gl.${t}(${o})`;oe.error(l)();debugger}function SD(n,e,t){let i="";oe.level>=1&&(i=l1(e,t),n.traceWebGL&&oe.log(1,i)());for(const s of t)if(s===void 0){i=i||l1(e,t);debugger}}const Yc=1;class AD extends wC{type="webgl";constructor(){super(),rr.defaultProps={...rr.defaultProps,...Qg}}enforceWebGL2(e){hD(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&oe.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:i}=await Xp(async()=>{const{WebGLDevice:o}=await Promise.resolve().then(()=>A1);return{WebGLDevice:o}},void 0);if(e instanceof i)return e;if(e?.device instanceof i)return e.device;if(!wD(e))throw new Error("Invalid WebGL2RenderingContext");const s=t.createCanvasContext===!0?{}:t.createCanvasContext;return new i({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...s}})}async create(e={}){const{WebGLDevice:t}=await Xp(async()=>{const{WebGLDevice:i}=await Promise.resolve().then(()=>A1);return{WebGLDevice:i}},void 0);oe.groupCollapsed(Yc,"WebGLDevice created")();try{const i=[];(e.debugWebGL||e.debug)&&i.push(yD()),e.debugSpectorJS&&i.push(gD(e));const s=await Promise.allSettled(i);for(const c of s)c.status==="rejected"&&oe.error(`Failed to initialize debug libraries ${c.reason}`)();const o=new t(e),l=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return oe.probe(Yc,l)(),oe.table(Yc,o.info)(),o}finally{oe.groupEnd(Yc)()}}}function wD(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const ip=new AD,Jg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Et=(n,e,t)=>e?n.enable(t):n.disable(t),c1=(n,e,t)=>n.hint(t,e),wn=(n,e,t)=>n.pixelStorei(t,e),u1=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},Pa=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function sp(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const ED={3042:Et,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:Et,2885:(n,e)=>n.cullFace(e),2929:Et,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:Et,35723:c1,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:u1,36010:u1,34964:Pa,36662:Pa,36663:Pa,35053:Pa,35055:Pa,2886:(n,e)=>n.frontFace(e),33170:c1,2849:(n,e)=>n.lineWidth(e),32823:Et,32824:"polygonOffset",10752:"polygonOffset",35977:Et,32926:Et,32928:Et,32938:"sampleCoverage",32939:"sampleCoverage",3089:Et,3088:(n,e)=>n.scissor(...e),2960:Et,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:Et,10754:Et,12288:Et,12289:Et,12290:Et,12291:Et,12292:Et,12293:Et,12294:Et,12295:Et,3333:wn,3317:wn,37440:wn,37441:wn,37443:wn,3330:wn,3332:wn,3331:wn,3314:wn,32878:wn,3316:wn,3315:wn,32877:wn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=sp(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=sp(e)&&e.length===3?[...e,...e]:e;const[t,i,s,o,l,c]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,o,l,c)},stencilOp:(n,e)=>{e=sp(e)&&e.length===3?[...e,...e]:e;const[t,i,s,o,l,c]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,o,l,c)},viewport:(n,e)=>n.viewport(...e)};function yt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const RD={blendEquation:(n,e,t)=>n.blendEquationSeparate(yt(32777,e,t),yt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(yt(32969,e,t),yt(32968,e,t),yt(32971,e,t),yt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(yt(32824,e,t),yt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(yt(32938,e,t),yt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,yt(2962,e,t),yt(2967,e,t),yt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,yt(34816,e,t),yt(36003,e,t),yt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,yt(2964,e,t),yt(2965,e,t),yt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,yt(34817,e,t),yt(34818,e,t),yt(34819,e,t))},f1={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},oi=(n,e)=>n.isEnabled(e),h1={3042:oi,2884:oi,2929:oi,3024:oi,32823:oi,32926:oi,32928:oi,3089:oi,2960:oi,35977:oi},CD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Io(n,e){if(OD(e))return;const t={};for(const s in e){const o=Number(s),l=ED[s];l&&(typeof l=="string"?t[l]=!0:l(n,e[s],o))}const i=n.state&&n.state.cache;if(i)for(const s in t){const o=RD[s];o(n,e,i)}}function D3(n,e=Jg){if(typeof e=="number"){const s=e,o=h1[s];return o?o(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const o=h1[s];i[s]=o?o(n,Number(s)):n.getParameter(Number(s))}return i}function MD(n){Io(n,Jg)}function OD(n){for(const e in n)return!1;return!0}function PD(n,e){if(n===e)return!0;if(d1(n)&&d1(e)&&n.length===e.length){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}return!1}function d1(n){return Array.isArray(n)||ArrayBuffer.isView(n)}class ir{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Io(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?D3(e):Object.assign({},Jg),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,ND(e);for(const i in f1){const s=f1[i];ID(e,i,s)}p1(e,"getParameter"),p1(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const l=e[o],c=this.cache[o];PD(l,c)||(t=!0,i=c,s&&!(o in s)&&(s[o]=c),this.cache[o]=l)}return{valueChanged:t,oldValue:i}}}function p1(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||CD.has(s))return t(s);const o=ir.get(n);return s in o.cache||(o.cache[s]=t(s)),o.enable?o.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function ID(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...o){const l=ir.get(n),{valueChanged:c,oldValue:f}=t(l._updateCache,...o);return c&&i(...o),f},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function ND(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=ir.get(n);s.program!==i&&(e(i),s.program=i)}}function DD(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let o=null;if(o||=n.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,o=n.getContext("webgl2",s),o.luma||={},o.luma.softwareRenderer=!0),o||(o=n.getContext("webgl",{}),o&&(o=null,i||="Your browser only supports WebGL1")),!o)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:c}=e;return n.addEventListener("webglcontextlost",f=>l(f),!1),n.addEventListener("webglcontextrestored",f=>c(f),!1),o.luma||={},o}function Ro(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function kD(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);Ro(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,o=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),c=o||t,f=l||i,d=n.getParameter(7938),p=k3(c,f),m=BD(c,f),y=LD(c,f);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:m,vendor:c,renderer:f,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function k3(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function BD(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function LD(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(k3(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function B3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Fa="WEBGL_compressed_texture_s3tc",za="WEBGL_compressed_texture_s3tc_srgb",ho="EXT_texture_compression_rgtc",po="EXT_texture_compression_bptc",UD="WEBGL_compressed_texture_etc",FD="WEBGL_compressed_texture_astc",zD="WEBGL_compressed_texture_etc1",VD="WEBGL_compressed_texture_pvrtc",HD="WEBGL_compressed_texture_atc",g1="EXT_texture_norm16",m1="EXT_render_snorm",jD="EXT_color_buffer_float",em={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[m1],"norm16-renderable-webgl":[g1],"snorm16-renderable-webgl":[g1,m1],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Fa,za,ho,po],"texture-compression-bc5-webgl":[ho],"texture-compression-bc7-webgl":[po],"texture-compression-etc2":[UD],"texture-compression-astc":[FD],"texture-compression-etc1-webgl":[zD],"texture-compression-pvrtc-webgl":[VD],"texture-compression-atc-webgl":[HD]};function WD(n){return n in em}function $D(n,e,t){return(em[e]||[]).every(s=>Ro(n,s,t))}const tm={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:jD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Fa},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:za},"bc1-rgba-unorm":{gl:33777,x:Fa},"bc1-rgba-unorm-srgb":{gl:35916,x:za},"bc2-rgba-unorm":{gl:33778,x:Fa},"bc2-rgba-unorm-srgb":{gl:35918,x:za},"bc3-rgba-unorm":{gl:33779,x:Fa},"bc3-rgba-unorm-srgb":{gl:35919,x:za},"bc4-r-unorm":{gl:36283,x:ho},"bc4-r-snorm":{gl:36284,x:ho},"bc5-rg-unorm":{gl:36285,x:ho},"bc5-rg-snorm":{gl:36286,x:ho},"bc6h-rgb-ufloat":{gl:36495,x:po},"bc6h-rgb-float":{gl:36494,x:po},"bc7-rgba-unorm":{gl:36492,x:po},"bc7-rgba-unorm-srgb":{gl:36493,x:po},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function XD(n,e,t){let i=e.create;const s=tm[e.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!Ro(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function L3(n){const e=tm[n],t=ZD(n),i=yo.getInfo(n);return i.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||YD(i.channels,i.integer,i.normalized,t),type:i.dataType?B3(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function qD(n){switch(yo.getInfo(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function YD(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function ZD(n){const t=tm[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const _1={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class KD extends SC{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,Ro(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),WD(e)&&$D(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(_1),...Object.keys(em)]}getWebGLFeature(e){const t=_1[e];return typeof t=="string"?!!Ro(this.gl,t,this.extensions):!!t}}class GD extends TC{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Ka extends qu{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const s=36064+t;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const t=qD(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${JD(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:s}=t,o=t.props.baseMipLevel,l=t.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,s.handle,o,l);break;case 34067:const c=QD(l);i.framebufferTexture2D(36160,e,c,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,e,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function QD(n){return n<34069?n+34069:n}function JD(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class ek extends Qs{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Ka(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const rp={};function tk(n="id"){rp[n]=rp[n]||1;const e=rp[n]++;return`${n}-${e}`}class Ga extends lt{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=nk(this.props.usage),this.glUsage=ik(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,i=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const i=ArrayBuffer.isView(e)?e:new Uint8Array(e),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,t,i),this.gl.bindBuffer(s,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,i=this.byteLength-t){const s=new ArrayBuffer(i);await e(s,"copied"),this.write(s,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,i){const s=await this.readAsync(t,i);return await e(s.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,s,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function nk(n){return n&lt.INDEX?34963:n&lt.VERTEX?34962:n&lt.UNIFORM?35345:34962}function ik(n){return n&lt.INDEX||n&lt.VERTEX?35044:n&lt.UNIFORM?35048:35044}function sk(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[m,y]=s;t.push({message:y.trim(),type:y1(m),lineNum:0,linePos:0});continue}const[o,l,c,...f]=s;let d=parseInt(c,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),t.push({message:f.join(":").trim(),type:y1(o),lineNum:d,linePos:p})}return t}function y1(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class rk extends Xu{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?sk(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}oe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),oe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function ok(n,e,t,i){if(uk(e))return i(n);const s=n;s.pushState();try{return ak(n,e),Io(s.gl,t),i(n)}finally{s.popState()}}function ak(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(sr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const o=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=sr("provokingVertex",e.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=sr("polygonMode",e.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,l),o?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(ck("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(qp("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&oe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,o=qp("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,o,0,s),i.stencilFuncSeparate(1029,o,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=op("stencilPassOperation",e.stencilPassOperation),o=op("stencilFailOperation",e.stencilFailOperation),l=op("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,o,l,s),i.stencilOpSeparate(1029,o,l,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=b1("blendColorOperation",e.blendColorOperation||"add"),o=b1("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,o);const l=Zc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=Zc("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=Zc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Zc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,c,f,d)}}function qp(n,e){return sr(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function op(n,e){return sr(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function b1(n,e){return sr(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Zc(n,e,t="color"){return sr(n,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function lk(n,e){return`Illegal parameter ${e} for ${n}`}function sr(n,e,t){if(!(e in t))throw new Error(lk(n,e));return t[e]}function ck(n,e){return e}function uk(n){let e=!0;for(const t in n){e=!1;break}return e}function U3(n){const e={};return n.addressModeU&&(e[10242]=ap(n.addressModeU)),n.addressModeV&&(e[10243]=ap(n.addressModeV)),n.addressModeW&&(e[32882]=ap(n.addressModeW)),n.magFilter&&(e[10240]=Yp(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=fk(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=qp("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function ap(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Yp(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function fk(n,e="none"){if(!e)return Yp(n);switch(e){case"none":return Yp(n);case"nearest":switch(n){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(n){case"nearest":return 9986;case"linear":return 9987}}}class hk extends or{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=U3(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const s=Number(t);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}function sl(n,e,t){if(dk(e))return t(n);const{nocatch:i=!0}=e,s=ir.get(n);s.push(),Io(n,e);let o;if(i)o=t(n),s.pop();else try{o=t(n)}finally{s.pop()}return o}function dk(n){for(const e in n)return!1;return!0}class go extends $u{device;gl;handle;texture;constructor(e,t){super(e,{...It.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class Qa extends It{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const i=L3(this.props.format);this.glTarget=pk(this.props.dimension),this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:o,height:l,depth:c,mipLevels:f,glTarget:d,glInternalFormat:p}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(d,f,p,o,l);break;case"2d-array":case"3d":this.gl.texStorage3D(d,f,p,o,l,c);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new go(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new go(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=U3(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),i=t.data,{width:s,height:o,depth:l}=this,{mipLevel:c=0,byteOffset:f=0,x:d=0,y:p=0,z:m=0}=t,{glFormat:y,glType:b,compressed:x}=this,T=v1(this.glTarget,this.dimension,m);let R;if(!this.compressed){const{bytesPerPixel:B}=this.device.getTextureFormatInfo(this.format);if(B){if(t.bytesPerRow%B!==0)throw new Error(`bytesPerRow (${t.bytesPerRow}) must be a multiple of bytesPerPixel (${B}) for ${this.format}`);R=t.bytesPerRow/B}}const E=this.compressed?{}:{...R!==void 0?{3314:R}:{},32878:t.rowsPerImage};this.gl.bindTexture(T,this.handle),sl(this.gl,E,()=>{switch(this.dimension){case"2d":case"cube":x?this.gl.compressedTexSubImage2D(T,c,d,p,s,o,y,i,f):this.gl.texSubImage2D(T,c,d,p,s,o,y,b,i,f);break;case"2d-array":case"3d":x?this.gl.compressedTexSubImage3D(T,c,d,p,m,s,o,l,y,i,f):this.gl.texSubImage3D(T,c,d,p,m,s,o,l,y,b,i,f);break;default:}}),this.gl.bindTexture(T,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:i,glType:s}=this,{image:o,depth:l,mipLevel:c,x:f,y:d,z:p,width:m,height:y}=t,b=v1(this.glTarget,this.dimension,l),x=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),sl(this.gl,x,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(b,c,f,d,m,y,i,s,o);break;case"2d-array":case"3d":this.gl.texSubImage3D(b,c,f,d,p,m,y,l,i,s,o);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(oe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){oe.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){oe.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const s=Number(t),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function pk(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function v1(n,e,t){return e==="cube"?34069+t:n}function gk(n){return bk[n]}function nm(n){return yk[n]}function mk(n){return!!F3[n]}function _k(n){return F3[n]}const yk={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},F3={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},bk={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function vk(n,e){const t={attributes:[],bindings:[]};t.attributes=xk(n,e);const i=Ak(n,e);for(const c of i){const f=c.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const s=Sk(n,e);let o=0;for(const c of s)if(mk(c.type)){const{viewDimension:f,sampleType:d}=_k(c.type);t.bindings.push({type:"texture",name:c.name,group:0,location:o,viewDimension:f,sampleType:d}),c.textureUnit=o,o+=1}s.length&&(t.uniforms=s);const l=Tk(n,e);return l?.length&&(t.varyings=l),t}function xk(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const o=n.getActiveAttrib(e,s);if(!o)throw new Error("activeInfo");const{name:l,type:c}=o,f=n.getAttribLocation(e,l);if(f>=0){const d=nm(c),p=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:f,stepMode:p,type:d})}}return t.sort((s,o)=>s.location-o.location),t}function Tk(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const o=n.getTransformFeedbackVarying(e,s);if(!o)throw new Error("activeInfo");const{name:l,type:c,size:f}=o,d=nm(c),{type:p,components:m}=d2(d);t.push({location:s,name:l,type:p,size:f*m})}return t.sort((s,o)=>s.location-o.location),t}function Sk(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const o=n.getActiveUniform(e,s);if(!o)throw new Error("activeInfo");const{name:l,size:c,type:f}=o,{name:d,isArray:p}=wk(l);let m=n.getUniformLocation(e,d);const y={location:m,name:d,size:c,type:f,isArray:p};if(t.push(y),y.size>1)for(let b=0;b<y.size;b++){const x=`${d}[${b}]`;m=n.getUniformLocation(e,x);const T={...y,name:x,location:m};t.push(T)}}return t}function Ak(n,e){const t=(o,l)=>n.getActiveUniformBlockParameter(e,o,l),i=[],s=n.getProgramParameter(e,35382);for(let o=0;o<s;o++){const l={name:n.getActiveUniformBlockName(e,o)||"",location:t(o,35391),byteLength:t(o,35392),vertex:t(o,35396),fragment:t(o,35398),uniformCount:t(o,35394),uniforms:[]},c=t(o,35395)||[],f=n.getActiveUniforms(e,c,35383),d=n.getActiveUniforms(e,c,35384),p=n.getActiveUniforms(e,c,35387),m=n.getActiveUniforms(e,c,35388);for(let y=0;y<l.uniformCount;++y){const b=n.getActiveUniform(e,c[y]);if(!b)throw new Error("activeInfo");const x=nm(f[y]);l.uniforms.push({name:b.name,format:x,type:f[y],arrayLength:d[y],byteOffset:p[y],byteStride:m[y]})}i.push(l)}return i.sort((o,l)=>o.location-l.location),i}function wk(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function Ek(n,e,t,i){const s=n;let o=i;o===!0&&(o=1),o===!1&&(o=0);const l=typeof o=="number"?[o]:o;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function Rk(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function Ck(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const x1=4;class Mk extends tr{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:s=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),oe.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=vk(this.device.gl,this.handle),oe.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?Ok(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[i,s]of Object.entries(e)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");t?.disableWarnings||oe.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||oe.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Ga)&&!(s.buffer instanceof Ga))throw new Error("buffer value");break;case"texture":if(!(s instanceof go||s instanceof Qa||s instanceof Ka))throw new Error(`${this} Bad texture binding for ${i}`);break;case"sampler":oe.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:c,isInstanced:f=!1,firstVertex:d=0,transformFeedback:p}=e,m=Rk(s),y=!!o.indexBuffer,b=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(t),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const x=t;return ok(this.device,i,x.glParameters,()=>{y&&f?this.device.gl.drawElementsInstanced(m,l||0,b,d,c||0):y?this.device.gl.drawElements(m,l||0,b,d):f?this.device.gl.drawArraysInstanced(m,d,l||0,c||0):this.device.gl.drawArrays(m,d,l||0),p&&p.end()}),o.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),oe.time(x1,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),oe.timeEnd(x1,`linkProgram for ${this.id}`)(),oe.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}oe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),oe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(oe.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,c=e.getUniformBlockIndex(this.handle,l);if(c===4294967295)throw new Error(`Invalid uniform block name ${l}`);e.uniformBlockBinding(this.handle,i,c),o instanceof Ga?e.bindBufferBase(35345,i,o.handle):e.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof go||o instanceof Qa||o instanceof Ka))throw new Error("texture");let f;if(o instanceof go)f=o.texture;else if(o instanceof Qa)f=o;else if(o instanceof Ka&&o.colorAttachments[0]instanceof go)oe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=o.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(f.glTarget,f.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:s,textureUnit:o}=e,l=this.uniforms[t]??o;l!==void 0&&Ek(this.device.gl,i,s,l)}}}function Ok(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const s=t.attributes.find(o=>o.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):oe.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class Pk extends Ag{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Ik(this.device,t.options);break;case"copy-buffer-to-texture":Nk(this.device,t.options);break;case"copy-texture-to-buffer":Dk(this.device,t.options);break;case"copy-texture-to-texture":kk(this.device,t.options);break;default:throw new Error(t.name)}}}function Ik(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function Nk(n,e){throw new Error("Not implemented")}function Dk(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:o=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:f=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:m,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||m||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:x}=z3(t);let T;try{const R=d,E=o||b.width,B=l||b.height,M=L3(b.colorAttachments[0].texture.props.format),D=M.format,F=M.type;n.gl.bindBuffer(35051,R.handle),T=n.gl.bindFramebuffer(36160,b.handle),n.gl.readPixels(f[0],f[1],E,B,D,F,p)}finally{n.gl.bindBuffer(35051,null),T!==void 0&&n.gl.bindFramebuffer(36160,T),x&&b.destroy()}}function kk(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:o=[0,0],destinationTexture:l}=e;let{width:c=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=z3(t),[m,y]=s,[b,x,T]=o,R=n.gl.bindFramebuffer(36160,d.handle);let E,B;if(l instanceof Qa)E=l,c=Number.isFinite(c)?c:E.width,f=Number.isFinite(f)?f:E.height,E._bind(0),B=E.glTarget;else throw new Error("invalid destination");switch(B){case 3553:case 34067:n.gl.copyTexSubImage2D(B,i,b,x,m,y,c,f);break;case 35866:case 32879:n.gl.copyTexSubImage3D(B,i,b,x,T,m,y,c,f);break}E&&E._unbind(),n.gl.bindFramebuffer(36160,R),p&&d.destroy()}function z3(n){if(n instanceof It){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}const Bk=[1,2,4,8];class Lk extends Ks{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:o,height:l}=t.framebuffer;i=[0,0,o,l]}else{const[o,l]=e.getDefaultCanvasContext().getDrawingBufferSize();i=[0,0,o,l]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&s?.handle){const o=this.props.framebuffer.colorAttachments.map((l,c)=>36064+c);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=Bk.map(i=>!!(i&e.colorMask))),this.glParameters=t,Io(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&sl(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){sl(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class T1 extends Sg{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Pk(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new Lk(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function Uk(n){const{target:e,source:t,start:i=0,count:s=1}=n,o=t.length,l=s*o;let c=0;for(let f=i;c<o;c++)e[f++]=t[c];for(;c<l;)c<l-c?(e.copyWithin(i+c,i,i+c),c*=2):(e.copyWithin(i+c,i,i+l-c),c=l);return n.target}class im extends wg{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return QA()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:c,normalized:f,integer:d,divisor:p}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),d?this.device.gl.vertexAttribIPointer(e,s,o,l,c):this.device.gl.vertexAttribPointer(e,s,o,f,l,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,p||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=B3(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const s=im.isConstantAttributeZeroSupported(this.device)||e!==0;(t||s)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=Fk(t),s=i.byteLength*e,o=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l||=!zk(i,this.bufferValue),l){const c=QC(t.constructor,o);Uk({target:c,source:i,start:0,count:o}),this.buffer.write(c),this.bufferValue=t}return this.buffer}}function Fk(n){return Array.isArray(n)?new Float32Array(n):n}function zk(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class Vk extends Eg{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Ck(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=s,oe.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(e){if(S1(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Ga)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:s}}_getVaryingIndex(e){if(S1(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,s){const o=t&&t.handle;!o||s===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,i,s)}}function S1(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class Hk extends Rg{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const i=this.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");this.handle=i,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function V3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function jk(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Wk(n){return $k[n]}const $k={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function Xk(n,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:o=null,sourceWidth:l,sourceHeight:c,sourceDepth:f,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:m,deleteFramebuffer:y}=H3(n),{gl:b,handle:x}=m;l||=m.width,c||=m.height;const T=m.colorAttachments[s]?.texture;if(!T)throw new Error(`Invalid framebuffer attachment ${s}`);f=T?.depth||1,d||=T?.glFormat||6408,p||=T?.glType||5121,o=Zk(o,p,d,l,c);const R=bg(o);p=p||gk(R);const E=b.bindFramebuffer(36160,x);return b.readBuffer(36064+s),b.readPixels(t,i,l,c,d,p,o),b.readBuffer(36064),b.bindFramebuffer(36160,E||null),y&&m.destroy(),o}function qk(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:o=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:c,sourceHeight:f,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:m}=H3(n);c=c||p.width,f=f||p.height;const y=p;d=d||5121;let b=t;if(!b){const T=V3(o),R=jk(d),E=l+c*f*T*R;b=y.device.createBuffer({byteLength:E})}const x=n.device.createCommandEncoder();return x.copyTextureToBuffer({sourceTexture:n,width:c,height:f,origin:[i,s],destinationBuffer:b,byteOffset:l}),x.destroy(),m&&p.destroy(),b}function H3(n){return n instanceof qu?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:Yk(n),deleteFramebuffer:!0}}function Yk(n,e){const{device:t,width:i,height:s,id:o}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:i,height:s,colorAttachments:[n]})}function Zk(n,e,t,i,s,o){if(n)return n;e||=5121;const l=Wk(e),c=vg(l),f=V3(t);return new c(i*s*f)}class Zp extends rr{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return e!=="unorm8x4-bgra"}constructor(e){super({...e,id:e.id||tk("webgl-device")});const t=rr._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new ek(this,t),this.lost=new Promise(p=>{this._resolveContextLost=p});const s={...e.webgl};t.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),e.powerPreference!==void 0&&(s.powerPreference=e.powerPreference);const l=this.props._handle||DD(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(e._reuseDevices)return oe.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=mD({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=kD(this.gl,this._extensions),this.limits=new GD(this.gl),this.features=new KD(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new ir(this.gl,{log:(...p)=>oe.log(1,...p)()}).trackState(this.gl,{copyState:!1});const f=e.debugWebGL||e.debug,d=e.debugWebGL;f&&(this.gl=bD(this.gl,{debugWebGL:f,traceWebGL:d}),oe.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(oe.level=Math.max(oe.level,1))),this.commandEncoder=new T1(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Ga(this,t)}createTexture(e){return new Qa(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new hk(this,e)}createShader(e){return new rk(this,e)}createFramebuffer(e){return new Ka(this,e)}createVertexArray(e){return new im(this,e)}createTransformFeedback(e){return new Vk(this,e)}createQuerySet(e){return new Hk(this,e)}createRenderPipeline(e){return new Mk(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new T1(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return Xk(e,t)}readPixelsToBufferWebGL(e,t){return qk(e,t)}setParametersWebGL(e){Io(this.gl,e)}getParametersWebGL(e){return D3(this.gl,e)}withParametersWebGL(e,t){return sl(this.gl,e,t)}resetWebGL(){oe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),MD(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return XD(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){ir.get(this.gl).push()}popState(){ir.get(this.gl).pop()}getGLKey(e,t){const i=Number(e);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,t)}`]=`${o}:${this.getGLKey(o,t)}`,i),{})}setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[e];switch(s&&Jk(s,t)&&oe.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Kk(this,e,t);break;case Int32Array:Gk(this,e,t);break;case Uint32Array:Qk(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Ro(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,i){e.luma=t;const s={props:i.spector,id:i.spector.id};e.__SPECTOR_Metadata=s}}function Kk(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function Gk(n,e,t){n.gl.vertexAttribI4iv(e,t)}function Qk(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function Jk(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const A1=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:Zp},Symbol.toStringTag,{value:"Module"}));function ys(){}const e6=({isDragging:n})=>n?"grabbing":"grab",j3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ys,onWebGLInitialized:ys,onResize:ys,onViewStateChange:ys,onInteractionStateChange:ys,onBeforeRender:ys,onAfterRender:ys,onLoad:ys,onError:n=>Le.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:e6,getTooltip:null,debug:!1,drawPickingColors:!1};class sm{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ul({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null,unproject3D:!1},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const o=i.offsetCenter;if(!o)return;s.x=o.x,s.y=o.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=Lp[i.type],o=i.offsetCenter;if(!s||!o||!this.layerManager)return;let l;const c=this.layerManager.getLayers(),f=c.some(b=>b.props.pickable==="3d");if(i.type==="click"&&f){const b=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius,unproject3D:!0});l=b.result[0]||b.emptyInfo}else l=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:c,viewports:this.getViewports(o)},this._lastPointerDownInfo);const{layer:d}=l,p=d&&(d[s]||d.props[s]),m=this.props[s];let y=!1;p&&(y=p.call(d,l,i)),y||(m?.(l,i),this.widgetManager.onEvent(l,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const s=i.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...j3,...e},e=this.props,e.viewState&&e.initialViewState&&Le.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;if(!t&&e.gl){e.gl instanceof WebGLRenderingContext&&Le.error("WebGL1 context not supported.")();const i=this.props.deviceProps?.onResize;t=ip.attach(e.gl,{_cacheShaders:!0,_cachePipelines:!0,...this.props.deviceProps,onResize:(s,o)=>{const{width:l,height:c}=s.canvas;s.drawingBufferWidth=l,s.drawingBufferHeight=c,this._needsRedraw="Canvas resized",i?.(s,o)}})}t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Ao.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Le.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Le.removed("onLayerClick","onClick")(),e.initialViewState&&!Fn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Le.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.setProps&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||i||s||o||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Ut(this.viewManager),this.viewManager.views}getView(e){return Ut(this.viewManager),this.viewManager.getView(e)}getViewports(e){return Ut(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){Ut(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Ut(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s}=t;return new qg({device:e,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,i=typeof t=="object"?t:void 0,s={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};s.adapters.includes(ip)||s.adapters.push(ip);const o={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},l=this.props.deviceProps?.onResize;return wp.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...o,...i,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(c,f)=>{this._needsRedraw="Canvas resized",l?.(c,f)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new O3({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const i=(this.layerManager?.getLayers()||[]).some(f=>f.props.pickable==="3d");e.unproject3D=i;const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let l=o,c=!1;for(const f of s)l=f,c=f.layer?.onHover(f,e.event)||c;c||(this.props.onHover?.(l,e.event),this.widgetManager.onHover(l,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new S3;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new MI(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(kv).map(s=>{const[o,l,c,f]=kv[s],d=this.props.eventRecognizerOptions?.[s],p={...l,...d,event:s};return{recognizer:new o(p),recognizeWith:c,requestFailure:f}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in Lp)this.eventManager.on(s,this._onEvent);this.viewManager=new PN({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new ON(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new YN({deck:this,device:this.device}),this.deckRenderer=new GN(this.device),this.deckPicker=new eD(this.device),this.widgetManager=new iD({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new P3),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Le.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=wp.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}sm.defaultProps=j3;sm.VERSION=RR;function t6(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return vg(n)}}const n6=bg;function Kc(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Js(n){return n.stride||n.size*n.bytesPerElement}function i6(n,e){return n.type===e.type&&n.size===e.size&&Js(n)===Js(e)&&(n.offset||0)===(e.offset||0)}function Kp(n,e){e.offset&&Le.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Js(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,o=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:o,stride:t}}function s6(n,e){const t=Kp(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class r6{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,o=s==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let c;o?c="float32":!s&&t.isIndexed?c="uint32":c=s||"float32";let f=t6(s||c);this.doublePrecision=o,o&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:l,logicalType:s,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Js(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ao.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const o=Kp(this.getAccessor(),t),l=o.offset/s.BYTES_PER_ELEMENT,c=o.size||this.size;i[e]=s.subarray(l,l+c)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],o={name:this.id,byteStride:Js(i),attributes:s};if(this.doublePrecision){const l=s6(i,t||{});s.push(Kc(e,{...i,...l.high},this.device.type),Kc(`${e}64Low`,{...i,...l.low},this.device.type))}else if(t){const l=Kp(i,t);s.push(Kc(e,{...i,...l},this.device.type))}else s.push(Kc(e,i,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,o=i*s;if(t&&o&&t.length>=o){const l=new Array(s).fill(1/0),c=new Array(s).fill(-1/0);for(let f=0;f<o;)for(let d=0;d<s;d++){const p=t[f++];p<l[d]&&(l[d]=p),p>c[d]&&(c[d]=p)}e=[l,c]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof lt?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=n6(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=Js(s)}if(t.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(i.buffer){const o=i.buffer;t.externalBuffer=o,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let o=i.value;t.externalBuffer=null,t.constant=!1,this.value=o;let{buffer:l}=this;const c=Js(s),f=(s.vertexOffset||0)*c;if(this.doublePrecision&&o instanceof Float64Array&&(o=Kd(o,s)),this.settings.isIndexed){const p=this.settings.defaultType;o.constructor!==p&&(o=new p(o))}const d=o.byteLength+f+c*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(o,f)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Kd(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,o=Ao.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{byteOffset:l}=this;let{buffer:c}=this;return(!c||c.byteLength<o.byteLength+l)&&(c=this._createBuffer(o.byteLength+l),t&&s&&c.write(s instanceof Float64Array?Kd(s,this):s,l)),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Le.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:o}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let l=o;for(;--l>=0;)t[i+l]=s[l];return t}switch(o){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let l=o;for(;--l>=0;)t[i+l]=Number.isFinite(e[l])?e[l]:s[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?lt.INDEX:lt.VERTEX)|lt.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const w1=[],E1=[];function Qu(n,e=0,t=1/0){let i=w1;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(E1.length=n.length,i=E1):i=w1,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function W3(n){return n&&n[Symbol.asyncIterator]}function $3(n,e){const{size:t,stride:i,offset:s,startIndices:o,nested:l}=e,c=n.BYTES_PER_ELEMENT,f=i?i/c:t,d=s?s/c:0,p=Math.floor((n.length-d)/f);return(m,{index:y,target:b})=>{if(!o){const E=y*f+d;for(let B=0;B<t;B++)b[B]=n[E+B];return b}const x=o[y],T=o[y+1]||p;let R;if(l){R=new Array(T-x);for(let E=x;E<T;E++){const B=E*f+d;b=new Array(t);for(let M=0;M<t;M++)b[M]=n[B+M];R[E-x]=b}}else if(f===t)R=n.subarray(x*t+d,T*t+d);else{R=new n.constructor((T-x)*t);let E=0;for(let B=x;B<T;B++){const M=B*f+d;for(let D=0;D<t;D++)R[E++]=n[M+D]}}return R}}const o6=[],mu=[[0,1/0]];function a6(n,e){if(n===mu||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let o=0;o<i;o++){const l=n[o];l[1]<e[0]?(t.push(l),s=o+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(s,0,e),t}const l6={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function X3(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...l6[t],...e,...n,type:t}}class q3 extends r6{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:mu}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!i6(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return X3(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=a6(this.state.updateRanges,[i,s])}else this.state.updateRanges=mu}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=o6}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==mu),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:l,noAlloc:c}}=this;let f=!0;if(l){for(const[d,p]of o)l.call(s,this,{data:t,startRow:d,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of o){const m=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e,t){const i=this.device.type==="webgpu";if(i||t===void 0||typeof t=="function"){if(i&&typeof t!="function"){const l=this._normalizeValue(t,[],0);this._areValuesEqual(l,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Ut(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const c=!!l.size&&l.size!==this.size;return i.binaryAccessor=$3(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const o in t){const l=super._getBufferLayout(o,t[o]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:o,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:c,state:f,value:d,size:p,startIndices:m}=e,{accessor:y,transform:b}=c;let x=f.binaryAccessor||(typeof y=="function"?y:o[y]);typeof x!="function"&&typeof y=="string"&&(x=()=>o[y]),Ut(typeof x=="function",`accessor "${y}" is not a function`);let T=e.getVertexOffset(i);const{iterable:R,objectInfo:E}=Qu(t,i,s);for(const B of R){E.index++;let M=x(B,E);if(b&&(M=b.call(this,M)),m){const D=(E.index<m.length-1?m[E.index+1]:l)-m[E.index];if(M&&Array.isArray(M[0])){let F=T;for(const W of M)e._normalizeValue(W,d,F),F+=p}else M&&M.length>p?d.set(M,T):(e._normalizeValue(M,E.target,0),wN({target:d,source:E.target,start:T,count:D}));T+=D*p}else e._normalizeValue(M,d,T),T+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function lp(n){const{source:e,target:t,start:i=0,size:s,getData:o}=n,l=n.end||t.length,c=e.length,f=l-i;if(c>f){t.set(e.subarray(0,f),i);return}if(t.set(e,i),!o)return;let d=c;for(;d<f;){const p=o(d,e);for(let m=0;m<s;m++)t[i+d]=p[m]||0,d++}}function c6({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:o}){if(!s||!o)return lp({source:n,target:e,size:t,getData:i}),e;let l=0,c=0;const f=i&&((p,m)=>i(p+c,m)),d=Math.min(s.length,o.length);for(let p=1;p<d;p++){const m=s[p]*t,y=o[p]*t;lp({source:n.subarray(l,m),target:e,start:c,end:y,size:t,getData:f}),l=m,c=y}return c<e.length&&lp({source:[],target:e,start:c,size:t,getData:f}),e}function u6(n){const{device:e,settings:t,value:i}=n,s=new q3(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function Y3(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function Z3(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function K3(n){n.push(n.shift())}function f6(n,e){const{doublePrecision:t,settings:i,value:s,size:o}=n,l=t&&s instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=n.settings;if(f)for(const d of Object.values(f))c=Math.max(c,d.vertexOffset??0);return(i.noAlloc?s.length:(e+c)*o)*l}function G3({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Q3({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:o,getData:l=c=>c}){const c=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*c,d=t.byteOffset,p=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,m=t.startIndices,y=o&&m,b=t.isConstant;if(!y&&e&&i>=s)return e;const x=t.value instanceof Float64Array?Float32Array:t.value.constructor,T=b?t.value:new x(t.getBuffer().readSyncWebGL(d,s*x.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!b){const M=l;l=(D,F)=>t.normalizeConstant(M(D,F))}const R=b?(M,D)=>l(T,D):(M,D)=>l(T.subarray(M+d,M+d+f),D),E=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),B=new Float32Array(s);return c6({source:E,target:B,sourceStartIndices:o,targetStartIndices:m,size:f,getData:R}),(!e||e.byteLength<B.byteLength+p)&&(e?.destroy(),e=n.createBuffer({byteLength:B.byteLength+p,usage:35050})),e.write(B,p),e}class J3{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ku(i),this.attribute=t,this.attributeInTransition=u6(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=f6(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class h6 extends J3{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=m6(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:l}=this;K3(o),o[0]=Q3({device:this.device,buffer:o[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),o[1]=G3({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:c}=this,f=c.model;let d=Math.floor(this.currentLength/l.size);eT(l)&&(d/=2),f.setVertexCount(d),l.isConstant?(f.setAttributes({aFrom:o[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:o[0],aTo:l.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:o}=this.transform,l={time:s};o.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const d6=`uniform interpolationUniforms {
  float time;
} interpolation;
`,R1={name:"interpolation",vs:d6,uniformTypes:{time:"f32"}},p6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,g6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function eT(n){return n.doublePrecision&&n.value instanceof Float64Array}function m6(n,e){const t=e.size,i=Y3(t),s=Z3(t),o=e.getBufferLayout();return eT(e)?new wo(n,{vs:g6,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[mP,R1],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new wo(n,{vs:p6,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:o.attributes[0].format}],modules:[R1],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class _6 extends J3{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=S6(e),this.framebuffer=A6(e,this.texture),this.transform=T6(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:o,attribute:l}=this;for(let f=0;f<2;f++)o[f]=Q3({device:this.device,buffer:o[f],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});o[2]=G3({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?c.setConstantAttributes({aTo:l.value}):c.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,o=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:o.stiffness,damping:o.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),K3(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const y6=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,b6={name:"spring",vs:y6,uniformTypes:{damping:"f32",stiffness:"f32"}},v6=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,x6=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function T6(n,e){const t=Y3(e.size),i=Z3(e.size);return new wo(n,{vs:v6,fs:x6,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[b6],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function S6(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function A6(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const w6={interpolation:h6,spring:_6};class E6{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const o=e[s],l=o.getTransitionSetting(t);l&&this._updateAttribute(s,o,l)}for(const s in this.transitions){const o=e[s];(!o||!o.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let o=!s||s.type!==i.type;if(o){s&&this._removeTransition(e);const l=w6[i.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(Le.error(`unsupported transition type '${i.type}'`)(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const C1="attributeManager.invalidate",R6="attributeManager.updateStart",C6="attributeManager.updateEnd",M6="attribute.updateStart",O6="attribute.allocate",P6="attribute.updateEnd";class I6{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=dl(W4),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new E6(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);Qt(C1,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Qt(C1,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:o={},buffers:l={},context:c={}}){let f=!1;Qt(R6,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],m=p.settings.accessor;p.startIndices=i,p.numInstances=t,o[d]&&Le.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof m=="string"?l[m]:void 0,e.startIndices)||typeof m=="string"&&!l[m]&&p.setConstantValue(c,o[m])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:o,context:c})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}f&&Qt(C6,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const o in t){const l=t[o];l.needsRedraw(e)&&!i.hasAttribute(o)&&(s[o]=l)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],o={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new q3(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,o=s[e];return o&&o.forEach(l=>{const c=i[l];c&&c.setNeedsUpdate(c.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(Qt(M6,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(i)&&Qt(O6,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Qt(P6,t,i))}}class N6 extends Ku{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:o}}=this,l=o(e/s);this._value=Es(t,i,l)}}const M1=1e-5;function O1(n,e,t,i,s){const o=e-n,c=(t-e)*s,f=-o*i;return c+f+o+e}function D6(n,e,t,i,s){if(Array.isArray(t)){const o=[];for(let l=0;l<t.length;l++)o[l]=O1(n[l],e[l],t[l],i,s);return o}return O1(n,e,t,i,s)}function P1(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class k6 extends Ku{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:o=e,_currValue:l=e}=this;let c=D6(o,l,t,i,s);const f=P1(c,t),d=P1(c,l);f<M1&&d<M1&&(c=t,this.end()),this._prevValue=l,this._currValue=c}}const B6={interpolation:N6,spring:k6};class L6{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:o}=this;if(o.has(e)){const f=o.get(e),{value:d=f.settings.fromValue}=f;t=d,this.remove(e)}if(s=X3(s),!s)return;const l=B6[s.type];if(!l){Le.error(`unsupported transition type '${s.type}'`)();return}const c=new l(this.timeline);c.start({...s,fromValue:t,toValue:i}),o.set(e,c)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function U6(n){const e=n[Rs];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function F6(n,e){const t=tT({newProps:n,oldProps:e,propTypes:n[Rs],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=V6(n,e);let s=!1;return i||(s=H6(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:j6(n,e),transitionsChanged:z6(n,e)}}function z6(n,e){if(!n.transitions)return!1;const t={},i=n[Rs];let s=!1;for(const o in n.transitions){const l=i[o],c=l&&l.type;(c==="number"||c==="color"||c==="array")&&Gp(n[o],e[o],l)&&(t[o]=!0,s=!0)}return s?t:!1}function tT({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const o of Object.keys(n))if(!(o in t)){if(!(o in e))return`${s}.${o} added`;const l=Gp(n[o],e[o],i[o]);if(l)return`${s}.${o} ${l}`}for(const o of Object.keys(e))if(!(o in t)){if(!(o in n))return`${s}.${o} dropped`;if(!Object.hasOwnProperty.call(n,o)){const l=Gp(n[o],e[o],i[o]);if(l)return`${s}.${o} ${l}`}}return!1}function Gp(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function V6(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function H6(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&I1(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&I1(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function j6(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function I1(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},tT({oldProps:s,newProps:i,triggerName:t})}const W6="count(): argument not an object",$6="count(): argument not a container";function X6(n){if(!Y6(n))throw new Error(W6);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(q6(n))return Object.keys(n).length;throw new Error($6)}function q6(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Y6(n){return n!==null&&typeof n=="object"}function N1(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const Z6={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Qp={};function K6(n,e,t,i){if(t instanceof It)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:o,height:l}=t.data,c=e.createTexture({...t,sampler:{...Z6,...s,...i},mipLevels:e.getMipLevelCount(o,l)});return c.generateMipmapsWebGL(),Qp[c.id]=n,c}function G6(n,e){!e||!(e instanceof It)||Qp[e.id]===n&&(e.delete(),delete Qp[e.id])}const Q6={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Jp(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Fn(n,e,1)}},accessor:{validate(n,e){const t=Fu(n);return t==="function"||t===Fu(e.value)},equal(n,e,t){return typeof e=="function"?!0:Fn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Jp(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Fn(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Fn(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:K6(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{G6(t.id,n)}}};function J6(n){const e={},t={},i={};for(const[s,o]of Object.entries(n)){const l=o?.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const c=eB(s,o);e[s]=c,t[s]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function eB(n,e){switch(Fu(e)){case"object":return Ia(n,e);case"array":return Ia(n,{type:"array",value:e,compare:!1});case"boolean":return Ia(n,{type:"boolean",value:e});case"number":return Ia(n,{type:"number",value:e});case"function":return Ia(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Ia(n,e){return"type"in e?{name:n,...Q6[e.type],...e}:"value"in e?{name:n,type:Fu(e.value),...e}:{name:n,type:"object",value:e}}function Jp(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Fu(n){return Jp(n)?"array":n===null?"null":typeof n}function tB(n,e){let t;for(let o=e.length-1;o>=0;o--){const l=e[o];"extensions"in l&&(t=l.extensions)}const i=eg(n.constructor,t),s=Object.create(i);s[Uu]=n,s[fr]={},s[Ss]={};for(let o=0;o<e.length;++o){const l=e[o];for(const c in l)s[c]=l[c]}return Object.freeze(s),s}const nB="_mergedDefaultProps";function eg(n,e){if(!(n instanceof Ju.constructor))return{};let t=nB;if(e)for(const s of e){const o=s.constructor;o&&(t+=`:${o.extensionName||o.name}`)}const i=nT(n,t);return i||(n[t]=iB(n,e||[]))}function iB(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=eg(i),o=nT(n,"defaultProps")||{},l=J6(o),c=Object.assign(Object.create(null),s,l.defaultProps),f=Object.assign(Object.create(null),s?.[Rs],l.propTypes),d=Object.assign(Object.create(null),s?.[tp],l.deprecatedProps);for(const p of e){const m=eg(p.constructor);m&&(Object.assign(c,m),Object.assign(f,m[Rs]),Object.assign(d,m[tp]))}return sB(c,n),oB(c,f),rB(c,d),c[Rs]=f,c[tp]=d,e.length===0&&!rm(n,"_propTypes")&&(n._propTypes=f),c}function sB(n,e){const t=lB(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function rB(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const o of e[t])rm(this,o)||(this[o]=i);Le.deprecated(s,e[t].join("/"))()}})}function oB(n,e){const t={},i={};for(const s in e){const o=e[s],{name:l,value:c}=o;o.async&&(t[l]=c,i[l]=aB(l))}n[vo]=t,n[fr]={},Object.defineProperties(n,i)}function aB(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||W3(e)?this[fr][n]=e:this[Ss][n]=e},get(){if(this[Ss]){if(n in this[Ss])return this[Ss][n]||this[vo][n];if(n in this[fr]){const e=this[Uu]&&this[Uu].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[vo][n]}}return this[vo][n]}}}function rm(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function nT(n,e){return rm(n,e)&&n[e]}function lB(n){const e=n.componentName;return e||Le.warn(`${n.name}.componentName not specified`)(),e||n.name}let cB=0;class Ju{constructor(...e){this.props=tB(this,e),this.id=this.props.id,this.count=cB++}clone(e){const{props:t}=this,i={};for(const s in t[vo])s in t[Ss]?i[s]=t[Ss][s]:s in t[fr]&&(i[s]=t[fr][s]);return new this.constructor({...t,...i,...e})}}Ju.componentName="Component";Ju.defaultProps={};const uB=Object.freeze({});class fB{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||uB}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Uu]||this.component;const t=e[Ss]||{},i=e[fr]||e,s=e[vo]||{};for(const o in t){const l=t[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,l),t[o]=this.getAsyncProp(o)}for(const o in i){const l=i[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(W3(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,s),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let o=[],l=0;for await(const c of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?o=f(c,o):o=o.concat(c),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:l,endRow:o.length}]}),l=o.length,this._setAsyncPropValue(e,o,s)}this._onResolve(e,o)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Rs];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class hB extends fB{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i?.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const dB="layer.changeFlag",pB="layer.initialize",gB="layer.update",mB="layer.finalize",_B="layer.matched",D1=2**24-1,yB=Object.freeze([]),bB=dl(({oldViewport:n,viewport:e})=>n.equals(e));let Zn=new Uint8ClampedArray(0);const vB={data:{type:"data",value:yB,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:o})=>{const{resourceManager:l}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,o&&(s={...s,fetch:{...s?.fetch,signal:o}});let c=l.contains(n);return!c&&!s&&(l.add({resourceId:n,data:Au(n,i),persistent:!1}),c=!0),c?l.subscribe({resourceId:n,onChange:f=>t.internalState?.reloadAsyncProp(e,f),consumerId:t.id,requestId:e}):Au(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:He.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class pi extends Ju{constructor(){super(...arguments),this.internalState=null,this.lifecycle=oo.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ut(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=T3(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,o,l]=g3(i,t.pixelProjectionMatrix);return e.length===2?[s,o]:[s,o,l]}unproject(e){return Ut(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Ut(this.internalState);const i=this.internalState.viewport||this.context.viewport;return K4(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===He.DEFAULT||e===He.LNGLAT||e===He.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ut(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:X6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=N1(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=N1(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,o=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||!!s.pickable||s.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(o!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:c,instancePickingColors:f}=t.attributes,d=c||f;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!bB({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Zn.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>D1&&Le.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Zn=Ao.allocate(Zn,t,{size:4,copy:!0,maxCount:Math.max(t,D1)});const s=Math.floor(Zn.length/4),o=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,o),Zn[l*4+0]=o[0],Zn[l*4+1]=o[1],Zn[l*4+2]=o[2],Zn[l*4+3]=0}e.value=Zn.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),t=c.getAttributes()}const s=e.userData?.excludeAttributes||{},o={},l={};for(const c in t){if(s[c])continue;const f=t[c].getValue();for(const d in f){const p=f[d];p instanceof lt?t[c].settings.isIndexed?e.setIndexBuffer(p):o[d]=p:p&&(l[d]=p)}}e.setAttributes(o),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,o=i||s,l=o&&t.attributes&&t.attributes[o.id];if(l&&l.value){const c=l.value,f=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=o.getVertexOffset(d);c[p]===f[0]&&c[p+1]===f[1]&&c[p+2]===f[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const o=s.getVertexOffset(e),l=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(l-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Zn.buffer&&(i.value=Zn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ut(!this.internalState),Ut(Number.isFinite(this.props.coordinateSystem)),Qt(pB,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new hB({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Le.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new L6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Qt(_B,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Qt(gB,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,o=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||o,this.props=l;try{const c=this._getUpdateParams(),f=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const p of this.props.extensions)p.updateState.call(this,c,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==f[0];this._postUpdate(c,d)}finally{i.viewport=o,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Qt(mB,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:c}=this.props,f=c&&c(i)||[0,0];l.device instanceof Zp&&l.device.setParametersWebGL({polygonOffset:f});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof Zp)l.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let o=!1;switch(s){case"dataChanged":const l=e[s],c=t[s];l&&Array.isArray(c)&&(t.dataChanged=Array.isArray(l)?c.concat(l):l,o=!0);default:t[s]||(t[s]=e[s],o=!0)}o&&Qt(dB,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=F6(e,t);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],e.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){U6(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new I6(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:c,highlightColor:f}=i;if(t||s.autoHighlight!==l||s.highlightedObjectIndex!==c||s.highlightColor!==f){const d={};Array.isArray(f)&&(d.highlightColor=f),(t||s.autoHighlight!==l||c!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}pi.defaultProps=vB;pi.layerName="Layer";const xB="compositeLayer.renderLayers";class ef extends pi{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:s,parameters:o,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:f,highlightColor:d,coordinateSystem:p,coordinateOrigin:m,wrapLongitude:y,positionFormat:b,modelMatrix:x,extensions:T,fetch:R,operation:E,_subLayerProps:B}=this.props,M={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:o,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:f,highlightColor:d,coordinateSystem:p,coordinateOrigin:m,wrapLongitude:y,positionFormat:b,modelMatrix:x,extensions:T,fetch:R,operation:E},D=B&&e.id&&B[e.id],F=D&&D.updateTriggers,W=e.id||"sublayer";if(D){const ee=this.props[Rs],ae=e.type?e.type._propTypes:{};for(const ne in D){const fe=ae[ne]||ee[ne];fe&&fe.type==="accessor"&&(D[ne]=this.getSubLayerAccessor(D[ne]))}}Object.assign(M,e,D),M.id=`${this.props.id}-${W}`,M.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...F};for(const ee of T){const ae=ee.getSubLayerProps.call(this,ee);ae&&Object.assign(M,ae,{updateTriggers:Object.assign(M.updateTriggers,ae.updateTriggers)})}return M}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const o=this.renderLayers();i=Zu(o,Boolean),this.internalState.subLayers=i}Qt(xB,this,s,i);for(const o of i)o.parent=this}}ef.layerName="CompositeLayer";class TB extends M3{constructor(e){const{startPanPos:t,...i}=e;super(i),t!==void 0&&(this._state.startPanPos=t)}panStart({pos:e}){const{latitude:t,longitude:i,zoom:s}=this.getViewportProps();return this._getUpdatedState({startPanLngLat:[i,t],startPanPos:e,startZoom:s})}pan({pos:e,startPos:t}){const i=this.getState(),s=i.startPanLngLat||this._unproject(t);if(!s)return this;const o=i.startZoom??this.getViewportProps().zoom,l=i.startPanPos||t,c=[s[0],s[1],o],d=this.makeViewport(this.getViewportProps()).panByPosition(c,e,l);return this._getUpdatedState(d)}panEnd(){return this._getUpdatedState({startPanLngLat:null,startPanPos:null,startZoom:null})}zoom({scale:e}){const i=(this.getState().startZoom||this.getViewportProps().zoom)+Math.log2(e);return this._getUpdatedState({zoom:i})}applyConstraints(e){const{longitude:t,latitude:i,maxZoom:s,minZoom:o,zoom:l}=e,c=uo(0),f=uo(i)-c;return e.zoom=fi(l,o+f,s+f),(t<-180||t>180)&&(e.longitude=z4(t+180,360)-180),e.latitude=fi(i,-hi,hi),e}}class SB extends C3{constructor(){super(...arguments),this.ControllerState=TB,this.transition={transitionDuration:300,transitionInterpolator:new Kg(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class iT extends hr{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Wi:Gu}get ControllerType(){return SB}}iT.displayName="GlobeView";const cp={bearing:0,pitch:0,position:[0,0,0]},AB={speed:1.2,curve:1.414};class wB extends R3{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...AB,...e}}interpolateProps(e,t,i){const s=l4(e,t,i,this.opts);for(const o in cp)s[o]=Es(e[o]||cp[o],t[o]||cp[o],i);return s}getDuration(e,t){let{transitionDuration:i}=t;return i==="auto"&&(i=c4(e,t,this.opts)),i}}class sT{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Ao,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:s,geometryBuffer:o,positionFormat:l,dataChanged:c,normalize:f=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=o&&o.size||(l==="XY"?2:3),this.buffers=i,this.normalize=f,o&&(Ut(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),f||(i.vertexPositions=o)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(const d of c)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?$3(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:s,_attributeDefs:o,typedArrayManager:l}=this;for(const c in o)if(c in s)l.release(i[c]),i[c]=null;else{const f=o[c];f.copy=t,i[c]=l.allocate(i[c],e,f)}}_forEachGeometry(e,t,i){const{data:s,getGeometry:o}=this,{iterable:l,objectInfo:c}=Qu(s,t,i);for(const f of l){c.index++;const d=o?o(f,c):null;e(d,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:s}=this;const{data:o,geometryBuffer:l}=this,{startRow:c=0,endRow:f=1/0}=e||{},d={};if(e||(t=[0],i=[0]),this.normalize||!l)this._forEachGeometry((m,y)=>{const b=m&&this.normalizeGeometry(m);d[y]=b,i[y+1]=i[y]+(b?this.getGeometrySize(b):0)},c,f),s=i[i.length-1];else if(i=o.startIndices,s=i[o.length]||0,ArrayBuffer.isView(l))s=s||l.length/this.positionSize;else if(l instanceof lt){const m=this.positionSize*4;s=s||l.byteLength/m}else if(l.buffer){const m=l.stride||this.positionSize*4;s=s||l.buffer.byteLength/m}else if(l.value){const m=l.value,y=l.stride/m.BYTES_PER_ELEMENT||this.positionSize;s=s||m.length/y}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=s;const p={};this._forEachGeometry((m,y)=>{const b=d[y]||m;p.vertexStart=i[y],p.indexStart=t[y];const x=y<i.length-1?i[y+1]:s;p.geometrySize=x-i[y],p.geometryIndex=y,this.updateGeometryAttributes(b,p)},c,f),this.vertexCount=t[t.length-1]}}const EB=typeof window<"u"?Ce.useLayoutEffect:Ce.useEffect;function zu(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const RB={position:"absolute",zIndex:-1};function rT(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>rT(t,e));if(tf(n)){if(CB(n))return e.style=RB,Ce.cloneElement(n,e);if(MB(n))return Ce.cloneElement(n,e)}return n}function tf(n){return n&&typeof n=="object"&&"type"in n||!1}function CB(n){return n.props?.mapStyle}function MB(n){const e=n.type;return e&&e.deckGLViewProps}function tg(n){if(typeof n=="function")return Ce.createElement(hr,{},n);if(Array.isArray(n))return n.map(tg);if(tf(n)){if(n.type===Ce.Fragment)return tg(n.props.children);if(zu(n.type,hr))return n}return n}function OB({children:n,layers:e=[],views:t=null}){const i=[],s=[],o={};return Ce.Children.forEach(tg(n),l=>{if(tf(l)){const c=l.type;if(zu(c,pi)){const f=PB(c,l.props);s.push(f)}else i.push(l);if(zu(c,hr)&&c!==hr&&l.props.id){const f=new c(l.props);o[f.id]=f}}else l&&i.push(l)}),Object.keys(o).length>0&&(Array.isArray(t)?t.forEach(l=>{o[l.id]=l}):t&&(o[t.id]=t),t=Object.values(o)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function PB(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const IB=Ce.createContext();function NB({children:n,deck:e,ContextProvider:t=IB.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},o=i.views[0].id;for(const l of n){let c=o,f=l;tf(l)&&zu(l.type,hr)&&(c=l.props.id||o,f=l.props.children);const d=i.getViewport(c),p=i.getViewState(c);if(d){p.padding=d.padding;const{x:m,y,width:b,height:x}=d;f=rT(f,{x:m,y,width:b,height:x,viewport:d,viewState:p}),s[c]||(s[c]={viewport:d,children:[]}),s[c].children.push(f)}}return Object.keys(s).map(l=>{const{viewport:c,children:f}=s[l],{x:d,y:p,width:m,height:y}=c,b={position:"absolute",left:d,top:p,width:m,height:y},x=`view-${l}`,T=Ce.createElement("div",{key:x,id:x,style:b},...f),R={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:B=>{B.viewId=l,e._onViewStateChange(B)},widgets:[]},E=`view-${l}-context`;return Ce.createElement(t,{key:E,value:R},T)})}const DB={mixBlendMode:null};function kB({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const o in t)o in DB?s[o]=t[o]:i[o]=t[o];return{containerStyle:i,canvasStyle:s}}function BB(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function oT(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function LB(n,e,t){const i=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{n.redrawReason=s;const o=i.getViewports();n.lastRenderedViewports!==o?n.forceUpdate():oT(n)}});return i}function UB(n,e){const[t,i]=Ce.useState(0),o=Ce.useRef({control:null,version:t,forceUpdate:()=>i(F=>F+1)}).current,l=Ce.useRef(null),c=Ce.useRef(null),f=Ce.useMemo(()=>OB(n),[n.layers,n.views,n.children]);let d=!0;const p=F=>d&&n.viewState?(o.viewStateUpdateRequested=F,null):(o.viewStateUpdateRequested=null,n.onViewStateChange?.(F)),m=F=>{d?o.interactionStateUpdateRequested=F:(o.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(F))},y=Ce.useMemo(()=>{const F={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:p,onInteractionStateChange:m};return delete F._customRender,o.deck&&o.deck.setProps(F),F},[n]);Ce.useEffect(()=>{const F=n.Deck||sm;return o.deck=LB(o,F,{...y,parent:l.current,canvas:c.current}),()=>o.deck?.finalize()},[]),EB(()=>{oT(o);const{viewStateUpdateRequested:F,interactionStateUpdateRequested:W}=o;F&&p(F),W&&m(W),o.deck?.isInitialized&&o.deck.redraw("Initial render")}),Ce.useImperativeHandle(e,()=>BB(o),[]);const b=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:x,width:T="100%",height:R="100%",id:E,style:B}=n,{containerStyle:M,canvasStyle:D}=Ce.useMemo(()=>kB({width:T,height:R,style:B}),[T,R,B]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===b||o.version!==t){o.lastRenderedViewports=b,o.version=t;const F=NB({children:f.children,deck:o.deck,ContextProvider:x}),W=Ce.createElement("canvas",{key:"canvas",id:E||"deckgl-overlay",ref:c,style:D});o.control=Ce.createElement("div",{id:`${E||"deckgl"}-wrapper`,ref:l,style:M},[W,F])}return d=!1,o.control}const FB=Ce.forwardRef(UB),zB=new Uint32Array([0,2,1,0,3,2]),VB=new Float32Array([0,1,0,0,1,0,1,1]);function HB(n,e){if(!e)return jB(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),i=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),s=Math.ceil(t/e)+1,o=Math.ceil(i/e)+1,l=(s-1)*(o-1)*6,c=new Uint32Array(l),f=new Float32Array(s*o*2),d=new Float64Array(s*o*3);let p=0,m=0;for(let y=0;y<s;y++){const b=y/(s-1);for(let x=0;x<o;x++){const T=x/(o-1),R=WB(n,b,T);d[p*3+0]=R[0],d[p*3+1]=R[1],d[p*3+2]=R[2]||0,f[p*2+0]=b,f[p*2+1]=1-T,y>0&&x>0&&(c[m++]=p-o,c[m++]=p-o-1,c[m++]=p-1,c[m++]=p-o,c[m++]=p-1,c[m++]=p),p++}}return{vertexCount:l,positions:d,indices:c,texCoords:f}}function jB(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:zB,texCoords:VB}}function WB(n,e,t){return Es(Es(n[0],n[1],t),Es(n[3],n[2],t),e)}const k1=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,$B={name:"bitmap",vs:k1,fs:k1,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},XB=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,qB=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,YB=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${qB}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,ZB={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:He.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class om extends pi{getShaders(){return super.getShaders({vs:XB,fs:YB,modules:[Mo,Oo,$B]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:i}){const s=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==t.bounds){const o=this.state.mesh,l=this._createMesh();this.state.model.setVertexCount(l.vertexCount);for(const c in l)o&&o[c]!==l[c]&&s.invalidate(c);this.setState({mesh:l,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;const{width:s,height:o}=t;i.index=0;const l=KB(i.color);return i.bitmap={size:{width:s,height:o},uv:l,pixel:[Math.floor(l[0]*s),Math.floor(l[1]*o)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return B1(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),HB(t,this.context.viewport.resolution)}_getModel(){return new Hn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:i,coordinateConversion:s,bounds:o,disablePicking:l}=this.state,{image:c,desaturate:f,transparentColor:d,tintColor:p}=this.props;if(!(t.picking.isActive&&l)&&c&&i){const m={bitmapTexture:c,bounds:o,coordinateConversion:s,desaturate:f,tintColor:p.slice(0,3).map(y=>y/255),transparentColor:d.map(y=>y/255)};i.shaderInputs.setProps({bitmap:m}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=He;let{_imageCoordinateSystem:s}=this.props;if(s!==i){const{bounds:o}=this.props;if(!B1(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const l=this.context.viewport.resolution?e:t;if(s=s===e?e:t,s===e&&l===t)return{coordinateConversion:-1,bounds:o};if(s===t&&l===e){const c=di([o[0],o[1]]),f=di([o[2],o[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],f[0],f[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}om.layerName="BitmapLayer";om.defaultProps=ZB;function KB(n){const[e,t,i]=n,s=(i&240)/256,o=(i&15)/16;return[(e+o)/256,(t+s)/256]}function B1(n){return Number.isFinite(n[0])}const L1=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,GB={name:"icon",vs:L1,fs:L1,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},QB=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,JB=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,eL=1024,tL=4,U1=()=>{},F1={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},nL={x:0,y:0,width:0,height:0};function iL(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function sL(n,e,t,i){const s=Math.min(t/e.width,i/e.height),o=Math.floor(e.width*s),l=Math.floor(e.height*s);return s===1?{image:e,width:o,height:l}:(n.canvas.height=l,n.canvas.width=o,n.clearRect(0,0,o,l),n.drawImage(e,0,0,e.width,e.height,0,0,o,l),{image:n.canvas,width:o,height:l})}function rl(n){return n&&(n.id||n.url)}function rL(n,e,t,i){const{width:s,height:o,device:l}=n,c=l.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipLevels:l.getMipLevelCount(e,t)}),f=l.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:n,destinationTexture:c,width:s,height:o}),f.finish(),c.generateMipmapsWebGL(),n.destroy(),c}function z1(n,e,t){for(let i=0;i<e.length;i++){const{icon:s,xOffset:o}=e[i],l=rl(s);n[l]={...s,x:o,y:t}}}function oL({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:s=0,rowHeight:o=0,canvasWidth:l}){let c=[];for(let f=0;f<n.length;f++){const d=n[f],p=rl(d);if(!t[p]){const{height:m,width:y}=d;i+y+e>l&&(z1(t,c,s),i=0,s=o+s+e,o=0,c=[]),c.push({icon:d,xOffset:i}),i=i+y+e,o=Math.max(o,m)}}return c.length>0&&z1(t,c,s),{mapping:t,rowHeight:o,xOffset:i,yOffset:s,canvasWidth:l,canvasHeight:iL(o+s+e)}}function aL(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:s,objectInfo:o}=Qu(n);for(const l of s){o.index++;const c=e(l,o),f=rl(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!i[f]&&(!t[f]||c.url!==t[f].url)&&(i[f]={...c,source:l,sourceIndex:o.index})}return i}class lL{constructor(e,{onUpdate:t=U1,onError:i=U1}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=tL,this._canvasWidth=eL,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?rl(e):e;return this._mapping[t]||nL}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:s,textureParameters:o}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(aL(e,t,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:o,yOffset:l,rowHeight:c,canvasHeight:f}=oL({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=s,this._xOffset=o,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||F1,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=rL(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||F1)),this.onUpdate(!0),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Au(i.url,this._loadOptions).then(s=>{const o=rl(i),l=this._mapping[o],{x:c,y:f,width:d,height:p}=l,{image:m,width:y,height:b}=sL(t,s,d,p),x=c+(d-y)/2,T=f+(p-b)/2;this._texture?.copyExternalImage({image:m,x,y:T,width:y,height:b}),l.x=x,l.y=T,l.width=y,l.height=b,this._texture?.generateMipmapsWebGL(),this.onUpdate(y!==d||b!==p)}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const aT=[0,0,0,255],cL={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:aT},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class nf extends pi{getShaders(){return super.getShaders({vs:QB,fs:JB,modules:[Mo,Oo,GB]})}initializeState(){this.state={iconManager:new lL(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:aT},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,o=this.getAttributeManager(),{iconAtlas:l,iconMapping:c,data:f,getIcon:d,textureParameters:p}=t,{iconManager:m}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");m.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?c:null,textureParameters:p}),y?i.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&m.packIcons(f,d),s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeBasis:i,sizeMinPixels:s,sizeMaxPixels:o,sizeUnits:l,billboard:c,alphaCutoff:f}=this.props,{iconManager:d}=this.state,p=d.getTexture();if(p){const m=this.state.model,y={iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Hi[l],sizeScale:t,sizeBasis:i==="height"?1:0,sizeMinPixels:s,sizeMaxPixels:o,billboard:c,alphaCutoff:f};m.shaderInputs.setProps({icon:y}),m.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Hn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Eo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(e){e?(this.getAttributeManager()?.invalidate("getIcon"),this.setNeedsUpdate()):this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):Le.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:s=t/2,anchorY:o=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,i/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:s,height:o}=this.state.iconManager.getIconMapping(e);return[t,i,s,o]}}nf.defaultProps=cL;nf.layerName="IconLayer";const V1=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,uL={name:"scatterplot",vs:V1,fs:V1,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},fL=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,hL=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dL=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,H1=[0,0,0,255],pL={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:H1},getLineColor:{type:"accessor",value:H1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ol extends pi{getShaders(){return super.getShaders({vs:fL,fs:hL,source:dL,modules:[Mo,IP,Oo,uL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,stroked:l,filled:c,billboard:f,antialiasing:d,lineWidthUnits:p,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,x={stroked:l,filled:c,billboard:f,antialiasing:d,radiusUnits:Hi[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,lineWidthUnits:Hi[p],lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:b},T=this.state.model;T.shaderInputs.setProps({scatterplot:x}),this.context.device.type==="webgpu"&&(T.instanceCount=this.props.data.length),T.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Hn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Eo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0,parameters:e})}}ol.defaultProps=pL;ol.layerName="ScatterplotLayer";const lT={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function cT(n,e,t={}){return gL(n,t)!==e?(_L(n,t),!0):!1}function gL(n,e={}){return Math.sign(mL(n,e))}const j1={x:0,y:1,z:2};function mL(n,e={}){const{start:t=0,end:i=n.length,plane:s="xy"}=e,o=e.size||2;let l=0;const c=j1[s[0]],f=j1[s[1]];for(let d=t,p=i-o;d<i;d+=o)l+=(n[d+c]-n[p+c])*(n[d+f]+n[p+f]),p=d;return l/2}function _L(n,e){const{start:t=0,end:i=n.length,size:s=2}=e,o=(i-t)/s,l=Math.floor(o/2);for(let c=0;c<l;++c){const f=t+c*s,d=t+(o-1-c)*s;for(let p=0;p<s;++p){const m=n[f+p];n[f+p]=n[d+p],n[d+p]=m}}}function Qn(n,e){const t=e.length,i=n.length;if(i>0){let s=!0;for(let o=0;o<t;o++)if(n[i-t+o]!==e[o]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[i+s]=e[s];return!0}function ng(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function al(n,e,t,i,s=[]){const o=i+e*t;for(let l=0;l<t;l++)s[l]=n[o+l];return s}function ig(n,e,t,i,s=[]){let o,l;if(t&8)o=(i[3]-n[1])/(e[1]-n[1]),l=3;else if(t&4)o=(i[1]-n[1])/(e[1]-n[1]),l=1;else if(t&2)o=(i[2]-n[0])/(e[0]-n[0]),l=2;else if(t&1)o=(i[0]-n[0])/(e[0]-n[0]),l=0;else return null;for(let c=0;c<n.length;c++)s[c]=(l&1)===c?i[l]:o*(e[c]-n[c])+n[c];return s}function _u(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function uT(n,e){const{size:t=2,broken:i=!1,gridResolution:s=10,gridOffset:o=[0,0],startIndex:l=0,endIndex:c=n.length}=e||{},f=(c-l)/t;let d=[];const p=[d],m=al(n,0,t,l);let y,b;const x=hT(m,s,o,[]),T=[];Qn(d,m);for(let R=1;R<f;R++){for(y=al(n,R,t,l,y),b=_u(y,x);b;){ig(m,y,b,x,T);const E=_u(T,x);E&&(ig(m,T,E,x,T),b=E),Qn(d,T),ng(m,T),bL(x,s,b),i&&d.length>t&&(d=[],p.push(d),Qn(d,m)),b=_u(y,x)}Qn(d,y),ng(m,y)}return i?p:p[0]}const W1=0,yL=1;function fT(n,e=null,t){if(!n.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:o=[0,0],edgeTypes:l=!1}=t||{},c=[],f=[{pos:n,types:l?new Array(n.length/i).fill(yL):null,holes:e||[]}],d=[[],[]];let p=[];for(;f.length;){const{pos:m,types:y,holes:b}=f.shift();vL(m,i,b[0]||m.length,d),p=hT(d[0],s,o,p);const x=_u(d[1],p);if(x){let T=$1(m,y,i,0,b[0]||m.length,p,x);const R={pos:T[0].pos,types:T[0].types,holes:[]},E={pos:T[1].pos,types:T[1].types,holes:[]};f.push(R,E);for(let B=0;B<b.length;B++)T=$1(m,y,i,b[B],b[B+1]||m.length,p,x),T[0]&&(R.holes.push(R.pos.length),R.pos=Gc(R.pos,T[0].pos),l&&(R.types=Gc(R.types,T[0].types))),T[1]&&(E.holes.push(E.pos.length),E.pos=Gc(E.pos,T[1].pos),l&&(E.types=Gc(E.types,T[1].types)))}else{const T={positions:m};l&&(T.edgeTypes=y),b.length&&(T.holeIndices=b),c.push(T)}}return c}function $1(n,e,t,i,s,o,l){const c=(s-i)/t,f=[],d=[],p=[],m=[],y=[];let b,x,T;const R=al(n,c-1,t,i);let E=Math.sign(l&8?R[1]-o[3]:R[0]-o[2]),B=e&&e[c-1],M=0,D=0;for(let F=0;F<c;F++)b=al(n,F,t,i,b),x=Math.sign(l&8?b[1]-o[3]:b[0]-o[2]),T=e&&e[i/t+F],x&&E&&E!==x&&(ig(R,b,l,o,y),Qn(f,y)&&p.push(B),Qn(d,y)&&m.push(B)),x<=0?(Qn(f,b)&&p.push(T),M-=x):p.length&&(p[p.length-1]=W1),x>=0?(Qn(d,b)&&m.push(T),D+=x):m.length&&(m[m.length-1]=W1),ng(R,b),E=x,B=T;return[M?{pos:f,types:e&&p}:null,D?{pos:d,types:e&&m}:null]}function hT(n,e,t,i){const s=Math.floor((n[0]-t[0])/e)*e+t[0],o=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=s,i[1]=o,i[2]=s+e,i[3]=o+e,i}function bL(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function vL(n,e,t,i){let s=1/0,o=-1/0,l=1/0,c=-1/0;for(let f=0;f<t;f+=e){const d=n[f],p=n[f+1];s=d<s?d:s,o=d>o?d:o,l=p<l?p:l,c=p>c?p:c}return i[0][0]=s,i[0][1]=l,i[1][0]=o,i[1][1]=c,i}function Gc(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const xL=85.051129;function TL(n,e){const{size:t=2,startIndex:i=0,endIndex:s=n.length,normalize:o=!0}=e||{},l=n.slice(i,s);dT(l,t,0,s-i);const c=uT(l,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const f of c)pT(f,t);return c}function SL(n,e=null,t){const{size:i=2,normalize:s=!0,edgeTypes:o=!1}=t||{};e=e||[];const l=[],c=[];let f=0,d=0;for(let m=0;m<=e.length;m++){const y=e[m]||n.length,b=d,x=AL(n,i,f,y);for(let T=x;T<y;T++)l[d++]=n[T];for(let T=f;T<x;T++)l[d++]=n[T];dT(l,i,b,d),wL(l,i,b,d,t?.maxLatitude),f=y,c[m]=d}c.pop();const p=fT(l,c,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(s)for(const m of p)pT(m.positions,i);return p}function AL(n,e,t,i){let s=-1,o=-1;for(let l=t+1;l<i;l+=e){const c=Math.abs(n[l]);c>s&&(s=c,o=l-1)}return o}function wL(n,e,t,i,s=xL){const o=n[t],l=n[i-e];if(Math.abs(o-l)>180){const c=al(n,0,e,t);c[0]+=Math.round((l-o)/360)*360,Qn(n,c),c[1]=Math.sign(c[1])*s,Qn(n,c),c[0]=o,Qn(n,c)}}function dT(n,e,t,i){let s=n[0],o;for(let l=t;l<i;l+=e){o=n[l];const c=o-s;(c>180||c<-180)&&(o-=Math.round(c/360)*360),n[l]=s=o}}function pT(n,e){let t;const i=n.length/e;for(let o=0;o<i&&(t=n[o*e],(t+180)%360===0);o++);const s=-Math.round(t/360)*360;if(s!==0)for(let o=0;o<i;o++)n[o*e]+=s}function EL(n,e,t,i){let s;if(Array.isArray(n[0])){const o=n.length*e;s=new Array(o);for(let l=0;l<n.length;l++)for(let c=0;c<e;c++)s[l*e+c]=n[l][c]||0}else s=n;return t?uT(s,{size:e,gridResolution:t}):i?TL(s,{size:e}):s}const RL=1,CL=2,up=4;class ML extends sT{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?EL(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(X1(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&X1(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:l}=t;i.fill(0,o,o+l),s?(i[o]=up,i[o+l-2]=up):(i[o]+=RL,i[o+l-2]+=CL),i[o+l-1]=up}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:o}=t,l=new Array(3);for(let c=s,f=0;f<o;c++,f++)this.getPointOnPath(e,f,l),i[c*3]=l[0],i[c*3+1]=l[1],i[c*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const o=t*s;return i[0]=e[o],i[1]=e[o+1],i[2]=s===3&&e[o+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function X1(n){return Array.isArray(n[0])}const q1=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,OL={name:"path",vs:q1,fs:q1,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},PL=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,IL=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,gT=[0,0,0,255],NL={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:gT},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},fp={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class sf extends pi{getShaders(){return super.getShaders({vs:PL,fs:IL,modules:[Mo,Oo,OL]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:fp,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:fp,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:fp,defaultValue:gT},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:s,target:o})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,o)}}),this.setState({pathTesselator:new ML({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,c=t.data.attributes||{};l.updateGeometry({data:t.data,geometryBuffer:c.getPath,buffers:c,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||s.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(o=>o.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:s,miterLimit:o,widthUnits:l,widthScale:c,widthMinPixels:f,widthMaxPixels:d}=this.props,p=this.state.model,m={jointType:Number(t),capType:Number(i),billboard:s,widthUnits:Hi[l],widthScale:c,miterLimit:o,widthMinPixels:f,widthMaxPixels:d};p.shaderInputs.setProps({path:m}),p.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Hn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Eo({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}sf.defaultProps=NL;sf.layerName="PathLayer";var Qc={exports:{}},Y1;function DL(){if(Y1)return Qc.exports;Y1=1,Qc.exports=n,Qc.exports.default=n;function n(S,I,P){P=P||2;var K=I&&I.length,G=K?I[0]*P:S.length,C=e(S,0,G,P,!0),k=[];if(!C||C.next===C.prev)return k;var X,re,ue,ye,Te,Me,Be;if(K&&(C=f(S,I,C,P)),S.length>80*P){X=ue=S[0],re=ye=S[1];for(var We=P;We<G;We+=P)Te=S[We],Me=S[We+1],Te<X&&(X=Te),Me<re&&(re=Me),Te>ue&&(ue=Te),Me>ye&&(ye=Me);Be=Math.max(ue-X,ye-re),Be=Be!==0?32767/Be:0}return i(C,k,P,X,re,Be,0),k}function e(S,I,P,K,G){var C,k;if(G===Xe(S,I,P,K)>0)for(C=I;C<P;C+=K)k=ge(C,S[C],S[C+1],k);else for(C=P-K;C>=I;C-=K)k=ge(C,S[C],S[C+1],k);return k&&D(k,k.next)&&(xe(k),k=k.next),k}function t(S,I){if(!S)return S;I||(I=S);var P=S,K;do if(K=!1,!P.steiner&&(D(P,P.next)||M(P.prev,P,P.next)===0)){if(xe(P),P=I=P.prev,P===P.next)break;K=!0}else P=P.next;while(K||P!==I);return I}function i(S,I,P,K,G,C,k){if(S){!k&&C&&b(S,K,G,C);for(var X=S,re,ue;S.prev!==S.next;){if(re=S.prev,ue=S.next,C?o(S,K,G,C):s(S)){I.push(re.i/P|0),I.push(S.i/P|0),I.push(ue.i/P|0),xe(S),S=ue.next,X=ue.next;continue}if(S=ue,S===X){k?k===1?(S=l(t(S),I,P),i(S,I,P,K,G,C,2)):k===2&&c(S,I,P,K,G,C):i(t(S),I,P,K,G,C,1);break}}}}function s(S){var I=S.prev,P=S,K=S.next;if(M(I,P,K)>=0)return!1;for(var G=I.x,C=P.x,k=K.x,X=I.y,re=P.y,ue=K.y,ye=G<C?G<k?G:k:C<k?C:k,Te=X<re?X<ue?X:ue:re<ue?re:ue,Me=G>C?G>k?G:k:C>k?C:k,Be=X>re?X>ue?X:ue:re>ue?re:ue,We=K.next;We!==I;){if(We.x>=ye&&We.x<=Me&&We.y>=Te&&We.y<=Be&&E(G,X,C,re,k,ue,We.x,We.y)&&M(We.prev,We,We.next)>=0)return!1;We=We.next}return!0}function o(S,I,P,K){var G=S.prev,C=S,k=S.next;if(M(G,C,k)>=0)return!1;for(var X=G.x,re=C.x,ue=k.x,ye=G.y,Te=C.y,Me=k.y,Be=X<re?X<ue?X:ue:re<ue?re:ue,We=ye<Te?ye<Me?ye:Me:Te<Me?Te:Me,Cn=X>re?X>ue?X:ue:re>ue?re:ue,$n=ye>Te?ye>Me?ye:Me:Te>Me?Te:Me,le=T(Be,We,I,P,K),be=T(Cn,$n,I,P,K),Se=S.prevZ,we=S.nextZ;Se&&Se.z>=le&&we&&we.z<=be;){if(Se.x>=Be&&Se.x<=Cn&&Se.y>=We&&Se.y<=$n&&Se!==G&&Se!==k&&E(X,ye,re,Te,ue,Me,Se.x,Se.y)&&M(Se.prev,Se,Se.next)>=0||(Se=Se.prevZ,we.x>=Be&&we.x<=Cn&&we.y>=We&&we.y<=$n&&we!==G&&we!==k&&E(X,ye,re,Te,ue,Me,we.x,we.y)&&M(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;Se&&Se.z>=le;){if(Se.x>=Be&&Se.x<=Cn&&Se.y>=We&&Se.y<=$n&&Se!==G&&Se!==k&&E(X,ye,re,Te,ue,Me,Se.x,Se.y)&&M(Se.prev,Se,Se.next)>=0)return!1;Se=Se.prevZ}for(;we&&we.z<=be;){if(we.x>=Be&&we.x<=Cn&&we.y>=We&&we.y<=$n&&we!==G&&we!==k&&E(X,ye,re,Te,ue,Me,we.x,we.y)&&M(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function l(S,I,P){var K=S;do{var G=K.prev,C=K.next.next;!D(G,C)&&F(G,K,K.next,C)&&ne(G,C)&&ne(C,G)&&(I.push(G.i/P|0),I.push(K.i/P|0),I.push(C.i/P|0),xe(K),xe(K.next),K=S=C),K=K.next}while(K!==S);return t(K)}function c(S,I,P,K,G,C){var k=S;do{for(var X=k.next.next;X!==k.prev;){if(k.i!==X.i&&B(k,X)){var re=pe(k,X);k=t(k,k.next),re=t(re,re.next),i(k,I,P,K,G,C,0),i(re,I,P,K,G,C,0);return}X=X.next}k=k.next}while(k!==S)}function f(S,I,P,K){var G=[],C,k,X,re,ue;for(C=0,k=I.length;C<k;C++)X=I[C]*K,re=C<k-1?I[C+1]*K:S.length,ue=e(S,X,re,K,!1),ue===ue.next&&(ue.steiner=!0),G.push(R(ue));for(G.sort(d),C=0;C<G.length;C++)P=p(G[C],P);return P}function d(S,I){return S.x-I.x}function p(S,I){var P=m(S,I);if(!P)return I;var K=pe(P,S);return t(K,K.next),t(P,P.next)}function m(S,I){var P=I,K=S.x,G=S.y,C=-1/0,k;do{if(G<=P.y&&G>=P.next.y&&P.next.y!==P.y){var X=P.x+(G-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(X<=K&&X>C&&(C=X,k=P.x<P.next.x?P:P.next,X===K))return k}P=P.next}while(P!==I);if(!k)return null;var re=k,ue=k.x,ye=k.y,Te=1/0,Me;P=k;do K>=P.x&&P.x>=ue&&K!==P.x&&E(G<ye?K:C,G,ue,ye,G<ye?C:K,G,P.x,P.y)&&(Me=Math.abs(G-P.y)/(K-P.x),ne(P,S)&&(Me<Te||Me===Te&&(P.x>k.x||P.x===k.x&&y(k,P)))&&(k=P,Te=Me)),P=P.next;while(P!==re);return k}function y(S,I){return M(S.prev,S,I.prev)<0&&M(I.next,S,S.next)<0}function b(S,I,P,K){var G=S;do G.z===0&&(G.z=T(G.x,G.y,I,P,K)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==S);G.prevZ.nextZ=null,G.prevZ=null,x(G)}function x(S){var I,P,K,G,C,k,X,re,ue=1;do{for(P=S,S=null,C=null,k=0;P;){for(k++,K=P,X=0,I=0;I<ue&&(X++,K=K.nextZ,!!K);I++);for(re=ue;X>0||re>0&&K;)X!==0&&(re===0||!K||P.z<=K.z)?(G=P,P=P.nextZ,X--):(G=K,K=K.nextZ,re--),C?C.nextZ=G:S=G,G.prevZ=C,C=G;P=K}C.nextZ=null,ue*=2}while(k>1);return S}function T(S,I,P,K,G){return S=(S-P)*G|0,I=(I-K)*G|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,I=(I|I<<8)&16711935,I=(I|I<<4)&252645135,I=(I|I<<2)&858993459,I=(I|I<<1)&1431655765,S|I<<1}function R(S){var I=S,P=S;do(I.x<P.x||I.x===P.x&&I.y<P.y)&&(P=I),I=I.next;while(I!==S);return P}function E(S,I,P,K,G,C,k,X){return(G-k)*(I-X)>=(S-k)*(C-X)&&(S-k)*(K-X)>=(P-k)*(I-X)&&(P-k)*(C-X)>=(G-k)*(K-X)}function B(S,I){return S.next.i!==I.i&&S.prev.i!==I.i&&!ae(S,I)&&(ne(S,I)&&ne(I,S)&&fe(S,I)&&(M(S.prev,S,I.prev)||M(S,I.prev,I))||D(S,I)&&M(S.prev,S,S.next)>0&&M(I.prev,I,I.next)>0)}function M(S,I,P){return(I.y-S.y)*(P.x-I.x)-(I.x-S.x)*(P.y-I.y)}function D(S,I){return S.x===I.x&&S.y===I.y}function F(S,I,P,K){var G=ee(M(S,I,P)),C=ee(M(S,I,K)),k=ee(M(P,K,S)),X=ee(M(P,K,I));return!!(G!==C&&k!==X||G===0&&W(S,P,I)||C===0&&W(S,K,I)||k===0&&W(P,S,K)||X===0&&W(P,I,K))}function W(S,I,P){return I.x<=Math.max(S.x,P.x)&&I.x>=Math.min(S.x,P.x)&&I.y<=Math.max(S.y,P.y)&&I.y>=Math.min(S.y,P.y)}function ee(S){return S>0?1:S<0?-1:0}function ae(S,I){var P=S;do{if(P.i!==S.i&&P.next.i!==S.i&&P.i!==I.i&&P.next.i!==I.i&&F(P,P.next,S,I))return!0;P=P.next}while(P!==S);return!1}function ne(S,I){return M(S.prev,S,S.next)<0?M(S,I,S.next)>=0&&M(S,S.prev,I)>=0:M(S,I,S.prev)<0||M(S,S.next,I)<0}function fe(S,I){var P=S,K=!1,G=(S.x+I.x)/2,C=(S.y+I.y)/2;do P.y>C!=P.next.y>C&&P.next.y!==P.y&&G<(P.next.x-P.x)*(C-P.y)/(P.next.y-P.y)+P.x&&(K=!K),P=P.next;while(P!==S);return K}function pe(S,I){var P=new de(S.i,S.x,S.y),K=new de(I.i,I.x,I.y),G=S.next,C=I.prev;return S.next=I,I.prev=S,P.next=G,G.prev=P,K.next=P,P.prev=K,C.next=K,K.prev=C,K}function ge(S,I,P,K){var G=new de(S,I,P);return K?(G.next=K.next,G.prev=K,K.next.prev=G,K.next=G):(G.prev=G,G.next=G),G}function xe(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function de(S,I,P){this.i=S,this.x=I,this.y=P,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(S,I,P,K){var G=I&&I.length,C=G?I[0]*P:S.length,k=Math.abs(Xe(S,0,C,P));if(G)for(var X=0,re=I.length;X<re;X++){var ue=I[X]*P,ye=X<re-1?I[X+1]*P:S.length;k-=Math.abs(Xe(S,ue,ye,P))}var Te=0;for(X=0;X<K.length;X+=3){var Me=K[X]*P,Be=K[X+1]*P,We=K[X+2]*P;Te+=Math.abs((S[Me]-S[We])*(S[Be+1]-S[Me+1])-(S[Me]-S[Be])*(S[We+1]-S[Me+1]))}return k===0&&Te===0?0:Math.abs((Te-k)/k)};function Xe(S,I,P,K){for(var G=0,C=I,k=P-K;C<P;C+=K)G+=(S[k]-S[C])*(S[C+1]+S[k+1]),k=C;return G}return n.flatten=function(S){for(var I=S[0][0].length,P={vertices:[],holes:[],dimensions:I},K=0,G=0;G<S.length;G++){for(var C=0;C<S[G].length;C++)for(var k=0;k<I;k++)P.vertices.push(S[G][C][k]);G>0&&(K+=S[G-1].length,P.holes.push(K))}return P},Qc.exports}var kL=DL();const BL=Px(kL),Jc=lT.CLOCKWISE,Z1=lT.COUNTER_CLOCKWISE,As={};function LL(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function Va(n){return"positions"in n?n.positions:n}function yu(n){return"holeIndices"in n?n.holeIndices:null}function UL(n){return Array.isArray(n[0])}function FL(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function zL(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function VL(n,e,t,i){for(let s=0;s<e;s++)if(n[t+s]!==n[i-e+s])return!1;return!0}function K1(n,e,t,i,s){let o=e;const l=t.length;for(let c=0;c<l;c++)for(let f=0;f<i;f++)n[o++]=t[c][f]||0;if(!zL(t))for(let c=0;c<i;c++)n[o++]=t[0][c]||0;return As.start=e,As.end=o,As.size=i,cT(n,s,As),o}function G1(n,e,t,i,s=0,o,l){o=o||t.length;const c=o-s;if(c<=0)return e;let f=e;for(let d=0;d<c;d++)n[f++]=t[s+d];if(!VL(t,i,s,o))for(let d=0;d<i;d++)n[f++]=t[s+d];return As.start=e,As.end=f,As.size=i,cT(n,l,As),f}function HL(n,e){LL(n);const t=[],i=[];if("positions"in n){const{positions:s,holeIndices:o}=n;if(o){let l=0;for(let c=0;c<=o.length;c++)l=G1(t,l,s,e,o[c-1],o[c],c===0?Jc:Z1),i.push(l);return i.pop(),{positions:t,holeIndices:i}}n=s}if(!UL(n))return G1(t,0,n,e,0,t.length,Jc),t;if(!FL(n)){let s=0;for(const[o,l]of n.entries())s=K1(t,s,l,e,o===0?Jc:Z1),i.push(s);return i.pop(),{positions:t,holeIndices:i}}return K1(t,0,n,e,Jc),t}function hp(n,e,t){const i=n.length/3;let s=0;for(let o=0;o<i;o++){const l=(o+1)%i;s+=n[o*3+e]*n[l*3+t],s-=n[l*3+e]*n[o*3+t]}return Math.abs(s/2)}function Q1(n,e,t,i){const s=n.length/3;for(let o=0;o<s;o++){const l=o*3,c=n[l+0],f=n[l+1],d=n[l+2];n[l+e]=c,n[l+t]=f,n[l+i]=d}}function jL(n,e,t,i){let s=yu(n);s&&(s=s.map(c=>c/e));let o=Va(n);const l=i&&e===3;if(t){const c=o.length;o=o.slice();const f=[];for(let d=0;d<c;d+=e){f[0]=o[d],f[1]=o[d+1],l&&(f[2]=o[d+2]);const p=t(f);o[d]=p[0],o[d+1]=p[1],l&&(o[d+2]=p[2])}}if(l){const c=hp(o,0,1),f=hp(o,0,2),d=hp(o,1,2);if(!c&&!f&&!d)return[];c>f&&c>d||(f>d?(t||(o=o.slice()),Q1(o,0,2,1)):(t||(o=o.slice()),Q1(o,2,0,1)))}return BL(o,s,e)}class WL extends sT{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=HL(e,this.positionSize);return this.opts.resolution?fT(Va(t),yu(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?SL(Va(t),yu(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(J1(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return Va(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&J1(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:s}){const{attributes:o,indexStarts:l,typedArrayManager:c}=this;let f=o.indices;if(!f||!e)return;let d=s;const p=jL(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=c.allocate(f,s+p.length,{copy:!0});for(let m=0;m<p.length;m++)f[d++]=p[m]+i;l[t+1]=s+p.length,o.indices=f}_updatePositions(e,{vertexStart:t,geometrySize:i}){const{attributes:{positions:s},positionSize:o}=this;if(!s||!e)return;const l=Va(e);for(let c=t,f=0;f<i;c++,f++){const d=l[f*o],p=l[f*o+1],m=o>2?l[f*o+2]:0;s[c*3]=d,s[c*3+1]=p,s[c*3+2]=m}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){const{positionSize:s}=this,o=this.attributes.vertexValid,l=e&&yu(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,t):o.fill(1,t,t+i),l)for(let c=0;c<l.length;c++)o[t+l[c]/s-1]=0;o[t+i-1]=0}}function J1(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const ex=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,$L={name:"solidPolygon",vs:ex,fs:ex,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},mT=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${mT}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,qL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${mT}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,YL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Vu=[0,0,0,255],ZL={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Vu},getLineColor:{type:"accessor",value:Vu},material:!0},eu={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class am extends pi{getShaders(e){return super.getShaders({vs:e==="top"?XL:qL,fs:YL,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Mo,e3,Oo,$L]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&t===He.DEFAULT&&(t=He.LNGLAT);let s;t===He.LNGLAT&&(i?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new WL({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),l=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:eu,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:eu,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:eu,accessor:"getFillColor",defaultValue:Vu},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:eu,accessor:"getLineColor",defaultValue:Vu},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:f,target:d})=>this.encodePickingColor(c&&c.__source?c.__source.index:f,d)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(o=>o.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:i,wireframe:s,elevationScale:o}=this.props,{topModel:l,sideModel:c,wireframeModel:f,polygonTesselator:d}=this.state,p={extruded:!!t,elevationScale:o,isWireframe:!1};f&&s&&(f.setInstanceCount(d.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...p,isWireframe:!0}}),f.draw(this.context.renderPass)),c&&i&&(c.setInstanceCount(d.instanceCount-1),c.shaderInputs.setProps({solidPolygon:p}),c.draw(this.context.renderPass)),l&&i&&(l.setVertexCount(d.vertexCount),l.shaderInputs.setProps({solidPolygon:p}),l.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:s}=e,o=this.getAttributeManager();(s.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,l=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let s,o,l;if(t){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new Hn(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new Hn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new Eo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new Hn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new Eo({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,l,s].filter(Boolean),topModel:s,sideModel:o,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}am.defaultProps=ZL;am.layerName="SolidPolygonLayer";function KL({data:n,getIndex:e,dataRange:t,replace:i}){const{startRow:s=0,endRow:o=1/0}=t,l=n.length;let c=l,f=l;for(let y=0;y<l;y++){const b=e(n[y]);if(c>y&&b>=s&&(c=y),b>=o){f=y;break}}let d=c;const m=f-c!==i.length?n.slice(f):void 0;for(let y=0;y<i.length;y++)n[d++]=i[y];if(m){for(let y=0;y<m.length;y++)n[d++]=m[y];n.length=d}return{startRow:c,endRow:c+i.length}}function GL(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,i=n.featureIds.value[t];return t!==-1?QL(n,i,t):null}function QL(n,e,t){const i={properties:{...n.properties[e]}};for(const s in n.numericProps)i.properties[s]=n.numericProps[s].value[t];return i}function JL(n,e){const t={points:null,lines:null,polygons:null};for(const i in t){const s=n[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(s.length*4);const o=[];for(let l=0;l<s.length;l++)e(s[l],o),t[i][l*4+0]=o[0],t[i][l*4+1]=o[1],t[i][l*4+2]=o[2],t[i][l*4+3]=255}return t}const tx=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,eU={name:"sdf",vs:tx,fs:tx,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},tU=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dp=192/256,nx=[],nU={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class lm extends nf{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,eU],fs:tU}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e,{outlineColor:s}=t;if(s!==i.outlineColor){const o=[s[0]/255,s[1]/255,s[2]/255,(s[3]??255)/255];this.setState({outlineColor:o})}!t.sdf&&t.outlineWidth&&Le.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:i,outlineWidth:s}=this.props,{outlineColor:o}=this.state,l=s?Math.max(i,dp*(1-s)):-1,c=this.state.model,f={buffer:dp,outlineBuffer:l,gamma:i,enabled:!!t,outlineColor:o};if(c.shaderInputs.setProps({sdf:f}),super.draw(e),t&&s){const{iconManager:d}=this.state;d.getTexture()&&(c.shaderInputs.setProps({sdf:{...f,outlineBuffer:dp}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):nx}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):nx}}lm.defaultProps=nU;lm.layerName="MultiIconLayer";const Ja=1e20;class iU{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:o="sans-serif",fontWeight:l="normal",fontStyle:c="normal",lang:f=null}={}){this.buffer=t,this.cutoff=s,this.radius=i,this.lang=f;const d=this.size=e+t*4,p=this._createCanvas(d),m=this.ctx=p.getContext("2d",{willReadFrequently:!0});m.font=`${c} ${l} ${e}px ${o}`,m.textBaseline="alphabetic",m.textAlign="left",m.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:o,actualBoundingBoxRight:l}=this.ctx.measureText(e),c=Math.ceil(i),f=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-o))),p=Math.min(this.size-this.buffer,c+Math.ceil(s)),m=d+2*this.buffer,y=p+2*this.buffer,b=Math.max(m*y,0),x=new Uint8ClampedArray(b),T={data:x,width:m,height:y,glyphWidth:d,glyphHeight:p,glyphTop:c,glyphLeft:f,glyphAdvance:t};if(d===0||p===0)return T;const{ctx:R,buffer:E,gridInner:B,gridOuter:M}=this;this.lang&&(R.lang=this.lang),R.clearRect(E,E,d,p),R.fillText(e,E,E+c);const D=R.getImageData(E,E,d,p);M.fill(Ja,0,b),B.fill(0,0,b);for(let F=0;F<p;F++)for(let W=0;W<d;W++){const ee=D.data[4*(F*d+W)+3]/255;if(ee===0)continue;const ae=(F+E)*m+W+E;if(ee===1)M[ae]=0,B[ae]=Ja;else{const ne=.5-ee;M[ae]=ne>0?ne*ne:0,B[ae]=ne<0?ne*ne:0}}ix(M,0,0,m,y,m,this.f,this.v,this.z),ix(B,E,E,d,p,m,this.f,this.v,this.z);for(let F=0;F<b;F++){const W=Math.sqrt(M[F])-Math.sqrt(B[F]);x[F]=Math.round(255-255*(W/this.radius+this.cutoff))}return T}}function ix(n,e,t,i,s,o,l,c,f){for(let d=e;d<e+i;d++)sx(n,t*o+d,o,s,l,c,f);for(let d=t;d<t+s;d++)sx(n,d*o+e,1,i,l,c,f)}function sx(n,e,t,i,s,o,l){o[0]=0,l[0]=-Ja,l[1]=Ja,s[0]=n[e];for(let c=1,f=0,d=0;c<i;c++){s[c]=n[e+c*t];const p=c*c;do{const m=o[f];d=(s[c]-s[m]+p-m*m)/(c-m)/2}while(d<=l[f]&&--f>-1);f++,o[f]=c,l[f]=d,l[f+1]=Ja}for(let c=0,f=0;c<i;c++){for(;l[f+1]<c;)f++;const d=o[f],p=c-d;n[e+c*t]=s[d]+p*p}}const sU=32,rU=[];function oU(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function aU({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:s,mapping:o={},xOffset:l=0,yOffset:c=0}){let f=0,d=l;const p=t+i*2;for(const m of n)if(!o[m]){const y=e(m);d+y+i*2>s&&(d=0,f++),o[m]={x:d+i,y:c+f*p+i,width:y,height:p,layoutWidth:y,layoutHeight:t},d+=y+i*2}return{mapping:o,xOffset:d,yOffset:c+f*p,canvasHeight:oU(c+(f+1)*p)}}function _T(n,e,t,i){let s=0;for(let o=e;o<t;o++){const l=n[o];s+=i[l]?.layoutWidth||0}return s}function yT(n,e,t,i,s,o){let l=e,c=0;for(let f=e;f<t;f++){const d=_T(n,f,f+1,s);c+d>i&&(l<f&&o.push(f),l=f,c=0),c+=d}return c}function lU(n,e,t,i,s,o){let l=e,c=e,f=e,d=0;for(let p=e;p<t;p++)if((n[p]===" "||n[p+1]===" "||p+1===t)&&(f=p+1),f>c){let m=_T(n,c,f,s);d+m>i&&(l<c&&(o.push(c),l=c,d=0),m>i&&(m=yT(n,c,f,i,s,o),l=o[o.length-1])),c=f,d+=m}return d}function cU(n,e,t,i,s=0,o){o===void 0&&(o=n.length);const l=[];return e==="break-all"?yT(n,s,o,t,i,l):lU(n,s,o,t,i,l),l}function uU(n,e,t,i,s,o){let l=0,c=0;for(let f=e;f<t;f++){const d=n[f],p=i[d];p?(c||(c=p.layoutHeight),s[f]=l+p.layoutWidth/2,l+=p.layoutWidth):(Le.warn(`Missing character: ${d} (${d.codePointAt(0)})`)(),s[f]=l,l+=sU)}o[0]=l,o[1]=c}function fU(n,e,t,i,s){const o=Array.from(n),l=o.length,c=new Array(l),f=new Array(l),d=new Array(l),p=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,m=[0,0],y=[0,0];let b=0,x=0,T=0;for(let R=0;R<=l;R++){const E=o[R];if((E===`
`||R===l)&&(T=R),T>x){const B=p?cU(o,t,i,s,x,T):rU;for(let M=0;M<=B.length;M++){const D=M===0?x:B[M-1],F=M<B.length?B[M]:T;uU(o,D,F,s,c,y);for(let W=D;W<F;W++){const ee=o[W],ae=s[ee]?.layoutOffsetY||0;f[W]=b+y[1]/2+ae,d[W]=y[0]}b=b+y[1]*e,m[0]=Math.max(m[0],y[0])}x=T}E===`
`&&(c[x]=0,f[x]=0,d[x]=0,x++)}return m[1]=b,{x:c,y:f,rowWidth:d,size:m}}function hU({value:n,length:e,stride:t,offset:i,startIndices:s,characterSet:o}){const l=n.BYTES_PER_ELEMENT,c=t?t/l:1,f=i?i/l:0,d=s[e]||Math.ceil((n.length-f)/c),p=o&&new Set,m=new Array(e);let y=n;if(c>1||f>0){const b=n.constructor;y=new b(d);for(let x=0;x<d;x++)y[x]=n[x*c+f]}for(let b=0;b<e;b++){const x=s[b],T=s[b+1]||d,R=y.subarray(x,T);m[b]=String.fromCodePoint.apply(null,R),p&&R.forEach(p.add,p)}if(p)for(const b of p)o.add(String.fromCodePoint(b));return{texts:m,characterCount:d}}class bT{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function dU(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const xo={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:dU(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},rx=1024,ox=.9,ax=1.2,vT=3;let Hu=new bT(vT);function pU(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const i=Hu.get(n);if(!i)return t;for(const s in i.mapping)t.has(s)&&t.delete(s);return t}function gU(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function lx(n,e,t,i){n.font=`${i} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function mU(n){Le.assert(Number.isFinite(n)&&n>=vT,"Invalid cache limit"),Hu=new bT(n)}class _U{constructor(){this.props={...xo}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*ax+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=pU(this._key,this.props.characterSet),i=Hu.get(this._key);if(i&&t.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(t,i);this._atlas=s,Hu.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:i,fontWeight:s,fontSize:o,buffer:l,sdf:c,radius:f,cutoff:d}=this.props;let p=t&&t.data;p||(p=document.createElement("canvas"),p.width=rx);const m=p.getContext("2d",{willReadFrequently:!0});lx(m,i,o,s);const{mapping:y,canvasHeight:b,xOffset:x,yOffset:T}=aU({getFontWidth:R=>m.measureText(R).width,fontHeight:o*ax,buffer:l,characterSet:e,maxCanvasWidth:rx,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(p.height!==b){const R=m.getImageData(0,0,p.width,p.height);p.height=b,m.putImageData(R,0,0)}if(lx(m,i,o,s),c){const R=new iU({fontSize:o,buffer:l,radius:f,cutoff:d,fontFamily:i,fontWeight:`${s}`});for(const E of e){const{data:B,width:M,height:D,glyphTop:F}=R.draw(E);y[E].width=M,y[E].layoutOffsetY=o*ox-F;const W=m.createImageData(M,D);gU(B,W),m.putImageData(W,y[E].x,y[E].y)}}else for(const R of e)m.fillText(R,y[R].x,y[R].y+l+o*ox);return{xOffset:x,yOffset:T,mapping:y,data:p,width:p.width,height:p.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:s,sdf:o,radius:l,cutoff:c}=this.props;return o?`${e} ${t} ${i} ${s} ${l} ${c}`:`${e} ${t} ${i} ${s}`}}const cx=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,yU={name:"textBackground",vs:cx,fs:cx,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},bU=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,vU=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,xU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class cm extends pi{getShaders(){return super.getShaders({vs:bU,fs:vU,modules:[Mo,Oo,yU]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:i,sizeUnits:s,sizeMinPixels:o,sizeMaxPixels:l,getLineWidth:c}=this.props;let{padding:f,borderRadius:d}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]),Array.isArray(d)||(d=[d,d,d,d]);const p=this.state.model,m={billboard:t,stroked:!!c,borderRadius:d,padding:f,sizeUnits:Hi[s],sizeScale:i,sizeMinPixels:o,sizeMaxPixels:l};p.shaderInputs.setProps({textBackground:m}),p.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Hn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Eo({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}cm.defaultProps=xU;cm.layerName="TextBackgroundLayer";const ux={start:1,middle:0,end:-1},fx={top:1,center:0,bottom:-1},pp=[0,0,0,255],TU=1,SU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:pp},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:xo.characterSet},fontFamily:xo.fontFamily,fontWeight:xo.fontWeight,lineHeight:TU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:pp},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:pp},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class um extends ef{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,s]}=this.transformParagraph(e,t);const{fontSize:o}=this.state.fontAtlasManager.props;i/=o,s/=o;const{getTextAnchor:l,getAlignmentBaseline:c}=this.props,f=ux[typeof l=="function"?l(e,t):l],d=fx[typeof c=="function"?c(e,t):c];return[(f-1)*i/2,(d-1)*s/2,i,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:o,y:l,rowWidth:c,size:[f,d]}=this.transformParagraph(e,t),p=ux[typeof i=="function"?i(e,t):i],m=fx[typeof s=="function"?s(e,t):s],y=o.length,b=new Array(y*2);let x=0;for(let T=0;T<y;T++){const R=(1-p)*(f-c[T])/2;b[x++]=(p-1)*f/2+R+o[T],b[x++]=(m-1)*d/2+l[T]}return b}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new _U},this.props.maxWidth>0&&Le.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:o}=this.state,l={...e,characterSet:o,fontFamily:t,fontWeight:i};if(!s.mapping)return s.setProps(l),!0;for(const c in l)if(l[c]!==s.props[c])return s.setProps(l),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,i=e.attributes?.getText;let{getText:s}=this.props,o=e.startIndices,l;const c=t==="auto"&&new Set;if(i&&o){const{texts:f,characterCount:d}=hU({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:o,characterSet:c});l=d,s=(p,{index:m})=>f[m]}else{const{iterable:f,objectInfo:d}=Qu(e);o=[0],l=0;for(const p of f){d.index++;const m=Array.from(s(p,d)||"");c&&m.forEach(c.add,c),l+=m.length,o.push(l)}}this.setState({getText:s,startIndices:o,numInstances:l,characterSet:c||t})}transformParagraph(e,t){const{fontAtlasManager:i}=this.state,s=i.mapping,o=this.state.getText,{wordBreak:l,lineHeight:c,maxWidth:f}=this.props,d=o(e,t)||"";return fU(d,c,l,f*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:s,atlas:o,mapping:l},styleVersion:c}=this.state,{data:f,_dataDiff:d,getPosition:p,getColor:m,getSize:y,getAngle:b,getPixelOffset:x,getBackgroundColor:T,getBorderColor:R,getBorderWidth:E,backgroundBorderRadius:B,backgroundPadding:M,background:D,billboard:F,fontSettings:W,outlineWidth:ee,outlineColor:ae,sizeScale:ne,sizeUnits:fe,sizeMinPixels:pe,sizeMaxPixels:ge,transitions:xe,updateTriggers:de}=this.props,Xe=this.getSubLayerClass("characters",lm),S=this.getSubLayerClass("background",cm);return[D&&new S({getFillColor:T,getLineColor:R,getLineWidth:E,borderRadius:B,padding:M,getPosition:p,getSize:y,getAngle:b,getPixelOffset:x,billboard:F,sizeScale:ne,sizeUnits:fe,sizeMinPixels:pe,sizeMaxPixels:ge,transitions:xe&&{getPosition:xe.getPosition,getAngle:xe.getAngle,getSize:xe.getSize,getFillColor:xe.getBackgroundColor,getLineColor:xe.getBorderColor,getLineWidth:xe.getBorderWidth,getPixelOffset:xe.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:de.getPosition,getAngle:de.getAngle,getSize:de.getSize,getFillColor:de.getBackgroundColor,getLineColor:de.getBorderColor,getLineWidth:de.getBorderWidth,getPixelOffset:de.getPixelOffset,getBoundingRect:{getText:de.getText,getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:c}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Xe({sdf:W.sdf,smoothing:Number.isFinite(W.smoothing)?W.smoothing:xo.smoothing,outlineWidth:ee/(W.radius||xo.radius),outlineColor:ae,iconAtlas:o,iconMapping:l,getPosition:p,getColor:m,getSize:y,getAngle:b,getPixelOffset:x,billboard:F,sizeScale:ne*s,sizeUnits:fe,sizeMinPixels:pe*s,sizeMaxPixels:ge*s,transitions:xe&&{getPosition:xe.getPosition,getAngle:xe.getAngle,getColor:xe.getColor,getSize:xe.getSize,getPixelOffset:xe.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:de.getText,getPosition:de.getPosition,getAngle:de.getAngle,getColor:de.getColor,getSize:de.getSize,getPixelOffset:de.getPixelOffset,getIconOffsets:{getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:c}}}),{data:f,_dataDiff:d,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){mU(e)}}um.defaultProps=SU;um.layerName="TextLayer";const bu={circle:{type:ol,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:nf,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:um,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},vu={type:sf,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},sg={type:am,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Na({type:n,props:e}){const t={};for(const i in e)t[i]=n.defaultProps[e[i]];return t}function gp(n,e){const{transitions:t,updateTriggers:i}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const o in e){const l=e[o];let c=n.props[o];o.startsWith("get")&&(c=n.getSubLayerAccessor(c),s.updateTriggers[l]=i[o],t&&(s.transitions[l]=t[o])),s[l]=c}return s}function AU(n){if(Array.isArray(n))return n;switch(Le.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return Le.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function hx(n,e,t={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:o=n.length}=t;for(let l=s;l<o;l++){const c=n[l],{geometry:f}=c;if(f)if(f.type==="GeometryCollection"){Le.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:d}=f;for(let p=0;p<d.length;p++){const m=d[p];dx(m,i,e,c,l)}}else dx(f,i,e,c,l)}return i}function dx(n,e,t,i,s){const{type:o,coordinates:l}=n,{pointFeatures:c,lineFeatures:f,polygonFeatures:d,polygonOutlineFeatures:p}=e;if(!EU(o,l)){Le.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":c.push(t({geometry:n},i,s));break;case"MultiPoint":l.forEach(m=>{c.push(t({geometry:{type:"Point",coordinates:m}},i,s))});break;case"LineString":f.push(t({geometry:n},i,s));break;case"MultiLineString":l.forEach(m=>{f.push(t({geometry:{type:"LineString",coordinates:m}},i,s))});break;case"Polygon":d.push(t({geometry:n},i,s)),l.forEach(m=>{p.push(t({geometry:{type:"LineString",coordinates:m}},i,s))});break;case"MultiPolygon":l.forEach(m=>{d.push(t({geometry:{type:"Polygon",coordinates:m}},i,s)),m.forEach(y=>{p.push(t({geometry:{type:"LineString",coordinates:y}},i,s))})});break}}const wU={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function EU(n,e){let t=wU[n];for(Le.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function xT(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function tu(n){return n.geometry.coordinates}function RU(n,e){const t=xT(),{pointFeatures:i,lineFeatures:s,polygonFeatures:o,polygonOutlineFeatures:l}=n;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=tu,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=tu,t.polygons.data=o,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=tu,t.polygonsOutline.data=l,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=tu,t}function CU(n,e){const t=xT(),{points:i,lines:s,polygons:o}=n,l=JL(n,e);t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:l.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:l.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open";const c=o.positions.value.length/o.positions.size,f=Array(c).fill(1);for(const d of o.primitivePolygonIndices.value)f[d-1]=0;return t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,instanceVertexValid:{size:1,value:new Uint16Array(f)},pickingColors:{size:4,value:l.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:l.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}const MU=["points","linestrings","polygons"],OU={...Na(bu.circle),...Na(bu.icon),...Na(bu.text),...Na(vu),...Na(sg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class fm extends ef{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const i=CU(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){const i=AU(e.data),s=this.getSubLayerRow.bind(this);let o={};const l={};if(Array.isArray(t.dataChanged)){const f=this.state.features;for(const d in f)o[d]=f[d].slice(),l[d]=[];for(const d of t.dataChanged){const p=hx(i,s,d);for(const m in f)l[m].push(KL({data:o[m],getIndex:y=>y.__source.index,dataRange:d,replace:p[m]}))}}else o=hx(i,s);const c=RU(o,l);this.setState({features:o,featuresDiff:l,layerProps:c})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i,sourceLayer:s}=t;return t.featureType=MU.find(o=>s.id.startsWith(`${this.id}-${o}-`)),i>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,s="polygons-fill",o=this.shouldRenderSubLayer(s,i.polygons?.data)&&this.getSubLayerClass(s,sg.type);if(o){const l=gp(this,sg.props),c=e&&t;return c||delete l.getLineColor,l.updateTriggers.lineColors=c,new o(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,s="polygons-stroke",o="linestrings",l=!e&&t&&this.shouldRenderSubLayer(s,i.polygonsOutline?.data)&&this.getSubLayerClass(s,vu.type),c=this.shouldRenderSubLayer(o,i.lines?.data)&&this.getSubLayerClass(o,vu.type);if(l||c){const f=gp(this,vu.props);return[l&&new l(f,this.getSubLayerProps({id:s,updateTriggers:f.updateTriggers}),i.polygonsOutline),c&&new c(f,this.getSubLayerProps({id:o,updateTriggers:f.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=t.points.data.findIndex(c=>c.__source.index===s));const o=new Set(e.split("+")),l=[];for(const c of o){const f=`points-${c}`,d=bu[c],p=d&&this.shouldRenderSubLayer(f,t.points?.data)&&this.getSubLayerClass(f,d.type);if(p){const m=gp(this,d.props);let y=t.points;if(c==="text"&&i){const{instancePickingColors:b,...x}=y.data.attributes;y={...y,data:{...y.data,attributes:x}}}l.push(new p(m,this.getSubLayerProps({id:f,updateTriggers:m.updateTriggers,highlightedObjectIndex:s}),y))}}return l}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,i,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:o,index:l}=s,c=GL(o,l);return e(c,s)}}}fm.layerName="GeoJsonLayer";fm.defaultProps=OU;class PU{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:s}){const{index:o,id:l,bbox:c,userData:f,zoom:d}=this,p=this._loaderId;this._abortController=new AbortController;const{signal:m}=this._abortController,y=await t.scheduleRequest(this,T=>T.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let b=null,x;try{b=await e({index:o,id:l,bbox:c,userData:f,zoom:d,signal:m})}catch(T){x=T||!0}finally{y.done()}if(p===this._loaderId){if(this._loader=void 0,this.content=b,this._isCancelled&&!b){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,x?s(x,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const Jt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},px=new me,IU=new me;class hm{constructor(e=[0,0,0],t=[0,0,0],i){i=i||px.copy(e).add(t).scale(.5),this.center=new me(i),this.halfDiagonal=new me(t).subtract(this.center),this.minimum=new me(e),this.maximum=new me(t)}clone(){return new hm(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,i=IU.from(e.normal),s=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-s>0?Jt.INSIDE:o+s<0?Jt.OUTSIDE:Jt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=px.from(e).subtract(this.center),{halfDiagonal:i}=this;let s=0,o;return o=Math.abs(t.x)-i.x,o>0&&(s+=o*o),o=Math.abs(t.y)-i.y,o>0&&(s+=o*o),o=Math.abs(t.z)-i.z,o>0&&(s+=o*o),s}}const Da=new me,gx=new me;class dm{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new me,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Da.from(t),this.center=new me().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new dm(this.center,this.radius)}union(e){const t=this.center,i=this.radius,s=e.center,o=e.radius,l=Da.copy(s).subtract(t),c=l.magnitude();if(i>=c+o)return this.clone();if(o>=c+i)return e.clone();const f=(i+c+o)*.5;return gx.copy(l).scale((-i+f)/c).add(t),this.center.copy(gx),this.radius=f,this}expand(e){const i=Da.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const t=wO(Da,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const i=Da.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const t=this.center,i=this.radius,o=e.normal.dot(t)+e.distance;return o<-i?Jt.OUTSIDE:o<i?Jt.INTERSECTING:Jt.INSIDE}}const NU=new me,DU=new me,nu=new me,iu=new me,su=new me,kU=new me,BU=new me,ki={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class pm{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new me().from(e),this.halfAxes=new $t(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new me(e).len(),new me(t).len(),new me(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new me(e).normalize(),o=new me(t).normalize(),l=new me(i).normalize();return new _v().fromMatrix3(new $t([...s,...o,...l]))}fromCenterHalfSizeQuaternion(e,t,i){const s=new _v(i),o=new $t().fromQuaternion(s);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new me().from(e),this.halfAxes=o,this}clone(){return new pm(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new dm){const t=this.halfAxes,i=t.getColumn(0,nu),s=t.getColumn(1,iu),o=t.getColumn(2,su),l=NU.copy(i).add(s).add(o);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,i=e.normal,s=this.halfAxes,o=i.x,l=i.y,c=i.z,f=Math.abs(o*s[ki.COLUMN0ROW0]+l*s[ki.COLUMN0ROW1]+c*s[ki.COLUMN0ROW2])+Math.abs(o*s[ki.COLUMN1ROW0]+l*s[ki.COLUMN1ROW1]+c*s[ki.COLUMN1ROW2])+Math.abs(o*s[ki.COLUMN2ROW0]+l*s[ki.COLUMN2ROW1]+c*s[ki.COLUMN2ROW2]),d=i.dot(t)+e.distance;return d<=-f?Jt.OUTSIDE:d>=f?Jt.INSIDE:Jt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=DU.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,nu),o=i.getColumn(1,iu),l=i.getColumn(2,su),c=s.magnitude(),f=o.magnitude(),d=l.magnitude();s.normalize(),o.normalize(),l.normalize();let p=0,m;return m=Math.abs(t.dot(s))-c,m>0&&(p+=m*m),m=Math.abs(t.dot(o))-f,m>0&&(p+=m*m),m=Math.abs(t.dot(l))-d,m>0&&(p+=m*m),p}computePlaneDistances(e,t,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const l=this.center,c=this.halfAxes,f=c.getColumn(0,nu),d=c.getColumn(1,iu),p=c.getColumn(2,su),m=kU.copy(f).add(d).add(p).add(l),y=BU.copy(m).subtract(e);let b=t.dot(y);return s=Math.min(b,s),o=Math.max(b,o),m.copy(l).add(f).add(d).subtract(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),m.copy(l).add(f).subtract(d).add(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),m.copy(l).add(f).subtract(d).subtract(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),l.copy(m).subtract(f).add(d).add(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),l.copy(m).subtract(f).add(d).subtract(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),l.copy(m).subtract(f).subtract(d).add(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),l.copy(m).subtract(f).subtract(d).subtract(p),y.copy(m).subtract(e),b=t.dot(y),s=Math.min(b,s),o=Math.max(b,o),i[0]=s,i[1]=o,i}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,nu);t.transformAsPoint(e);const i=this.halfAxes.getColumn(1,iu);i.transformAsPoint(e);const s=this.halfAxes.getColumn(2,su);return s.transformAsPoint(e),this.halfAxes=new $t([...t,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const mx=new me,_x=new me;class ll{constructor(e=[0,0,1],t=0){this.normal=new me,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return tl(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=mx.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,s){return this.normal.set(e,t,i),tl(zi(this.normal.len(),1)),this.distance=s,this}clone(){return new ll(this.normal,this.distance)}equals(e){return zi(this.distance,e.distance)&&zi(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=_x.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){const i=mx.from(e),s=this.getPointDistance(i),o=_x.copy(this.normal).scale(s);return i.subtract(o).to(t)}}const yx=[new me([1,0,0]),new me([0,1,0]),new me([0,0,1])],bx=new me,LU=new me;class Fi{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*yx.length;const t=e.center,i=e.radius;let s=0;for(const o of yx){let l=this.planes[s],c=this.planes[s+1];l||(l=this.planes[s]=new ll),c||(c=this.planes[s+1]=new ll);const f=bx.copy(o).scale(-i).add(t);l.fromPointNormal(f,o);const d=bx.copy(o).scale(i).add(t),p=LU.copy(o).negate();c.fromPointNormal(d,p),s+=2}return this}computeVisibility(e){let t=Jt.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Jt.OUTSIDE:return Jt.OUTSIDE;case Jt.INTERSECTING:t=Jt.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(tl(Number.isFinite(t),"parentPlaneMask is required."),t===Fi.MASK_OUTSIDE||t===Fi.MASK_INSIDE)return t;let i=Fi.MASK_INSIDE;const s=this.planes;for(let o=0;o<this.planes.length;++o){const l=o<31?1<<o:0;if(o<31&&(t&l)===0)continue;const c=s[o],f=e.intersectPlane(c);if(f===Jt.OUTSIDE)return Fi.MASK_OUTSIDE;f===Jt.INTERSECTING&&(i|=l)}return i}}Fi.MASK_OUTSIDE=4294967295;Fi.MASK_INSIDE=0;Fi.MASK_INDETERMINATE=2147483647;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;const ai=new $t,UU=new $t,FU=new $t,ru=new $t,vx=new $t;function zU(n,e={}){const t=cP,i=10;let s=0,o=0;const l=UU,c=FU;l.identity(),c.copy(n);const f=t*VU(c);for(;o<i&&HU(c)>f;)jU(c,ru),vx.copy(ru).transpose(),c.multiplyRight(ru),c.multiplyLeft(vx),l.multiplyRight(ru),++s>2&&(++o,s=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function VU(n){let e=0;for(let t=0;t<9;++t){const i=n[t];e+=i*i}return Math.sqrt(e)}const rg=[1,0,0],og=[2,2,1];function HU(n){let e=0;for(let t=0;t<3;++t){const i=n[ai.getElementIndex(og[t],rg[t])];e+=2*i*i}return Math.sqrt(e)}function jU(n,e){const t=lP;let i=0,s=1;for(let d=0;d<3;++d){const p=Math.abs(n[ai.getElementIndex(og[d],rg[d])]);p>i&&(s=d,i=p)}const o=rg[s],l=og[s];let c=1,f=0;if(Math.abs(n[ai.getElementIndex(l,o)])>t){const d=n[ai.getElementIndex(l,l)],p=n[ai.getElementIndex(o,o)],m=n[ai.getElementIndex(l,o)],y=(d-p)/2/m;let b;y<0?b=-1/(-y+Math.sqrt(1+y*y)):b=1/(y+Math.sqrt(1+y*y)),c=1/Math.sqrt(1+b*b),f=b*c}return $t.IDENTITY.to(e),e[ai.getElementIndex(o,o)]=e[ai.getElementIndex(l,l)]=c,e[ai.getElementIndex(l,o)]=f,e[ai.getElementIndex(o,l)]=-f,e}const bs=new me,WU=new me,$U=new me,XU=new me,qU=new me,YU=new $t,ZU={diagonal:new $t,unitary:new $t};function KU(n,e=new pm){if(!n||n.length===0)return e.halfAxes=new $t([0,0,0,0,0,0,0,0,0]),e.center=new me,e;const t=n.length,i=new me(0,0,0);for(const ne of n)i.add(ne);const s=1/t;i.multiplyByScalar(s);let o=0,l=0,c=0,f=0,d=0,p=0;for(const ne of n){const fe=bs.copy(ne).subtract(i);o+=fe.x*fe.x,l+=fe.x*fe.y,c+=fe.x*fe.z,f+=fe.y*fe.y,d+=fe.y*fe.z,p+=fe.z*fe.z}o*=s,l*=s,c*=s,f*=s,d*=s,p*=s;const m=YU;m[0]=o,m[1]=l,m[2]=c,m[3]=l,m[4]=f,m[5]=d,m[6]=c,m[7]=d,m[8]=p;const{unitary:y}=zU(m,ZU),b=e.halfAxes.copy(y);let x=b.getColumn(0,$U),T=b.getColumn(1,XU),R=b.getColumn(2,qU),E=-Number.MAX_VALUE,B=-Number.MAX_VALUE,M=-Number.MAX_VALUE,D=Number.MAX_VALUE,F=Number.MAX_VALUE,W=Number.MAX_VALUE;for(const ne of n)bs.copy(ne),E=Math.max(bs.dot(x),E),B=Math.max(bs.dot(T),B),M=Math.max(bs.dot(R),M),D=Math.min(bs.dot(x),D),F=Math.min(bs.dot(T),F),W=Math.min(bs.dot(R),W);x=x.multiplyByScalar(.5*(D+E)),T=T.multiplyByScalar(.5*(F+B)),R=R.multiplyByScalar(.5*(W+M)),e.center.copy(x).add(T).add(R);const ee=WU.set(E-D,B-F,M-W).multiplyByScalar(.5),ae=new $t([ee[0],0,0,0,ee[1],0,0,0,ee[2]]);return e.halfAxes.multiplyRight(ae),e}const mo=512,xx=3,TT=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],ST=TT.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),GU=ST.concat([[.25,.5],[.75,.5]]);class _o{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){const e=this.x*2,t=this.y*2,i=this.z+1;this._children=[new _o(e,t,i),new _o(e,t+1,i),new _o(e+1,t,i),new _o(e+1,t+1,i)]}return this._children}update(e){const{viewport:t,cullingVolume:i,elevationBounds:s,minZ:o,maxZ:l,bounds:c,offset:f,project:d}=e,p=this.getBoundingVolume(s,f,d);if(c&&!this.insideBounds(c)||i.computeVisibility(p)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<l&&y>=o){const b=p.distanceTo(t.cameraPosition)*t.scale/t.height;y+=Math.floor(Math.log2(b))}if(y>=l)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,s]){const o=Math.pow(2,this.z),l=mo/o;return this.x*l<i&&this.y*l<s&&(this.x+1)*l>e&&(this.y+1)*l>t}getBoundingVolume(e,t,i){if(i){const f=this.z<1?GU:this.z<2?ST:TT,d=[];for(const p of f){const m=lg(this.x+p[0],this.y+p[1],this.z);m[2]=e[0],d.push(i(m)),e[0]!==e[1]&&(m[2]=e[1],d.push(i(m)))}return KU(d)}const s=Math.pow(2,this.z),o=mo/s,l=this.x*o+t*mo,c=mo-(this.y+1)*o;return new hm([l,c,e[0]],[l+o,c+o,e[1]])}}function QU(n,e,t,i){const s=n instanceof Gu&&n.resolution?n.projectPosition:null,o=Object.values(n.getFrustumPlanes()).map(({normal:b,distance:x})=>new ll(b.clone().negate(),x)),l=new Fi(o),c=n.distanceScales.unitsPerMeter[2],f=t&&t[0]*c||0,d=t&&t[1]*c||0,p=n instanceof Wi&&n.pitch<=60?e:0;if(i){const[b,x,T,R]=i,E=di([b,R]),B=di([T,x]);i=[E[0],mo-E[1],B[0],mo-B[1]]}const m=new _o(0,0,0),y={viewport:n,project:s,cullingVolume:l,elevationBounds:[f,d],minZ:p,maxZ:e,bounds:i,offset:0};if(m.update(y),n instanceof Wi&&n.subViewports&&n.subViewports.length>1){for(y.offset=-1;m.update(y)&&!(--y.offset<-xx););for(y.offset=1;m.update(y)&&!(++y.offset>xx););}return m.getSelected()}const $i=512,JU=[-1/0,-1/0,1/0,1/0],eF={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}};function gm(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(s=>s[0])),Math.min(...t.map(s=>s[1])),Math.max(...t.map(s=>s[0])),Math.max(...t.map(s=>s[1]))]}function tF(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function nF(n,e){if(!n||!n.length)return null;const{index:t,id:i}=e;if(Array.isArray(n)){const o=tF(i)%n.length;n=n[o]}let s=n;for(const o of Object.keys(t)){const l=new RegExp(`{${o}}`,"g");s=s.replace(l,String(t[o]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),s}function iF(n,e,t){let i;return i=n.getBounds(),n.isGeospatial?[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]:[Math.max(Math.min(i[0],t[2]),t[0]),Math.max(Math.min(i[1],t[3]),t[1]),Math.min(Math.max(i[2],t[0]),t[2]),Math.min(Math.max(i[3],t[1]),t[3])]}function sF({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(s=>ag(s,e||0,t))}function ag(n,e,t){if(!Array.isArray(e)){const o=t.x-n.x,l=t.y-n.y,{width:c,height:f}=t,d={targetZ:e},p=n.unproject([o,l],d),m=n.unproject([o+c,l],d),y=n.unproject([o,l+f],d),b=n.unproject([o+c,l+f],d);return[Math.min(p[0],m[0],y[0],b[0]),Math.min(p[1],m[1],y[1],b[1]),Math.max(p[0],m[0],y[0],b[0]),Math.max(p[1],m[1],y[1],b[1])]}const i=ag(n,e[0],t),s=ag(n,e[1],t);return[Math.min(i[0],s[0]),Math.min(i[1],s[1]),Math.max(i[2],s[2]),Math.max(i[3],s[3])]}function rF(n,e,t){return t?gm(n,t).map(s=>s*e/$i):n.map(i=>i*e/$i)}function mm(n,e){return Math.pow(2,n)*$i/e}function lg(n,e,t){const i=mm(t,$i),s=n/i*360-180,o=Math.PI-2*Math.PI*e/i,l=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[s,l]}function Tx(n,e,t,i){const s=mm(t,i);return[n/s*$i,e/s*$i]}function oF(n,e,t,i,s=$i){if(n.isGeospatial){const[d,p]=lg(e,t,i),[m,y]=lg(e+1,t+1,i);return{west:d,north:p,east:m,south:y}}const[o,l]=Tx(e,t,i,s),[c,f]=Tx(e+1,t+1,i,s);return{left:o,top:l,right:c,bottom:f}}function aF(n,e,t,i,s){const o=iF(n,null,i),l=mm(e,t),[c,f,d,p]=rF(o,l,s),m=[];for(let y=Math.floor(c);y<d;y++)for(let b=Math.floor(f);b<p;b++)m.push({x:y,y:b,z:e});return m}function lF({viewport:n,maxZoom:e,minZoom:t,zRange:i,extent:s,tileSize:o=$i,modelMatrix:l,modelMatrixInverse:c,zoomOffset:f=0}){let d=n.isGeospatial?Math.round(n.zoom+Math.log2($i/o))+f:Math.ceil(n.zoom)+f;if(typeof t=="number"&&Number.isFinite(t)&&d<t){if(!s)return[];d=t}typeof e=="number"&&Number.isFinite(e)&&d>e&&(d=e);let p=s;return l&&c&&s&&!n.isGeospatial&&(p=gm(s,l)),n.isGeospatial?QU(n,d,i,s):aF(n,d,o,p||JU,c)}function cF(n){let e={},t;return i=>{for(const s in i)if(!uF(i[s],e[s])){t=n(i),e=i;break}return t}}function uF(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}const Sx=1,rf=2,fF="never",hF="no-overlap",_m="best-available",dF=5,pF={[_m]:_F,[hF]:yF,[fF]:()=>{}},gF={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class mF{constructor(e){this._getCullBounds=cF(sF),this.opts={...gF,...e},this.setOptions(this.opts),this.onTileLoad=t=>{this.opts.onTileLoad?.(t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Fw({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Wt,this._modelMatrixInverse=new Wt}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:i}={zRange:null,modelMatrix:null}){const s=i?new Wt(i):new Wt,o=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!zi(this._zRange,t)||o){o&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=t;const c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(f=>this._getTile(f,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));const l=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),l&&this._frameNumber++,this._frameNumber}isTileVisible(e,t,i){if(!e.isVisible)return!1;if(t&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t});let{bbox:o}=e;for(const[l,c,f,d]of s){let p;if("west"in o)p=o.west<f&&o.east>l&&o.south<d&&o.north>c;else{if(i&&!Wt.IDENTITY.equals(i)){const[b,x,T,R]=gm([o.left,o.top,o.right,o.bottom],i);o={left:b,top:x,right:T,bottom:R}}const m=Math.min(o.top,o.bottom),y=Math.max(o.top,o.bottom);p=o.left<f&&o.right>l&&m<d&&y>c}if(p)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:s,modelMatrix:o,modelMatrixInverse:l}){const{tileSize:c,extent:f,zoomOffset:d}=this.opts;return lF({viewport:e,maxZoom:t,minZoom:i,zRange:s,tileSize:c,extent:f,modelMatrix:o,modelMatrixInverse:l,zoomOffset:d})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:oF(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),i=Math.floor(e.y/2),s=e.z-1;return{x:t,y:i,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||_m,t=new Array(this._cache.size);let i=0;for(const s of this._cache.values())t[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:pF[e])(Array.from(this._cache.values())),i=0;for(const s of this._cache.values())if(t[i++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let i=0;for(const s of this._cache.values())s.isLoading&&(i++,!s.isSelected&&!s.isVisible&&t.push(s));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const i=this._getNearestAncestor(t);t.parent=i,i?.children&&i.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,i=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:dF*this.selectedTiles.length),s=t.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>s){for(const[l,c]of e)if(!c.isVisible&&!c.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?c.byteLength:0,e.delete(l),this.opts.onTileUnload?.(c)),e.size<=i&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,c)=>l.zoom-c.zoom),this._dirty=!1)}_getTile(e,t){const i=this.getTileId(e);let s=this._cache.get(i),o=!1;return!s&&t?(s=new PU(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:i,zoom:this.getTileZoom(s.index)}),o=!0,this._cache.set(i,s),this._dirty=!0):s&&s.needsReload&&(o=!0),s&&o&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:t=0}=this;let i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);const s=this._getTile(i);if(s)return s}return null}}function _F(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!AT(e)&&ym(e);for(const e of n)e.isVisible=!!(e.state&rf)}function yF(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&AT(t);const e=Array.from(n).sort((t,i)=>t.zoom-i.zoom);for(const t of e)if(t.isVisible=!!(t.state&rf),t.children&&(t.isVisible||t.state&Sx))for(const i of t.children)i.state=Sx;else t.isSelected&&ym(t)}function AT(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=rf,!0;e=e.parent}return!1}function ym(n){for(const e of n.children)e.isLoaded||e.content?e.state|=rf:ym(e)}const bF={TilesetClass:mF,data:{type:"data",value:[]},dataComparator:eF.equal,renderSubLayers:{type:"function",value:n=>new fm(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:_m,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class bm extends ef{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(t=>t.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),s?t.reloadAll():t.tiles.forEach(o=>{o.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:s,extent:o,maxZoom:l,minZoom:c,maxRequests:f,debounceTime:d,zoomOffset:p}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:l,minZoom:c,tileSize:e,refinementStrategy:s,extent:o,maxRequests:f,debounceTime:d,zoomOffset:p,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,s=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:o}=e,l=this.state.isLoaded!==o,c=this.state.frameNumber!==s;o&&(l||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:s}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:i,fetch:s}=this.props,{signal:o}=e;return e.url=typeof t=="string"||Array.isArray(t)?nF(t,e):null,i?i(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,i=t.props.tile,s=e.info;return s.picked&&(s.tile=i),s.sourceTile=i,s.sourceTileSubLayer=t,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(i=>e.layers[0].props[i]!==t[i])&&(e.layers=e.layers.map(i=>i.clone(t)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Zu(i,Boolean).map(s=>s.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:i}=e.props,{modelMatrix:s}=this.props;return this.state.tileset.isTileVisible(i,t,s?new Wt(s):null)}}bm.defaultProps=bF;bm.layerName="TileLayer";const Vi=11102230246251565e-32,Kt=134217729,vF=(3+8*Vi)*Vi;function mp(n,e,t,i,s){let o,l,c,f,d=e[0],p=i[0],m=0,y=0;p>d==p>-d?(o=d,d=e[++m]):(o=p,p=i[++y]);let b=0;if(m<n&&y<t)for(p>d==p>-d?(l=d+o,c=o-(l-d),d=e[++m]):(l=p+o,c=o-(l-p),p=i[++y]),o=l,c!==0&&(s[b++]=c);m<n&&y<t;)p>d==p>-d?(l=o+d,f=l-o,c=o-(l-f)+(d-f),d=e[++m]):(l=o+p,f=l-o,c=o-(l-f)+(p-f),p=i[++y]),o=l,c!==0&&(s[b++]=c);for(;m<n;)l=o+d,f=l-o,c=o-(l-f)+(d-f),d=e[++m],o=l,c!==0&&(s[b++]=c);for(;y<t;)l=o+p,f=l-o,c=o-(l-f)+(p-f),p=i[++y],o=l,c!==0&&(s[b++]=c);return(o!==0||b===0)&&(s[b++]=o),b}function xF(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function gl(n){return new Float64Array(n)}const TF=(3+16*Vi)*Vi,SF=(2+12*Vi)*Vi,AF=(9+64*Vi)*Vi*Vi,so=gl(4),Ax=gl(8),wx=gl(12),Ex=gl(16),sn=gl(4);function wF(n,e,t,i,s,o,l){let c,f,d,p,m,y,b,x,T,R,E,B,M,D,F,W,ee,ae;const ne=n-s,fe=t-s,pe=e-o,ge=i-o;D=ne*ge,y=Kt*ne,b=y-(y-ne),x=ne-b,y=Kt*ge,T=y-(y-ge),R=ge-T,F=x*R-(D-b*T-x*T-b*R),W=pe*fe,y=Kt*pe,b=y-(y-pe),x=pe-b,y=Kt*fe,T=y-(y-fe),R=fe-T,ee=x*R-(W-b*T-x*T-b*R),E=F-ee,m=F-E,so[0]=F-(E+m)+(m-ee),B=D+E,m=B-D,M=D-(B-m)+(E-m),E=M-W,m=M-E,so[1]=M-(E+m)+(m-W),ae=B+E,m=ae-B,so[2]=B-(ae-m)+(E-m),so[3]=ae;let xe=xF(4,so),de=SF*l;if(xe>=de||-xe>=de||(m=n-ne,c=n-(ne+m)+(m-s),m=t-fe,d=t-(fe+m)+(m-s),m=e-pe,f=e-(pe+m)+(m-o),m=i-ge,p=i-(ge+m)+(m-o),c===0&&f===0&&d===0&&p===0)||(de=AF*l+vF*Math.abs(xe),xe+=ne*p+ge*c-(pe*d+fe*f),xe>=de||-xe>=de))return xe;D=c*ge,y=Kt*c,b=y-(y-c),x=c-b,y=Kt*ge,T=y-(y-ge),R=ge-T,F=x*R-(D-b*T-x*T-b*R),W=f*fe,y=Kt*f,b=y-(y-f),x=f-b,y=Kt*fe,T=y-(y-fe),R=fe-T,ee=x*R-(W-b*T-x*T-b*R),E=F-ee,m=F-E,sn[0]=F-(E+m)+(m-ee),B=D+E,m=B-D,M=D-(B-m)+(E-m),E=M-W,m=M-E,sn[1]=M-(E+m)+(m-W),ae=B+E,m=ae-B,sn[2]=B-(ae-m)+(E-m),sn[3]=ae;const Xe=mp(4,so,4,sn,Ax);D=ne*p,y=Kt*ne,b=y-(y-ne),x=ne-b,y=Kt*p,T=y-(y-p),R=p-T,F=x*R-(D-b*T-x*T-b*R),W=pe*d,y=Kt*pe,b=y-(y-pe),x=pe-b,y=Kt*d,T=y-(y-d),R=d-T,ee=x*R-(W-b*T-x*T-b*R),E=F-ee,m=F-E,sn[0]=F-(E+m)+(m-ee),B=D+E,m=B-D,M=D-(B-m)+(E-m),E=M-W,m=M-E,sn[1]=M-(E+m)+(m-W),ae=B+E,m=ae-B,sn[2]=B-(ae-m)+(E-m),sn[3]=ae;const S=mp(Xe,Ax,4,sn,wx);D=c*p,y=Kt*c,b=y-(y-c),x=c-b,y=Kt*p,T=y-(y-p),R=p-T,F=x*R-(D-b*T-x*T-b*R),W=f*d,y=Kt*f,b=y-(y-f),x=f-b,y=Kt*d,T=y-(y-d),R=d-T,ee=x*R-(W-b*T-x*T-b*R),E=F-ee,m=F-E,sn[0]=F-(E+m)+(m-ee),B=D+E,m=B-D,M=D-(B-m)+(E-m),E=M-W,m=M-E,sn[1]=M-(E+m)+(m-W),ae=B+E,m=ae-B,sn[2]=B-(ae-m)+(E-m),sn[3]=ae;const I=mp(S,wx,4,sn,Ex);return Ex[I-1]}function EF(n,e,t,i,s,o){const l=(e-o)*(t-s),c=(n-s)*(i-o),f=l-c,d=Math.abs(l+c);return Math.abs(f)>=TF*d?f:-wF(n,e,t,i,s,o,d)}function RF(n,e){var t,i,s=0,o,l,c,f,d,p,m,y=n[0],b=n[1],x=e.length;for(t=0;t<x;t++){i=0;var T=e[t],R=T.length-1;if(p=T[0],p[0]!==T[R][0]&&p[1]!==T[R][1])throw new Error("First and last coordinates in a ring must be the same");for(l=p[0]-y,c=p[1]-b,i;i<R;i++){if(m=T[i+1],f=m[0]-y,d=m[1]-b,c===0&&d===0){if(f<=0&&l>=0||l<=0&&f>=0)return 0}else if(d>=0&&c<=0||d<=0&&c>=0){if(o=EF(l,f,c,d,0,0),o===0)return 0;(o>0&&d>0&&c<=0||o<0&&d<=0&&c>0)&&s++}p=m,c=d,l=f}}return s%2!==0}function CF(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties={},i.geometry=n,i}function MF(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Rx(n[0])||!Rx(n[1]))throw new Error("coordinates must contain numbers");return CF({type:"Point",coordinates:n},e,t)}function Rx(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function OF(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function PF(n){return n.type==="Feature"?n.geometry:n}function IF(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const i=OF(n),s=PF(e),o=s.type,l=e.bbox;let c=s.coordinates;if(l&&NF(i,l)===!1)return!1;o==="Polygon"&&(c=[c]);let f=!1;for(var d=0;d<c.length;++d){const p=RF(i,c[d]);if(p===0)return!t.ignoreBoundary;p&&(f=!0)}return f}function NF(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}var DF=IF;function wT(n,e,t){if(n!==null)for(var i,s,o,l,c,f,d,p=0,m=0,y,b=n.type,x=b==="FeatureCollection",T=b==="Feature",R=x?n.features.length:1,E=0;E<R;E++){d=x?n.features[E].geometry:T?n.geometry:n,y=d?d.type==="GeometryCollection":!1,c=y?d.geometries.length:1;for(var B=0;B<c;B++){var M=0,D=0;if(l=y?d.geometries[B]:d,l!==null){f=l.coordinates;var F=l.type;switch(p=0,F){case null:break;case"Point":if(e(f,m,E,M,D)===!1)return!1;m++,M++;break;case"LineString":case"MultiPoint":for(i=0;i<f.length;i++){if(e(f[i],m,E,M,D)===!1)return!1;m++,F==="MultiPoint"&&M++}F==="LineString"&&M++;break;case"Polygon":case"MultiLineString":for(i=0;i<f.length;i++){for(s=0;s<f[i].length-p;s++){if(e(f[i][s],m,E,M,D)===!1)return!1;m++}F==="MultiLineString"&&M++,F==="Polygon"&&D++}F==="Polygon"&&M++;break;case"MultiPolygon":for(i=0;i<f.length;i++){for(D=0,s=0;s<f[i].length;s++){for(o=0;o<f[i][s].length-p;o++){if(e(f[i][s][o],m,E,M,D)===!1)return!1;m++}D++}M++}break;case"GeometryCollection":for(i=0;i<l.geometries.length;i++)if(wT(l.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function kF(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return wT(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var BF=kF;const LF="/geo/countries_110m.json",UF="https://cdn.jsdelivr.net/gh/nvkelso/natural-earth-vector@master/geojson/ne_110m_admin_0_countries.geojson";let _p=null;function FF(n){let e=Number(n);for(;e>180;)e-=360;for(;e<-180;)e+=360;return e}function zF(n){const e=Number(n);return Math.max(-90,Math.min(90,e))}async function VF(){if(_p)return _p;let n=LF,e=await fetch(n).catch(()=>null);if(e?.ok||(n=UF,e=await fetch(n)),!e.ok)throw new Error(`Failed to load countries: ${e.status}`);const t=await e.json();return _p=t,t}function HF(n,e,t){const[i,s,o,l]=t;return i<=o?n>=i&&n<=o&&e>=s&&e<=l:(n>=i||n<=o)&&e>=s&&e<=l}function jF(n){const e=n?.properties||{};return e.NAME||e.ADMIN||e.name||e.admin||"Unknown"}function WF(n){return(n.features||[]).map(e=>({feature:e,bbox:BF(e)}))}function $F(n,e,t){const i=zF(n),s=FF(e),o={country:null,region:null,city:null,label:"",lat:i,lon:s},l=WF(t),c=MF([s,i]);for(const{feature:f,bbox:d}of l)if(HF(s,i,d)&&DF(c,f))return o.country=jF(f),o.label=o.country,o;return o.label="Open ocean",o}const XF=["United States of America","United States"];async function ou(n,e){const t=await VF();let i=$F(n,e,t);if(XF.includes(i.country)){const{resolveUSState:s}=await Xp(async()=>{const{resolveUSState:l}=await import("./resolveUSState-Cs9_9pFo.js");return{resolveUSState:l}},[]),o=s(n,e);o&&(i={...i,label:`${o}, USA`},console.log("Resolved USA state:",o))}return i}const qF=["All","Africa","Antarctica","Asia","Europe","North America","Oceania","South America","Other"],YF={Afghanistan:"Asia",Algeria:"Africa",Argentina:"South America",Australia:"Oceania",Austria:"Europe",Bangladesh:"Asia",Bolivia:"South America",Brazil:"South America",Bulgaria:"Europe",Canada:"North America",Chile:"South America",China:"Asia",Colombia:"South America","Costa Rica":"North America",Croatia:"Europe",Cyprus:"Asia","Czech Republic":"Europe",Denmark:"Europe",Ecuador:"South America",Egypt:"Africa",Ethiopia:"Africa",Finland:"Europe",France:"Europe",Germany:"Europe",Greece:"Europe",Guatemala:"North America",Honduras:"North America",Hungary:"Europe",Iceland:"Europe",India:"Asia",Indonesia:"Asia",Iran:"Asia",Israel:"Asia",Italy:"Europe",Japan:"Asia",Jordan:"Asia",Kenya:"Africa",Kuwait:"Asia",Lebanon:"Asia",Libya:"Africa",Mexico:"North America",Morocco:"Africa",Nepal:"Asia","New Zealand":"Oceania",Nicaragua:"North America",Nigeria:"Africa",Norway:"Europe",Oman:"Asia",Pakistan:"Asia",Panama:"North America","Papua New Guinea":"Oceania",Peru:"South America",Philippines:"Asia",Poland:"Europe",Portugal:"Europe",Romania:"Europe",Russia:"Europe","Saudi Arabia":"Asia",Serbia:"Europe",Slovakia:"Europe",Slovenia:"Europe","South Africa":"Africa",Spain:"Europe",Sudan:"Africa",Sweden:"Europe",Switzerland:"Europe",Syria:"Asia",Taiwan:"Asia",Tanzania:"Africa",Thailand:"Asia",Tunisia:"Africa",Turkey:"Asia",Uganda:"Africa",Ukraine:"Europe","United Arab Emirates":"Asia","United Kingdom":"Europe","United States":"North America","United States of America":"North America",USA:"North America",Venezuela:"South America",Vietnam:"Asia",Yemen:"Asia",Zambia:"Africa"};function ZF(n){if(n==null||typeof n!="string")return{countryName:"",stateName:null};const e=n.trim();if(!e)return{countryName:"",stateName:null};if(e.endsWith(", USA"))return{countryName:"USA",stateName:e.slice(0,e.length-5).trim()||null};const t=e.lastIndexOf(",");return t!==-1?{countryName:e.slice(t+1).trim(),stateName:null}:{countryName:e,stateName:null}}function KF(n){return n==null||n===""?"Other":YF[n]??"Other"}const GF={longitude:0,latitude:20,zoom:1.5,minZoom:0,maxZoom:20},Ha=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]];function QF(n){const t=Math.max(0,Math.min(1,n))*(Ha.length-1),i=Math.floor(t),s=Math.min(i+1,Ha.length-1),o=t-i,l=Ha[i],c=Ha[s];return[Math.round(l[0]+o*(c[0]-l[0])),Math.round(l[1]+o*(c[1]-l[1])),Math.round(l[2]+o*(c[2]-l[2])),180]}const JF=new iT({id:"globe",controller:!0}),ro={position:"absolute",background:"rgba(8, 8, 18, 0.88)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.09)",borderRadius:8,color:"#e0e0e0",fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:12};function Cx(n){return n?{heatFlowComponent:n.hf??0,boundaryDistanceKm:n.bd??null}:{heatFlowComponent:0,boundaryDistanceKm:null}}function e8(n,e){const t=Cx(n),i=Cx(e),s=(n?.score??0)>=(e?.score??0)?"A":"B",o=[];if(s==="A"){const l=(t.heatFlowComponent??0)-(i.heatFlowComponent??0),c=(i.boundaryDistanceKm??0)-(t.boundaryDistanceKm??0);l>0&&o.push(`higher heat flow (+${l.toFixed(0)} mW/m)`),c>0&&o.push(`closer to plate boundary (${c.toFixed(1)} km)`)}else{const l=(i.heatFlowComponent??0)-(t.heatFlowComponent??0),c=(t.boundaryDistanceKm??0)-(i.boundaryDistanceKm??0);l>0&&o.push(`higher heat flow (+${l.toFixed(0)} mW/m)`),c>0&&o.push(`closer to plate boundary (${c.toFixed(1)} km)`)}return o.length===0?"Scores are very close.":`${s} wins because it has ${o.join(" and ")}.`}const Mx=150;function t8(){const[n,e]=Ce.useState(!1),[t,i]=Ce.useState([]),[s,o]=Ce.useState([]),[l,c]=Ce.useState(null),[f,d]=Ce.useState(!0),[p,m]=Ce.useState(!0),[y,b]=Ce.useState(null),[x,T]=Ce.useState(null),[R,E]=Ce.useState(null),[B,M]=Ce.useState(!1),[D,F]=Ce.useState({globe:GF}),[W,ee]=Ce.useState(.5),[ae,ne]=Ce.useState("All"),[fe,pe]=Ce.useState("All"),[ge,xe]=Ce.useState("All"),[de,Xe]=Ce.useState(!1),[S,I]=Ce.useState(null),[P,K]=Ce.useState(null);Ce.useEffect(()=>{Promise.all([fetch("/geothermal_data.json").then(le=>le.json()),fetch("/plate_boundaries.json").then(le=>le.json())]).then(([le,be])=>{i(le),o(be)})},[]),Ce.useEffect(()=>{if(!t.length)return;let le=!1;return(async()=>{const be=[];for(let Se=0;Se<t.length;Se+=Mx){if(le)return;const we=t.slice(Se,Se+Mx),gi=await Promise.all(we.map(async rn=>{const[gn,en]=rn.coordinates,$e=await ou(en,gn).catch(()=>({label:"Unknown"})),{countryName:on,stateName:Oe}=ZF($e.label),ct=KF(on);return{...rn,resolvedPlace:$e.label,countryName:on,stateName:Oe,continentName:ct}}));be.push(...gi)}le||c(be)})(),()=>{le=!0}},[t]);const G=Ce.useCallback((le,be)=>{F(Se=>({...Se,globe:{...Se.globe,longitude:le,latitude:be,zoom:6,transitionDuration:1500,transitionInterpolator:new wB}}))},[]),C=Ce.useCallback(le=>{b(le)},[]),k=l??t.map(le=>({...le,resolvedPlace:"",countryName:"",stateName:null,continentName:"Other"})),X=Ce.useMemo(()=>k.filter(le=>!(ae!=="All"&&le.continentName!==ae||fe!=="All"&&le.countryName!==fe||ge!=="All"&&le.stateName!==ge)),[k,ae,fe,ge]),{topSitesComputed:re,uniqueCountries:ue,uniqueStates:ye}=Ce.useMemo(()=>{const le=X.length>0?X.reduce(($e,on)=>{const Oe=on.score??0;return{min:Math.min($e.min,Oe),max:Math.max($e.max,Oe)}},{min:1/0,max:-1/0}):{min:0,max:1},be=le.max-le.min||1,Se=$e=>(Math.max(le.min,Math.min(le.max,$e??0))-le.min)/be,rn=[...X.filter($e=>Se($e.score)>=W)].sort(($e,on)=>(on.score??0)-($e.score??0)).slice(0,20).map(($e,on)=>{const[Oe,ct]=$e.coordinates;return{...$e,rank:on+1,lon:Oe,lat:ct}}),gn=[...new Set(k.map($e=>$e.countryName).filter(Boolean))].sort(),en=[...new Set(k.filter($e=>$e.countryName==="USA").map($e=>$e.stateName).filter(Boolean))].sort();return{topSitesComputed:rn,uniqueCountries:gn,uniqueStates:en}},[X,W,k]),Te=Ce.useCallback(({coordinate:le,object:be,layer:Se})=>{const we=(Pe,qe,ut,mn=!0)=>{T([Pe,qe]),M(!0),ou(qe,Pe).then(Do=>{E(Do),M(!1)}).catch(()=>{E({country:null,region:null,city:null,label:"Unable to load map data",lat:qe,lon:Pe}),M(!1)}),C(ut),mn&&G(Pe,qe)},gi=Pe=>{const qe=Pe.lon??Pe.coordinates?.[0],ut=Pe.lat??Pe.coordinates?.[1],mn=Pe.resolvedPlace??"";return{coordinates:[qe,ut],lon:qe,lat:ut,score:Pe.score,hf:Pe.hf,bd:Pe.bd,resolvedPlace:mn}},rn=(Pe,qe)=>{if(!Pe)return!1;const ut=qe.lon??qe.coordinates?.[0],mn=qe.lat??qe.coordinates?.[1];return Pe.lon===ut&&Pe.lat===mn};if(de){if(be&&(Se?.id==="top-sites"||Se?.id==="heatmap-dots")){const Pe=be.lon??be.coordinates?.[0],qe=be.lat??be.coordinates?.[1],ut=gi({...be,lon:Pe,lat:qe,resolvedPlace:be.resolvedPlace??""});if(rn(S,ut)){I(null);return}if(rn(P,ut)){K(null);return}if(!S){I(ut),we(Pe,qe,{...be,coordinates:[Pe,qe],score:be.score,hf:be.hf,bd:be.bd},!0);return}if(!P){K(ut),we(Pe,qe,{...be,coordinates:[Pe,qe],score:be.score,hf:be.hf,bd:be.bd},!0);return}I(ut),K(null),we(Pe,qe,{...be,coordinates:[Pe,qe],score:be.score,hf:be.hf,bd:be.bd},!0);return}if(le){const[Pe,qe]=le,ut=X.length?X.reduce((dt,Dt)=>({min:Math.min(dt.min,Dt.score??0),max:Math.max(dt.max,Dt.score??0)}),{min:1/0,max:-1/0}):{min:0,max:1},mn=ut.max-ut.min||1,Do=dt=>(Math.max(ut.min,Math.min(ut.max,dt??0))-ut.min)/mn,of=X.filter(dt=>Do(dt.score)>=W);let Nt=null,Xt=1/0;for(const dt of of){const[Dt,af]=dt.coordinates,ml=(Dt-Pe)**2+(af-qe)**2;ml<Xt&&(Xt=ml,Nt=dt)}if(Nt){const dt=gi(Nt);if(rn(S,dt)){I(null);return}if(rn(P,dt)){K(null);return}if(!S){I(dt),we(Nt.coordinates[0],Nt.coordinates[1],Nt,!0);return}if(!P){K(dt),we(Nt.coordinates[0],Nt.coordinates[1],Nt,!0);return}I(dt),K(null),we(Nt.coordinates[0],Nt.coordinates[1],Nt,!0)}}return}if(be&&Se?.id==="top-sites"){we(be.lon,be.lat,{coordinates:[be.lon,be.lat],score:be.score,hf:be.hf,bd:be.bd});return}if(be&&Se?.id==="heatmap-dots"){const[Pe,qe]=be.coordinates;we(Pe,qe,be);return}if(!le)return;const[gn,en]=le;if(T(le),M(!0),ou(en,gn).then(Pe=>{E(Pe),M(!1)}).catch(()=>{E({country:null,region:null,city:null,label:"Unable to load map data",lat:en,lon:gn}),M(!1)}),!X.length)return;const $e=X.reduce((Pe,qe)=>{const ut=qe.score??0;return{min:Math.min(Pe.min,ut),max:Math.max(Pe.max,ut)}},{min:1/0,max:-1/0}),on=$e.max-$e.min||1,Oe=Pe=>(Math.max($e.min,Math.min($e.max,Pe??0))-$e.min)/on,ct=X.filter(Pe=>Oe(Pe.score)>=W);let Ms=null,No=1/0;for(const Pe of ct){const[qe,ut]=Pe.coordinates,mn=(qe-gn)**2+(ut-en)**2;mn<No&&(No=mn,Ms=Pe)}C(Ms)},[t,X,W,C,G,de,S,P]),Me=Ce.useMemo(()=>{const le=new bm({id:"basemap",data:"https://basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png",minZoom:0,maxZoom:19,tileSize:256,renderSubLayers:Oe=>{const{tile:{bbox:ct}}=Oe;return new om(Oe,{data:null,image:Oe.data,bounds:[ct.west,ct.south,ct.east,ct.north]})}}),be=X.length>0?X.reduce((Oe,ct)=>{const Ms=ct.score??0;return{min:Math.min(Oe.min,Ms),max:Math.max(Oe.max,Ms)}},{min:1/0,max:-1/0}):{min:0,max:1},Se=be.max-be.min||1,we=Oe=>(Math.max(be.min,Math.min(be.max,Oe??0))-be.min)/Se,gi=X.filter(Oe=>we(Oe.score)>=W),rn=new ol({id:"heatmap-dots",data:gi,getPosition:Oe=>Oe.coordinates,getRadius:28e3,radiusUnits:"meters",getFillColor:Oe=>QF(we(Oe.score)),stroked:!1,pickable:!0}),gn=f?new sf({id:"boundaries",data:s,getPath:Oe=>Oe.path,getColor:[255,190,60,160],getWidth:1.5,widthUnits:"pixels",widthMinPixels:1}):null,en=Oe=>S&&Oe.lon===S.lon&&Oe.lat===S.lat,$e=Oe=>P&&Oe.lon===P.lon&&Oe.lat===P.lat,on=new ol({id:"top-sites",data:re,getPosition:Oe=>[Oe.lon,Oe.lat],getRadius:Oe=>en(Oe)||$e(Oe)?11:7,radiusUnits:"pixels",getFillColor:Oe=>en(Oe)?[255,255,255,255]:$e(Oe)?[255,200,100,255]:y?.coordinates?.[0]===Oe.lon&&y?.coordinates?.[1]===Oe.lat?[255,255,255,255]:[255,210,0,230],getLineColor:Oe=>en(Oe)||$e(Oe)?[255,165,0,255]:[20,20,20,200],stroked:!0,lineWidthMinPixels:2,pickable:!0,updateTriggers:{getFillColor:[y,S,P],getRadius:[S,P]}});return[le,rn,gn,on].filter(Boolean)},[t,s,X,W,re,f,y,S,P]),[Be,We]=y?.coordinates??[0,0],Cn=R?.lat??x?.[1]??We,$n=R?.lon??x?.[0]??Be;return ce.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[ce.jsx(FB,{views:[JF],viewState:D,onViewStateChange:({viewId:le,viewState:be})=>F(Se=>({...Se,[le]:be})),layers:Me,onClick:Te,getCursor:()=>"crosshair",parameters:{clearColor:[.02,.02,.02,1],cull:!0},style:{width:"100%",height:"100%"}}),!n&&ce.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(8, 8, 18, 0.5)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",transition:"opacity 0.4s ease",zIndex:10},children:ce.jsxs("div",{style:{...ro,maxWidth:420,padding:28,textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,0.4)"},children:[ce.jsx("h1",{style:{margin:"0 0 14px",color:"#f97316",fontWeight:"bold",letterSpacing:2,fontSize:16},children:"GEOTHERMAL POTENTIAL"}),ce.jsx("p",{style:{margin:"0 0 24px",color:"#b0b0b0",fontSize:13,lineHeight:1.6},children:"This app helps you explore global geothermal energy potential. Use the map to view heat-flow data and composite scores, compare top sites, and inspect plate boundaries. Click the map or the Top 20 list to zoom to a location and see detailed stats."}),ce.jsx("button",{onClick:()=>e(!0),style:{background:"#f97316",color:"#fff",border:"none",borderRadius:6,padding:"10px 28px",fontSize:13,fontWeight:"bold",letterSpacing:1,cursor:"pointer",fontFamily:"inherit",transition:"background 0.2s, transform 0.1s"},onMouseDown:le=>le.currentTarget.style.transform="scale(0.98)",onMouseUp:le=>le.currentTarget.style.transform="scale(1)",onMouseLeave:le=>le.currentTarget.style.transform="scale(1)",children:"Start"})]})}),ce.jsxs("div",{style:{...ro,top:12,left:"50%",transform:"translateX(-50%)",padding:"7px 16px",display:"flex",gap:12,alignItems:"center",whiteSpace:"nowrap"},children:[ce.jsx("span",{style:{color:"#f97316",fontWeight:"bold",letterSpacing:2,fontSize:11},children:"GEOTHERMAL POTENTIAL"}),ce.jsx(Ox,{active:f,onClick:()=>d(le=>!le),children:"Plate Boundaries"}),ce.jsx(Ox,{active:p,onClick:()=>m(le=>!le),children:"Top 20 Sites"})]}),ce.jsxs("div",{style:{...ro,bottom:24,left:"50%",transform:"translateX(-50%)",padding:"6px 14px",display:"flex",gap:8,alignItems:"center"},children:[ce.jsx("span",{style:{color:"#666",fontSize:10},children:"LOW"}),Ha.map(([le,be,Se],we)=>ce.jsx("div",{style:{width:22,height:10,borderRadius:2,background:`rgb(${le},${be},${Se})`}},we)),ce.jsx("span",{style:{color:"#666",fontSize:10},children:"HIGH"}),ce.jsx("span",{style:{color:"#555",fontSize:10,marginLeft:8},children:" plate boundary  top site"})]}),p&&ce.jsxs("div",{style:{...ro,top:56,left:12,bottom:54,width:230,overflowY:"auto",padding:0},children:[ce.jsx("div",{style:{padding:"10px 12px 7px",borderBottom:"none",color:"#f97316",fontWeight:"bold",fontSize:10,letterSpacing:2,position:"sticky",top:0,background:"rgba(8,8,18,0.95)"},children:"HIGH POTENTIAL THRESHOLD"}),ce.jsxs("div",{style:{padding:"8px 12px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[ce.jsxs("div",{style:{color:"#888",fontSize:10,marginBottom:4},children:["Threshold ",W.toFixed(2)]}),ce.jsx("input",{type:"range",min:0,max:1,step:.01,value:W,onChange:le=>ee(Number(le.target.value)),style:{width:"100%",accentColor:"#f97316"}})]}),ce.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)",color:"#f97316",fontWeight:"bold",fontSize:10,letterSpacing:2},children:"REGION FILTERS"}),ce.jsxs("div",{style:{padding:"8px 12px 10px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[ce.jsxs("div",{style:{marginBottom:6},children:[ce.jsx("label",{style:{color:"#888",fontSize:10,display:"block",marginBottom:2},children:"Continent"}),ce.jsx("select",{value:ae,onChange:le=>ne(le.target.value),style:{width:"100%",padding:"4px 6px",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,color:"#e0e0e0",fontSize:11},children:qF.map(le=>ce.jsx("option",{value:le,children:le},le))})]}),ce.jsxs("div",{style:{marginBottom:6},children:[ce.jsx("label",{style:{color:"#888",fontSize:10,display:"block",marginBottom:2},children:"Country"}),ce.jsxs("select",{value:fe,onChange:le=>pe(le.target.value),style:{width:"100%",padding:"4px 6px",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,color:"#e0e0e0",fontSize:11},children:[ce.jsx("option",{value:"All",children:"All"}),ue.map(le=>ce.jsx("option",{value:le,children:le},le))]})]}),ce.jsxs("div",{children:[ce.jsx("label",{style:{color:"#888",fontSize:10,display:"block",marginBottom:2},children:"State (USA)"}),ce.jsxs("select",{value:ge,onChange:le=>xe(le.target.value),disabled:fe!=="USA",style:{width:"100%",padding:"4px 6px",background:fe==="USA"?"rgba(255,255,255,0.06)":"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,color:"#e0e0e0",fontSize:11},children:[ce.jsx("option",{value:"All",children:"All"}),ye.map(le=>ce.jsx("option",{value:le,children:le},le))]})]})]}),ce.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)",color:"#f97316",fontWeight:"bold",fontSize:10,letterSpacing:2},children:"COMPARE"}),ce.jsxs("div",{style:{padding:"8px 12px 10px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[ce.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:8},children:[ce.jsx("input",{type:"checkbox",checked:de,onChange:le=>Xe(le.target.checked),style:{accentColor:"#f97316"}}),ce.jsx("span",{style:{fontSize:11,color:"#ddd"},children:"Compare mode"})]}),de&&ce.jsx("p",{style:{color:"#888",fontSize:10,margin:"0 0 8px",lineHeight:1.4},children:"Click two points to compare, click again to unpin."}),ce.jsxs("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:["Slot A: ",S?`${S.resolvedPlace||"Selected"} (${(S.score??0).toFixed(3)})`:"None selected"]}),ce.jsxs("div",{style:{fontSize:10,color:"#888",marginBottom:8},children:["Slot B: ",P?`${P.resolvedPlace||"Selected"} (${(P.score??0).toFixed(3)})`:"None selected"]}),ce.jsx("button",{type:"button",onClick:()=>{I(null),K(null)},style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"4px 10px",color:"#aaa",fontSize:10,cursor:"pointer"},children:"Clear compare"}),S&&P&&ce.jsxs("div",{style:{marginTop:12,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:4},children:[ce.jsx("div",{style:{color:"#f97316",fontSize:10,fontWeight:"bold",marginBottom:6},children:"Comparison"}),ce.jsxs("table",{style:{width:"100%",fontSize:10,borderCollapse:"collapse"},children:[ce.jsx("thead",{children:ce.jsxs("tr",{style:{color:"#888"},children:[ce.jsx("th",{style:{textAlign:"left",padding:"2px 4px"},children:"Metric"}),ce.jsx("th",{style:{textAlign:"center",padding:"2px 4px"},children:"A"}),ce.jsx("th",{style:{textAlign:"center",padding:"2px 4px"},children:"B"})]})}),ce.jsxs("tbody",{style:{color:"#ddd"},children:[ce.jsxs("tr",{children:[ce.jsx("td",{style:{padding:"2px 4px"},children:"Score"}),ce.jsx("td",{style:{textAlign:"center"},children:(S.score??0).toFixed(4)}),ce.jsx("td",{style:{textAlign:"center"},children:(P.score??0).toFixed(4)})]}),ce.jsxs("tr",{children:[ce.jsx("td",{style:{padding:"2px 4px"},children:"Heat flow (mW/m)"}),ce.jsx("td",{style:{textAlign:"center"},children:S.hf!=null?S.hf:""}),ce.jsx("td",{style:{textAlign:"center"},children:P.hf!=null?P.hf:""})]}),ce.jsxs("tr",{children:[ce.jsx("td",{style:{padding:"2px 4px"},children:"Boundary (km)"}),ce.jsx("td",{style:{textAlign:"center"},children:S.bd!=null?S.bd.toFixed(1):""}),ce.jsx("td",{style:{textAlign:"center"},children:P.bd!=null?P.bd.toFixed(1):""})]})]})]}),ce.jsxs("div",{style:{marginTop:6,fontSize:10,color:"#b0b0b0"},children:["Winner: ",e8(S,P)]})]})]}),ce.jsx("div",{style:{padding:"8px 12px 7px",color:"#f97316",fontWeight:"bold",fontSize:10,letterSpacing:2},children:"TOP 20 SITES"}),re.map(le=>{const be=y?.coordinates?.[0]===le.lon&&y?.coordinates?.[1]===le.lat;return ce.jsxs("div",{onClick:()=>{T([le.lon,le.lat]),le.resolvedPlace?E({label:le.resolvedPlace,lat:le.lat,lon:le.lon}):(M(!0),ou(le.lat,le.lon).then(Se=>{E(Se),M(!1)}).catch(()=>{E({country:null,region:null,city:null,label:"Unable to load map data",lat:le.lat,lon:le.lon}),M(!1)})),C({coordinates:[le.lon,le.lat],score:le.score,hf:le.hf,bd:le.bd}),G(le.lon,le.lat)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"none",display:"flex",alignItems:"center",gap:9,background:be?"rgba(249,115,22,0.13)":"transparent",borderLeft:be?"2px solid #f97316":"2px solid transparent",transition:"background 0.12s"},children:[ce.jsxs("span",{style:{color:"#f97316",width:20,textAlign:"right",flexShrink:0,fontSize:11},children:["#",le.rank]}),ce.jsxs("div",{children:[ce.jsxs("div",{style:{color:"#ddd",fontSize:11},children:[le.lat.toFixed(2),", ",le.lon.toFixed(2),""]}),ce.jsxs("div",{style:{color:"#666",fontSize:10,marginTop:1},children:[le.score.toFixed(3)," score  ",le.hf," mW/m"]})]})]},`${le.rank}-${le.lon}-${le.lat}`)})]}),x!=null&&R&&ce.jsxs("div",{style:{...ro,bottom:24,left:12,padding:"8px 12px",fontSize:11,maxWidth:320},children:[ce.jsx("div",{style:{color:"#888",marginBottom:4},children:"Last click (WGS84)"}),ce.jsxs("div",{style:{color:"#ddd",fontFamily:"monospace"},children:["lat ",R.lat.toFixed(4),", lon ",R.lon.toFixed(4),""]}),ce.jsx("div",{style:{color:"#f97316",marginTop:4},children:R.label})]}),x!=null&&ce.jsxs("div",{style:{...ro,top:56,right:12,width:268,padding:14},children:[ce.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[ce.jsx("span",{style:{color:"#f97316",fontWeight:"bold",fontSize:10,letterSpacing:2},children:"SITE ANALYSIS"}),ce.jsx("span",{onClick:()=>{b(null),T(null),E(null),M(!1)},style:{cursor:"pointer",color:"#555",fontSize:14,lineHeight:1},children:""})]}),ce.jsx(ka,{label:"Coordinates",value:`${Cn.toFixed(4)}, ${$n.toFixed(4)}`}),ce.jsx(ka,{label:"Location",value:B?"Loading":R?.label??""}),ce.jsx(ka,{label:"Composite score",value:y?.score?.toFixed(4)??"",accent:!0}),ce.jsx(ka,{label:"Heat flow",value:y?.hf!=null?`${y.hf} mW/m`:""}),ce.jsx(ka,{label:"Plate boundary",value:y?.bd!=null?`${y.bd} km`:""}),y!=null&&ce.jsx("div",{style:{marginTop:10},children:ce.jsx("div",{style:{height:4,borderRadius:2,background:"rgba(255,255,255,0.08)"},children:ce.jsx("div",{style:{height:"100%",width:`${(y.score??0)*100}%`,borderRadius:2,background:"linear-gradient(90deg, #1d9abf, #f97316)",transition:"width 0.3s"}})})})]})]})}function ka({label:n,value:e,accent:t}){return ce.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[ce.jsx("span",{style:{color:"#555"},children:n}),ce.jsx("span",{style:{color:t?"#f97316":"#ddd",fontWeight:t?"bold":"normal"},children:e})]})}function Ox({active:n,onClick:e,children:t}){return ce.jsx("button",{onClick:e,style:{background:n?"rgba(249,115,22,0.2)":"rgba(255,255,255,0.06)",color:n?"#f97316":"#666",border:`1px solid ${n?"rgba(249,115,22,0.5)":"rgba(255,255,255,0.08)"}`,borderRadius:4,padding:"3px 10px",cursor:"pointer",fontSize:11,fontFamily:"inherit",transition:"all 0.15s"},children:t})}function n8(){return ce.jsx("main",{className:"app",children:ce.jsx(t8,{})})}KA.createRoot(document.getElementById("root")).render(ce.jsx(jA.StrictMode,{children:ce.jsx(n8,{})}));export{BF as a,DF as i,MF as p};
