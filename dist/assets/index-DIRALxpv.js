(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function hx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Kh={exports:{}},oa={};var Q0;function AA(){if(Q0)return oa;Q0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var u in s)u!=="key"&&(o[u]=s[u])}else o=s;return s=o.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:o}}return oa.Fragment=e,oa.jsx=t,oa.jsxs=t,oa}var J0;function wA(){return J0||(J0=1,Kh.exports=AA()),Kh.exports}var Pa=wA(),Zh={exports:{}},Ae={};var eb;function EA(){if(eb)return Ae;eb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),y=Symbol.iterator;function v(E){return E===null||typeof E!="object"?null:(E=y&&E[y]||E["@@iterator"],typeof E=="function"?E:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,R={};function M(E,D,K){this.props=E,this.context=D,this.refs=R,this.updater=K||T}M.prototype.isReactComponent={},M.prototype.setState=function(E,D){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,D,"setState")},M.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function H(){}H.prototype=M.prototype;function O(E,D,K){this.props=E,this.context=D,this.refs=R,this.updater=K||T}var L=O.prototype=new H;L.constructor=O,A(L,M.prototype),L.isPureReactComponent=!0;var X=Array.isArray;function Y(){}var re={H:null,A:null,T:null,S:null},le=Object.prototype.hasOwnProperty;function oe(E,D,K){var se=K.ref;return{$$typeof:n,type:E,key:D,ref:se!==void 0?se:null,props:K}}function fe(E,D){return oe(E.type,D,E.props)}function me(E){return typeof E=="object"&&E!==null&&E.$$typeof===n}function ve(E){var D={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(K){return D[K]})}var xe=/\/+/g;function de(E,D){return typeof E=="object"&&E!==null&&E.key!=null?ve(""+E.key):D.toString(36)}function We(E){switch(E.status){case"fulfilled":return E.value;case"rejected":throw E.reason;default:switch(typeof E.status=="string"?E.then(Y,Y):(E.status="pending",E.then(function(D){E.status==="pending"&&(E.status="fulfilled",E.value=D)},function(D){E.status==="pending"&&(E.status="rejected",E.reason=D)})),E.status){case"fulfilled":return E.value;case"rejected":throw E.reason}}throw E}function S(E,D,K,se,ae){var pe=typeof E;(pe==="undefined"||pe==="boolean")&&(E=null);var _e=!1;if(E===null)_e=!0;else switch(pe){case"bigint":case"string":case"number":_e=!0;break;case"object":switch(E.$$typeof){case n:case e:_e=!0;break;case p:return _e=E._init,S(_e(E._payload),D,K,se,ae)}}if(_e)return ae=ae(E),_e=se===""?"."+de(E,0):se,X(ae)?(K="",_e!=null&&(K=_e.replace(xe,"$&/")+"/"),S(ae,D,K,"",function(Ue){return Ue})):ae!=null&&(me(ae)&&(ae=fe(ae,K+(ae.key==null||E&&E.key===ae.key?"":(""+ae.key).replace(xe,"$&/")+"/")+_e)),D.push(ae)),1;_e=0;var Se=se===""?".":se+":";if(X(E))for(var Oe=0;Oe<E.length;Oe++)se=E[Oe],pe=Se+de(se,Oe),_e+=S(se,D,K,pe,ae);else if(Oe=v(E),typeof Oe=="function")for(E=Oe.call(E),Oe=0;!(se=E.next()).done;)se=se.value,pe=Se+de(se,Oe++),_e+=S(se,D,K,pe,ae);else if(pe==="object"){if(typeof E.then=="function")return S(We(E),D,K,se,ae);throw D=String(E),Error("Objects are not valid as a React child (found: "+(D==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":D)+"). If you meant to render a collection of children, use an array instead.")}return _e}function I(E,D,K){if(E==null)return E;var se=[],ae=0;return S(E,se,"","",function(pe){return D.call(K,pe,ae++)}),se}function P(E){if(E._status===-1){var D=E._result;D=D(),D.then(function(K){(E._status===0||E._status===-1)&&(E._status=1,E._result=K)},function(K){(E._status===0||E._status===-1)&&(E._status=2,E._result=K)}),E._status===-1&&(E._status=0,E._result=D)}if(E._status===1)return E._result.default;throw E._result}var G=typeof reportError=="function"?reportError:function(E){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var D=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof E=="object"&&E!==null&&typeof E.message=="string"?String(E.message):String(E),error:E});if(!window.dispatchEvent(D))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",E);return}console.error(E)},Q={map:I,forEach:function(E,D,K){I(E,function(){D.apply(this,arguments)},K)},count:function(E){var D=0;return I(E,function(){D++}),D},toArray:function(E){return I(E,function(D){return D})||[]},only:function(E){if(!me(E))throw Error("React.Children.only expected to receive a single React element child.");return E}};return Ae.Activity=_,Ae.Children=Q,Ae.Component=M,Ae.Fragment=t,Ae.Profiler=s,Ae.PureComponent=O,Ae.StrictMode=i,Ae.Suspense=f,Ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=re,Ae.__COMPILER_RUNTIME={__proto__:null,c:function(E){return re.H.useMemoCache(E)}},Ae.cache=function(E){return function(){return E.apply(null,arguments)}},Ae.cacheSignal=function(){return null},Ae.cloneElement=function(E,D,K){if(E==null)throw Error("The argument must be a React element, but you passed "+E+".");var se=A({},E.props),ae=E.key;if(D!=null)for(pe in D.key!==void 0&&(ae=""+D.key),D)!le.call(D,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&D.ref===void 0||(se[pe]=D[pe]);var pe=arguments.length-2;if(pe===1)se.children=K;else if(1<pe){for(var _e=Array(pe),Se=0;Se<pe;Se++)_e[Se]=arguments[Se+2];se.children=_e}return oe(E.type,ae,se)},Ae.createContext=function(E){return E={$$typeof:l,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null},E.Provider=E,E.Consumer={$$typeof:o,_context:E},E},Ae.createElement=function(E,D,K){var se,ae={},pe=null;if(D!=null)for(se in D.key!==void 0&&(pe=""+D.key),D)le.call(D,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(ae[se]=D[se]);var _e=arguments.length-2;if(_e===1)ae.children=K;else if(1<_e){for(var Se=Array(_e),Oe=0;Oe<_e;Oe++)Se[Oe]=arguments[Oe+2];ae.children=Se}if(E&&E.defaultProps)for(se in _e=E.defaultProps,_e)ae[se]===void 0&&(ae[se]=_e[se]);return oe(E,pe,ae)},Ae.createRef=function(){return{current:null}},Ae.forwardRef=function(E){return{$$typeof:u,render:E}},Ae.isValidElement=me,Ae.lazy=function(E){return{$$typeof:p,_payload:{_status:-1,_result:E},_init:P}},Ae.memo=function(E,D){return{$$typeof:d,type:E,compare:D===void 0?null:D}},Ae.startTransition=function(E){var D=re.T,K={};re.T=K;try{var se=E(),ae=re.S;ae!==null&&ae(K,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(Y,G)}catch(pe){G(pe)}finally{D!==null&&K.types!==null&&(D.types=K.types),re.T=D}},Ae.unstable_useCacheRefresh=function(){return re.H.useCacheRefresh()},Ae.use=function(E){return re.H.use(E)},Ae.useActionState=function(E,D,K){return re.H.useActionState(E,D,K)},Ae.useCallback=function(E,D){return re.H.useCallback(E,D)},Ae.useContext=function(E){return re.H.useContext(E)},Ae.useDebugValue=function(){},Ae.useDeferredValue=function(E,D){return re.H.useDeferredValue(E,D)},Ae.useEffect=function(E,D){return re.H.useEffect(E,D)},Ae.useEffectEvent=function(E){return re.H.useEffectEvent(E)},Ae.useId=function(){return re.H.useId()},Ae.useImperativeHandle=function(E,D,K){return re.H.useImperativeHandle(E,D,K)},Ae.useInsertionEffect=function(E,D){return re.H.useInsertionEffect(E,D)},Ae.useLayoutEffect=function(E,D){return re.H.useLayoutEffect(E,D)},Ae.useMemo=function(E,D){return re.H.useMemo(E,D)},Ae.useOptimistic=function(E,D){return re.H.useOptimistic(E,D)},Ae.useReducer=function(E,D,K){return re.H.useReducer(E,D,K)},Ae.useRef=function(E){return re.H.useRef(E)},Ae.useState=function(E){return re.H.useState(E)},Ae.useSyncExternalStore=function(E,D,K){return re.H.useSyncExternalStore(E,D,K)},Ae.useTransition=function(){return re.H.useTransition()},Ae.version="19.2.4",Ae}var tb;function Bp(){return tb||(tb=1,Zh.exports=EA()),Zh.exports}var st=Bp();const CA=hx(st);var Gh={exports:{}},aa={},Qh={exports:{}},Jh={};var nb;function RA(){return nb||(nb=1,(function(n){function e(S,I){var P=S.length;S.push(I);e:for(;0<P;){var G=P-1>>>1,Q=S[G];if(0<s(Q,I))S[G]=I,S[P]=Q,P=G;else break e}}function t(S){return S.length===0?null:S[0]}function i(S){if(S.length===0)return null;var I=S[0],P=S.pop();if(P!==I){S[0]=P;e:for(var G=0,Q=S.length,E=Q>>>1;G<E;){var D=2*(G+1)-1,K=S[D],se=D+1,ae=S[se];if(0>s(K,P))se<Q&&0>s(ae,K)?(S[G]=ae,S[se]=P,G=se):(S[G]=K,S[D]=P,G=D);else if(se<Q&&0>s(ae,P))S[G]=ae,S[se]=P,G=se;else break e}}return I}function s(S,I){var P=S.sortIndex-I.sortIndex;return P!==0?P:S.id-I.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();n.unstable_now=function(){return l.now()-u}}var f=[],d=[],p=1,_=null,y=3,v=!1,T=!1,A=!1,R=!1,M=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function L(S){for(var I=t(d);I!==null;){if(I.callback===null)i(d);else if(I.startTime<=S)i(d),I.sortIndex=I.expirationTime,e(f,I);else break;I=t(d)}}function X(S){if(A=!1,L(S),!T)if(t(f)!==null)T=!0,Y||(Y=!0,ve());else{var I=t(d);I!==null&&We(X,I.startTime-S)}}var Y=!1,re=-1,le=5,oe=-1;function fe(){return R?!0:!(n.unstable_now()-oe<le)}function me(){if(R=!1,Y){var S=n.unstable_now();oe=S;var I=!0;try{e:{T=!1,A&&(A=!1,H(re),re=-1),v=!0;var P=y;try{t:{for(L(S),_=t(f);_!==null&&!(_.expirationTime>S&&fe());){var G=_.callback;if(typeof G=="function"){_.callback=null,y=_.priorityLevel;var Q=G(_.expirationTime<=S);if(S=n.unstable_now(),typeof Q=="function"){_.callback=Q,L(S),I=!0;break t}_===t(f)&&i(f),L(S)}else i(f);_=t(f)}if(_!==null)I=!0;else{var E=t(d);E!==null&&We(X,E.startTime-S),I=!1}}break e}finally{_=null,y=P,v=!1}I=void 0}}finally{I?ve():Y=!1}}}var ve;if(typeof O=="function")ve=function(){O(me)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,de=xe.port2;xe.port1.onmessage=me,ve=function(){de.postMessage(null)}}else ve=function(){M(me,0)};function We(S,I){re=M(function(){S(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(S){S.callback=null},n.unstable_forceFrameRate=function(S){0>S||125<S?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):le=0<S?Math.floor(1e3/S):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(S){switch(y){case 1:case 2:case 3:var I=3;break;default:I=y}var P=y;y=I;try{return S()}finally{y=P}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(S,I){switch(S){case 1:case 2:case 3:case 4:case 5:break;default:S=3}var P=y;y=S;try{return I()}finally{y=P}},n.unstable_scheduleCallback=function(S,I,P){var G=n.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?G+P:G):P=G,S){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=P+Q,S={id:p++,callback:I,priorityLevel:S,startTime:P,expirationTime:Q,sortIndex:-1},P>G?(S.sortIndex=P,e(d,S),t(f)===null&&S===t(d)&&(A?(H(re),re=-1):A=!0,We(X,P-G))):(S.sortIndex=Q,e(f,S),T||v||(T=!0,Y||(Y=!0,ve()))),S},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(S){var I=y;return function(){var P=y;y=I;try{return S.apply(this,arguments)}finally{y=P}}}})(Jh)),Jh}var ib;function MA(){return ib||(ib=1,Qh.exports=RA()),Qh.exports}var ed={exports:{}},Dt={};var sb;function OA(){if(sb)return Dt;sb=1;var n=Bp();function e(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(f,d,p){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:f,containerInfo:d,implementation:p}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Dt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Dt.createPortal=function(f,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return o(f,d,null,p)},Dt.flushSync=function(f){var d=l.T,p=i.p;try{if(l.T=null,i.p=2,f)return f()}finally{l.T=d,i.p=p,i.d.f()}},Dt.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(f,d))},Dt.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Dt.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var p=d.as,_=u(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:v}):p==="script"&&i.d.X(f,{crossOrigin:_,integrity:y,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Dt.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=u(d.as,d.crossOrigin);i.d.M(f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(f)},Dt.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,_=u(p,d.crossOrigin);i.d.L(f,p,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Dt.preloadModule=function(f,d){if(typeof f=="string")if(d){var p=u(d.as,d.crossOrigin);i.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(f)},Dt.requestFormReset=function(f){i.d.r(f)},Dt.unstable_batchedUpdates=function(f,d){return f(d)},Dt.useFormState=function(f,d,p){return l.H.useFormState(f,d,p)},Dt.useFormStatus=function(){return l.H.useHostTransitionStatus()},Dt.version="19.2.4",Dt}var rb;function IA(){if(rb)return ed.exports;rb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ed.exports=OA(),ed.exports}var ob;function PA(){if(ob)return aa;ob=1;var n=MA(),e=Bp(),t=IA();function i(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,c=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(c=a.return),r=a.return;while(r)}return a.tag===3?c:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function u(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function f(r){if(o(r)!==r)throw Error(i(188))}function d(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(i(188));return a!==r?null:r}for(var c=r,h=a;;){var g=c.return;if(g===null)break;var m=g.alternate;if(m===null){if(h=g.return,h!==null){c=h;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===c)return f(g),r;if(m===h)return f(g),a;m=m.sibling}throw Error(i(188))}if(c.return!==h.return)c=g,h=m;else{for(var b=!1,x=g.child;x;){if(x===c){b=!0,c=g,h=m;break}if(x===h){b=!0,h=g,c=m;break}x=x.sibling}if(!b){for(x=m.child;x;){if(x===c){b=!0,c=m,h=g;break}if(x===h){b=!0,h=m,c=g;break}x=x.sibling}if(!b)throw Error(i(189))}}if(c.alternate!==h)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?r:a}function p(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=p(r),a!==null)return a;r=r.sibling}return null}var _=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),H=Symbol.for("react.consumer"),O=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),Y=Symbol.for("react.suspense_list"),re=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),oe=Symbol.for("react.activity"),fe=Symbol.for("react.memo_cache_sentinel"),me=Symbol.iterator;function ve(r){return r===null||typeof r!="object"?null:(r=me&&r[me]||r["@@iterator"],typeof r=="function"?r:null)}var xe=Symbol.for("react.client.reference");function de(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===xe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case A:return"Fragment";case M:return"Profiler";case R:return"StrictMode";case X:return"Suspense";case Y:return"SuspenseList";case oe:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case T:return"Portal";case O:return r.displayName||"Context";case H:return(r._context.displayName||"Context")+".Consumer";case L:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case re:return a=r.displayName||null,a!==null?a:de(r.type)||"Memo";case le:a=r._payload,r=r._init;try{return de(r(a))}catch{}}return null}var We=Array.isArray,S=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},G=[],Q=-1;function E(r){return{current:r}}function D(r){0>Q||(r.current=G[Q],G[Q]=null,Q--)}function K(r,a){Q++,G[Q]=r.current,r.current=a}var se=E(null),ae=E(null),pe=E(null),_e=E(null);function Se(r,a){switch(K(pe,a),K(ae,r),K(se,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?T0(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=T0(a),r=x0(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}D(se),K(se,r)}function Oe(){D(se),D(ae),D(pe)}function Ue(r){r.memoizedState!==null&&K(_e,r);var a=se.current,c=x0(a,r.type);a!==c&&(K(ae,r),K(se,c))}function Ln(r){ae.current===r&&(D(se),D(ae)),_e.current===r&&(D(_e),na._currentValue=P)}var Kn,ho;function Un(r){if(Kn===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);Kn=a&&a[1]||"",ho=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Kn+r+ho}var Be=!1;function Le(r,a){if(!r||Be)return"";Be=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(a){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(Z){var q=Z}Reflect.construct(r,[],ne)}else{try{ne.call()}catch(Z){q=Z}r.call(ne.prototype)}}else{try{throw Error()}catch(Z){q=Z}(ne=r())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(Z){if(Z&&q&&typeof Z.stack=="string")return[Z.stack,q.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=h.DetermineComponentFrameRoot(),b=m[0],x=m[1];if(b&&x){var N=b.split(`
`),$=x.split(`
`);for(g=h=0;h<N.length&&!N[h].includes("DetermineComponentFrameRoot");)h++;for(;g<$.length&&!$[g].includes("DetermineComponentFrameRoot");)g++;if(h===N.length||g===$.length)for(h=N.length-1,g=$.length-1;1<=h&&0<=g&&N[h]!==$[g];)g--;for(;1<=h&&0<=g;h--,g--)if(N[h]!==$[g]){if(h!==1||g!==1)do if(h--,g--,0>g||N[h]!==$[g]){var J=`
`+N[h].replace(" at new "," at ");return r.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",r.displayName)),J}while(1<=h&&0<=g);break}}}finally{Be=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Un(c):""}function t1(r,a){switch(r.tag){case 26:case 27:case 5:return Un(r.type);case 16:return Un("Lazy");case 13:return r.child!==a&&a!==null?Un("Suspense Fallback"):Un("Suspense");case 19:return Un("SuspenseList");case 0:case 15:return Le(r.type,!1);case 11:return Le(r.type.render,!1);case 1:return Le(r.type,!0);case 31:return Un("Activity");default:return""}}function Qg(r){try{var a="",c=null;do a+=t1(r,c),c=r,r=r.return;while(r);return a}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var Nu=Object.prototype.hasOwnProperty,Du=n.unstable_scheduleCallback,ku=n.unstable_cancelCallback,n1=n.unstable_shouldYield,i1=n.unstable_requestPaint,Gt=n.unstable_now,s1=n.unstable_getCurrentPriorityLevel,Jg=n.unstable_ImmediatePriority,em=n.unstable_UserBlockingPriority,qa=n.unstable_NormalPriority,r1=n.unstable_LowPriority,tm=n.unstable_IdlePriority,o1=n.log,a1=n.unstable_setDisableYieldValue,po=null,Qt=null;function Ai(r){if(typeof o1=="function"&&a1(r),Qt&&typeof Qt.setStrictMode=="function")try{Qt.setStrictMode(po,r)}catch{}}var Jt=Math.clz32?Math.clz32:u1,l1=Math.log,c1=Math.LN2;function u1(r){return r>>>=0,r===0?32:31-(l1(r)/c1|0)|0}var Ya=256,Ka=262144,Za=4194304;function hs(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Ga(r,a,c){var h=r.pendingLanes;if(h===0)return 0;var g=0,m=r.suspendedLanes,b=r.pingedLanes;r=r.warmLanes;var x=h&134217727;return x!==0?(h=x&~m,h!==0?g=hs(h):(b&=x,b!==0?g=hs(b):c||(c=x&~r,c!==0&&(g=hs(c))))):(x=h&~m,x!==0?g=hs(x):b!==0?g=hs(b):c||(c=h&~r,c!==0&&(g=hs(c)))),g===0?0:a!==0&&a!==g&&(a&m)===0&&(m=g&-g,c=a&-a,m>=c||m===32&&(c&4194048)!==0)?a:g}function go(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function f1(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nm(){var r=Za;return Za<<=1,(Za&62914560)===0&&(Za=4194304),r}function Bu(r){for(var a=[],c=0;31>c;c++)a.push(r);return a}function mo(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function h1(r,a,c,h,g,m){var b=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var x=r.entanglements,N=r.expirationTimes,$=r.hiddenUpdates;for(c=b&~c;0<c;){var J=31-Jt(c),ne=1<<J;x[J]=0,N[J]=-1;var q=$[J];if(q!==null)for($[J]=null,J=0;J<q.length;J++){var Z=q[J];Z!==null&&(Z.lane&=-536870913)}c&=~ne}h!==0&&im(r,h,0),m!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=m&~(b&~a))}function im(r,a,c){r.pendingLanes|=a,r.suspendedLanes&=~a;var h=31-Jt(a);r.entangledLanes|=a,r.entanglements[h]=r.entanglements[h]|1073741824|c&261930}function sm(r,a){var c=r.entangledLanes|=a;for(r=r.entanglements;c;){var h=31-Jt(c),g=1<<h;g&a|r[h]&a&&(r[h]|=a),c&=~g}}function rm(r,a){var c=a&-a;return c=(c&42)!==0?1:Lu(c),(c&(r.suspendedLanes|a))!==0?0:c}function Lu(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Uu(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function om(){var r=I.p;return r!==0?r:(r=window.event,r===void 0?32:$0(r.type))}function am(r,a){var c=I.p;try{return I.p=r,a()}finally{I.p=c}}var wi=Math.random().toString(36).slice(2),Ct="__reactFiber$"+wi,Ht="__reactProps$"+wi,Gs="__reactContainer$"+wi,Fu="__reactEvents$"+wi,d1="__reactListeners$"+wi,p1="__reactHandles$"+wi,lm="__reactResources$"+wi,_o="__reactMarker$"+wi;function zu(r){delete r[Ct],delete r[Ht],delete r[Fu],delete r[d1],delete r[p1]}function Qs(r){var a=r[Ct];if(a)return a;for(var c=r.parentNode;c;){if(a=c[Gs]||c[Ct]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(r=M0(r);r!==null;){if(c=r[Ct])return c;r=M0(r)}return a}r=c,c=r.parentNode}return null}function Js(r){if(r=r[Ct]||r[Gs]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function yo(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(i(33))}function er(r){var a=r[lm];return a||(a=r[lm]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function St(r){r[_o]=!0}var cm=new Set,um={};function ds(r,a){tr(r,a),tr(r+"Capture",a)}function tr(r,a){for(um[r]=a,r=0;r<a.length;r++)cm.add(a[r])}var g1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fm={},hm={};function m1(r){return Nu.call(hm,r)?!0:Nu.call(fm,r)?!1:g1.test(r)?hm[r]=!0:(fm[r]=!0,!1)}function Qa(r,a,c){if(m1(a))if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var h=a.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+c)}}function Ja(r,a,c){if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+c)}}function Zn(r,a,c,h){if(h===null)r.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(a,c,""+h)}}function hn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function dm(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function _1(r,a,c){var h=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,m=h.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return g.call(this)},set:function(b){c=""+b,m.call(this,b)}}),Object.defineProperty(r,a,{enumerable:h.enumerable}),{getValue:function(){return c},setValue:function(b){c=""+b},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function Vu(r){if(!r._valueTracker){var a=dm(r)?"checked":"value";r._valueTracker=_1(r,a,""+r[a])}}function pm(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var c=a.getValue(),h="";return r&&(h=dm(r)?r.checked?"true":"false":r.value),r=h,r!==c?(a.setValue(r),!0):!1}function el(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var y1=/[\n"\\]/g;function dn(r){return r.replace(y1,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Hu(r,a,c,h,g,m,b,x){r.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?r.type=b:r.removeAttribute("type"),a!=null?b==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+hn(a)):r.value!==""+hn(a)&&(r.value=""+hn(a)):b!=="submit"&&b!=="reset"||r.removeAttribute("value"),a!=null?ju(r,b,hn(a)):c!=null?ju(r,b,hn(c)):h!=null&&r.removeAttribute("value"),g==null&&m!=null&&(r.defaultChecked=!!m),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?r.name=""+hn(x):r.removeAttribute("name")}function gm(r,a,c,h,g,m,b,x){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(r.type=m),a!=null||c!=null){if(!(m!=="submit"&&m!=="reset"||a!=null)){Vu(r);return}c=c!=null?""+hn(c):"",a=a!=null?""+hn(a):c,x||a===r.value||(r.value=a),r.defaultValue=a}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,r.checked=x?r.checked:!!h,r.defaultChecked=!!h,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(r.name=b),Vu(r)}function ju(r,a,c){a==="number"&&el(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function nr(r,a,c,h){if(r=r.options,a){a={};for(var g=0;g<c.length;g++)a["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=a.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&h&&(r[c].defaultSelected=!0)}else{for(c=""+hn(c),a=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,h&&(r[g].defaultSelected=!0);return}a!==null||r[g].disabled||(a=r[g])}a!==null&&(a.selected=!0)}}function mm(r,a,c){if(a!=null&&(a=""+hn(a),a!==r.value&&(r.value=a),c==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=c!=null?""+hn(c):""}function _m(r,a,c,h){if(a==null){if(h!=null){if(c!=null)throw Error(i(92));if(We(h)){if(1<h.length)throw Error(i(93));h=h[0]}c=h}c==null&&(c=""),a=c}c=hn(a),r.defaultValue=c,h=r.textContent,h===c&&h!==""&&h!==null&&(r.value=h),Vu(r)}function ir(r,a){if(a){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=a;return}}r.textContent=a}var b1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ym(r,a,c){var h=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?h?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":h?r.setProperty(a,c):typeof c!="number"||c===0||b1.has(a)?a==="float"?r.cssFloat=c:r[a]=(""+c).trim():r[a]=c+"px"}function bm(r,a,c){if(a!=null&&typeof a!="object")throw Error(i(62));if(r=r.style,c!=null){for(var h in c)!c.hasOwnProperty(h)||a!=null&&a.hasOwnProperty(h)||(h.indexOf("--")===0?r.setProperty(h,""):h==="float"?r.cssFloat="":r[h]="");for(var g in a)h=a[g],a.hasOwnProperty(g)&&c[g]!==h&&ym(r,g,h)}else for(var m in a)a.hasOwnProperty(m)&&ym(r,m,a[m])}function Wu(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var v1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),T1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function tl(r){return T1.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Gn(){}var $u=null;function Xu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var sr=null,rr=null;function vm(r){var a=Js(r);if(a&&(r=a.stateNode)){var c=r[Ht]||null;e:switch(r=a.stateNode,a.type){case"input":if(Hu(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+dn(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var h=c[a];if(h!==r&&h.form===r.form){var g=h[Ht]||null;if(!g)throw Error(i(90));Hu(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(a=0;a<c.length;a++)h=c[a],h.form===r.form&&pm(h)}break e;case"textarea":mm(r,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&nr(r,!!c.multiple,a,!1)}}}var qu=!1;function Tm(r,a,c){if(qu)return r(a,c);qu=!0;try{var h=r(a);return h}finally{if(qu=!1,(sr!==null||rr!==null)&&(Hl(),sr&&(a=sr,r=rr,rr=sr=null,vm(a),r)))for(a=0;a<r.length;a++)vm(r[a])}}function bo(r,a){var c=r.stateNode;if(c===null)return null;var h=c[Ht]||null;if(h===null)return null;c=h[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(r=r.type,h=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!h;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(i(231,a,typeof c));return c}var Qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yu=!1;if(Qn)try{var vo={};Object.defineProperty(vo,"passive",{get:function(){Yu=!0}}),window.addEventListener("test",vo,vo),window.removeEventListener("test",vo,vo)}catch{Yu=!1}var Ei=null,Ku=null,nl=null;function xm(){if(nl)return nl;var r,a=Ku,c=a.length,h,g="value"in Ei?Ei.value:Ei.textContent,m=g.length;for(r=0;r<c&&a[r]===g[r];r++);var b=c-r;for(h=1;h<=b&&a[c-h]===g[m-h];h++);return nl=g.slice(r,1<h?1-h:void 0)}function il(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function sl(){return!0}function Sm(){return!1}function jt(r){function a(c,h,g,m,b){this._reactName=c,this._targetInst=g,this.type=h,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var x in r)r.hasOwnProperty(x)&&(c=r[x],this[x]=c?c(m):m[x]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?sl:Sm,this.isPropagationStopped=Sm,this}return _(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=sl)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=sl)},persist:function(){},isPersistent:sl}),a}var ps={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rl=jt(ps),To=_({},ps,{view:0,detail:0}),x1=jt(To),Zu,Gu,xo,ol=_({},To,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ju,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==xo&&(xo&&r.type==="mousemove"?(Zu=r.screenX-xo.screenX,Gu=r.screenY-xo.screenY):Gu=Zu=0,xo=r),Zu)},movementY:function(r){return"movementY"in r?r.movementY:Gu}}),Am=jt(ol),S1=_({},ol,{dataTransfer:0}),A1=jt(S1),w1=_({},To,{relatedTarget:0}),Qu=jt(w1),E1=_({},ps,{animationName:0,elapsedTime:0,pseudoElement:0}),C1=jt(E1),R1=_({},ps,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),M1=jt(R1),O1=_({},ps,{data:0}),wm=jt(O1),I1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},P1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},N1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function D1(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=N1[r])?!!a[r]:!1}function Ju(){return D1}var k1=_({},To,{key:function(r){if(r.key){var a=I1[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=il(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?P1[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ju,charCode:function(r){return r.type==="keypress"?il(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?il(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),B1=jt(k1),L1=_({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Em=jt(L1),U1=_({},To,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ju}),F1=jt(U1),z1=_({},ps,{propertyName:0,elapsedTime:0,pseudoElement:0}),V1=jt(z1),H1=_({},ol,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),j1=jt(H1),W1=_({},ps,{newState:0,oldState:0}),$1=jt(W1),X1=[9,13,27,32],ef=Qn&&"CompositionEvent"in window,So=null;Qn&&"documentMode"in document&&(So=document.documentMode);var q1=Qn&&"TextEvent"in window&&!So,Cm=Qn&&(!ef||So&&8<So&&11>=So),Rm=" ",Mm=!1;function Om(r,a){switch(r){case"keyup":return X1.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Im(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var or=!1;function Y1(r,a){switch(r){case"compositionend":return Im(a);case"keypress":return a.which!==32?null:(Mm=!0,Rm);case"textInput":return r=a.data,r===Rm&&Mm?null:r;default:return null}}function K1(r,a){if(or)return r==="compositionend"||!ef&&Om(r,a)?(r=xm(),nl=Ku=Ei=null,or=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Cm&&a.locale!=="ko"?null:a.data;default:return null}}var Z1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pm(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!Z1[r.type]:a==="textarea"}function Nm(r,a,c,h){sr?rr?rr.push(h):rr=[h]:sr=h,a=Kl(a,"onChange"),0<a.length&&(c=new rl("onChange","change",null,c,h),r.push({event:c,listeners:a}))}var Ao=null,wo=null;function G1(r){g0(r,0)}function al(r){var a=yo(r);if(pm(a))return r}function Dm(r,a){if(r==="change")return a}var km=!1;if(Qn){var tf;if(Qn){var nf="oninput"in document;if(!nf){var Bm=document.createElement("div");Bm.setAttribute("oninput","return;"),nf=typeof Bm.oninput=="function"}tf=nf}else tf=!1;km=tf&&(!document.documentMode||9<document.documentMode)}function Lm(){Ao&&(Ao.detachEvent("onpropertychange",Um),wo=Ao=null)}function Um(r){if(r.propertyName==="value"&&al(wo)){var a=[];Nm(a,wo,r,Xu(r)),Tm(G1,a)}}function Q1(r,a,c){r==="focusin"?(Lm(),Ao=a,wo=c,Ao.attachEvent("onpropertychange",Um)):r==="focusout"&&Lm()}function J1(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return al(wo)}function eS(r,a){if(r==="click")return al(a)}function tS(r,a){if(r==="input"||r==="change")return al(a)}function nS(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var en=typeof Object.is=="function"?Object.is:nS;function Eo(r,a){if(en(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var c=Object.keys(r),h=Object.keys(a);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var g=c[h];if(!Nu.call(a,g)||!en(r[g],a[g]))return!1}return!0}function Fm(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function zm(r,a){var c=Fm(r);r=0;for(var h;c;){if(c.nodeType===3){if(h=r+c.textContent.length,r<=a&&h>=a)return{node:c,offset:a-r};r=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Fm(c)}}function Vm(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?Vm(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function Hm(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=el(r.document);a instanceof r.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)r=a.contentWindow;else break;a=el(r.document)}return a}function sf(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var iS=Qn&&"documentMode"in document&&11>=document.documentMode,ar=null,rf=null,Co=null,of=!1;function jm(r,a,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;of||ar==null||ar!==el(h)||(h=ar,"selectionStart"in h&&sf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Co&&Eo(Co,h)||(Co=h,h=Kl(rf,"onSelect"),0<h.length&&(a=new rl("onSelect","select",null,a,c),r.push({event:a,listeners:h}),a.target=ar)))}function gs(r,a){var c={};return c[r.toLowerCase()]=a.toLowerCase(),c["Webkit"+r]="webkit"+a,c["Moz"+r]="moz"+a,c}var lr={animationend:gs("Animation","AnimationEnd"),animationiteration:gs("Animation","AnimationIteration"),animationstart:gs("Animation","AnimationStart"),transitionrun:gs("Transition","TransitionRun"),transitionstart:gs("Transition","TransitionStart"),transitioncancel:gs("Transition","TransitionCancel"),transitionend:gs("Transition","TransitionEnd")},af={},Wm={};Qn&&(Wm=document.createElement("div").style,"AnimationEvent"in window||(delete lr.animationend.animation,delete lr.animationiteration.animation,delete lr.animationstart.animation),"TransitionEvent"in window||delete lr.transitionend.transition);function ms(r){if(af[r])return af[r];if(!lr[r])return r;var a=lr[r],c;for(c in a)if(a.hasOwnProperty(c)&&c in Wm)return af[r]=a[c];return r}var $m=ms("animationend"),Xm=ms("animationiteration"),qm=ms("animationstart"),sS=ms("transitionrun"),rS=ms("transitionstart"),oS=ms("transitioncancel"),Ym=ms("transitionend"),Km=new Map,lf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");lf.push("scrollEnd");function Cn(r,a){Km.set(r,a),ds(a,[r])}var ll=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},pn=[],cr=0,cf=0;function cl(){for(var r=cr,a=cf=cr=0;a<r;){var c=pn[a];pn[a++]=null;var h=pn[a];pn[a++]=null;var g=pn[a];pn[a++]=null;var m=pn[a];if(pn[a++]=null,h!==null&&g!==null){var b=h.pending;b===null?g.next=g:(g.next=b.next,b.next=g),h.pending=g}m!==0&&Zm(c,g,m)}}function ul(r,a,c,h){pn[cr++]=r,pn[cr++]=a,pn[cr++]=c,pn[cr++]=h,cf|=h,r.lanes|=h,r=r.alternate,r!==null&&(r.lanes|=h)}function uf(r,a,c,h){return ul(r,a,c,h),fl(r)}function _s(r,a){return ul(r,null,null,a),fl(r)}function Zm(r,a,c){r.lanes|=c;var h=r.alternate;h!==null&&(h.lanes|=c);for(var g=!1,m=r.return;m!==null;)m.childLanes|=c,h=m.alternate,h!==null&&(h.childLanes|=c),m.tag===22&&(r=m.stateNode,r===null||r._visibility&1||(g=!0)),r=m,m=m.return;return r.tag===3?(m=r.stateNode,g&&a!==null&&(g=31-Jt(c),r=m.hiddenUpdates,h=r[g],h===null?r[g]=[a]:h.push(a),a.lane=c|536870912),m):null}function fl(r){if(50<Ko)throw Ko=0,bh=null,Error(i(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var ur={};function aS(r,a,c,h){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function tn(r,a,c,h){return new aS(r,a,c,h)}function ff(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Jn(r,a){var c=r.alternate;return c===null?(c=tn(r.tag,a,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=a,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,a=r.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Gm(r,a){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,a=c.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function hl(r,a,c,h,g,m){var b=0;if(h=r,typeof r=="function")ff(r)&&(b=1);else if(typeof r=="string")b=hA(r,c,se.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case oe:return r=tn(31,c,a,g),r.elementType=oe,r.lanes=m,r;case A:return ys(c.children,g,m,a);case R:b=8,g|=24;break;case M:return r=tn(12,c,a,g|2),r.elementType=M,r.lanes=m,r;case X:return r=tn(13,c,a,g),r.elementType=X,r.lanes=m,r;case Y:return r=tn(19,c,a,g),r.elementType=Y,r.lanes=m,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case O:b=10;break e;case H:b=9;break e;case L:b=11;break e;case re:b=14;break e;case le:b=16,h=null;break e}b=29,c=Error(i(130,r===null?"null":typeof r,"")),h=null}return a=tn(b,c,a,g),a.elementType=r,a.type=h,a.lanes=m,a}function ys(r,a,c,h){return r=tn(7,r,h,a),r.lanes=c,r}function hf(r,a,c){return r=tn(6,r,null,a),r.lanes=c,r}function Qm(r){var a=tn(18,null,null,0);return a.stateNode=r,a}function df(r,a,c){return a=tn(4,r.children!==null?r.children:[],r.key,a),a.lanes=c,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var Jm=new WeakMap;function gn(r,a){if(typeof r=="object"&&r!==null){var c=Jm.get(r);return c!==void 0?c:(a={value:r,source:a,stack:Qg(a)},Jm.set(r,a),a)}return{value:r,source:a,stack:Qg(a)}}var fr=[],hr=0,dl=null,Ro=0,mn=[],_n=0,Ci=null,Fn=1,zn="";function ei(r,a){fr[hr++]=Ro,fr[hr++]=dl,dl=r,Ro=a}function e_(r,a,c){mn[_n++]=Fn,mn[_n++]=zn,mn[_n++]=Ci,Ci=r;var h=Fn;r=zn;var g=32-Jt(h)-1;h&=~(1<<g),c+=1;var m=32-Jt(a)+g;if(30<m){var b=g-g%5;m=(h&(1<<b)-1).toString(32),h>>=b,g-=b,Fn=1<<32-Jt(a)+g|c<<g|h,zn=m+r}else Fn=1<<m|c<<g|h,zn=r}function pf(r){r.return!==null&&(ei(r,1),e_(r,1,0))}function gf(r){for(;r===dl;)dl=fr[--hr],fr[hr]=null,Ro=fr[--hr],fr[hr]=null;for(;r===Ci;)Ci=mn[--_n],mn[_n]=null,zn=mn[--_n],mn[_n]=null,Fn=mn[--_n],mn[_n]=null}function t_(r,a){mn[_n++]=Fn,mn[_n++]=zn,mn[_n++]=Ci,Fn=a.id,zn=a.overflow,Ci=r}var Rt=null,tt=null,ke=!1,Ri=null,yn=!1,mf=Error(i(519));function Mi(r){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Mo(gn(a,r)),mf}function n_(r){var a=r.stateNode,c=r.type,h=r.memoizedProps;switch(a[Ct]=r,a[Ht]=h,c){case"dialog":Pe("cancel",a),Pe("close",a);break;case"iframe":case"object":case"embed":Pe("load",a);break;case"video":case"audio":for(c=0;c<Go.length;c++)Pe(Go[c],a);break;case"source":Pe("error",a);break;case"img":case"image":case"link":Pe("error",a),Pe("load",a);break;case"details":Pe("toggle",a);break;case"input":Pe("invalid",a),gm(a,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":Pe("invalid",a);break;case"textarea":Pe("invalid",a),_m(a,h.value,h.defaultValue,h.children)}c=h.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||h.suppressHydrationWarning===!0||b0(a.textContent,c)?(h.popover!=null&&(Pe("beforetoggle",a),Pe("toggle",a)),h.onScroll!=null&&Pe("scroll",a),h.onScrollEnd!=null&&Pe("scrollend",a),h.onClick!=null&&(a.onclick=Gn),a=!0):a=!1,a||Mi(r,!0)}function i_(r){for(Rt=r.return;Rt;)switch(Rt.tag){case 5:case 31:case 13:yn=!1;return;case 27:case 3:yn=!0;return;default:Rt=Rt.return}}function dr(r){if(r!==Rt)return!1;if(!ke)return i_(r),ke=!0,!1;var a=r.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||Dh(r.type,r.memoizedProps)),c=!c),c&&tt&&Mi(r),i_(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));tt=R0(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));tt=R0(r)}else a===27?(a=tt,ji(r.type)?(r=Fh,Fh=null,tt=r):tt=a):tt=Rt?vn(r.stateNode.nextSibling):null;return!0}function bs(){tt=Rt=null,ke=!1}function _f(){var r=Ri;return r!==null&&(qt===null?qt=r:qt.push.apply(qt,r),Ri=null),r}function Mo(r){Ri===null?Ri=[r]:Ri.push(r)}var yf=E(null),vs=null,ti=null;function Oi(r,a,c){K(yf,a._currentValue),a._currentValue=c}function ni(r){r._currentValue=yf.current,D(yf)}function bf(r,a,c){for(;r!==null;){var h=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,h!==null&&(h.childLanes|=a)):h!==null&&(h.childLanes&a)!==a&&(h.childLanes|=a),r===c)break;r=r.return}}function vf(r,a,c,h){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var m=g.dependencies;if(m!==null){var b=g.child;m=m.firstContext;e:for(;m!==null;){var x=m;m=g;for(var N=0;N<a.length;N++)if(x.context===a[N]){m.lanes|=c,x=m.alternate,x!==null&&(x.lanes|=c),bf(m.return,c,r),h||(b=null);break e}m=x.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(i(341));b.lanes|=c,m=b.alternate,m!==null&&(m.lanes|=c),bf(b,c,r),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===r){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function pr(r,a,c,h){r=null;for(var g=a,m=!1;g!==null;){if(!m){if((g.flags&524288)!==0)m=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var x=g.type;en(g.pendingProps.value,b.value)||(r!==null?r.push(x):r=[x])}}else if(g===_e.current){if(b=g.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(na):r=[na])}g=g.return}r!==null&&vf(a,r,c,h),a.flags|=262144}function pl(r){for(r=r.firstContext;r!==null;){if(!en(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ts(r){vs=r,ti=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Mt(r){return s_(vs,r)}function gl(r,a){return vs===null&&Ts(r),s_(r,a)}function s_(r,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ti===null){if(r===null)throw Error(i(308));ti=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else ti=ti.next=a;return c}var lS=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(c,h){r.push(h)}};this.abort=function(){a.aborted=!0,r.forEach(function(c){return c()})}},cS=n.unstable_scheduleCallback,uS=n.unstable_NormalPriority,ht={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Tf(){return{controller:new lS,data:new Map,refCount:0}}function Oo(r){r.refCount--,r.refCount===0&&cS(uS,function(){r.controller.abort()})}var Io=null,xf=0,gr=0,mr=null;function fS(r,a){if(Io===null){var c=Io=[];xf=0,gr=wh(),mr={status:"pending",value:void 0,then:function(h){c.push(h)}}}return xf++,a.then(r_,r_),a}function r_(){if(--xf===0&&Io!==null){mr!==null&&(mr.status="fulfilled");var r=Io;Io=null,gr=0,mr=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function hS(r,a){var c=[],h={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){h.status="fulfilled",h.value=a;for(var g=0;g<c.length;g++)(0,c[g])(a)},function(g){for(h.status="rejected",h.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),h}var o_=S.S;S.S=function(r,a){jy=Gt(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&fS(r,a),o_!==null&&o_(r,a)};var xs=E(null);function Sf(){var r=xs.current;return r!==null?r:Qe.pooledCache}function ml(r,a){a===null?K(xs,xs.current):K(xs,a.pool)}function a_(){var r=Sf();return r===null?null:{parent:ht._currentValue,pool:r}}var _r=Error(i(460)),Af=Error(i(474)),_l=Error(i(542)),yl={then:function(){}};function l_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function c_(r,a,c){switch(c=r[c],c===void 0?r.push(a):c!==a&&(a.then(Gn,Gn),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,f_(r),r;default:if(typeof a.status=="string")a.then(Gn,Gn);else{if(r=Qe,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=a,r.status="pending",r.then(function(h){if(a.status==="pending"){var g=a;g.status="fulfilled",g.value=h}},function(h){if(a.status==="pending"){var g=a;g.status="rejected",g.reason=h}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,f_(r),r}throw As=a,_r}}function Ss(r){try{var a=r._init;return a(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(As=c,_r):c}}var As=null;function u_(){if(As===null)throw Error(i(459));var r=As;return As=null,r}function f_(r){if(r===_r||r===_l)throw Error(i(483))}var yr=null,Po=0;function bl(r){var a=Po;return Po+=1,yr===null&&(yr=[]),c_(yr,r,a)}function No(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function vl(r,a){throw a.$$typeof===y?Error(i(525)):(r=Object.prototype.toString.call(a),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function h_(r){function a(z,k){if(r){var W=z.deletions;W===null?(z.deletions=[k],z.flags|=16):W.push(k)}}function c(z,k){if(!r)return null;for(;k!==null;)a(z,k),k=k.sibling;return null}function h(z){for(var k=new Map;z!==null;)z.key!==null?k.set(z.key,z):k.set(z.index,z),z=z.sibling;return k}function g(z,k){return z=Jn(z,k),z.index=0,z.sibling=null,z}function m(z,k,W){return z.index=W,r?(W=z.alternate,W!==null?(W=W.index,W<k?(z.flags|=67108866,k):W):(z.flags|=67108866,k)):(z.flags|=1048576,k)}function b(z){return r&&z.alternate===null&&(z.flags|=67108866),z}function x(z,k,W,ee){return k===null||k.tag!==6?(k=hf(W,z.mode,ee),k.return=z,k):(k=g(k,W),k.return=z,k)}function N(z,k,W,ee){var ye=W.type;return ye===A?J(z,k,W.props.children,ee,W.key):k!==null&&(k.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===le&&Ss(ye)===k.type)?(k=g(k,W.props),No(k,W),k.return=z,k):(k=hl(W.type,W.key,W.props,null,z.mode,ee),No(k,W),k.return=z,k)}function $(z,k,W,ee){return k===null||k.tag!==4||k.stateNode.containerInfo!==W.containerInfo||k.stateNode.implementation!==W.implementation?(k=df(W,z.mode,ee),k.return=z,k):(k=g(k,W.children||[]),k.return=z,k)}function J(z,k,W,ee,ye){return k===null||k.tag!==7?(k=ys(W,z.mode,ee,ye),k.return=z,k):(k=g(k,W),k.return=z,k)}function ne(z,k,W){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return k=hf(""+k,z.mode,W),k.return=z,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case v:return W=hl(k.type,k.key,k.props,null,z.mode,W),No(W,k),W.return=z,W;case T:return k=df(k,z.mode,W),k.return=z,k;case le:return k=Ss(k),ne(z,k,W)}if(We(k)||ve(k))return k=ys(k,z.mode,W,null),k.return=z,k;if(typeof k.then=="function")return ne(z,bl(k),W);if(k.$$typeof===O)return ne(z,gl(z,k),W);vl(z,k)}return null}function q(z,k,W,ee){var ye=k!==null?k.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return ye!==null?null:x(z,k,""+W,ee);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case v:return W.key===ye?N(z,k,W,ee):null;case T:return W.key===ye?$(z,k,W,ee):null;case le:return W=Ss(W),q(z,k,W,ee)}if(We(W)||ve(W))return ye!==null?null:J(z,k,W,ee,null);if(typeof W.then=="function")return q(z,k,bl(W),ee);if(W.$$typeof===O)return q(z,k,gl(z,W),ee);vl(z,W)}return null}function Z(z,k,W,ee,ye){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return z=z.get(W)||null,x(k,z,""+ee,ye);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case v:return z=z.get(ee.key===null?W:ee.key)||null,N(k,z,ee,ye);case T:return z=z.get(ee.key===null?W:ee.key)||null,$(k,z,ee,ye);case le:return ee=Ss(ee),Z(z,k,W,ee,ye)}if(We(ee)||ve(ee))return z=z.get(W)||null,J(k,z,ee,ye,null);if(typeof ee.then=="function")return Z(z,k,W,bl(ee),ye);if(ee.$$typeof===O)return Z(z,k,W,gl(k,ee),ye);vl(k,ee)}return null}function he(z,k,W,ee){for(var ye=null,Fe=null,ge=k,Ce=k=0,De=null;ge!==null&&Ce<W.length;Ce++){ge.index>Ce?(De=ge,ge=null):De=ge.sibling;var ze=q(z,ge,W[Ce],ee);if(ze===null){ge===null&&(ge=De);break}r&&ge&&ze.alternate===null&&a(z,ge),k=m(ze,k,Ce),Fe===null?ye=ze:Fe.sibling=ze,Fe=ze,ge=De}if(Ce===W.length)return c(z,ge),ke&&ei(z,Ce),ye;if(ge===null){for(;Ce<W.length;Ce++)ge=ne(z,W[Ce],ee),ge!==null&&(k=m(ge,k,Ce),Fe===null?ye=ge:Fe.sibling=ge,Fe=ge);return ke&&ei(z,Ce),ye}for(ge=h(ge);Ce<W.length;Ce++)De=Z(ge,z,Ce,W[Ce],ee),De!==null&&(r&&De.alternate!==null&&ge.delete(De.key===null?Ce:De.key),k=m(De,k,Ce),Fe===null?ye=De:Fe.sibling=De,Fe=De);return r&&ge.forEach(function(Yi){return a(z,Yi)}),ke&&ei(z,Ce),ye}function be(z,k,W,ee){if(W==null)throw Error(i(151));for(var ye=null,Fe=null,ge=k,Ce=k=0,De=null,ze=W.next();ge!==null&&!ze.done;Ce++,ze=W.next()){ge.index>Ce?(De=ge,ge=null):De=ge.sibling;var Yi=q(z,ge,ze.value,ee);if(Yi===null){ge===null&&(ge=De);break}r&&ge&&Yi.alternate===null&&a(z,ge),k=m(Yi,k,Ce),Fe===null?ye=Yi:Fe.sibling=Yi,Fe=Yi,ge=De}if(ze.done)return c(z,ge),ke&&ei(z,Ce),ye;if(ge===null){for(;!ze.done;Ce++,ze=W.next())ze=ne(z,ze.value,ee),ze!==null&&(k=m(ze,k,Ce),Fe===null?ye=ze:Fe.sibling=ze,Fe=ze);return ke&&ei(z,Ce),ye}for(ge=h(ge);!ze.done;Ce++,ze=W.next())ze=Z(ge,z,Ce,ze.value,ee),ze!==null&&(r&&ze.alternate!==null&&ge.delete(ze.key===null?Ce:ze.key),k=m(ze,k,Ce),Fe===null?ye=ze:Fe.sibling=ze,Fe=ze);return r&&ge.forEach(function(SA){return a(z,SA)}),ke&&ei(z,Ce),ye}function Ke(z,k,W,ee){if(typeof W=="object"&&W!==null&&W.type===A&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case v:e:{for(var ye=W.key;k!==null;){if(k.key===ye){if(ye=W.type,ye===A){if(k.tag===7){c(z,k.sibling),ee=g(k,W.props.children),ee.return=z,z=ee;break e}}else if(k.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===le&&Ss(ye)===k.type){c(z,k.sibling),ee=g(k,W.props),No(ee,W),ee.return=z,z=ee;break e}c(z,k);break}else a(z,k);k=k.sibling}W.type===A?(ee=ys(W.props.children,z.mode,ee,W.key),ee.return=z,z=ee):(ee=hl(W.type,W.key,W.props,null,z.mode,ee),No(ee,W),ee.return=z,z=ee)}return b(z);case T:e:{for(ye=W.key;k!==null;){if(k.key===ye)if(k.tag===4&&k.stateNode.containerInfo===W.containerInfo&&k.stateNode.implementation===W.implementation){c(z,k.sibling),ee=g(k,W.children||[]),ee.return=z,z=ee;break e}else{c(z,k);break}else a(z,k);k=k.sibling}ee=df(W,z.mode,ee),ee.return=z,z=ee}return b(z);case le:return W=Ss(W),Ke(z,k,W,ee)}if(We(W))return he(z,k,W,ee);if(ve(W)){if(ye=ve(W),typeof ye!="function")throw Error(i(150));return W=ye.call(W),be(z,k,W,ee)}if(typeof W.then=="function")return Ke(z,k,bl(W),ee);if(W.$$typeof===O)return Ke(z,k,gl(z,W),ee);vl(z,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,k!==null&&k.tag===6?(c(z,k.sibling),ee=g(k,W),ee.return=z,z=ee):(c(z,k),ee=hf(W,z.mode,ee),ee.return=z,z=ee),b(z)):c(z,k)}return function(z,k,W,ee){try{Po=0;var ye=Ke(z,k,W,ee);return yr=null,ye}catch(ge){if(ge===_r||ge===_l)throw ge;var Fe=tn(29,ge,null,z.mode);return Fe.lanes=ee,Fe.return=z,Fe}}}var ws=h_(!0),d_=h_(!1),Ii=!1;function wf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ef(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Pi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ni(r,a,c){var h=r.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var g=h.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),h.pending=a,a=fl(r),Zm(r,null,c),a}return ul(r,h,a,c),fl(r)}function Do(r,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var h=a.lanes;h&=r.pendingLanes,c|=h,a.lanes=c,sm(r,c)}}function Cf(r,a){var c=r.updateQueue,h=r.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var g=null,m=null;if(c=c.firstBaseUpdate,c!==null){do{var b={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};m===null?g=m=b:m=m.next=b,c=c.next}while(c!==null);m===null?g=m=a:m=m.next=a}else g=m=a;c={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:h.shared,callbacks:h.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=a:r.next=a,c.lastBaseUpdate=a}var Rf=!1;function ko(){if(Rf){var r=mr;if(r!==null)throw r}}function Bo(r,a,c,h){Rf=!1;var g=r.updateQueue;Ii=!1;var m=g.firstBaseUpdate,b=g.lastBaseUpdate,x=g.shared.pending;if(x!==null){g.shared.pending=null;var N=x,$=N.next;N.next=null,b===null?m=$:b.next=$,b=N;var J=r.alternate;J!==null&&(J=J.updateQueue,x=J.lastBaseUpdate,x!==b&&(x===null?J.firstBaseUpdate=$:x.next=$,J.lastBaseUpdate=N))}if(m!==null){var ne=g.baseState;b=0,J=$=N=null,x=m;do{var q=x.lane&-536870913,Z=q!==x.lane;if(Z?(Ne&q)===q:(h&q)===q){q!==0&&q===gr&&(Rf=!0),J!==null&&(J=J.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var he=r,be=x;q=a;var Ke=c;switch(be.tag){case 1:if(he=be.payload,typeof he=="function"){ne=he.call(Ke,ne,q);break e}ne=he;break e;case 3:he.flags=he.flags&-65537|128;case 0:if(he=be.payload,q=typeof he=="function"?he.call(Ke,ne,q):he,q==null)break e;ne=_({},ne,q);break e;case 2:Ii=!0}}q=x.callback,q!==null&&(r.flags|=64,Z&&(r.flags|=8192),Z=g.callbacks,Z===null?g.callbacks=[q]:Z.push(q))}else Z={lane:q,tag:x.tag,payload:x.payload,callback:x.callback,next:null},J===null?($=J=Z,N=ne):J=J.next=Z,b|=q;if(x=x.next,x===null){if(x=g.shared.pending,x===null)break;Z=x,x=Z.next,Z.next=null,g.lastBaseUpdate=Z,g.shared.pending=null}}while(!0);J===null&&(N=ne),g.baseState=N,g.firstBaseUpdate=$,g.lastBaseUpdate=J,m===null&&(g.shared.lanes=0),Ui|=b,r.lanes=b,r.memoizedState=ne}}function p_(r,a){if(typeof r!="function")throw Error(i(191,r));r.call(a)}function g_(r,a){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)p_(c[r],a)}var br=E(null),Tl=E(0);function m_(r,a){r=fi,K(Tl,r),K(br,a),fi=r|a.baseLanes}function Mf(){K(Tl,fi),K(br,br.current)}function Of(){fi=Tl.current,D(br),D(Tl)}var nn=E(null),bn=null;function Di(r){var a=r.alternate;K(ut,ut.current&1),K(nn,r),bn===null&&(a===null||br.current!==null||a.memoizedState!==null)&&(bn=r)}function If(r){K(ut,ut.current),K(nn,r),bn===null&&(bn=r)}function __(r){r.tag===22?(K(ut,ut.current),K(nn,r),bn===null&&(bn=r)):ki()}function ki(){K(ut,ut.current),K(nn,nn.current)}function sn(r){D(nn),bn===r&&(bn=null),D(ut)}var ut=E(0);function xl(r){for(var a=r;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Lh(c)||Uh(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ii=0,Ee=null,qe=null,dt=null,Sl=!1,vr=!1,Es=!1,Al=0,Lo=0,Tr=null,dS=0;function ot(){throw Error(i(321))}function Pf(r,a){if(a===null)return!1;for(var c=0;c<a.length&&c<r.length;c++)if(!en(r[c],a[c]))return!1;return!0}function Nf(r,a,c,h,g,m){return ii=m,Ee=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,S.H=r===null||r.memoizedState===null?ey:Yf,Es=!1,m=c(h,g),Es=!1,vr&&(m=b_(a,c,h,g)),y_(r),m}function y_(r){S.H=zo;var a=qe!==null&&qe.next!==null;if(ii=0,dt=qe=Ee=null,Sl=!1,Lo=0,Tr=null,a)throw Error(i(300));r===null||pt||(r=r.dependencies,r!==null&&pl(r)&&(pt=!0))}function b_(r,a,c,h){Ee=r;var g=0;do{if(vr&&(Tr=null),Lo=0,vr=!1,25<=g)throw Error(i(301));if(g+=1,dt=qe=null,r.updateQueue!=null){var m=r.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}S.H=ty,m=a(c,h)}while(vr);return m}function pS(){var r=S.H,a=r.useState()[0];return a=typeof a.then=="function"?Uo(a):a,r=r.useState()[0],(qe!==null?qe.memoizedState:null)!==r&&(Ee.flags|=1024),a}function Df(){var r=Al!==0;return Al=0,r}function kf(r,a,c){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~c}function Bf(r){if(Sl){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Sl=!1}ii=0,dt=qe=Ee=null,vr=!1,Lo=Al=0,Tr=null}function zt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dt===null?Ee.memoizedState=dt=r:dt=dt.next=r,dt}function ft(){if(qe===null){var r=Ee.alternate;r=r!==null?r.memoizedState:null}else r=qe.next;var a=dt===null?Ee.memoizedState:dt.next;if(a!==null)dt=a,qe=r;else{if(r===null)throw Ee.alternate===null?Error(i(467)):Error(i(310));qe=r,r={memoizedState:qe.memoizedState,baseState:qe.baseState,baseQueue:qe.baseQueue,queue:qe.queue,next:null},dt===null?Ee.memoizedState=dt=r:dt=dt.next=r}return dt}function wl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Uo(r){var a=Lo;return Lo+=1,Tr===null&&(Tr=[]),r=c_(Tr,r,a),a=Ee,(dt===null?a.memoizedState:dt.next)===null&&(a=a.alternate,S.H=a===null||a.memoizedState===null?ey:Yf),r}function El(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Uo(r);if(r.$$typeof===O)return Mt(r)}throw Error(i(438,String(r)))}function Lf(r){var a=null,c=Ee.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var h=Ee.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(a={data:h.data.map(function(g){return g.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=wl(),Ee.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(r),h=0;h<r;h++)c[h]=fe;return a.index++,c}function si(r,a){return typeof a=="function"?a(r):a}function Cl(r){var a=ft();return Uf(a,qe,r)}function Uf(r,a,c){var h=r.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=c;var g=r.baseQueue,m=h.pending;if(m!==null){if(g!==null){var b=g.next;g.next=m.next,m.next=b}a.baseQueue=g=m,h.pending=null}if(m=r.baseState,g===null)r.memoizedState=m;else{a=g.next;var x=b=null,N=null,$=a,J=!1;do{var ne=$.lane&-536870913;if(ne!==$.lane?(Ne&ne)===ne:(ii&ne)===ne){var q=$.revertLane;if(q===0)N!==null&&(N=N.next={lane:0,revertLane:0,gesture:null,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),ne===gr&&(J=!0);else if((ii&q)===q){$=$.next,q===gr&&(J=!0);continue}else ne={lane:0,revertLane:$.revertLane,gesture:null,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null},N===null?(x=N=ne,b=m):N=N.next=ne,Ee.lanes|=q,Ui|=q;ne=$.action,Es&&c(m,ne),m=$.hasEagerState?$.eagerState:c(m,ne)}else q={lane:ne,revertLane:$.revertLane,gesture:$.gesture,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null},N===null?(x=N=q,b=m):N=N.next=q,Ee.lanes|=ne,Ui|=ne;$=$.next}while($!==null&&$!==a);if(N===null?b=m:N.next=x,!en(m,r.memoizedState)&&(pt=!0,J&&(c=mr,c!==null)))throw c;r.memoizedState=m,r.baseState=b,r.baseQueue=N,h.lastRenderedState=m}return g===null&&(h.lanes=0),[r.memoizedState,h.dispatch]}function Ff(r){var a=ft(),c=a.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=r;var h=c.dispatch,g=c.pending,m=a.memoizedState;if(g!==null){c.pending=null;var b=g=g.next;do m=r(m,b.action),b=b.next;while(b!==g);en(m,a.memoizedState)||(pt=!0),a.memoizedState=m,a.baseQueue===null&&(a.baseState=m),c.lastRenderedState=m}return[m,h]}function v_(r,a,c){var h=Ee,g=ft(),m=ke;if(m){if(c===void 0)throw Error(i(407));c=c()}else c=a();var b=!en((qe||g).memoizedState,c);if(b&&(g.memoizedState=c,pt=!0),g=g.queue,Hf(S_.bind(null,h,g,r),[r]),g.getSnapshot!==a||b||dt!==null&&dt.memoizedState.tag&1){if(h.flags|=2048,xr(9,{destroy:void 0},x_.bind(null,h,g,c,a),null),Qe===null)throw Error(i(349));m||(ii&127)!==0||T_(h,a,c)}return c}function T_(r,a,c){r.flags|=16384,r={getSnapshot:a,value:c},a=Ee.updateQueue,a===null?(a=wl(),Ee.updateQueue=a,a.stores=[r]):(c=a.stores,c===null?a.stores=[r]:c.push(r))}function x_(r,a,c,h){a.value=c,a.getSnapshot=h,A_(a)&&w_(r)}function S_(r,a,c){return c(function(){A_(a)&&w_(r)})}function A_(r){var a=r.getSnapshot;r=r.value;try{var c=a();return!en(r,c)}catch{return!0}}function w_(r){var a=_s(r,2);a!==null&&Yt(a,r,2)}function zf(r){var a=zt();if(typeof r=="function"){var c=r;if(r=c(),Es){Ai(!0);try{c()}finally{Ai(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:r},a}function E_(r,a,c,h){return r.baseState=c,Uf(r,qe,typeof h=="function"?h:si)}function gS(r,a,c,h,g){if(Ol(r))throw Error(i(485));if(r=a.action,r!==null){var m={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){m.listeners.push(b)}};S.T!==null?c(!0):m.isTransition=!1,h(m),c=a.pending,c===null?(m.next=a.pending=m,C_(a,m)):(m.next=c.next,a.pending=c.next=m)}}function C_(r,a){var c=a.action,h=a.payload,g=r.state;if(a.isTransition){var m=S.T,b={};S.T=b;try{var x=c(g,h),N=S.S;N!==null&&N(b,x),R_(r,a,x)}catch($){Vf(r,a,$)}finally{m!==null&&b.types!==null&&(m.types=b.types),S.T=m}}else try{m=c(g,h),R_(r,a,m)}catch($){Vf(r,a,$)}}function R_(r,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(h){M_(r,a,h)},function(h){return Vf(r,a,h)}):M_(r,a,c)}function M_(r,a,c){a.status="fulfilled",a.value=c,O_(a),r.state=c,a=r.pending,a!==null&&(c=a.next,c===a?r.pending=null:(c=c.next,a.next=c,C_(r,c)))}function Vf(r,a,c){var h=r.pending;if(r.pending=null,h!==null){h=h.next;do a.status="rejected",a.reason=c,O_(a),a=a.next;while(a!==h)}r.action=null}function O_(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function I_(r,a){return a}function P_(r,a){if(ke){var c=Qe.formState;if(c!==null){e:{var h=Ee;if(ke){if(tt){t:{for(var g=tt,m=yn;g.nodeType!==8;){if(!m){g=null;break t}if(g=vn(g.nextSibling),g===null){g=null;break t}}m=g.data,g=m==="F!"||m==="F"?g:null}if(g){tt=vn(g.nextSibling),h=g.data==="F!";break e}}Mi(h)}h=!1}h&&(a=c[0])}}return c=zt(),c.memoizedState=c.baseState=a,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:I_,lastRenderedState:a},c.queue=h,c=G_.bind(null,Ee,h),h.dispatch=c,h=zf(!1),m=qf.bind(null,Ee,!1,h.queue),h=zt(),g={state:a,dispatch:null,action:r,pending:null},h.queue=g,c=gS.bind(null,Ee,g,m,c),g.dispatch=c,h.memoizedState=r,[a,c,!1]}function N_(r){var a=ft();return D_(a,qe,r)}function D_(r,a,c){if(a=Uf(r,a,I_)[0],r=Cl(si)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var h=Uo(a)}catch(b){throw b===_r?_l:b}else h=a;a=ft();var g=a.queue,m=g.dispatch;return c!==a.memoizedState&&(Ee.flags|=2048,xr(9,{destroy:void 0},mS.bind(null,g,c),null)),[h,m,r]}function mS(r,a){r.action=a}function k_(r){var a=ft(),c=qe;if(c!==null)return D_(a,c,r);ft(),a=a.memoizedState,c=ft();var h=c.queue.dispatch;return c.memoizedState=r,[a,h,!1]}function xr(r,a,c,h){return r={tag:r,create:c,deps:h,inst:a,next:null},a=Ee.updateQueue,a===null&&(a=wl(),Ee.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=r.next=r:(h=c.next,c.next=r,r.next=h,a.lastEffect=r),r}function B_(){return ft().memoizedState}function Rl(r,a,c,h){var g=zt();Ee.flags|=r,g.memoizedState=xr(1|a,{destroy:void 0},c,h===void 0?null:h)}function Ml(r,a,c,h){var g=ft();h=h===void 0?null:h;var m=g.memoizedState.inst;qe!==null&&h!==null&&Pf(h,qe.memoizedState.deps)?g.memoizedState=xr(a,m,c,h):(Ee.flags|=r,g.memoizedState=xr(1|a,m,c,h))}function L_(r,a){Rl(8390656,8,r,a)}function Hf(r,a){Ml(2048,8,r,a)}function _S(r){Ee.flags|=4;var a=Ee.updateQueue;if(a===null)a=wl(),Ee.updateQueue=a,a.events=[r];else{var c=a.events;c===null?a.events=[r]:c.push(r)}}function U_(r){var a=ft().memoizedState;return _S({ref:a,nextImpl:r}),function(){if((Ve&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function F_(r,a){return Ml(4,2,r,a)}function z_(r,a){return Ml(4,4,r,a)}function V_(r,a){if(typeof a=="function"){r=r();var c=a(r);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function H_(r,a,c){c=c!=null?c.concat([r]):null,Ml(4,4,V_.bind(null,a,r),c)}function jf(){}function j_(r,a){var c=ft();a=a===void 0?null:a;var h=c.memoizedState;return a!==null&&Pf(a,h[1])?h[0]:(c.memoizedState=[r,a],r)}function W_(r,a){var c=ft();a=a===void 0?null:a;var h=c.memoizedState;if(a!==null&&Pf(a,h[1]))return h[0];if(h=r(),Es){Ai(!0);try{r()}finally{Ai(!1)}}return c.memoizedState=[h,a],h}function Wf(r,a,c){return c===void 0||(ii&1073741824)!==0&&(Ne&261930)===0?r.memoizedState=a:(r.memoizedState=c,r=$y(),Ee.lanes|=r,Ui|=r,c)}function $_(r,a,c,h){return en(c,a)?c:br.current!==null?(r=Wf(r,c,h),en(r,a)||(pt=!0),r):(ii&42)===0||(ii&1073741824)!==0&&(Ne&261930)===0?(pt=!0,r.memoizedState=c):(r=$y(),Ee.lanes|=r,Ui|=r,a)}function X_(r,a,c,h,g){var m=I.p;I.p=m!==0&&8>m?m:8;var b=S.T,x={};S.T=x,qf(r,!1,a,c);try{var N=g(),$=S.S;if($!==null&&$(x,N),N!==null&&typeof N=="object"&&typeof N.then=="function"){var J=hS(N,h);Fo(r,a,J,an(r))}else Fo(r,a,h,an(r))}catch(ne){Fo(r,a,{then:function(){},status:"rejected",reason:ne},an())}finally{I.p=m,b!==null&&x.types!==null&&(b.types=x.types),S.T=b}}function yS(){}function $f(r,a,c,h){if(r.tag!==5)throw Error(i(476));var g=q_(r).queue;X_(r,g,a,P,c===null?yS:function(){return Y_(r),c(h)})}function q_(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:P},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:c},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function Y_(r){var a=q_(r);a.next===null&&(a=r.alternate.memoizedState),Fo(r,a.next.queue,{},an())}function Xf(){return Mt(na)}function K_(){return ft().memoizedState}function Z_(){return ft().memoizedState}function bS(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var c=an();r=Pi(c);var h=Ni(a,r,c);h!==null&&(Yt(h,a,c),Do(h,a,c)),a={cache:Tf()},r.payload=a;return}a=a.return}}function vS(r,a,c){var h=an();c={lane:h,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Ol(r)?Q_(a,c):(c=uf(r,a,c,h),c!==null&&(Yt(c,r,h),J_(c,a,h)))}function G_(r,a,c){var h=an();Fo(r,a,c,h)}function Fo(r,a,c,h){var g={lane:h,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ol(r))Q_(a,g);else{var m=r.alternate;if(r.lanes===0&&(m===null||m.lanes===0)&&(m=a.lastRenderedReducer,m!==null))try{var b=a.lastRenderedState,x=m(b,c);if(g.hasEagerState=!0,g.eagerState=x,en(x,b))return ul(r,a,g,0),Qe===null&&cl(),!1}catch{}if(c=uf(r,a,g,h),c!==null)return Yt(c,r,h),J_(c,a,h),!0}return!1}function qf(r,a,c,h){if(h={lane:2,revertLane:wh(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Ol(r)){if(a)throw Error(i(479))}else a=uf(r,c,h,2),a!==null&&Yt(a,r,2)}function Ol(r){var a=r.alternate;return r===Ee||a!==null&&a===Ee}function Q_(r,a){vr=Sl=!0;var c=r.pending;c===null?a.next=a:(a.next=c.next,c.next=a),r.pending=a}function J_(r,a,c){if((c&4194048)!==0){var h=a.lanes;h&=r.pendingLanes,c|=h,a.lanes=c,sm(r,c)}}var zo={readContext:Mt,use:El,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useLayoutEffect:ot,useInsertionEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useSyncExternalStore:ot,useId:ot,useHostTransitionStatus:ot,useFormState:ot,useActionState:ot,useOptimistic:ot,useMemoCache:ot,useCacheRefresh:ot};zo.useEffectEvent=ot;var ey={readContext:Mt,use:El,useCallback:function(r,a){return zt().memoizedState=[r,a===void 0?null:a],r},useContext:Mt,useEffect:L_,useImperativeHandle:function(r,a,c){c=c!=null?c.concat([r]):null,Rl(4194308,4,V_.bind(null,a,r),c)},useLayoutEffect:function(r,a){return Rl(4194308,4,r,a)},useInsertionEffect:function(r,a){Rl(4,2,r,a)},useMemo:function(r,a){var c=zt();a=a===void 0?null:a;var h=r();if(Es){Ai(!0);try{r()}finally{Ai(!1)}}return c.memoizedState=[h,a],h},useReducer:function(r,a,c){var h=zt();if(c!==void 0){var g=c(a);if(Es){Ai(!0);try{c(a)}finally{Ai(!1)}}}else g=a;return h.memoizedState=h.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},h.queue=r,r=r.dispatch=vS.bind(null,Ee,r),[h.memoizedState,r]},useRef:function(r){var a=zt();return r={current:r},a.memoizedState=r},useState:function(r){r=zf(r);var a=r.queue,c=G_.bind(null,Ee,a);return a.dispatch=c,[r.memoizedState,c]},useDebugValue:jf,useDeferredValue:function(r,a){var c=zt();return Wf(c,r,a)},useTransition:function(){var r=zf(!1);return r=X_.bind(null,Ee,r.queue,!0,!1),zt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,c){var h=Ee,g=zt();if(ke){if(c===void 0)throw Error(i(407));c=c()}else{if(c=a(),Qe===null)throw Error(i(349));(Ne&127)!==0||T_(h,a,c)}g.memoizedState=c;var m={value:c,getSnapshot:a};return g.queue=m,L_(S_.bind(null,h,m,r),[r]),h.flags|=2048,xr(9,{destroy:void 0},x_.bind(null,h,m,c,a),null),c},useId:function(){var r=zt(),a=Qe.identifierPrefix;if(ke){var c=zn,h=Fn;c=(h&~(1<<32-Jt(h)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Al++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=dS++,a="_"+a+"r_"+c.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:Xf,useFormState:P_,useActionState:P_,useOptimistic:function(r){var a=zt();a.memoizedState=a.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=qf.bind(null,Ee,!0,c),c.dispatch=a,[r,a]},useMemoCache:Lf,useCacheRefresh:function(){return zt().memoizedState=bS.bind(null,Ee)},useEffectEvent:function(r){var a=zt(),c={impl:r};return a.memoizedState=c,function(){if((Ve&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},Yf={readContext:Mt,use:El,useCallback:j_,useContext:Mt,useEffect:Hf,useImperativeHandle:H_,useInsertionEffect:F_,useLayoutEffect:z_,useMemo:W_,useReducer:Cl,useRef:B_,useState:function(){return Cl(si)},useDebugValue:jf,useDeferredValue:function(r,a){var c=ft();return $_(c,qe.memoizedState,r,a)},useTransition:function(){var r=Cl(si)[0],a=ft().memoizedState;return[typeof r=="boolean"?r:Uo(r),a]},useSyncExternalStore:v_,useId:K_,useHostTransitionStatus:Xf,useFormState:N_,useActionState:N_,useOptimistic:function(r,a){var c=ft();return E_(c,qe,r,a)},useMemoCache:Lf,useCacheRefresh:Z_};Yf.useEffectEvent=U_;var ty={readContext:Mt,use:El,useCallback:j_,useContext:Mt,useEffect:Hf,useImperativeHandle:H_,useInsertionEffect:F_,useLayoutEffect:z_,useMemo:W_,useReducer:Ff,useRef:B_,useState:function(){return Ff(si)},useDebugValue:jf,useDeferredValue:function(r,a){var c=ft();return qe===null?Wf(c,r,a):$_(c,qe.memoizedState,r,a)},useTransition:function(){var r=Ff(si)[0],a=ft().memoizedState;return[typeof r=="boolean"?r:Uo(r),a]},useSyncExternalStore:v_,useId:K_,useHostTransitionStatus:Xf,useFormState:k_,useActionState:k_,useOptimistic:function(r,a){var c=ft();return qe!==null?E_(c,qe,r,a):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Lf,useCacheRefresh:Z_};ty.useEffectEvent=U_;function Kf(r,a,c,h){a=r.memoizedState,c=c(h,a),c=c==null?a:_({},a,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Zf={enqueueSetState:function(r,a,c){r=r._reactInternals;var h=an(),g=Pi(h);g.payload=a,c!=null&&(g.callback=c),a=Ni(r,g,h),a!==null&&(Yt(a,r,h),Do(a,r,h))},enqueueReplaceState:function(r,a,c){r=r._reactInternals;var h=an(),g=Pi(h);g.tag=1,g.payload=a,c!=null&&(g.callback=c),a=Ni(r,g,h),a!==null&&(Yt(a,r,h),Do(a,r,h))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var c=an(),h=Pi(c);h.tag=2,a!=null&&(h.callback=a),a=Ni(r,h,c),a!==null&&(Yt(a,r,c),Do(a,r,c))}};function ny(r,a,c,h,g,m,b){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(h,m,b):a.prototype&&a.prototype.isPureReactComponent?!Eo(c,h)||!Eo(g,m):!0}function iy(r,a,c,h){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,h),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,h),a.state!==r&&Zf.enqueueReplaceState(a,a.state,null)}function Cs(r,a){var c=a;if("ref"in a){c={};for(var h in a)h!=="ref"&&(c[h]=a[h])}if(r=r.defaultProps){c===a&&(c=_({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}function sy(r){ll(r)}function ry(r){console.error(r)}function oy(r){ll(r)}function Il(r,a){try{var c=r.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(h){setTimeout(function(){throw h})}}function ay(r,a,c){try{var h=r.onCaughtError;h(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Gf(r,a,c){return c=Pi(c),c.tag=3,c.payload={element:null},c.callback=function(){Il(r,a)},c}function ly(r){return r=Pi(r),r.tag=3,r}function cy(r,a,c,h){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var m=h.value;r.payload=function(){return g(m)},r.callback=function(){ay(a,c,h)}}var b=c.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(r.callback=function(){ay(a,c,h),typeof g!="function"&&(Fi===null?Fi=new Set([this]):Fi.add(this));var x=h.stack;this.componentDidCatch(h.value,{componentStack:x!==null?x:""})})}function TS(r,a,c,h,g){if(c.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(a=c.alternate,a!==null&&pr(a,c,g,!0),c=nn.current,c!==null){switch(c.tag){case 31:case 13:return bn===null?jl():c.alternate===null&&at===0&&(at=3),c.flags&=-257,c.flags|=65536,c.lanes=g,h===yl?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([h]):a.add(h),xh(r,h,g)),!1;case 22:return c.flags|=65536,h===yl?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([h])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([h]):c.add(h)),xh(r,h,g)),!1}throw Error(i(435,c.tag))}return xh(r,h,g),jl(),!1}if(ke)return a=nn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=g,h!==mf&&(r=Error(i(422),{cause:h}),Mo(gn(r,c)))):(h!==mf&&(a=Error(i(423),{cause:h}),Mo(gn(a,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,h=gn(h,c),g=Gf(r.stateNode,h,g),Cf(r,g),at!==4&&(at=2)),!1;var m=Error(i(520),{cause:h});if(m=gn(m,c),Yo===null?Yo=[m]:Yo.push(m),at!==4&&(at=2),a===null)return!0;h=gn(h,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=Gf(c.stateNode,h,r),Cf(c,r),!1;case 1:if(a=c.type,m=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Fi===null||!Fi.has(m))))return c.flags|=65536,g&=-g,c.lanes|=g,g=ly(g),cy(g,r,c,h),Cf(c,g),!1}c=c.return}while(c!==null);return!1}var Qf=Error(i(461)),pt=!1;function Ot(r,a,c,h){a.child=r===null?d_(a,null,c,h):ws(a,r.child,c,h)}function uy(r,a,c,h,g){c=c.render;var m=a.ref;if("ref"in h){var b={};for(var x in h)x!=="ref"&&(b[x]=h[x])}else b=h;return Ts(a),h=Nf(r,a,c,b,m,g),x=Df(),r!==null&&!pt?(kf(r,a,g),ri(r,a,g)):(ke&&x&&pf(a),a.flags|=1,Ot(r,a,h,g),a.child)}function fy(r,a,c,h,g){if(r===null){var m=c.type;return typeof m=="function"&&!ff(m)&&m.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=m,hy(r,a,m,h,g)):(r=hl(c.type,null,h,a,a.mode,g),r.ref=a.ref,r.return=a,a.child=r)}if(m=r.child,!oh(r,g)){var b=m.memoizedProps;if(c=c.compare,c=c!==null?c:Eo,c(b,h)&&r.ref===a.ref)return ri(r,a,g)}return a.flags|=1,r=Jn(m,h),r.ref=a.ref,r.return=a,a.child=r}function hy(r,a,c,h,g){if(r!==null){var m=r.memoizedProps;if(Eo(m,h)&&r.ref===a.ref)if(pt=!1,a.pendingProps=h=m,oh(r,g))(r.flags&131072)!==0&&(pt=!0);else return a.lanes=r.lanes,ri(r,a,g)}return Jf(r,a,c,h,g)}function dy(r,a,c,h){var g=h.children,m=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((a.flags&128)!==0){if(m=m!==null?m.baseLanes|c:c,r!==null){for(h=a.child=r.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~m}else h=0,a.child=null;return py(r,a,m,c,h)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&ml(a,m!==null?m.cachePool:null),m!==null?m_(a,m):Mf(),__(a);else return h=a.lanes=536870912,py(r,a,m!==null?m.baseLanes|c:c,c,h)}else m!==null?(ml(a,m.cachePool),m_(a,m),ki(),a.memoizedState=null):(r!==null&&ml(a,null),Mf(),ki());return Ot(r,a,g,c),a.child}function Vo(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function py(r,a,c,h,g){var m=Sf();return m=m===null?null:{parent:ht._currentValue,pool:m},a.memoizedState={baseLanes:c,cachePool:m},r!==null&&ml(a,null),Mf(),__(a),r!==null&&pr(r,a,h,!0),a.childLanes=g,null}function Pl(r,a){return a=Dl({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function gy(r,a,c){return ws(a,r.child,null,c),r=Pl(a,a.pendingProps),r.flags|=2,sn(a),a.memoizedState=null,r}function xS(r,a,c){var h=a.pendingProps,g=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(ke){if(h.mode==="hidden")return r=Pl(a,h),a.lanes=536870912,Vo(null,r);if(If(a),(r=tt)?(r=C0(r,yn),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Ci!==null?{id:Fn,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},c=Qm(r),c.return=a,a.child=c,Rt=a,tt=null)):r=null,r===null)throw Mi(a);return a.lanes=536870912,null}return Pl(a,h)}var m=r.memoizedState;if(m!==null){var b=m.dehydrated;if(If(a),g)if(a.flags&256)a.flags&=-257,a=gy(r,a,c);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(i(558));else if(pt||pr(r,a,c,!1),g=(c&r.childLanes)!==0,pt||g){if(h=Qe,h!==null&&(b=rm(h,c),b!==0&&b!==m.retryLane))throw m.retryLane=b,_s(r,b),Yt(h,r,b),Qf;jl(),a=gy(r,a,c)}else r=m.treeContext,tt=vn(b.nextSibling),Rt=a,ke=!0,Ri=null,yn=!1,r!==null&&t_(a,r),a=Pl(a,h),a.flags|=4096;return a}return r=Jn(r.child,{mode:h.mode,children:h.children}),r.ref=a.ref,a.child=r,r.return=a,r}function Nl(r,a){var c=a.ref;if(c===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(r===null||r.ref!==c)&&(a.flags|=4194816)}}function Jf(r,a,c,h,g){return Ts(a),c=Nf(r,a,c,h,void 0,g),h=Df(),r!==null&&!pt?(kf(r,a,g),ri(r,a,g)):(ke&&h&&pf(a),a.flags|=1,Ot(r,a,c,g),a.child)}function my(r,a,c,h,g,m){return Ts(a),a.updateQueue=null,c=b_(a,h,c,g),y_(r),h=Df(),r!==null&&!pt?(kf(r,a,m),ri(r,a,m)):(ke&&h&&pf(a),a.flags|=1,Ot(r,a,c,m),a.child)}function _y(r,a,c,h,g){if(Ts(a),a.stateNode===null){var m=ur,b=c.contextType;typeof b=="object"&&b!==null&&(m=Mt(b)),m=new c(h,m),a.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Zf,a.stateNode=m,m._reactInternals=a,m=a.stateNode,m.props=h,m.state=a.memoizedState,m.refs={},wf(a),b=c.contextType,m.context=typeof b=="object"&&b!==null?Mt(b):ur,m.state=a.memoizedState,b=c.getDerivedStateFromProps,typeof b=="function"&&(Kf(a,c,b,h),m.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(b=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),b!==m.state&&Zf.enqueueReplaceState(m,m.state,null),Bo(a,h,m,g),ko(),m.state=a.memoizedState),typeof m.componentDidMount=="function"&&(a.flags|=4194308),h=!0}else if(r===null){m=a.stateNode;var x=a.memoizedProps,N=Cs(c,x);m.props=N;var $=m.context,J=c.contextType;b=ur,typeof J=="object"&&J!==null&&(b=Mt(J));var ne=c.getDerivedStateFromProps;J=typeof ne=="function"||typeof m.getSnapshotBeforeUpdate=="function",x=a.pendingProps!==x,J||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(x||$!==b)&&iy(a,m,h,b),Ii=!1;var q=a.memoizedState;m.state=q,Bo(a,h,m,g),ko(),$=a.memoizedState,x||q!==$||Ii?(typeof ne=="function"&&(Kf(a,c,ne,h),$=a.memoizedState),(N=Ii||ny(a,c,N,h,q,$,b))?(J||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(a.flags|=4194308)):(typeof m.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=h,a.memoizedState=$),m.props=h,m.state=$,m.context=b,h=N):(typeof m.componentDidMount=="function"&&(a.flags|=4194308),h=!1)}else{m=a.stateNode,Ef(r,a),b=a.memoizedProps,J=Cs(c,b),m.props=J,ne=a.pendingProps,q=m.context,$=c.contextType,N=ur,typeof $=="object"&&$!==null&&(N=Mt($)),x=c.getDerivedStateFromProps,($=typeof x=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(b!==ne||q!==N)&&iy(a,m,h,N),Ii=!1,q=a.memoizedState,m.state=q,Bo(a,h,m,g),ko();var Z=a.memoizedState;b!==ne||q!==Z||Ii||r!==null&&r.dependencies!==null&&pl(r.dependencies)?(typeof x=="function"&&(Kf(a,c,x,h),Z=a.memoizedState),(J=Ii||ny(a,c,J,h,q,Z,N)||r!==null&&r.dependencies!==null&&pl(r.dependencies))?($||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(h,Z,N),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(h,Z,N)),typeof m.componentDidUpdate=="function"&&(a.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof m.componentDidUpdate!="function"||b===r.memoizedProps&&q===r.memoizedState||(a.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&q===r.memoizedState||(a.flags|=1024),a.memoizedProps=h,a.memoizedState=Z),m.props=h,m.state=Z,m.context=N,h=J):(typeof m.componentDidUpdate!="function"||b===r.memoizedProps&&q===r.memoizedState||(a.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&q===r.memoizedState||(a.flags|=1024),h=!1)}return m=h,Nl(r,a),h=(a.flags&128)!==0,m||h?(m=a.stateNode,c=h&&typeof c.getDerivedStateFromError!="function"?null:m.render(),a.flags|=1,r!==null&&h?(a.child=ws(a,r.child,null,g),a.child=ws(a,null,c,g)):Ot(r,a,c,g),a.memoizedState=m.state,r=a.child):r=ri(r,a,g),r}function yy(r,a,c,h){return bs(),a.flags|=256,Ot(r,a,c,h),a.child}var eh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function th(r){return{baseLanes:r,cachePool:a_()}}function nh(r,a,c){return r=r!==null?r.childLanes&~c:0,a&&(r|=on),r}function by(r,a,c){var h=a.pendingProps,g=!1,m=(a.flags&128)!==0,b;if((b=m)||(b=r!==null&&r.memoizedState===null?!1:(ut.current&2)!==0),b&&(g=!0,a.flags&=-129),b=(a.flags&32)!==0,a.flags&=-33,r===null){if(ke){if(g?Di(a):ki(),(r=tt)?(r=C0(r,yn),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Ci!==null?{id:Fn,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},c=Qm(r),c.return=a,a.child=c,Rt=a,tt=null)):r=null,r===null)throw Mi(a);return Uh(r)?a.lanes=32:a.lanes=536870912,null}var x=h.children;return h=h.fallback,g?(ki(),g=a.mode,x=Dl({mode:"hidden",children:x},g),h=ys(h,g,c,null),x.return=a,h.return=a,x.sibling=h,a.child=x,h=a.child,h.memoizedState=th(c),h.childLanes=nh(r,b,c),a.memoizedState=eh,Vo(null,h)):(Di(a),ih(a,x))}var N=r.memoizedState;if(N!==null&&(x=N.dehydrated,x!==null)){if(m)a.flags&256?(Di(a),a.flags&=-257,a=sh(r,a,c)):a.memoizedState!==null?(ki(),a.child=r.child,a.flags|=128,a=null):(ki(),x=h.fallback,g=a.mode,h=Dl({mode:"visible",children:h.children},g),x=ys(x,g,c,null),x.flags|=2,h.return=a,x.return=a,h.sibling=x,a.child=h,ws(a,r.child,null,c),h=a.child,h.memoizedState=th(c),h.childLanes=nh(r,b,c),a.memoizedState=eh,a=Vo(null,h));else if(Di(a),Uh(x)){if(b=x.nextSibling&&x.nextSibling.dataset,b)var $=b.dgst;b=$,h=Error(i(419)),h.stack="",h.digest=b,Mo({value:h,source:null,stack:null}),a=sh(r,a,c)}else if(pt||pr(r,a,c,!1),b=(c&r.childLanes)!==0,pt||b){if(b=Qe,b!==null&&(h=rm(b,c),h!==0&&h!==N.retryLane))throw N.retryLane=h,_s(r,h),Yt(b,r,h),Qf;Lh(x)||jl(),a=sh(r,a,c)}else Lh(x)?(a.flags|=192,a.child=r.child,a=null):(r=N.treeContext,tt=vn(x.nextSibling),Rt=a,ke=!0,Ri=null,yn=!1,r!==null&&t_(a,r),a=ih(a,h.children),a.flags|=4096);return a}return g?(ki(),x=h.fallback,g=a.mode,N=r.child,$=N.sibling,h=Jn(N,{mode:"hidden",children:h.children}),h.subtreeFlags=N.subtreeFlags&65011712,$!==null?x=Jn($,x):(x=ys(x,g,c,null),x.flags|=2),x.return=a,h.return=a,h.sibling=x,a.child=h,Vo(null,h),h=a.child,x=r.child.memoizedState,x===null?x=th(c):(g=x.cachePool,g!==null?(N=ht._currentValue,g=g.parent!==N?{parent:N,pool:N}:g):g=a_(),x={baseLanes:x.baseLanes|c,cachePool:g}),h.memoizedState=x,h.childLanes=nh(r,b,c),a.memoizedState=eh,Vo(r.child,h)):(Di(a),c=r.child,r=c.sibling,c=Jn(c,{mode:"visible",children:h.children}),c.return=a,c.sibling=null,r!==null&&(b=a.deletions,b===null?(a.deletions=[r],a.flags|=16):b.push(r)),a.child=c,a.memoizedState=null,c)}function ih(r,a){return a=Dl({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function Dl(r,a){return r=tn(22,r,null,a),r.lanes=0,r}function sh(r,a,c){return ws(a,r.child,null,c),r=ih(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function vy(r,a,c){r.lanes|=a;var h=r.alternate;h!==null&&(h.lanes|=a),bf(r.return,a,c)}function rh(r,a,c,h,g,m){var b=r.memoizedState;b===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:g,treeForkCount:m}:(b.isBackwards=a,b.rendering=null,b.renderingStartTime=0,b.last=h,b.tail=c,b.tailMode=g,b.treeForkCount=m)}function Ty(r,a,c){var h=a.pendingProps,g=h.revealOrder,m=h.tail;h=h.children;var b=ut.current,x=(b&2)!==0;if(x?(b=b&1|2,a.flags|=128):b&=1,K(ut,b),Ot(r,a,h,c),h=ke?Ro:0,!x&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&vy(r,c,a);else if(r.tag===19)vy(r,c,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(g){case"forwards":for(c=a.child,g=null;c!==null;)r=c.alternate,r!==null&&xl(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=a.child,a.child=null):(g=c.sibling,c.sibling=null),rh(a,!1,g,c,m,h);break;case"backwards":case"unstable_legacy-backwards":for(c=null,g=a.child,a.child=null;g!==null;){if(r=g.alternate,r!==null&&xl(r)===null){a.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}rh(a,!0,c,null,m,h);break;case"together":rh(a,!1,null,null,void 0,h);break;default:a.memoizedState=null}return a.child}function ri(r,a,c){if(r!==null&&(a.dependencies=r.dependencies),Ui|=a.lanes,(c&a.childLanes)===0)if(r!==null){if(pr(r,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(i(153));if(a.child!==null){for(r=a.child,c=Jn(r,r.pendingProps),a.child=c,c.return=a;r.sibling!==null;)r=r.sibling,c=c.sibling=Jn(r,r.pendingProps),c.return=a;c.sibling=null}return a.child}function oh(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&pl(r)))}function SS(r,a,c){switch(a.tag){case 3:Se(a,a.stateNode.containerInfo),Oi(a,ht,r.memoizedState.cache),bs();break;case 27:case 5:Ue(a);break;case 4:Se(a,a.stateNode.containerInfo);break;case 10:Oi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,If(a),null;break;case 13:var h=a.memoizedState;if(h!==null)return h.dehydrated!==null?(Di(a),a.flags|=128,null):(c&a.child.childLanes)!==0?by(r,a,c):(Di(a),r=ri(r,a,c),r!==null?r.sibling:null);Di(a);break;case 19:var g=(r.flags&128)!==0;if(h=(c&a.childLanes)!==0,h||(pr(r,a,c,!1),h=(c&a.childLanes)!==0),g){if(h)return Ty(r,a,c);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),K(ut,ut.current),h)break;return null;case 22:return a.lanes=0,dy(r,a,c,a.pendingProps);case 24:Oi(a,ht,r.memoizedState.cache)}return ri(r,a,c)}function xy(r,a,c){if(r!==null)if(r.memoizedProps!==a.pendingProps)pt=!0;else{if(!oh(r,c)&&(a.flags&128)===0)return pt=!1,SS(r,a,c);pt=(r.flags&131072)!==0}else pt=!1,ke&&(a.flags&1048576)!==0&&e_(a,Ro,a.index);switch(a.lanes=0,a.tag){case 16:e:{var h=a.pendingProps;if(r=Ss(a.elementType),a.type=r,typeof r=="function")ff(r)?(h=Cs(r,h),a.tag=1,a=_y(null,a,r,h,c)):(a.tag=0,a=Jf(null,a,r,h,c));else{if(r!=null){var g=r.$$typeof;if(g===L){a.tag=11,a=uy(null,a,r,h,c);break e}else if(g===re){a.tag=14,a=fy(null,a,r,h,c);break e}}throw a=de(r)||r,Error(i(306,a,""))}}return a;case 0:return Jf(r,a,a.type,a.pendingProps,c);case 1:return h=a.type,g=Cs(h,a.pendingProps),_y(r,a,h,g,c);case 3:e:{if(Se(a,a.stateNode.containerInfo),r===null)throw Error(i(387));h=a.pendingProps;var m=a.memoizedState;g=m.element,Ef(r,a),Bo(a,h,null,c);var b=a.memoizedState;if(h=b.cache,Oi(a,ht,h),h!==m.cache&&vf(a,[ht],c,!0),ko(),h=b.element,m.isDehydrated)if(m={element:h,isDehydrated:!1,cache:b.cache},a.updateQueue.baseState=m,a.memoizedState=m,a.flags&256){a=yy(r,a,h,c);break e}else if(h!==g){g=gn(Error(i(424)),a),Mo(g),a=yy(r,a,h,c);break e}else for(r=a.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,tt=vn(r.firstChild),Rt=a,ke=!0,Ri=null,yn=!0,c=d_(a,null,h,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(bs(),h===g){a=ri(r,a,c);break e}Ot(r,a,h,c)}a=a.child}return a;case 26:return Nl(r,a),r===null?(c=N0(a.type,null,a.pendingProps,null))?a.memoizedState=c:ke||(c=a.type,r=a.pendingProps,h=Zl(pe.current).createElement(c),h[Ct]=a,h[Ht]=r,It(h,c,r),St(h),a.stateNode=h):a.memoizedState=N0(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return Ue(a),r===null&&ke&&(h=a.stateNode=O0(a.type,a.pendingProps,pe.current),Rt=a,yn=!0,g=tt,ji(a.type)?(Fh=g,tt=vn(h.firstChild)):tt=g),Ot(r,a,a.pendingProps.children,c),Nl(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&ke&&((g=h=tt)&&(h=JS(h,a.type,a.pendingProps,yn),h!==null?(a.stateNode=h,Rt=a,tt=vn(h.firstChild),yn=!1,g=!0):g=!1),g||Mi(a)),Ue(a),g=a.type,m=a.pendingProps,b=r!==null?r.memoizedProps:null,h=m.children,Dh(g,m)?h=null:b!==null&&Dh(g,b)&&(a.flags|=32),a.memoizedState!==null&&(g=Nf(r,a,pS,null,null,c),na._currentValue=g),Nl(r,a),Ot(r,a,h,c),a.child;case 6:return r===null&&ke&&((r=c=tt)&&(c=eA(c,a.pendingProps,yn),c!==null?(a.stateNode=c,Rt=a,tt=null,r=!0):r=!1),r||Mi(a)),null;case 13:return by(r,a,c);case 4:return Se(a,a.stateNode.containerInfo),h=a.pendingProps,r===null?a.child=ws(a,null,h,c):Ot(r,a,h,c),a.child;case 11:return uy(r,a,a.type,a.pendingProps,c);case 7:return Ot(r,a,a.pendingProps,c),a.child;case 8:return Ot(r,a,a.pendingProps.children,c),a.child;case 12:return Ot(r,a,a.pendingProps.children,c),a.child;case 10:return h=a.pendingProps,Oi(a,a.type,h.value),Ot(r,a,h.children,c),a.child;case 9:return g=a.type._context,h=a.pendingProps.children,Ts(a),g=Mt(g),h=h(g),a.flags|=1,Ot(r,a,h,c),a.child;case 14:return fy(r,a,a.type,a.pendingProps,c);case 15:return hy(r,a,a.type,a.pendingProps,c);case 19:return Ty(r,a,c);case 31:return xS(r,a,c);case 22:return dy(r,a,c,a.pendingProps);case 24:return Ts(a),h=Mt(ht),r===null?(g=Sf(),g===null&&(g=Qe,m=Tf(),g.pooledCache=m,m.refCount++,m!==null&&(g.pooledCacheLanes|=c),g=m),a.memoizedState={parent:h,cache:g},wf(a),Oi(a,ht,g)):((r.lanes&c)!==0&&(Ef(r,a),Bo(a,null,null,c),ko()),g=r.memoizedState,m=a.memoizedState,g.parent!==h?(g={parent:h,cache:h},a.memoizedState=g,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=g),Oi(a,ht,h)):(h=m.cache,Oi(a,ht,h),h!==g.cache&&vf(a,[ht],c,!0))),Ot(r,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function oi(r){r.flags|=4}function ah(r,a,c,h,g){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(g&335544128)===g)if(r.stateNode.complete)r.flags|=8192;else if(Ky())r.flags|=8192;else throw As=yl,Af}else r.flags&=-16777217}function Sy(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!U0(a))if(Ky())r.flags|=8192;else throw As=yl,Af}function kl(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?nm():536870912,r.lanes|=a,Er|=a)}function Ho(r,a){if(!ke)switch(r.tailMode){case"hidden":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:h.sibling=null}}function nt(r){var a=r.alternate!==null&&r.alternate.child===r.child,c=0,h=0;if(a)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=h,r.childLanes=c,a}function AS(r,a,c){var h=a.pendingProps;switch(gf(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nt(a),null;case 1:return nt(a),null;case 3:return c=a.stateNode,h=null,r!==null&&(h=r.memoizedState.cache),a.memoizedState.cache!==h&&(a.flags|=2048),ni(ht),Oe(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(dr(a)?oi(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,_f())),nt(a),null;case 26:var g=a.type,m=a.memoizedState;return r===null?(oi(a),m!==null?(nt(a),Sy(a,m)):(nt(a),ah(a,g,null,h,c))):m?m!==r.memoizedState?(oi(a),nt(a),Sy(a,m)):(nt(a),a.flags&=-16777217):(r=r.memoizedProps,r!==h&&oi(a),nt(a),ah(a,g,r,h,c)),null;case 27:if(Ln(a),c=pe.current,g=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==h&&oi(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return nt(a),null}r=se.current,dr(a)?n_(a):(r=O0(g,h,c),a.stateNode=r,oi(a))}return nt(a),null;case 5:if(Ln(a),g=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==h&&oi(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return nt(a),null}if(m=se.current,dr(a))n_(a);else{var b=Zl(pe.current);switch(m){case 1:m=b.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:m=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":m=b.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":m=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":m=b.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild);break;case"select":m=typeof h.is=="string"?b.createElement("select",{is:h.is}):b.createElement("select"),h.multiple?m.multiple=!0:h.size&&(m.size=h.size);break;default:m=typeof h.is=="string"?b.createElement(g,{is:h.is}):b.createElement(g)}}m[Ct]=a,m[Ht]=h;e:for(b=a.child;b!==null;){if(b.tag===5||b.tag===6)m.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===a)break e;for(;b.sibling===null;){if(b.return===null||b.return===a)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}a.stateNode=m;e:switch(It(m,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&oi(a)}}return nt(a),ah(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,c),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==h&&oi(a);else{if(typeof h!="string"&&a.stateNode===null)throw Error(i(166));if(r=pe.current,dr(a)){if(r=a.stateNode,c=a.memoizedProps,h=null,g=Rt,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}r[Ct]=a,r=!!(r.nodeValue===c||h!==null&&h.suppressHydrationWarning===!0||b0(r.nodeValue,c)),r||Mi(a,!0)}else r=Zl(r).createTextNode(h),r[Ct]=a,a.stateNode=r}return nt(a),null;case 31:if(c=a.memoizedState,r===null||r.memoizedState!==null){if(h=dr(a),c!==null){if(r===null){if(!h)throw Error(i(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[Ct]=a}else bs(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;nt(a),r=!1}else c=_f(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return a.flags&256?(sn(a),a):(sn(a),null);if((a.flags&128)!==0)throw Error(i(558))}return nt(a),null;case 13:if(h=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=dr(a),h!==null&&h.dehydrated!==null){if(r===null){if(!g)throw Error(i(318));if(g=a.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Ct]=a}else bs(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;nt(a),g=!1}else g=_f(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return a.flags&256?(sn(a),a):(sn(a),null)}return sn(a),(a.flags&128)!==0?(a.lanes=c,a):(c=h!==null,r=r!==null&&r.memoizedState!==null,c&&(h=a.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),m=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(m=h.memoizedState.cachePool.pool),m!==g&&(h.flags|=2048)),c!==r&&c&&(a.child.flags|=8192),kl(a,a.updateQueue),nt(a),null);case 4:return Oe(),r===null&&Mh(a.stateNode.containerInfo),nt(a),null;case 10:return ni(a.type),nt(a),null;case 19:if(D(ut),h=a.memoizedState,h===null)return nt(a),null;if(g=(a.flags&128)!==0,m=h.rendering,m===null)if(g)Ho(h,!1);else{if(at!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(m=xl(r),m!==null){for(a.flags|=128,Ho(h,!1),r=m.updateQueue,a.updateQueue=r,kl(a,r),a.subtreeFlags=0,r=c,c=a.child;c!==null;)Gm(c,r),c=c.sibling;return K(ut,ut.current&1|2),ke&&ei(a,h.treeForkCount),a.child}r=r.sibling}h.tail!==null&&Gt()>zl&&(a.flags|=128,g=!0,Ho(h,!1),a.lanes=4194304)}else{if(!g)if(r=xl(m),r!==null){if(a.flags|=128,g=!0,r=r.updateQueue,a.updateQueue=r,kl(a,r),Ho(h,!0),h.tail===null&&h.tailMode==="hidden"&&!m.alternate&&!ke)return nt(a),null}else 2*Gt()-h.renderingStartTime>zl&&c!==536870912&&(a.flags|=128,g=!0,Ho(h,!1),a.lanes=4194304);h.isBackwards?(m.sibling=a.child,a.child=m):(r=h.last,r!==null?r.sibling=m:a.child=m,h.last=m)}return h.tail!==null?(r=h.tail,h.rendering=r,h.tail=r.sibling,h.renderingStartTime=Gt(),r.sibling=null,c=ut.current,K(ut,g?c&1|2:c&1),ke&&ei(a,h.treeForkCount),r):(nt(a),null);case 22:case 23:return sn(a),Of(),h=a.memoizedState!==null,r!==null?r.memoizedState!==null!==h&&(a.flags|=8192):h&&(a.flags|=8192),h?(c&536870912)!==0&&(a.flags&128)===0&&(nt(a),a.subtreeFlags&6&&(a.flags|=8192)):nt(a),c=a.updateQueue,c!==null&&kl(a,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),h=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),h!==c&&(a.flags|=2048),r!==null&&D(xs),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ni(ht),nt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function wS(r,a){switch(gf(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return ni(ht),Oe(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return Ln(a),null;case 31:if(a.memoizedState!==null){if(sn(a),a.alternate===null)throw Error(i(340));bs()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(sn(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(i(340));bs()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return D(ut),null;case 4:return Oe(),null;case 10:return ni(a.type),null;case 22:case 23:return sn(a),Of(),r!==null&&D(xs),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return ni(ht),null;case 25:return null;default:return null}}function Ay(r,a){switch(gf(a),a.tag){case 3:ni(ht),Oe();break;case 26:case 27:case 5:Ln(a);break;case 4:Oe();break;case 31:a.memoizedState!==null&&sn(a);break;case 13:sn(a);break;case 19:D(ut);break;case 10:ni(a.type);break;case 22:case 23:sn(a),Of(),r!==null&&D(xs);break;case 24:ni(ht)}}function jo(r,a){try{var c=a.updateQueue,h=c!==null?c.lastEffect:null;if(h!==null){var g=h.next;c=g;do{if((c.tag&r)===r){h=void 0;var m=c.create,b=c.inst;h=m(),b.destroy=h}c=c.next}while(c!==g)}}catch(x){Xe(a,a.return,x)}}function Bi(r,a,c){try{var h=a.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var m=g.next;h=m;do{if((h.tag&r)===r){var b=h.inst,x=b.destroy;if(x!==void 0){b.destroy=void 0,g=a;var N=c,$=x;try{$()}catch(J){Xe(g,N,J)}}}h=h.next}while(h!==m)}}catch(J){Xe(a,a.return,J)}}function wy(r){var a=r.updateQueue;if(a!==null){var c=r.stateNode;try{g_(a,c)}catch(h){Xe(r,r.return,h)}}}function Ey(r,a,c){c.props=Cs(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(h){Xe(r,a,h)}}function Wo(r,a){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var h=r.stateNode;break;case 30:h=r.stateNode;break;default:h=r.stateNode}typeof c=="function"?r.refCleanup=c(h):c.current=h}}catch(g){Xe(r,a,g)}}function Vn(r,a){var c=r.ref,h=r.refCleanup;if(c!==null)if(typeof h=="function")try{h()}catch(g){Xe(r,a,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Xe(r,a,g)}else c.current=null}function Cy(r){var a=r.type,c=r.memoizedProps,h=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&h.focus();break e;case"img":c.src?h.src=c.src:c.srcSet&&(h.srcset=c.srcSet)}}catch(g){Xe(r,r.return,g)}}function lh(r,a,c){try{var h=r.stateNode;qS(h,r.type,c,a),h[Ht]=a}catch(g){Xe(r,r.return,g)}}function Ry(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&ji(r.type)||r.tag===4}function ch(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Ry(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&ji(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function uh(r,a,c){var h=r.tag;if(h===5||h===6)r=r.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(r),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Gn));else if(h!==4&&(h===27&&ji(r.type)&&(c=r.stateNode,a=null),r=r.child,r!==null))for(uh(r,a,c),r=r.sibling;r!==null;)uh(r,a,c),r=r.sibling}function Bl(r,a,c){var h=r.tag;if(h===5||h===6)r=r.stateNode,a?c.insertBefore(r,a):c.appendChild(r);else if(h!==4&&(h===27&&ji(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Bl(r,a,c),r=r.sibling;r!==null;)Bl(r,a,c),r=r.sibling}function My(r){var a=r.stateNode,c=r.memoizedProps;try{for(var h=r.type,g=a.attributes;g.length;)a.removeAttributeNode(g[0]);It(a,h,c),a[Ct]=r,a[Ht]=c}catch(m){Xe(r,r.return,m)}}var ai=!1,gt=!1,fh=!1,Oy=typeof WeakSet=="function"?WeakSet:Set,At=null;function ES(r,a){if(r=r.containerInfo,Ph=ic,r=Hm(r),sf(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var g=h.anchorOffset,m=h.focusNode;h=h.focusOffset;try{c.nodeType,m.nodeType}catch{c=null;break e}var b=0,x=-1,N=-1,$=0,J=0,ne=r,q=null;t:for(;;){for(var Z;ne!==c||g!==0&&ne.nodeType!==3||(x=b+g),ne!==m||h!==0&&ne.nodeType!==3||(N=b+h),ne.nodeType===3&&(b+=ne.nodeValue.length),(Z=ne.firstChild)!==null;)q=ne,ne=Z;for(;;){if(ne===r)break t;if(q===c&&++$===g&&(x=b),q===m&&++J===h&&(N=b),(Z=ne.nextSibling)!==null)break;ne=q,q=ne.parentNode}ne=Z}c=x===-1||N===-1?null:{start:x,end:N}}else c=null}c=c||{start:0,end:0}}else c=null;for(Nh={focusedElem:r,selectionRange:c},ic=!1,At=a;At!==null;)if(a=At,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,At=r;else for(;At!==null;){switch(a=At,m=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)g=r[c],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&m!==null){r=void 0,c=a,g=m.memoizedProps,m=m.memoizedState,h=c.stateNode;try{var he=Cs(c.type,g);r=h.getSnapshotBeforeUpdate(he,m),h.__reactInternalSnapshotBeforeUpdate=r}catch(be){Xe(c,c.return,be)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,c=r.nodeType,c===9)Bh(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Bh(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=a.sibling,r!==null){r.return=a.return,At=r;break}At=a.return}}function Iy(r,a,c){var h=c.flags;switch(c.tag){case 0:case 11:case 15:ci(r,c),h&4&&jo(5,c);break;case 1:if(ci(r,c),h&4)if(r=c.stateNode,a===null)try{r.componentDidMount()}catch(b){Xe(c,c.return,b)}else{var g=Cs(c.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(g,a,r.__reactInternalSnapshotBeforeUpdate)}catch(b){Xe(c,c.return,b)}}h&64&&wy(c),h&512&&Wo(c,c.return);break;case 3:if(ci(r,c),h&64&&(r=c.updateQueue,r!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{g_(r,a)}catch(b){Xe(c,c.return,b)}}break;case 27:a===null&&h&4&&My(c);case 26:case 5:ci(r,c),a===null&&h&4&&Cy(c),h&512&&Wo(c,c.return);break;case 12:ci(r,c);break;case 31:ci(r,c),h&4&&Dy(r,c);break;case 13:ci(r,c),h&4&&ky(r,c),h&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=kS.bind(null,c),tA(r,c))));break;case 22:if(h=c.memoizedState!==null||ai,!h){a=a!==null&&a.memoizedState!==null||gt,g=ai;var m=gt;ai=h,(gt=a)&&!m?ui(r,c,(c.subtreeFlags&8772)!==0):ci(r,c),ai=g,gt=m}break;case 30:break;default:ci(r,c)}}function Py(r){var a=r.alternate;a!==null&&(r.alternate=null,Py(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&zu(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var it=null,Wt=!1;function li(r,a,c){for(c=c.child;c!==null;)Ny(r,a,c),c=c.sibling}function Ny(r,a,c){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(po,c)}catch{}switch(c.tag){case 26:gt||Vn(c,a),li(r,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:gt||Vn(c,a);var h=it,g=Wt;ji(c.type)&&(it=c.stateNode,Wt=!1),li(r,a,c),Jo(c.stateNode),it=h,Wt=g;break;case 5:gt||Vn(c,a);case 6:if(h=it,g=Wt,it=null,li(r,a,c),it=h,Wt=g,it!==null)if(Wt)try{(it.nodeType===9?it.body:it.nodeName==="HTML"?it.ownerDocument.body:it).removeChild(c.stateNode)}catch(m){Xe(c,a,m)}else try{it.removeChild(c.stateNode)}catch(m){Xe(c,a,m)}break;case 18:it!==null&&(Wt?(r=it,w0(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),Dr(r)):w0(it,c.stateNode));break;case 4:h=it,g=Wt,it=c.stateNode.containerInfo,Wt=!0,li(r,a,c),it=h,Wt=g;break;case 0:case 11:case 14:case 15:Bi(2,c,a),gt||Bi(4,c,a),li(r,a,c);break;case 1:gt||(Vn(c,a),h=c.stateNode,typeof h.componentWillUnmount=="function"&&Ey(c,a,h)),li(r,a,c);break;case 21:li(r,a,c);break;case 22:gt=(h=gt)||c.memoizedState!==null,li(r,a,c),gt=h;break;default:li(r,a,c)}}function Dy(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Dr(r)}catch(c){Xe(a,a.return,c)}}}function ky(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Dr(r)}catch(c){Xe(a,a.return,c)}}function CS(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new Oy),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new Oy),a;default:throw Error(i(435,r.tag))}}function Ll(r,a){var c=CS(r);a.forEach(function(h){if(!c.has(h)){c.add(h);var g=BS.bind(null,r,h);h.then(g,g)}})}function $t(r,a){var c=a.deletions;if(c!==null)for(var h=0;h<c.length;h++){var g=c[h],m=r,b=a,x=b;e:for(;x!==null;){switch(x.tag){case 27:if(ji(x.type)){it=x.stateNode,Wt=!1;break e}break;case 5:it=x.stateNode,Wt=!1;break e;case 3:case 4:it=x.stateNode.containerInfo,Wt=!0;break e}x=x.return}if(it===null)throw Error(i(160));Ny(m,b,g),it=null,Wt=!1,m=g.alternate,m!==null&&(m.return=null),g.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)By(a,r),a=a.sibling}var Rn=null;function By(r,a){var c=r.alternate,h=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:$t(a,r),Xt(r),h&4&&(Bi(3,r,r.return),jo(3,r),Bi(5,r,r.return));break;case 1:$t(a,r),Xt(r),h&512&&(gt||c===null||Vn(c,c.return)),h&64&&ai&&(r=r.updateQueue,r!==null&&(h=r.callbacks,h!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?h:c.concat(h))));break;case 26:var g=Rn;if($t(a,r),Xt(r),h&512&&(gt||c===null||Vn(c,c.return)),h&4){var m=c!==null?c.memoizedState:null;if(h=r.memoizedState,c===null)if(h===null)if(r.stateNode===null){e:{h=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":m=g.getElementsByTagName("title")[0],(!m||m[_o]||m[Ct]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=g.createElement(h),g.head.insertBefore(m,g.querySelector("head > title"))),It(m,h,c),m[Ct]=r,St(m),h=m;break e;case"link":var b=B0("link","href",g).get(h+(c.href||""));if(b){for(var x=0;x<b.length;x++)if(m=b[x],m.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&m.getAttribute("rel")===(c.rel==null?null:c.rel)&&m.getAttribute("title")===(c.title==null?null:c.title)&&m.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){b.splice(x,1);break t}}m=g.createElement(h),It(m,h,c),g.head.appendChild(m);break;case"meta":if(b=B0("meta","content",g).get(h+(c.content||""))){for(x=0;x<b.length;x++)if(m=b[x],m.getAttribute("content")===(c.content==null?null:""+c.content)&&m.getAttribute("name")===(c.name==null?null:c.name)&&m.getAttribute("property")===(c.property==null?null:c.property)&&m.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&m.getAttribute("charset")===(c.charSet==null?null:c.charSet)){b.splice(x,1);break t}}m=g.createElement(h),It(m,h,c),g.head.appendChild(m);break;default:throw Error(i(468,h))}m[Ct]=r,St(m),h=m}r.stateNode=h}else L0(g,r.type,r.stateNode);else r.stateNode=k0(g,h,r.memoizedProps);else m!==h?(m===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):m.count--,h===null?L0(g,r.type,r.stateNode):k0(g,h,r.memoizedProps)):h===null&&r.stateNode!==null&&lh(r,r.memoizedProps,c.memoizedProps)}break;case 27:$t(a,r),Xt(r),h&512&&(gt||c===null||Vn(c,c.return)),c!==null&&h&4&&lh(r,r.memoizedProps,c.memoizedProps);break;case 5:if($t(a,r),Xt(r),h&512&&(gt||c===null||Vn(c,c.return)),r.flags&32){g=r.stateNode;try{ir(g,"")}catch(he){Xe(r,r.return,he)}}h&4&&r.stateNode!=null&&(g=r.memoizedProps,lh(r,g,c!==null?c.memoizedProps:g)),h&1024&&(fh=!0);break;case 6:if($t(a,r),Xt(r),h&4){if(r.stateNode===null)throw Error(i(162));h=r.memoizedProps,c=r.stateNode;try{c.nodeValue=h}catch(he){Xe(r,r.return,he)}}break;case 3:if(Jl=null,g=Rn,Rn=Gl(a.containerInfo),$t(a,r),Rn=g,Xt(r),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Dr(a.containerInfo)}catch(he){Xe(r,r.return,he)}fh&&(fh=!1,Ly(r));break;case 4:h=Rn,Rn=Gl(r.stateNode.containerInfo),$t(a,r),Xt(r),Rn=h;break;case 12:$t(a,r),Xt(r);break;case 31:$t(a,r),Xt(r),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,Ll(r,h)));break;case 13:$t(a,r),Xt(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Fl=Gt()),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,Ll(r,h)));break;case 22:g=r.memoizedState!==null;var N=c!==null&&c.memoizedState!==null,$=ai,J=gt;if(ai=$||g,gt=J||N,$t(a,r),gt=J,ai=$,Xt(r),h&8192)e:for(a=r.stateNode,a._visibility=g?a._visibility&-2:a._visibility|1,g&&(c===null||N||ai||gt||Rs(r)),c=null,a=r;;){if(a.tag===5||a.tag===26){if(c===null){N=c=a;try{if(m=N.stateNode,g)b=m.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{x=N.stateNode;var ne=N.memoizedProps.style,q=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;x.style.display=q==null||typeof q=="boolean"?"":(""+q).trim()}}catch(he){Xe(N,N.return,he)}}}else if(a.tag===6){if(c===null){N=a;try{N.stateNode.nodeValue=g?"":N.memoizedProps}catch(he){Xe(N,N.return,he)}}}else if(a.tag===18){if(c===null){N=a;try{var Z=N.stateNode;g?E0(Z,!0):E0(N.stateNode,!1)}catch(he){Xe(N,N.return,he)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}h&4&&(h=r.updateQueue,h!==null&&(c=h.retryQueue,c!==null&&(h.retryQueue=null,Ll(r,c))));break;case 19:$t(a,r),Xt(r),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,Ll(r,h)));break;case 30:break;case 21:break;default:$t(a,r),Xt(r)}}function Xt(r){var a=r.flags;if(a&2){try{for(var c,h=r.return;h!==null;){if(Ry(h)){c=h;break}h=h.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var g=c.stateNode,m=ch(r);Bl(r,m,g);break;case 5:var b=c.stateNode;c.flags&32&&(ir(b,""),c.flags&=-33);var x=ch(r);Bl(r,x,b);break;case 3:case 4:var N=c.stateNode.containerInfo,$=ch(r);uh(r,$,N);break;default:throw Error(i(161))}}catch(J){Xe(r,r.return,J)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function Ly(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;Ly(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function ci(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Iy(r,a.alternate,a),a=a.sibling}function Rs(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Bi(4,a,a.return),Rs(a);break;case 1:Vn(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Ey(a,a.return,c),Rs(a);break;case 27:Jo(a.stateNode);case 26:case 5:Vn(a,a.return),Rs(a);break;case 22:a.memoizedState===null&&Rs(a);break;case 30:Rs(a);break;default:Rs(a)}r=r.sibling}}function ui(r,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var h=a.alternate,g=r,m=a,b=m.flags;switch(m.tag){case 0:case 11:case 15:ui(g,m,c),jo(4,m);break;case 1:if(ui(g,m,c),h=m,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch($){Xe(h,h.return,$)}if(h=m,g=h.updateQueue,g!==null){var x=h.stateNode;try{var N=g.shared.hiddenCallbacks;if(N!==null)for(g.shared.hiddenCallbacks=null,g=0;g<N.length;g++)p_(N[g],x)}catch($){Xe(h,h.return,$)}}c&&b&64&&wy(m),Wo(m,m.return);break;case 27:My(m);case 26:case 5:ui(g,m,c),c&&h===null&&b&4&&Cy(m),Wo(m,m.return);break;case 12:ui(g,m,c);break;case 31:ui(g,m,c),c&&b&4&&Dy(g,m);break;case 13:ui(g,m,c),c&&b&4&&ky(g,m);break;case 22:m.memoizedState===null&&ui(g,m,c),Wo(m,m.return);break;case 30:break;default:ui(g,m,c)}a=a.sibling}}function hh(r,a){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&Oo(c))}function dh(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&Oo(r))}function Mn(r,a,c,h){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Uy(r,a,c,h),a=a.sibling}function Uy(r,a,c,h){var g=a.flags;switch(a.tag){case 0:case 11:case 15:Mn(r,a,c,h),g&2048&&jo(9,a);break;case 1:Mn(r,a,c,h);break;case 3:Mn(r,a,c,h),g&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&Oo(r)));break;case 12:if(g&2048){Mn(r,a,c,h),r=a.stateNode;try{var m=a.memoizedProps,b=m.id,x=m.onPostCommit;typeof x=="function"&&x(b,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(N){Xe(a,a.return,N)}}else Mn(r,a,c,h);break;case 31:Mn(r,a,c,h);break;case 13:Mn(r,a,c,h);break;case 23:break;case 22:m=a.stateNode,b=a.alternate,a.memoizedState!==null?m._visibility&2?Mn(r,a,c,h):$o(r,a):m._visibility&2?Mn(r,a,c,h):(m._visibility|=2,Sr(r,a,c,h,(a.subtreeFlags&10256)!==0||!1)),g&2048&&hh(b,a);break;case 24:Mn(r,a,c,h),g&2048&&dh(a.alternate,a);break;default:Mn(r,a,c,h)}}function Sr(r,a,c,h,g){for(g=g&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var m=r,b=a,x=c,N=h,$=b.flags;switch(b.tag){case 0:case 11:case 15:Sr(m,b,x,N,g),jo(8,b);break;case 23:break;case 22:var J=b.stateNode;b.memoizedState!==null?J._visibility&2?Sr(m,b,x,N,g):$o(m,b):(J._visibility|=2,Sr(m,b,x,N,g)),g&&$&2048&&hh(b.alternate,b);break;case 24:Sr(m,b,x,N,g),g&&$&2048&&dh(b.alternate,b);break;default:Sr(m,b,x,N,g)}a=a.sibling}}function $o(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=r,h=a,g=h.flags;switch(h.tag){case 22:$o(c,h),g&2048&&hh(h.alternate,h);break;case 24:$o(c,h),g&2048&&dh(h.alternate,h);break;default:$o(c,h)}a=a.sibling}}var Xo=8192;function Ar(r,a,c){if(r.subtreeFlags&Xo)for(r=r.child;r!==null;)Fy(r,a,c),r=r.sibling}function Fy(r,a,c){switch(r.tag){case 26:Ar(r,a,c),r.flags&Xo&&r.memoizedState!==null&&dA(c,Rn,r.memoizedState,r.memoizedProps);break;case 5:Ar(r,a,c);break;case 3:case 4:var h=Rn;Rn=Gl(r.stateNode.containerInfo),Ar(r,a,c),Rn=h;break;case 22:r.memoizedState===null&&(h=r.alternate,h!==null&&h.memoizedState!==null?(h=Xo,Xo=16777216,Ar(r,a,c),Xo=h):Ar(r,a,c));break;default:Ar(r,a,c)}}function zy(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function qo(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];At=h,Hy(h,r)}zy(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Vy(r),r=r.sibling}function Vy(r){switch(r.tag){case 0:case 11:case 15:qo(r),r.flags&2048&&Bi(9,r,r.return);break;case 3:qo(r);break;case 12:qo(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,Ul(r)):qo(r);break;default:qo(r)}}function Ul(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];At=h,Hy(h,r)}zy(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Bi(8,a,a.return),Ul(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Ul(a));break;default:Ul(a)}r=r.sibling}}function Hy(r,a){for(;At!==null;){var c=At;switch(c.tag){case 0:case 11:case 15:Bi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var h=c.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Oo(c.memoizedState.cache)}if(h=c.child,h!==null)h.return=c,At=h;else e:for(c=r;At!==null;){h=At;var g=h.sibling,m=h.return;if(Py(h),h===c){At=null;break e}if(g!==null){g.return=m,At=g;break e}At=m}}}var RS={getCacheForType:function(r){var a=Mt(ht),c=a.data.get(r);return c===void 0&&(c=r(),a.data.set(r,c)),c},cacheSignal:function(){return Mt(ht).controller.signal}},MS=typeof WeakMap=="function"?WeakMap:Map,Ve=0,Qe=null,Ie=null,Ne=0,$e=0,rn=null,Li=!1,wr=!1,ph=!1,fi=0,at=0,Ui=0,Ms=0,gh=0,on=0,Er=0,Yo=null,qt=null,mh=!1,Fl=0,jy=0,zl=1/0,Vl=null,Fi=null,bt=0,zi=null,Cr=null,hi=0,_h=0,yh=null,Wy=null,Ko=0,bh=null;function an(){return(Ve&2)!==0&&Ne!==0?Ne&-Ne:S.T!==null?wh():om()}function $y(){if(on===0)if((Ne&536870912)===0||ke){var r=Ka;Ka<<=1,(Ka&3932160)===0&&(Ka=262144),on=r}else on=536870912;return r=nn.current,r!==null&&(r.flags|=32),on}function Yt(r,a,c){(r===Qe&&($e===2||$e===9)||r.cancelPendingCommit!==null)&&(Rr(r,0),Vi(r,Ne,on,!1)),mo(r,c),((Ve&2)===0||r!==Qe)&&(r===Qe&&((Ve&2)===0&&(Ms|=c),at===4&&Vi(r,Ne,on,!1)),Hn(r))}function Xy(r,a,c){if((Ve&6)!==0)throw Error(i(327));var h=!c&&(a&127)===0&&(a&r.expiredLanes)===0||go(r,a),g=h?PS(r,a):Th(r,a,!0),m=h;do{if(g===0){wr&&!h&&Vi(r,a,0,!1);break}else{if(c=r.current.alternate,m&&!OS(c)){g=Th(r,a,!1),m=!1;continue}if(g===2){if(m=a,r.errorRecoveryDisabledLanes&m)var b=0;else b=r.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){a=b;e:{var x=r;g=Yo;var N=x.current.memoizedState.isDehydrated;if(N&&(Rr(x,b).flags|=256),b=Th(x,b,!1),b!==2){if(ph&&!N){x.errorRecoveryDisabledLanes|=m,Ms|=m,g=4;break e}m=qt,qt=g,m!==null&&(qt===null?qt=m:qt.push.apply(qt,m))}g=b}if(m=!1,g!==2)continue}}if(g===1){Rr(r,0),Vi(r,a,0,!0);break}e:{switch(h=r,m=g,m){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:Vi(h,a,on,!Li);break e;case 2:qt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(g=Fl+300-Gt(),10<g)){if(Vi(h,a,on,!Li),Ga(h,0,!0)!==0)break e;hi=a,h.timeoutHandle=S0(qy.bind(null,h,c,qt,Vl,mh,a,on,Ms,Er,Li,m,"Throttled",-0,0),g);break e}qy(h,c,qt,Vl,mh,a,on,Ms,Er,Li,m,null,-0,0)}}break}while(!0);Hn(r)}function qy(r,a,c,h,g,m,b,x,N,$,J,ne,q,Z){if(r.timeoutHandle=-1,ne=a.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Gn},Fy(a,m,ne);var he=(m&62914560)===m?Fl-Gt():(m&4194048)===m?jy-Gt():0;if(he=pA(ne,he),he!==null){hi=m,r.cancelPendingCommit=he(t0.bind(null,r,a,m,c,h,g,b,x,N,J,ne,null,q,Z)),Vi(r,m,b,!$);return}}t0(r,a,m,c,h,g,b,x,N)}function OS(r){for(var a=r;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var h=0;h<c.length;h++){var g=c[h],m=g.getSnapshot;g=g.value;try{if(!en(m(),g))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Vi(r,a,c,h){a&=~gh,a&=~Ms,r.suspendedLanes|=a,r.pingedLanes&=~a,h&&(r.warmLanes|=a),h=r.expirationTimes;for(var g=a;0<g;){var m=31-Jt(g),b=1<<m;h[m]=-1,g&=~b}c!==0&&im(r,c,a)}function Hl(){return(Ve&6)===0?(Zo(0),!1):!0}function vh(){if(Ie!==null){if($e===0)var r=Ie.return;else r=Ie,ti=vs=null,Bf(r),yr=null,Po=0,r=Ie;for(;r!==null;)Ay(r.alternate,r),r=r.return;Ie=null}}function Rr(r,a){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,ZS(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),hi=0,vh(),Qe=r,Ie=c=Jn(r.current,null),Ne=a,$e=0,rn=null,Li=!1,wr=go(r,a),ph=!1,Er=on=gh=Ms=Ui=at=0,qt=Yo=null,mh=!1,(a&8)!==0&&(a|=a&32);var h=r.entangledLanes;if(h!==0)for(r=r.entanglements,h&=a;0<h;){var g=31-Jt(h),m=1<<g;a|=r[g],h&=~m}return fi=a,cl(),c}function Yy(r,a){Ee=null,S.H=zo,a===_r||a===_l?(a=u_(),$e=3):a===Af?(a=u_(),$e=4):$e=a===Qf?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,rn=a,Ie===null&&(at=1,Il(r,gn(a,r.current)))}function Ky(){var r=nn.current;return r===null?!0:(Ne&4194048)===Ne?bn===null:(Ne&62914560)===Ne||(Ne&536870912)!==0?r===bn:!1}function Zy(){var r=S.H;return S.H=zo,r===null?zo:r}function Gy(){var r=S.A;return S.A=RS,r}function jl(){at=4,Li||(Ne&4194048)!==Ne&&nn.current!==null||(wr=!0),(Ui&134217727)===0&&(Ms&134217727)===0||Qe===null||Vi(Qe,Ne,on,!1)}function Th(r,a,c){var h=Ve;Ve|=2;var g=Zy(),m=Gy();(Qe!==r||Ne!==a)&&(Vl=null,Rr(r,a)),a=!1;var b=at;e:do try{if($e!==0&&Ie!==null){var x=Ie,N=rn;switch($e){case 8:vh(),b=6;break e;case 3:case 2:case 9:case 6:nn.current===null&&(a=!0);var $=$e;if($e=0,rn=null,Mr(r,x,N,$),c&&wr){b=0;break e}break;default:$=$e,$e=0,rn=null,Mr(r,x,N,$)}}IS(),b=at;break}catch(J){Yy(r,J)}while(!0);return a&&r.shellSuspendCounter++,ti=vs=null,Ve=h,S.H=g,S.A=m,Ie===null&&(Qe=null,Ne=0,cl()),b}function IS(){for(;Ie!==null;)Qy(Ie)}function PS(r,a){var c=Ve;Ve|=2;var h=Zy(),g=Gy();Qe!==r||Ne!==a?(Vl=null,zl=Gt()+500,Rr(r,a)):wr=go(r,a);e:do try{if($e!==0&&Ie!==null){a=Ie;var m=rn;t:switch($e){case 1:$e=0,rn=null,Mr(r,a,m,1);break;case 2:case 9:if(l_(m)){$e=0,rn=null,Jy(a);break}a=function(){$e!==2&&$e!==9||Qe!==r||($e=7),Hn(r)},m.then(a,a);break e;case 3:$e=7;break e;case 4:$e=5;break e;case 7:l_(m)?($e=0,rn=null,Jy(a)):($e=0,rn=null,Mr(r,a,m,7));break;case 5:var b=null;switch(Ie.tag){case 26:b=Ie.memoizedState;case 5:case 27:var x=Ie;if(b?U0(b):x.stateNode.complete){$e=0,rn=null;var N=x.sibling;if(N!==null)Ie=N;else{var $=x.return;$!==null?(Ie=$,Wl($)):Ie=null}break t}}$e=0,rn=null,Mr(r,a,m,5);break;case 6:$e=0,rn=null,Mr(r,a,m,6);break;case 8:vh(),at=6;break e;default:throw Error(i(462))}}NS();break}catch(J){Yy(r,J)}while(!0);return ti=vs=null,S.H=h,S.A=g,Ve=c,Ie!==null?0:(Qe=null,Ne=0,cl(),at)}function NS(){for(;Ie!==null&&!n1();)Qy(Ie)}function Qy(r){var a=xy(r.alternate,r,fi);r.memoizedProps=r.pendingProps,a===null?Wl(r):Ie=a}function Jy(r){var a=r,c=a.alternate;switch(a.tag){case 15:case 0:a=my(c,a,a.pendingProps,a.type,void 0,Ne);break;case 11:a=my(c,a,a.pendingProps,a.type.render,a.ref,Ne);break;case 5:Bf(a);default:Ay(c,a),a=Ie=Gm(a,fi),a=xy(c,a,fi)}r.memoizedProps=r.pendingProps,a===null?Wl(r):Ie=a}function Mr(r,a,c,h){ti=vs=null,Bf(a),yr=null,Po=0;var g=a.return;try{if(TS(r,g,a,c,Ne)){at=1,Il(r,gn(c,r.current)),Ie=null;return}}catch(m){if(g!==null)throw Ie=g,m;at=1,Il(r,gn(c,r.current)),Ie=null;return}a.flags&32768?(ke||h===1?r=!0:wr||(Ne&536870912)!==0?r=!1:(Li=r=!0,(h===2||h===9||h===3||h===6)&&(h=nn.current,h!==null&&h.tag===13&&(h.flags|=16384))),e0(a,r)):Wl(a)}function Wl(r){var a=r;do{if((a.flags&32768)!==0){e0(a,Li);return}r=a.return;var c=AS(a.alternate,a,fi);if(c!==null){Ie=c;return}if(a=a.sibling,a!==null){Ie=a;return}Ie=a=r}while(a!==null);at===0&&(at=5)}function e0(r,a){do{var c=wS(r.alternate,r);if(c!==null){c.flags&=32767,Ie=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(r=r.sibling,r!==null)){Ie=r;return}Ie=r=c}while(r!==null);at=6,Ie=null}function t0(r,a,c,h,g,m,b,x,N){r.cancelPendingCommit=null;do $l();while(bt!==0);if((Ve&6)!==0)throw Error(i(327));if(a!==null){if(a===r.current)throw Error(i(177));if(m=a.lanes|a.childLanes,m|=cf,h1(r,c,m,b,x,N),r===Qe&&(Ie=Qe=null,Ne=0),Cr=a,zi=r,hi=c,_h=m,yh=g,Wy=h,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,LS(qa,function(){return o0(),null})):(r.callbackNode=null,r.callbackPriority=0),h=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||h){h=S.T,S.T=null,g=I.p,I.p=2,b=Ve,Ve|=4;try{ES(r,a,c)}finally{Ve=b,I.p=g,S.T=h}}bt=1,n0(),i0(),s0()}}function n0(){if(bt===1){bt=0;var r=zi,a=Cr,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=S.T,S.T=null;var h=I.p;I.p=2;var g=Ve;Ve|=4;try{By(a,r);var m=Nh,b=Hm(r.containerInfo),x=m.focusedElem,N=m.selectionRange;if(b!==x&&x&&x.ownerDocument&&Vm(x.ownerDocument.documentElement,x)){if(N!==null&&sf(x)){var $=N.start,J=N.end;if(J===void 0&&(J=$),"selectionStart"in x)x.selectionStart=$,x.selectionEnd=Math.min(J,x.value.length);else{var ne=x.ownerDocument||document,q=ne&&ne.defaultView||window;if(q.getSelection){var Z=q.getSelection(),he=x.textContent.length,be=Math.min(N.start,he),Ke=N.end===void 0?be:Math.min(N.end,he);!Z.extend&&be>Ke&&(b=Ke,Ke=be,be=b);var z=zm(x,be),k=zm(x,Ke);if(z&&k&&(Z.rangeCount!==1||Z.anchorNode!==z.node||Z.anchorOffset!==z.offset||Z.focusNode!==k.node||Z.focusOffset!==k.offset)){var W=ne.createRange();W.setStart(z.node,z.offset),Z.removeAllRanges(),be>Ke?(Z.addRange(W),Z.extend(k.node,k.offset)):(W.setEnd(k.node,k.offset),Z.addRange(W))}}}}for(ne=[],Z=x;Z=Z.parentNode;)Z.nodeType===1&&ne.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<ne.length;x++){var ee=ne[x];ee.element.scrollLeft=ee.left,ee.element.scrollTop=ee.top}}ic=!!Ph,Nh=Ph=null}finally{Ve=g,I.p=h,S.T=c}}r.current=a,bt=2}}function i0(){if(bt===2){bt=0;var r=zi,a=Cr,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=S.T,S.T=null;var h=I.p;I.p=2;var g=Ve;Ve|=4;try{Iy(r,a.alternate,a)}finally{Ve=g,I.p=h,S.T=c}}bt=3}}function s0(){if(bt===4||bt===3){bt=0,i1();var r=zi,a=Cr,c=hi,h=Wy;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?bt=5:(bt=0,Cr=zi=null,r0(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Fi=null),Uu(c),a=a.stateNode,Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(po,a,void 0,(a.current.flags&128)===128)}catch{}if(h!==null){a=S.T,g=I.p,I.p=2,S.T=null;try{for(var m=r.onRecoverableError,b=0;b<h.length;b++){var x=h[b];m(x.value,{componentStack:x.stack})}}finally{S.T=a,I.p=g}}(hi&3)!==0&&$l(),Hn(r),g=r.pendingLanes,(c&261930)!==0&&(g&42)!==0?r===bh?Ko++:(Ko=0,bh=r):Ko=0,Zo(0)}}function r0(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,Oo(a)))}function $l(){return n0(),i0(),s0(),o0()}function o0(){if(bt!==5)return!1;var r=zi,a=_h;_h=0;var c=Uu(hi),h=S.T,g=I.p;try{I.p=32>c?32:c,S.T=null,c=yh,yh=null;var m=zi,b=hi;if(bt=0,Cr=zi=null,hi=0,(Ve&6)!==0)throw Error(i(331));var x=Ve;if(Ve|=4,Vy(m.current),Uy(m,m.current,b,c),Ve=x,Zo(0,!1),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(po,m)}catch{}return!0}finally{I.p=g,S.T=h,r0(r,a)}}function a0(r,a,c){a=gn(c,a),a=Gf(r.stateNode,a,2),r=Ni(r,a,2),r!==null&&(mo(r,2),Hn(r))}function Xe(r,a,c){if(r.tag===3)a0(r,r,c);else for(;a!==null;){if(a.tag===3){a0(a,r,c);break}else if(a.tag===1){var h=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Fi===null||!Fi.has(h))){r=gn(c,r),c=ly(2),h=Ni(a,c,2),h!==null&&(cy(c,h,a,r),mo(h,2),Hn(h));break}}a=a.return}}function xh(r,a,c){var h=r.pingCache;if(h===null){h=r.pingCache=new MS;var g=new Set;h.set(a,g)}else g=h.get(a),g===void 0&&(g=new Set,h.set(a,g));g.has(c)||(ph=!0,g.add(c),r=DS.bind(null,r,a,c),a.then(r,r))}function DS(r,a,c){var h=r.pingCache;h!==null&&h.delete(a),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Qe===r&&(Ne&c)===c&&(at===4||at===3&&(Ne&62914560)===Ne&&300>Gt()-Fl?(Ve&2)===0&&Rr(r,0):gh|=c,Er===Ne&&(Er=0)),Hn(r)}function l0(r,a){a===0&&(a=nm()),r=_s(r,a),r!==null&&(mo(r,a),Hn(r))}function kS(r){var a=r.memoizedState,c=0;a!==null&&(c=a.retryLane),l0(r,c)}function BS(r,a){var c=0;switch(r.tag){case 31:case 13:var h=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:h=r.stateNode;break;case 22:h=r.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(a),l0(r,c)}function LS(r,a){return Du(r,a)}var Xl=null,Or=null,Sh=!1,ql=!1,Ah=!1,Hi=0;function Hn(r){r!==Or&&r.next===null&&(Or===null?Xl=Or=r:Or=Or.next=r),ql=!0,Sh||(Sh=!0,FS())}function Zo(r,a){if(!Ah&&ql){Ah=!0;do for(var c=!1,h=Xl;h!==null;){if(r!==0){var g=h.pendingLanes;if(g===0)var m=0;else{var b=h.suspendedLanes,x=h.pingedLanes;m=(1<<31-Jt(42|r)+1)-1,m&=g&~(b&~x),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(c=!0,h0(h,m))}else m=Ne,m=Ga(h,h===Qe?m:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(m&3)===0||go(h,m)||(c=!0,h0(h,m));h=h.next}while(c);Ah=!1}}function US(){c0()}function c0(){ql=Sh=!1;var r=0;Hi!==0&&KS()&&(r=Hi);for(var a=Gt(),c=null,h=Xl;h!==null;){var g=h.next,m=u0(h,a);m===0?(h.next=null,c===null?Xl=g:c.next=g,g===null&&(Or=c)):(c=h,(r!==0||(m&3)!==0)&&(ql=!0)),h=g}bt!==0&&bt!==5||Zo(r),Hi!==0&&(Hi=0)}function u0(r,a){for(var c=r.suspendedLanes,h=r.pingedLanes,g=r.expirationTimes,m=r.pendingLanes&-62914561;0<m;){var b=31-Jt(m),x=1<<b,N=g[b];N===-1?((x&c)===0||(x&h)!==0)&&(g[b]=f1(x,a)):N<=a&&(r.expiredLanes|=x),m&=~x}if(a=Qe,c=Ne,c=Ga(r,r===a?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),h=r.callbackNode,c===0||r===a&&($e===2||$e===9)||r.cancelPendingCommit!==null)return h!==null&&h!==null&&ku(h),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||go(r,c)){if(a=c&-c,a===r.callbackPriority)return a;switch(h!==null&&ku(h),Uu(c)){case 2:case 8:c=em;break;case 32:c=qa;break;case 268435456:c=tm;break;default:c=qa}return h=f0.bind(null,r),c=Du(c,h),r.callbackPriority=a,r.callbackNode=c,a}return h!==null&&h!==null&&ku(h),r.callbackPriority=2,r.callbackNode=null,2}function f0(r,a){if(bt!==0&&bt!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if($l()&&r.callbackNode!==c)return null;var h=Ne;return h=Ga(r,r===Qe?h:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),h===0?null:(Xy(r,h,a),u0(r,Gt()),r.callbackNode!=null&&r.callbackNode===c?f0.bind(null,r):null)}function h0(r,a){if($l())return null;Xy(r,a,!0)}function FS(){GS(function(){(Ve&6)!==0?Du(Jg,US):c0()})}function wh(){if(Hi===0){var r=gr;r===0&&(r=Ya,Ya<<=1,(Ya&261888)===0&&(Ya=256)),Hi=r}return Hi}function d0(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:tl(""+r)}function p0(r,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,r.id&&c.setAttribute("form",r.id),a.parentNode.insertBefore(c,a),r=new FormData(r),c.parentNode.removeChild(c),r}function zS(r,a,c,h,g){if(a==="submit"&&c&&c.stateNode===g){var m=d0((g[Ht]||null).action),b=h.submitter;b&&(a=(a=b[Ht]||null)?d0(a.formAction):b.getAttribute("formAction"),a!==null&&(m=a,b=null));var x=new rl("action","action",null,h,g);r.push({event:x,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Hi!==0){var N=b?p0(g,b):new FormData(g);$f(c,{pending:!0,data:N,method:g.method,action:m},null,N)}}else typeof m=="function"&&(x.preventDefault(),N=b?p0(g,b):new FormData(g),$f(c,{pending:!0,data:N,method:g.method,action:m},m,N))},currentTarget:g}]})}}for(var Eh=0;Eh<lf.length;Eh++){var Ch=lf[Eh],VS=Ch.toLowerCase(),HS=Ch[0].toUpperCase()+Ch.slice(1);Cn(VS,"on"+HS)}Cn($m,"onAnimationEnd"),Cn(Xm,"onAnimationIteration"),Cn(qm,"onAnimationStart"),Cn("dblclick","onDoubleClick"),Cn("focusin","onFocus"),Cn("focusout","onBlur"),Cn(sS,"onTransitionRun"),Cn(rS,"onTransitionStart"),Cn(oS,"onTransitionCancel"),Cn(Ym,"onTransitionEnd"),tr("onMouseEnter",["mouseout","mouseover"]),tr("onMouseLeave",["mouseout","mouseover"]),tr("onPointerEnter",["pointerout","pointerover"]),tr("onPointerLeave",["pointerout","pointerover"]),ds("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ds("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ds("onBeforeInput",["compositionend","keypress","textInput","paste"]),ds("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ds("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ds("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Go="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Go));function g0(r,a){a=(a&4)!==0;for(var c=0;c<r.length;c++){var h=r[c],g=h.event;h=h.listeners;e:{var m=void 0;if(a)for(var b=h.length-1;0<=b;b--){var x=h[b],N=x.instance,$=x.currentTarget;if(x=x.listener,N!==m&&g.isPropagationStopped())break e;m=x,g.currentTarget=$;try{m(g)}catch(J){ll(J)}g.currentTarget=null,m=N}else for(b=0;b<h.length;b++){if(x=h[b],N=x.instance,$=x.currentTarget,x=x.listener,N!==m&&g.isPropagationStopped())break e;m=x,g.currentTarget=$;try{m(g)}catch(J){ll(J)}g.currentTarget=null,m=N}}}}function Pe(r,a){var c=a[Fu];c===void 0&&(c=a[Fu]=new Set);var h=r+"__bubble";c.has(h)||(m0(a,r,2,!1),c.add(h))}function Rh(r,a,c){var h=0;a&&(h|=4),m0(c,r,h,a)}var Yl="_reactListening"+Math.random().toString(36).slice(2);function Mh(r){if(!r[Yl]){r[Yl]=!0,cm.forEach(function(c){c!=="selectionchange"&&(jS.has(c)||Rh(c,!1,r),Rh(c,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[Yl]||(a[Yl]=!0,Rh("selectionchange",!1,a))}}function m0(r,a,c,h){switch($0(a)){case 2:var g=_A;break;case 8:g=yA;break;default:g=Wh}c=g.bind(null,a,c,r),g=void 0,!Yu||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),h?g!==void 0?r.addEventListener(a,c,{capture:!0,passive:g}):r.addEventListener(a,c,!0):g!==void 0?r.addEventListener(a,c,{passive:g}):r.addEventListener(a,c,!1)}function Oh(r,a,c,h,g){var m=h;if((a&1)===0&&(a&2)===0&&h!==null)e:for(;;){if(h===null)return;var b=h.tag;if(b===3||b===4){var x=h.stateNode.containerInfo;if(x===g)break;if(b===4)for(b=h.return;b!==null;){var N=b.tag;if((N===3||N===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;x!==null;){if(b=Qs(x),b===null)return;if(N=b.tag,N===5||N===6||N===26||N===27){h=m=b;continue e}x=x.parentNode}}h=h.return}Tm(function(){var $=m,J=Xu(c),ne=[];e:{var q=Km.get(r);if(q!==void 0){var Z=rl,he=r;switch(r){case"keypress":if(il(c)===0)break e;case"keydown":case"keyup":Z=B1;break;case"focusin":he="focus",Z=Qu;break;case"focusout":he="blur",Z=Qu;break;case"beforeblur":case"afterblur":Z=Qu;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Am;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=A1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=F1;break;case $m:case Xm:case qm:Z=C1;break;case Ym:Z=V1;break;case"scroll":case"scrollend":Z=x1;break;case"wheel":Z=j1;break;case"copy":case"cut":case"paste":Z=M1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Em;break;case"toggle":case"beforetoggle":Z=$1}var be=(a&4)!==0,Ke=!be&&(r==="scroll"||r==="scrollend"),z=be?q!==null?q+"Capture":null:q;be=[];for(var k=$,W;k!==null;){var ee=k;if(W=ee.stateNode,ee=ee.tag,ee!==5&&ee!==26&&ee!==27||W===null||z===null||(ee=bo(k,z),ee!=null&&be.push(Qo(k,ee,W))),Ke)break;k=k.return}0<be.length&&(q=new Z(q,he,null,c,J),ne.push({event:q,listeners:be}))}}if((a&7)===0){e:{if(q=r==="mouseover"||r==="pointerover",Z=r==="mouseout"||r==="pointerout",q&&c!==$u&&(he=c.relatedTarget||c.fromElement)&&(Qs(he)||he[Gs]))break e;if((Z||q)&&(q=J.window===J?J:(q=J.ownerDocument)?q.defaultView||q.parentWindow:window,Z?(he=c.relatedTarget||c.toElement,Z=$,he=he?Qs(he):null,he!==null&&(Ke=o(he),be=he.tag,he!==Ke||be!==5&&be!==27&&be!==6)&&(he=null)):(Z=null,he=$),Z!==he)){if(be=Am,ee="onMouseLeave",z="onMouseEnter",k="mouse",(r==="pointerout"||r==="pointerover")&&(be=Em,ee="onPointerLeave",z="onPointerEnter",k="pointer"),Ke=Z==null?q:yo(Z),W=he==null?q:yo(he),q=new be(ee,k+"leave",Z,c,J),q.target=Ke,q.relatedTarget=W,ee=null,Qs(J)===$&&(be=new be(z,k+"enter",he,c,J),be.target=W,be.relatedTarget=Ke,ee=be),Ke=ee,Z&&he)t:{for(be=WS,z=Z,k=he,W=0,ee=z;ee;ee=be(ee))W++;ee=0;for(var ye=k;ye;ye=be(ye))ee++;for(;0<W-ee;)z=be(z),W--;for(;0<ee-W;)k=be(k),ee--;for(;W--;){if(z===k||k!==null&&z===k.alternate){be=z;break t}z=be(z),k=be(k)}be=null}else be=null;Z!==null&&_0(ne,q,Z,be,!1),he!==null&&Ke!==null&&_0(ne,Ke,he,be,!0)}}e:{if(q=$?yo($):window,Z=q.nodeName&&q.nodeName.toLowerCase(),Z==="select"||Z==="input"&&q.type==="file")var Fe=Dm;else if(Pm(q))if(km)Fe=tS;else{Fe=J1;var ge=Q1}else Z=q.nodeName,!Z||Z.toLowerCase()!=="input"||q.type!=="checkbox"&&q.type!=="radio"?$&&Wu($.elementType)&&(Fe=Dm):Fe=eS;if(Fe&&(Fe=Fe(r,$))){Nm(ne,Fe,c,J);break e}ge&&ge(r,q,$),r==="focusout"&&$&&q.type==="number"&&$.memoizedProps.value!=null&&ju(q,"number",q.value)}switch(ge=$?yo($):window,r){case"focusin":(Pm(ge)||ge.contentEditable==="true")&&(ar=ge,rf=$,Co=null);break;case"focusout":Co=rf=ar=null;break;case"mousedown":of=!0;break;case"contextmenu":case"mouseup":case"dragend":of=!1,jm(ne,c,J);break;case"selectionchange":if(iS)break;case"keydown":case"keyup":jm(ne,c,J)}var Ce;if(ef)e:{switch(r){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else or?Om(r,c)&&(De="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(De="onCompositionStart");De&&(Cm&&c.locale!=="ko"&&(or||De!=="onCompositionStart"?De==="onCompositionEnd"&&or&&(Ce=xm()):(Ei=J,Ku="value"in Ei?Ei.value:Ei.textContent,or=!0)),ge=Kl($,De),0<ge.length&&(De=new wm(De,r,null,c,J),ne.push({event:De,listeners:ge}),Ce?De.data=Ce:(Ce=Im(c),Ce!==null&&(De.data=Ce)))),(Ce=q1?Y1(r,c):K1(r,c))&&(De=Kl($,"onBeforeInput"),0<De.length&&(ge=new wm("onBeforeInput","beforeinput",null,c,J),ne.push({event:ge,listeners:De}),ge.data=Ce)),zS(ne,r,$,c,J)}g0(ne,a)})}function Qo(r,a,c){return{instance:r,listener:a,currentTarget:c}}function Kl(r,a){for(var c=a+"Capture",h=[];r!==null;){var g=r,m=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||m===null||(g=bo(r,c),g!=null&&h.unshift(Qo(r,g,m)),g=bo(r,a),g!=null&&h.push(Qo(r,g,m))),r.tag===3)return h;r=r.return}return[]}function WS(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function _0(r,a,c,h,g){for(var m=a._reactName,b=[];c!==null&&c!==h;){var x=c,N=x.alternate,$=x.stateNode;if(x=x.tag,N!==null&&N===h)break;x!==5&&x!==26&&x!==27||$===null||(N=$,g?($=bo(c,m),$!=null&&b.unshift(Qo(c,$,N))):g||($=bo(c,m),$!=null&&b.push(Qo(c,$,N)))),c=c.return}b.length!==0&&r.push({event:a,listeners:b})}var $S=/\r\n?/g,XS=/\u0000|\uFFFD/g;function y0(r){return(typeof r=="string"?r:""+r).replace($S,`
`).replace(XS,"")}function b0(r,a){return a=y0(a),y0(r)===a}function Ye(r,a,c,h,g,m){switch(c){case"children":typeof h=="string"?a==="body"||a==="textarea"&&h===""||ir(r,h):(typeof h=="number"||typeof h=="bigint")&&a!=="body"&&ir(r,""+h);break;case"className":Ja(r,"class",h);break;case"tabIndex":Ja(r,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Ja(r,c,h);break;case"style":bm(r,h,m);break;case"data":if(a!=="object"){Ja(r,"data",h);break}case"src":case"href":if(h===""&&(a!=="a"||c!=="href")){r.removeAttribute(c);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){r.removeAttribute(c);break}h=tl(""+h),r.setAttribute(c,h);break;case"action":case"formAction":if(typeof h=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(c==="formAction"?(a!=="input"&&Ye(r,a,"name",g.name,g,null),Ye(r,a,"formEncType",g.formEncType,g,null),Ye(r,a,"formMethod",g.formMethod,g,null),Ye(r,a,"formTarget",g.formTarget,g,null)):(Ye(r,a,"encType",g.encType,g,null),Ye(r,a,"method",g.method,g,null),Ye(r,a,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){r.removeAttribute(c);break}h=tl(""+h),r.setAttribute(c,h);break;case"onClick":h!=null&&(r.onclick=Gn);break;case"onScroll":h!=null&&Pe("scroll",r);break;case"onScrollEnd":h!=null&&Pe("scrollend",r);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"multiple":r.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":r.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){r.removeAttribute("xlink:href");break}c=tl(""+h),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(c,""+h):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":h===!0?r.setAttribute(c,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(c,h):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?r.setAttribute(c,h):r.removeAttribute(c);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?r.removeAttribute(c):r.setAttribute(c,h);break;case"popover":Pe("beforetoggle",r),Pe("toggle",r),Qa(r,"popover",h);break;case"xlinkActuate":Zn(r,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":Zn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":Zn(r,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":Zn(r,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":Zn(r,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":Zn(r,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":Zn(r,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":Zn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":Zn(r,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Qa(r,"is",h);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=v1.get(c)||c,Qa(r,c,h))}}function Ih(r,a,c,h,g,m){switch(c){case"style":bm(r,h,m);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"children":typeof h=="string"?ir(r,h):(typeof h=="number"||typeof h=="bigint")&&ir(r,""+h);break;case"onScroll":h!=null&&Pe("scroll",r);break;case"onScrollEnd":h!=null&&Pe("scrollend",r);break;case"onClick":h!=null&&(r.onclick=Gn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!um.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),a=c.slice(2,g?c.length-7:void 0),m=r[Ht]||null,m=m!=null?m[c]:null,typeof m=="function"&&r.removeEventListener(a,m,g),typeof h=="function")){typeof m!="function"&&m!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(a,h,g);break e}c in r?r[c]=h:h===!0?r.setAttribute(c,""):Qa(r,c,h)}}}function It(r,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Pe("error",r),Pe("load",r);var h=!1,g=!1,m;for(m in c)if(c.hasOwnProperty(m)){var b=c[m];if(b!=null)switch(m){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ye(r,a,m,b,c,null)}}g&&Ye(r,a,"srcSet",c.srcSet,c,null),h&&Ye(r,a,"src",c.src,c,null);return;case"input":Pe("invalid",r);var x=m=b=g=null,N=null,$=null;for(h in c)if(c.hasOwnProperty(h)){var J=c[h];if(J!=null)switch(h){case"name":g=J;break;case"type":b=J;break;case"checked":N=J;break;case"defaultChecked":$=J;break;case"value":m=J;break;case"defaultValue":x=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(137,a));break;default:Ye(r,a,h,J,c,null)}}gm(r,m,x,N,$,b,g,!1);return;case"select":Pe("invalid",r),h=b=m=null;for(g in c)if(c.hasOwnProperty(g)&&(x=c[g],x!=null))switch(g){case"value":m=x;break;case"defaultValue":b=x;break;case"multiple":h=x;default:Ye(r,a,g,x,c,null)}a=m,c=b,r.multiple=!!h,a!=null?nr(r,!!h,a,!1):c!=null&&nr(r,!!h,c,!0);return;case"textarea":Pe("invalid",r),m=g=h=null;for(b in c)if(c.hasOwnProperty(b)&&(x=c[b],x!=null))switch(b){case"value":h=x;break;case"defaultValue":g=x;break;case"children":m=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:Ye(r,a,b,x,c,null)}_m(r,h,g,m);return;case"option":for(N in c)c.hasOwnProperty(N)&&(h=c[N],h!=null)&&(N==="selected"?r.selected=h&&typeof h!="function"&&typeof h!="symbol":Ye(r,a,N,h,c,null));return;case"dialog":Pe("beforetoggle",r),Pe("toggle",r),Pe("cancel",r),Pe("close",r);break;case"iframe":case"object":Pe("load",r);break;case"video":case"audio":for(h=0;h<Go.length;h++)Pe(Go[h],r);break;case"image":Pe("error",r),Pe("load",r);break;case"details":Pe("toggle",r);break;case"embed":case"source":case"link":Pe("error",r),Pe("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for($ in c)if(c.hasOwnProperty($)&&(h=c[$],h!=null))switch($){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ye(r,a,$,h,c,null)}return;default:if(Wu(a)){for(J in c)c.hasOwnProperty(J)&&(h=c[J],h!==void 0&&Ih(r,a,J,h,c,void 0));return}}for(x in c)c.hasOwnProperty(x)&&(h=c[x],h!=null&&Ye(r,a,x,h,c,null))}function qS(r,a,c,h){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,m=null,b=null,x=null,N=null,$=null,J=null;for(Z in c){var ne=c[Z];if(c.hasOwnProperty(Z)&&ne!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":N=ne;default:h.hasOwnProperty(Z)||Ye(r,a,Z,null,h,ne)}}for(var q in h){var Z=h[q];if(ne=c[q],h.hasOwnProperty(q)&&(Z!=null||ne!=null))switch(q){case"type":m=Z;break;case"name":g=Z;break;case"checked":$=Z;break;case"defaultChecked":J=Z;break;case"value":b=Z;break;case"defaultValue":x=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,a));break;default:Z!==ne&&Ye(r,a,q,Z,h,ne)}}Hu(r,b,x,N,$,J,m,g);return;case"select":Z=b=x=q=null;for(m in c)if(N=c[m],c.hasOwnProperty(m)&&N!=null)switch(m){case"value":break;case"multiple":Z=N;default:h.hasOwnProperty(m)||Ye(r,a,m,null,h,N)}for(g in h)if(m=h[g],N=c[g],h.hasOwnProperty(g)&&(m!=null||N!=null))switch(g){case"value":q=m;break;case"defaultValue":x=m;break;case"multiple":b=m;default:m!==N&&Ye(r,a,g,m,h,N)}a=x,c=b,h=Z,q!=null?nr(r,!!c,q,!1):!!h!=!!c&&(a!=null?nr(r,!!c,a,!0):nr(r,!!c,c?[]:"",!1));return;case"textarea":Z=q=null;for(x in c)if(g=c[x],c.hasOwnProperty(x)&&g!=null&&!h.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:Ye(r,a,x,null,h,g)}for(b in h)if(g=h[b],m=c[b],h.hasOwnProperty(b)&&(g!=null||m!=null))switch(b){case"value":q=g;break;case"defaultValue":Z=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==m&&Ye(r,a,b,g,h,m)}mm(r,q,Z);return;case"option":for(var he in c)q=c[he],c.hasOwnProperty(he)&&q!=null&&!h.hasOwnProperty(he)&&(he==="selected"?r.selected=!1:Ye(r,a,he,null,h,q));for(N in h)q=h[N],Z=c[N],h.hasOwnProperty(N)&&q!==Z&&(q!=null||Z!=null)&&(N==="selected"?r.selected=q&&typeof q!="function"&&typeof q!="symbol":Ye(r,a,N,q,h,Z));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var be in c)q=c[be],c.hasOwnProperty(be)&&q!=null&&!h.hasOwnProperty(be)&&Ye(r,a,be,null,h,q);for($ in h)if(q=h[$],Z=c[$],h.hasOwnProperty($)&&q!==Z&&(q!=null||Z!=null))switch($){case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(i(137,a));break;default:Ye(r,a,$,q,h,Z)}return;default:if(Wu(a)){for(var Ke in c)q=c[Ke],c.hasOwnProperty(Ke)&&q!==void 0&&!h.hasOwnProperty(Ke)&&Ih(r,a,Ke,void 0,h,q);for(J in h)q=h[J],Z=c[J],!h.hasOwnProperty(J)||q===Z||q===void 0&&Z===void 0||Ih(r,a,J,q,h,Z);return}}for(var z in c)q=c[z],c.hasOwnProperty(z)&&q!=null&&!h.hasOwnProperty(z)&&Ye(r,a,z,null,h,q);for(ne in h)q=h[ne],Z=c[ne],!h.hasOwnProperty(ne)||q===Z||q==null&&Z==null||Ye(r,a,ne,q,h,Z)}function v0(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function YS(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,c=performance.getEntriesByType("resource"),h=0;h<c.length;h++){var g=c[h],m=g.transferSize,b=g.initiatorType,x=g.duration;if(m&&x&&v0(b)){for(b=0,x=g.responseEnd,h+=1;h<c.length;h++){var N=c[h],$=N.startTime;if($>x)break;var J=N.transferSize,ne=N.initiatorType;J&&v0(ne)&&(N=N.responseEnd,b+=J*(N<x?1:(x-$)/(N-$)))}if(--h,a+=8*(m+b)/(g.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Ph=null,Nh=null;function Zl(r){return r.nodeType===9?r:r.ownerDocument}function T0(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function x0(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function Dh(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var kh=null;function KS(){var r=window.event;return r&&r.type==="popstate"?r===kh?!1:(kh=r,!0):(kh=null,!1)}var S0=typeof setTimeout=="function"?setTimeout:void 0,ZS=typeof clearTimeout=="function"?clearTimeout:void 0,A0=typeof Promise=="function"?Promise:void 0,GS=typeof queueMicrotask=="function"?queueMicrotask:typeof A0<"u"?function(r){return A0.resolve(null).then(r).catch(QS)}:S0;function QS(r){setTimeout(function(){throw r})}function ji(r){return r==="head"}function w0(r,a){var c=a,h=0;do{var g=c.nextSibling;if(r.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"||c==="/&"){if(h===0){r.removeChild(g),Dr(a);return}h--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")h++;else if(c==="html")Jo(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,Jo(c);for(var m=c.firstChild;m;){var b=m.nextSibling,x=m.nodeName;m[_o]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&m.rel.toLowerCase()==="stylesheet"||c.removeChild(m),m=b}}else c==="body"&&Jo(r.ownerDocument.body);c=g}while(c);Dr(a)}function E0(r,a){var c=r;r=0;do{var h=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),h&&h.nodeType===8)if(c=h.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=h}while(c)}function Bh(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Bh(c),zu(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function JS(r,a,c,h){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!h&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(h){if(!r[_o])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(m=r.getAttribute("rel"),m==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(m!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(m=r.getAttribute("src"),(m!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&m&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var m=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===m)return r}else return r;if(r=vn(r.nextSibling),r===null)break}return null}function eA(r,a,c){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=vn(r.nextSibling),r===null))return null;return r}function C0(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=vn(r.nextSibling),r===null))return null;return r}function Lh(r){return r.data==="$?"||r.data==="$~"}function Uh(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function tA(r,a){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||c.readyState!=="loading")a();else{var h=function(){a(),c.removeEventListener("DOMContentLoaded",h)};c.addEventListener("DOMContentLoaded",h),r._reactRetry=h}}function vn(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var Fh=null;function R0(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(a===0)return vn(r.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}r=r.nextSibling}return null}function M0(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return r;a--}else c!=="/$"&&c!=="/&"||a++}r=r.previousSibling}return null}function O0(r,a,c){switch(a=Zl(c),r){case"html":if(r=a.documentElement,!r)throw Error(i(452));return r;case"head":if(r=a.head,!r)throw Error(i(453));return r;case"body":if(r=a.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function Jo(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);zu(r)}var Tn=new Map,I0=new Set;function Gl(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var di=I.d;I.d={f:nA,r:iA,D:sA,C:rA,L:oA,m:aA,X:cA,S:lA,M:uA};function nA(){var r=di.f(),a=Hl();return r||a}function iA(r){var a=Js(r);a!==null&&a.tag===5&&a.type==="form"?Y_(a):di.r(r)}var Ir=typeof document>"u"?null:document;function P0(r,a,c){var h=Ir;if(h&&typeof a=="string"&&a){var g=dn(a);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),I0.has(g)||(I0.add(g),r={rel:r,crossOrigin:c,href:a},h.querySelector(g)===null&&(a=h.createElement("link"),It(a,"link",r),St(a),h.head.appendChild(a)))}}function sA(r){di.D(r),P0("dns-prefetch",r,null)}function rA(r,a){di.C(r,a),P0("preconnect",r,a)}function oA(r,a,c){di.L(r,a,c);var h=Ir;if(h&&r&&a){var g='link[rel="preload"][as="'+dn(a)+'"]';a==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+dn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+dn(c.imageSizes)+'"]')):g+='[href="'+dn(r)+'"]';var m=g;switch(a){case"style":m=Pr(r);break;case"script":m=Nr(r)}Tn.has(m)||(r=_({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:r,as:a},c),Tn.set(m,r),h.querySelector(g)!==null||a==="style"&&h.querySelector(ea(m))||a==="script"&&h.querySelector(ta(m))||(a=h.createElement("link"),It(a,"link",r),St(a),h.head.appendChild(a)))}}function aA(r,a){di.m(r,a);var c=Ir;if(c&&r){var h=a&&typeof a.as=="string"?a.as:"script",g='link[rel="modulepreload"][as="'+dn(h)+'"][href="'+dn(r)+'"]',m=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Nr(r)}if(!Tn.has(m)&&(r=_({rel:"modulepreload",href:r},a),Tn.set(m,r),c.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(ta(m)))return}h=c.createElement("link"),It(h,"link",r),St(h),c.head.appendChild(h)}}}function lA(r,a,c){di.S(r,a,c);var h=Ir;if(h&&r){var g=er(h).hoistableStyles,m=Pr(r);a=a||"default";var b=g.get(m);if(!b){var x={loading:0,preload:null};if(b=h.querySelector(ea(m)))x.loading=5;else{r=_({rel:"stylesheet",href:r,"data-precedence":a},c),(c=Tn.get(m))&&zh(r,c);var N=b=h.createElement("link");St(N),It(N,"link",r),N._p=new Promise(function($,J){N.onload=$,N.onerror=J}),N.addEventListener("load",function(){x.loading|=1}),N.addEventListener("error",function(){x.loading|=2}),x.loading|=4,Ql(b,a,h)}b={type:"stylesheet",instance:b,count:1,state:x},g.set(m,b)}}}function cA(r,a){di.X(r,a);var c=Ir;if(c&&r){var h=er(c).hoistableScripts,g=Nr(r),m=h.get(g);m||(m=c.querySelector(ta(g)),m||(r=_({src:r,async:!0},a),(a=Tn.get(g))&&Vh(r,a),m=c.createElement("script"),St(m),It(m,"link",r),c.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},h.set(g,m))}}function uA(r,a){di.M(r,a);var c=Ir;if(c&&r){var h=er(c).hoistableScripts,g=Nr(r),m=h.get(g);m||(m=c.querySelector(ta(g)),m||(r=_({src:r,async:!0,type:"module"},a),(a=Tn.get(g))&&Vh(r,a),m=c.createElement("script"),St(m),It(m,"link",r),c.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},h.set(g,m))}}function N0(r,a,c,h){var g=(g=pe.current)?Gl(g):null;if(!g)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Pr(c.href),c=er(g).hoistableStyles,h=c.get(a),h||(h={type:"style",instance:null,count:0,state:null},c.set(a,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=Pr(c.href);var m=er(g).hoistableStyles,b=m.get(r);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(r,b),(m=g.querySelector(ea(r)))&&!m._p&&(b.instance=m,b.state.loading=5),Tn.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Tn.set(r,c),m||fA(g,r,c,b.state))),a&&h===null)throw Error(i(528,""));return b}if(a&&h!==null)throw Error(i(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Nr(c),c=er(g).hoistableScripts,h=c.get(a),h||(h={type:"script",instance:null,count:0,state:null},c.set(a,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Pr(r){return'href="'+dn(r)+'"'}function ea(r){return'link[rel="stylesheet"]['+r+"]"}function D0(r){return _({},r,{"data-precedence":r.precedence,precedence:null})}function fA(r,a,c,h){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?h.loading=1:(a=r.createElement("link"),h.preload=a,a.addEventListener("load",function(){return h.loading|=1}),a.addEventListener("error",function(){return h.loading|=2}),It(a,"link",c),St(a),r.head.appendChild(a))}function Nr(r){return'[src="'+dn(r)+'"]'}function ta(r){return"script[async]"+r}function k0(r,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var h=r.querySelector('style[data-href~="'+dn(c.href)+'"]');if(h)return a.instance=h,St(h),h;var g=_({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return h=(r.ownerDocument||r).createElement("style"),St(h),It(h,"style",g),Ql(h,c.precedence,r),a.instance=h;case"stylesheet":g=Pr(c.href);var m=r.querySelector(ea(g));if(m)return a.state.loading|=4,a.instance=m,St(m),m;h=D0(c),(g=Tn.get(g))&&zh(h,g),m=(r.ownerDocument||r).createElement("link"),St(m);var b=m;return b._p=new Promise(function(x,N){b.onload=x,b.onerror=N}),It(m,"link",h),a.state.loading|=4,Ql(m,c.precedence,r),a.instance=m;case"script":return m=Nr(c.src),(g=r.querySelector(ta(m)))?(a.instance=g,St(g),g):(h=c,(g=Tn.get(m))&&(h=_({},c),Vh(h,g)),r=r.ownerDocument||r,g=r.createElement("script"),St(g),It(g,"link",h),r.head.appendChild(g),a.instance=g);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(h=a.instance,a.state.loading|=4,Ql(h,c.precedence,r));return a.instance}function Ql(r,a,c){for(var h=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,m=g,b=0;b<h.length;b++){var x=h[b];if(x.dataset.precedence===a)m=x;else if(m!==g)break}m?m.parentNode.insertBefore(r,m.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(r,a.firstChild))}function zh(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Vh(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Jl=null;function B0(r,a,c){if(Jl===null){var h=new Map,g=Jl=new Map;g.set(c,h)}else g=Jl,h=g.get(c),h||(h=new Map,g.set(c,h));if(h.has(r))return h;for(h.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var m=c[g];if(!(m[_o]||m[Ct]||r==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var b=m.getAttribute(a)||"";b=r+b;var x=h.get(b);x?x.push(m):h.set(b,[m])}}return h}function L0(r,a,c){r=r.ownerDocument||r,r.head.insertBefore(c,a==="title"?r.querySelector("head > title"):null)}function hA(r,a,c){if(c===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(r=a.disabled,typeof a.precedence=="string"&&r==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function U0(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function dA(r,a,c,h){if(c.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var g=Pr(h.href),m=a.querySelector(ea(g));if(m){a=m._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=ec.bind(r),a.then(r,r)),c.state.loading|=4,c.instance=m,St(m);return}m=a.ownerDocument||a,h=D0(h),(g=Tn.get(g))&&zh(h,g),m=m.createElement("link"),St(m);var b=m;b._p=new Promise(function(x,N){b.onload=x,b.onerror=N}),It(m,"link",h),c.instance=m}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=ec.bind(r),a.addEventListener("load",c),a.addEventListener("error",c))}}var Hh=0;function pA(r,a){return r.stylesheets&&r.count===0&&nc(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var h=setTimeout(function(){if(r.stylesheets&&nc(r,r.stylesheets),r.unsuspend){var m=r.unsuspend;r.unsuspend=null,m()}},6e4+a);0<r.imgBytes&&Hh===0&&(Hh=62500*YS());var g=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&nc(r,r.stylesheets),r.unsuspend)){var m=r.unsuspend;r.unsuspend=null,m()}},(r.imgBytes>Hh?50:800)+a);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function ec(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nc(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var tc=null;function nc(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,tc=new Map,a.forEach(gA,r),tc=null,ec.call(r))}function gA(r,a){if(!(a.state.loading&4)){var c=tc.get(r);if(c)var h=c.get(null);else{c=new Map,tc.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<g.length;m++){var b=g[m];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(c.set(b.dataset.precedence,b),h=b)}h&&c.set(null,h)}g=a.instance,b=g.getAttribute("data-precedence"),m=c.get(b)||h,m===h&&c.set(null,g),c.set(b,g),this.count++,h=ec.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),m?m.parentNode.insertBefore(g,m.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),a.state.loading|=4}}var na={$$typeof:O,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function mA(r,a,c,h,g,m,b,x,N){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Bu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bu(0),this.hiddenUpdates=Bu(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=m,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=N,this.incompleteTransitions=new Map}function F0(r,a,c,h,g,m,b,x,N,$,J,ne){return r=new mA(r,a,c,b,N,$,J,ne,x),a=1,m===!0&&(a|=24),m=tn(3,null,null,a),r.current=m,m.stateNode=r,a=Tf(),a.refCount++,r.pooledCache=a,a.refCount++,m.memoizedState={element:h,isDehydrated:c,cache:a},wf(m),r}function z0(r){return r?(r=ur,r):ur}function V0(r,a,c,h,g,m){g=z0(g),h.context===null?h.context=g:h.pendingContext=g,h=Pi(a),h.payload={element:c},m=m===void 0?null:m,m!==null&&(h.callback=m),c=Ni(r,h,a),c!==null&&(Yt(c,r,a),Do(c,r,a))}function H0(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<a?c:a}}function jh(r,a){H0(r,a),(r=r.alternate)&&H0(r,a)}function j0(r){if(r.tag===13||r.tag===31){var a=_s(r,67108864);a!==null&&Yt(a,r,67108864),jh(r,67108864)}}function W0(r){if(r.tag===13||r.tag===31){var a=an();a=Lu(a);var c=_s(r,a);c!==null&&Yt(c,r,a),jh(r,a)}}var ic=!0;function _A(r,a,c,h){var g=S.T;S.T=null;var m=I.p;try{I.p=2,Wh(r,a,c,h)}finally{I.p=m,S.T=g}}function yA(r,a,c,h){var g=S.T;S.T=null;var m=I.p;try{I.p=8,Wh(r,a,c,h)}finally{I.p=m,S.T=g}}function Wh(r,a,c,h){if(ic){var g=$h(h);if(g===null)Oh(r,a,h,sc,c),X0(r,h);else if(vA(g,r,a,c,h))h.stopPropagation();else if(X0(r,h),a&4&&-1<bA.indexOf(r)){for(;g!==null;){var m=Js(g);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var b=hs(m.pendingLanes);if(b!==0){var x=m;for(x.pendingLanes|=2,x.entangledLanes|=2;b;){var N=1<<31-Jt(b);x.entanglements[1]|=N,b&=~N}Hn(m),(Ve&6)===0&&(zl=Gt()+500,Zo(0))}}break;case 31:case 13:x=_s(m,2),x!==null&&Yt(x,m,2),Hl(),jh(m,2)}if(m=$h(h),m===null&&Oh(r,a,h,sc,c),m===g)break;g=m}g!==null&&h.stopPropagation()}else Oh(r,a,h,null,c)}}function $h(r){return r=Xu(r),Xh(r)}var sc=null;function Xh(r){if(sc=null,r=Qs(r),r!==null){var a=o(r);if(a===null)r=null;else{var c=a.tag;if(c===13){if(r=l(a),r!==null)return r;r=null}else if(c===31){if(r=u(a),r!==null)return r;r=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return sc=r,null}function $0(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(s1()){case Jg:return 2;case em:return 8;case qa:case r1:return 32;case tm:return 268435456;default:return 32}default:return 32}}var qh=!1,Wi=null,$i=null,Xi=null,ia=new Map,sa=new Map,qi=[],bA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function X0(r,a){switch(r){case"focusin":case"focusout":Wi=null;break;case"dragenter":case"dragleave":$i=null;break;case"mouseover":case"mouseout":Xi=null;break;case"pointerover":case"pointerout":ia.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":sa.delete(a.pointerId)}}function ra(r,a,c,h,g,m){return r===null||r.nativeEvent!==m?(r={blockedOn:a,domEventName:c,eventSystemFlags:h,nativeEvent:m,targetContainers:[g]},a!==null&&(a=Js(a),a!==null&&j0(a)),r):(r.eventSystemFlags|=h,a=r.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),r)}function vA(r,a,c,h,g){switch(a){case"focusin":return Wi=ra(Wi,r,a,c,h,g),!0;case"dragenter":return $i=ra($i,r,a,c,h,g),!0;case"mouseover":return Xi=ra(Xi,r,a,c,h,g),!0;case"pointerover":var m=g.pointerId;return ia.set(m,ra(ia.get(m)||null,r,a,c,h,g)),!0;case"gotpointercapture":return m=g.pointerId,sa.set(m,ra(sa.get(m)||null,r,a,c,h,g)),!0}return!1}function q0(r){var a=Qs(r.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){r.blockedOn=a,am(r.priority,function(){W0(c)});return}}else if(a===31){if(a=u(c),a!==null){r.blockedOn=a,am(r.priority,function(){W0(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function rc(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var c=$h(r.nativeEvent);if(c===null){c=r.nativeEvent;var h=new c.constructor(c.type,c);$u=h,c.target.dispatchEvent(h),$u=null}else return a=Js(c),a!==null&&j0(a),r.blockedOn=c,!1;a.shift()}return!0}function Y0(r,a,c){rc(r)&&c.delete(a)}function TA(){qh=!1,Wi!==null&&rc(Wi)&&(Wi=null),$i!==null&&rc($i)&&($i=null),Xi!==null&&rc(Xi)&&(Xi=null),ia.forEach(Y0),sa.forEach(Y0)}function oc(r,a){r.blockedOn===a&&(r.blockedOn=null,qh||(qh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,TA)))}var ac=null;function K0(r){ac!==r&&(ac=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){ac===r&&(ac=null);for(var a=0;a<r.length;a+=3){var c=r[a],h=r[a+1],g=r[a+2];if(typeof h!="function"){if(Xh(h||c)===null)continue;break}var m=Js(c);m!==null&&(r.splice(a,3),a-=3,$f(m,{pending:!0,data:g,method:c.method,action:h},h,g))}}))}function Dr(r){function a(N){return oc(N,r)}Wi!==null&&oc(Wi,r),$i!==null&&oc($i,r),Xi!==null&&oc(Xi,r),ia.forEach(a),sa.forEach(a);for(var c=0;c<qi.length;c++){var h=qi[c];h.blockedOn===r&&(h.blockedOn=null)}for(;0<qi.length&&(c=qi[0],c.blockedOn===null);)q0(c),c.blockedOn===null&&qi.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(h=0;h<c.length;h+=3){var g=c[h],m=c[h+1],b=g[Ht]||null;if(typeof m=="function")b||K0(c);else if(b){var x=null;if(m&&m.hasAttribute("formAction")){if(g=m,b=m[Ht]||null)x=b.formAction;else if(Xh(g)!==null)continue}else x=b.action;typeof x=="function"?c[h+1]=x:(c.splice(h,3),h-=3),K0(c)}}}function Z0(){function r(m){m.canIntercept&&m.info==="react-transition"&&m.intercept({handler:function(){return new Promise(function(b){return g=b})},focusReset:"manual",scroll:"manual"})}function a(){g!==null&&(g(),g=null),h||setTimeout(c,20)}function c(){if(!h&&!navigation.transition){var m=navigation.currentEntry;m&&m.url!=null&&navigation.navigate(m.url,{state:m.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){h=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),g!==null&&(g(),g=null)}}}function Yh(r){this._internalRoot=r}lc.prototype.render=Yh.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(i(409));var c=a.current,h=an();V0(c,h,r,a,null,null)},lc.prototype.unmount=Yh.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;V0(r.current,2,null,r,null,null),Hl(),a[Gs]=null}};function lc(r){this._internalRoot=r}lc.prototype.unstable_scheduleHydration=function(r){if(r){var a=om();r={blockedOn:null,target:r,priority:a};for(var c=0;c<qi.length&&a!==0&&a<qi[c].priority;c++);qi.splice(c,0,r),c===0&&q0(r)}};var G0=e.version;if(G0!=="19.2.4")throw Error(i(527,G0,"19.2.4"));I.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=d(a),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var xA={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:S,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cc.isDisabled&&cc.supportsFiber)try{po=cc.inject(xA),Qt=cc}catch{}}return aa.createRoot=function(r,a){if(!s(r))throw Error(i(299));var c=!1,h="",g=sy,m=ry,b=oy;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(m=a.onCaughtError),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),a=F0(r,1,!1,null,null,c,h,null,g,m,b,Z0),r[Gs]=a.current,Mh(r),new Yh(a)},aa.hydrateRoot=function(r,a,c){if(!s(r))throw Error(i(299));var h=!1,g="",m=sy,b=ry,x=oy,N=null;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(m=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(x=c.onRecoverableError),c.formState!==void 0&&(N=c.formState)),a=F0(r,1,!0,a,c??null,h,g,N,m,b,x,Z0),a.context=z0(null),c=a.current,h=an(),h=Lu(h),g=Pi(h),g.callback=null,Ni(c,g,h),c=h,a.current.lanes=c,mo(a,c),Hn(a),r[Gs]=a.current,Mh(r),new lc(a)},aa.version="19.2.4",aa}var ab;function NA(){if(ab)return Gh.exports;ab=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Gh.exports=PA(),Gh.exports}var DA=NA();function Qc(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Lp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),lb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);lb&&parseFloat(lb[1]);const cb=globalThis,ub=globalThis.process||{},kA=globalThis.navigator||{};function dx(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Ys(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||dx()}function BA(n){return Ys()?dx()?"Electron":(kA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const px="4.1.1";function Up(n,e){if(!n)throw new Error("Assertion failed")}function gx(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Up(Number.isFinite(e)&&e>=0),e}function LA(n){const{logLevel:e,message:t}=n;n.logLevel=gx(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Up(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}const zr=()=>{};class UA{constructor({level:e=0}={}){this.userData={},this._onceCache=new Set,this._level=e}set level(e){this.setLevel(e)}get level(){return this.getLevel()}setLevel(e){return this._level=e,this}getLevel(){return this._level}warn(e,...t){return this._log("warn",0,e,t,{once:!0})}error(e,...t){return this._log("error",0,e,t)}log(e,t,...i){return this._log("log",e,t,i)}info(e,t,...i){return this._log("info",e,t,i)}once(e,t,...i){return this._log("once",e,t,i,{once:!0})}_log(e,t,i,s,o={}){const l=LA({logLevel:t,message:i,args:this._buildArgs(t,i,s),opts:o});return this._createLogFunction(e,l,o)}_buildArgs(e,t,i){return[e,t,...i]}_createLogFunction(e,t,i){if(!this._shouldLog(t.logLevel))return zr;const s=this._getOnceTag(i.tag??t.tag??t.message);if((i.once||t.once)&&s!==void 0){if(this._onceCache.has(s))return zr;this._onceCache.add(s)}return this._emit(e,t)}_shouldLog(e){return this.getLevel()>=gx(e)}_getOnceTag(e){if(e!==void 0)try{return typeof e=="string"?e:String(e)}catch{return}}}function FA(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class zA{constructor(e,t,i="sessionStorage"){this.storage=FA(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function VA(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function HA(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Jc;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Jc||(Jc={}));const jA=10;function fb(n){return typeof n!="string"?n:(n=n.toUpperCase(),Jc[n]||Jc.WHITE)}function WA(n,e,t){return!Ys&&typeof n=="string"&&(e&&(n=`\x1B[${fb(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${fb(t)+jA}m${n}\x1B[49m`)),n}function $A(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const o of i){const l=s[o];typeof l=="function"&&(e.find(u=>o===u)||(s[o]=l.bind(n)))}}function la(){let n;if(Ys()&&cb.performance)n=cb?.performance?.now?.();else if("hrtime"in ub){const e=ub?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const kr={debug:Ys()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},td={enabled:!0,level:0};class Va extends UA{constructor({id:e}={id:""}){super({level:0}),this.VERSION=px,this._startTs=la(),this._deltaTs=la(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new zA(`__probe-${this.id}__`,{[this.id]:td}),this.timeStamp(`${this.id} started`),$A(this),Object.seal(this)}isEnabled(){return this._getConfiguration().enabled}getLevel(){return this._getConfiguration().level}getTotal(){return Number((la()-this._startTs).toPrecision(10))}getDelta(){return Number((la()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._updateConfiguration({enabled:e}),this}setLevel(e){return this._updateConfiguration({level:e}),this}get(e){return this._getConfiguration()[e]}set(e,t){this._updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e,...t){return this._log("warn",0,e,t,{method:kr.warn,once:!0})}error(e,...t){return this._log("error",0,e,t,{method:kr.error})}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t,...i){return this._log("log",e,t,i,{method:kr.log,time:!0,once:!0})}log(e,t,...i){return this._log("log",e,t,i,{method:kr.debug})}info(e,t,...i){return this._log("info",e,t,i,{method:console.info})}once(e,t,...i){return this._log("once",e,t,i,{method:kr.debug||kr.info,once:!0})}table(e,t,i){return t?this._log("table",e,t,i&&[i]||[],{method:console.table||zr,tag:qA(t)}):zr}time(e,t){return this._log("time",e,t,[],{method:console.time?console.time:console.info})}timeEnd(e,t){return this._log("time",e,t,[],{method:console.timeEnd?console.timeEnd:console.info})}timeStamp(e,t){return this._log("time",e,t,[],{method:console.timeStamp||zr})}group(e,t,i={collapsed:!1}){const s=(i.collapsed?console.groupCollapsed:console.group)||console.info;return this._log("group",e,t,[],{method:s})}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._log("groupEnd",e,"",[],{method:console.groupEnd||zr})}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&super._shouldLog(e)}_emit(e,t){const i=t.method;Up(i),t.total=this.getTotal(),t.delta=this.getDelta(),this._deltaTs=la();const s=XA(this.id,t.message,t);return i.bind(console,s,...t.args)}_getConfiguration(){return this._storage.config[this.id]||this._updateConfiguration(td),this._storage.config[this.id]}_updateConfiguration(e){const t=this._storage.config[this.id]||{...td};this._storage.setConfiguration({[this.id]:{...t,...e}})}}Va.VERSION=px;function XA(n,e,t){if(typeof e=="string"){const i=t.time?HA(VA(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=WA(e,t.color,t.background)}return e}function qA(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const nd="4.3.3",YA=nd[0]>="0"&&nd[0]<="9"?`v${nd}`:"";function KA(){const n=new Va({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=YA,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const ZA=KA();function GA(n,e){return mx(n||{},e)}function mx(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?i[s]=mx(i[s]||{},e[s],t+1):i[s]=e[s];return i}const QA="latest";function JA(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const ew=JA();function ls(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Bs=typeof process!="object"||String(process)!=="[object process]"||process.browser,tw=typeof window<"u"&&typeof window.orientation<"u",hb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);hb&&parseFloat(hb[1]);class nw{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ls(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ls(this.isRunning),this.isRunning=!1,this._reject(e)}}class id{terminate(){}}const sd=new Map;function iw(n){ls(n.source&&!n.url||!n.source&&n.url);let e=sd.get(n.source||n.url);return e||(n.url&&(e=sw(n.url),sd.set(n.url,e)),n.source&&(e=_x(n.source),sd.set(n.source,e))),ls(e),e}function sw(n){if(!n.startsWith("http"))return n;const e=rw(n);return _x(e)}function _x(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function rw(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function yx(n,e=!0,t){const i=t||new Set;if(n){if(db(n))i.add(n);else if(db(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)yx(n[s],e,i)}}return t===void 0?Array.from(i):[]}function db(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const rd=()=>{};class qd{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Bs||typeof id<"u"&&!Bs}constructor(e){const{name:t,source:i,url:s}=e;ls(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=rd,this.onError=o=>console.log(o),this.worker=Bs?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=rd,this.onError=rd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||yx(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=iw({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new id(i,{eval:!1})}else if(this.source)e=new id(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class ow{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return qd.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,o,l)=>s.done(l),i=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new nw(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Bs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new qd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return tw?this.maxMobileConcurrency:this.maxConcurrency}}const aw={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class es{props;workerPools=new Map;static _workerFarm;static isSupported(){return qd.isSupported()}static getWorkerFarm(e={}){return es._workerFarm=es._workerFarm||new es({}),es._workerFarm.setProps(e),es._workerFarm}constructor(e){this.props={...aw},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let o=this.workerPools.get(t);return o||(o=new ow({name:t,source:i,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function lw(n,e={}){const t=e[n.id]||{},i=Bs?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Bs?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let o=n.version;o==="latest"&&(o=QA);const l=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return ls(s),s}function cw(n,e=ew){ls(n,"no worker provided");const t=n.version;return!(!e||!t)}function uw(n,e){return!es.isSupported()||!Bs&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function fw(n,e,t,i,s){const o=n.id,l=lw(n,t),f=es.getWorkerFarm(t).getWorkerPool({name:o,url:l});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await f.startJob("process-on-worker",hw.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function hw(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:o,options:l}=i;try{const u=await n(o,l);e.postMessage("done",{id:s,result:u})}catch(u){const f=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:s,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function dw(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0}function pw(...n){return gw(n)}function gw(n){const e=n.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,l)=>o+l.byteLength,0),i=new Uint8Array(t);let s=0;for(const o of e)i.set(o,s),s+=o.byteLength;return i.buffer}async function mw(n){const e=[];for await(const t of n)e.push(t);return pw(...e)}function pb(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class gb{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=pb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(pb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ha{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof gb?s=e:s=new gb(t,i),this.stats[t]=s),s}}const _w="Queued Requests",yw="Active Requests",bw="Cancelled Requests",vw="Queued Requests Ever",Tw="Active Requests Ever",xw={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Sw{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...xw,...e},this.stats=new Ha({id:this.props.id}),this.stats.get(_w),this.stats.get(yw),this.stats.get(bw),this.stats.get(vw),this.stats.get(Tw)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:t},s=new Promise(o=>(i.resolve=o,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:i}=e;let s=!1;const o=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Aw="";const mb={};function ww(n){for(const e in mb)if(n.startsWith(e)){const t=mb[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${Aw}${n}`),n}function Ew(n){return n&&typeof n=="object"&&n.isBuffer}function bx(n){if(Ew(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function vx(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function Cw(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const Rw=n=>typeof n=="boolean",Ta=n=>typeof n=="function",ja=n=>n!==null&&typeof n=="object",_b=n=>ja(n)&&n.constructor==={}.constructor,Mw=n=>!!n&&typeof n[Symbol.iterator]=="function",Ow=n=>n&&typeof n[Symbol.asyncIterator]=="function",Ks=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Zs=n=>typeof Blob<"u"&&n instanceof Blob,Iw=n=>n&&typeof n=="object"&&n.isBuffer,Pw=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||ja(n)&&Ta(n.tee)&&Ta(n.cancel)&&Ta(n.getReader),Nw=n=>ja(n)&&Ta(n.read)&&Ta(n.pipe)&&Rw(n.readable),Tx=n=>Pw(n)||Nw(n);class Dw extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const kw=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Bw=/^([-\w.]+\/[-\w.+]+)/;function yb(n,e){return n.toLowerCase()===e.toLowerCase()}function Lw(n){const e=Bw.exec(n);return e?e[1]:n}function bb(n){const e=kw.exec(n);return e?e[1]:""}const xx=/\?.*/;function Uw(n){const e=n.match(xx);return e&&e[0]}function Fp(n){return n.replace(xx,"")}function Fw(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function vu(n){return Ks(n)?n.url:Zs(n)?n.name||"":typeof n=="string"?n:""}function zp(n){if(Ks(n)){const e=n,t=e.headers.get("content-type")||"",i=Fp(e.url);return Lw(t)||bb(i)}return Zs(n)?n.type||"":typeof n=="string"?bb(n):""}function zw(n){return Ks(n)?n.headers["content-length"]||-1:Zs(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Sx(n){if(Ks(n))return n;const e={},t=zw(n);t>=0&&(e["content-length"]=String(t));const i=vu(n),s=zp(n);s&&(e["content-type"]=s);const o=await jw(n);o&&(e["x-first-bytes"]=o),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function Vw(n){if(!n.ok)throw await Hw(n)}async function Hw(n){const e=Fw(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&s?.includes("application/json")?await n.json():await n.text()}catch{}return new Dw(t,i)}async function jw(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=o=>i(o?.target?.result),s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${Ww(t)}`}return null}function Ww(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function $w(n){return!Xw(n)&&!qw(n)}function Xw(n){return n.startsWith("http:")||n.startsWith("https:")}function qw(n){return n.startsWith("data:")}async function vb(n,e){if(typeof n=="string"){const t=ww(n);return $w(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await Sx(n)}const Tb=new Va({id:"loaders.gl"});class Yw{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Kw{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Ax={fetch:null,mimeType:void 0,nothrow:!1,log:new Kw,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Lp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Zw={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function wx(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function Ex(){const n=wx();return n.globalOptions=n.globalOptions||{...Ax},n.globalOptions}function Gw(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],Qw(n,t),eE(e,n,i)}function Qw(n,e){xb(n,null,Ax,Zw,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};xb(i,t.id,s,o,e)}}function xb(n,e,t,i,s){const o=e||"Top level",l=e?`${e}.`:"";for(const u in n){const f=!e&&ja(n[u]),d=u==="baseUri"&&!e,p=u==="workerUrl"&&e;if(!(u in t)&&!d&&!p){if(u in i)Tb.warn(`${o} loader option '${l}${u}' no longer supported, use '${i[u]}'`)();else if(!f){const _=Jw(u,s);Tb.warn(`${o} loader option '${l}${u}' not recognized. ${_}`)()}}}}function Jw(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const o in s.options){if(n===o)return`Did you mean '${s.id}.${o}'?`;const l=o.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(i=i||`Did you mean '${s.id}.${o}'?`)}return i}function eE(n,e,t){const s={...n.options||{}};return tE(s,t),s.log===null&&(s.log=new Yw),Sb(s,Ex()),Sb(s,e),s}function Sb(n,e){for(const t in e)if(t in e){const i=e[t];_b(i)&&_b(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function tE(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Vp(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function Hp(n){Qc(n,"null loader"),Qc(Vp(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Cx=()=>{const n=wx();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function nE(n){const e=Cx();n=Array.isArray(n)?n:[n];for(const t of n){const i=Hp(t);e.find(s=>i===s)||e.unshift(i)}}function iE(){return Cx()}const sE=/\.([^.]+)$/;async function rE(n,e=[],t,i){if(!Rx(n))return null;let s=Ab(n,e,{...t,nothrow:!0},i);if(s)return s;if(Zs(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Ab(n,e,t,i)),!s&&!t?.nothrow)throw new Error(Mx(n));return s}function Ab(n,e=[],t,i){if(!Rx(n))return null;if(e&&!Array.isArray(e))return Hp(e);let s=[];e&&(s=s.concat(e)),t?.ignoreRegisteredLoaders||s.push(...iE()),aE(s);const o=oE(n,s,t,i);if(!o&&!t?.nothrow)throw new Error(Mx(n));return o}function oE(n,e,t,i){const s=vu(n),o=zp(n),l=Fp(s)||i?.url;let u=null,f="";return t?.mimeType&&(u=od(e,t?.mimeType),f=`match forced by supplied MIME type ${t?.mimeType}`),u=u||lE(e,l),f=f||(u?`matched url ${l}`:""),u=u||od(e,o),f=f||(u?`matched MIME type ${o}`:""),u=u||uE(e,n),f=f||(u?`matched initial data ${Ox(n)}`:""),t?.fallbackMimeType&&(u=u||od(e,t?.fallbackMimeType),f=f||(u?`matched fallback MIME type ${o}`:"")),f&&ZA.log(1,`selectLoader selected ${u?.name}: ${f}.`),u}function Rx(n){return!(n instanceof Response&&n.status===204)}function Mx(n){const e=vu(n),t=zp(n);let i="No valid loader found (";i+=e?`${vx(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?Ox(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function aE(n){for(const e of n)Hp(e)}function lE(n,e){const t=e&&sE.exec(e),i=t&&t[1];return i?cE(n,i):null}function cE(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function od(n,e){for(const t of n)if(t.mimeTypes?.some(i=>yb(e,i))||yb(e,`application/x.${t.id}`))return t;return null}function uE(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(fE(e,t))return t}else if(ArrayBuffer.isView(e)){if(wb(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&wb(e,0,t))return t;return null}function fE(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function wb(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>hE(n,e,t,s))}function hE(n,e,t,i){if(i instanceof ArrayBuffer)return dw(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=Yd(n,e,i.length);return i===s;default:return!1}}function Ox(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Yd(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Yd(n,0,e):""}function Yd(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let o=0;o<t;o++)s+=String.fromCharCode(i.getUint8(e+o));return s}const dE=256*1024;function*pE(n,e){const t=e?.chunkSize||dE;let i=0;const s=new TextEncoder;for(;i<n.length;){const o=Math.min(n.length-i,t),l=n.slice(i,i+o);i+=o,yield s.encode(l)}}const gE=256*1024;function*mE(n,e={}){const{chunkSize:t=gE}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),o=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(o).set(l),i+=s,yield o}}const _E=1024*1024;async function*yE(n,e){const t=e?.chunkSize||_E;let i=0;for(;i<n.size;){const s=i+t,o=await n.slice(i,s).arrayBuffer();i=s,yield o}}function Eb(n,e){return Lp?bE(n,e):vE(n)}async function*bE(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:o,value:l}=await s;if(o)return;yield bx(l)}}catch{t.releaseLock()}}async function*vE(n,e){for await(const t of n)yield bx(t)}function TE(n,e){if(typeof n=="string")return pE(n,e);if(n instanceof ArrayBuffer)return mE(n,e);if(Zs(n))return yE(n,e);if(Tx(n))return Eb(n,e);if(Ks(n))return Eb(n.body,e);throw new Error("makeIterator")}const Ix="Cannot convert supplied data type";function xE(n,e,t){if(e.text&&typeof n=="string")return n;if(Iw(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(Ix)}async function SE(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return xE(n,e);if(Zs(n)&&(n=await Sx(n)),Ks(n)){const s=n;return await Vw(s),e.binary?await s.arrayBuffer():await s.text()}if(Tx(n)&&(n=TE(n,t)),Mw(n)||Ow(n))return mw(n);throw new Error(Ix)}function Px(n,e){const t=Ex(),i=n||t;return typeof i.fetch=="function"?i.fetch:ja(i.fetch)?s=>vb(s,i.fetch):e?.fetch?e?.fetch:vb}function AE(n,e,t){if(t)return t;const i={fetch:Px(e,n),...n};if(i.url){const s=Fp(i.url);i.baseUrl=s,i.queryString=Uw(i.url),i.filename=vx(s),i.baseUrl=Cw(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function wE(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function eu(n,e,t,i){e&&!Array.isArray(e)&&!Vp(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=vu(n),l=wE(e,i),u=await rE(n,l,t);return u?(t=Gw(t,u,l,s),i=AE({url:s,_parse:eu,loaders:l},t,i||null),await EE(u,n,t,i)):null}async function EE(n,e,t,i){if(cw(n),t=GA(n.options,t),Ks(e)){const o=e,{ok:l,redirected:u,status:f,statusText:d,type:p,url:_}=o,y=Object.fromEntries(o.headers.entries());i.response={headers:y,ok:l,redirected:u,status:f,statusText:d,type:p,url:_}}e=await SE(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(uw(n,t))return await fw(n,e,t,i,eu);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw ls(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function tu(n,e,t,i){let s,o;!Array.isArray(e)&&!Vp(e)?(s=[],o=e):(s=e,o=t);const l=Px(o);let u=n;return typeof n=="string"&&(u=await l(n)),Zs(n)&&(u=await l(n)),Array.isArray(s)?await eu(u,s,o):await eu(u,s,o)}const CE="4.3.3",RE=globalThis.loaders?.parseImageNode,Kd=typeof Image<"u",Zd=typeof ImageBitmap<"u",ME=!!RE,Gd=Lp?!0:ME;function OE(n){switch(n){case"auto":return Zd||Kd||Gd;case"imagebitmap":return Zd;case"image":return Kd;case"data":return Gd;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function IE(){if(Zd)return"imagebitmap";if(Kd)return"image";if(Gd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function PE(n){const e=DE(n);if(!e)throw new Error("Not an image");return e}function NE(n){switch(PE(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function DE(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const kE=/^data:image\/svg\+xml/,BE=/\.svg((\?|#).*)?$/;function jp(n){return n&&(kE.test(n)||BE.test(n))}function LE(n,e){if(jp(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return Nx(n,e)}function Nx(n,e){if(jp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Dx(n,e,t){const i=LE(n,t),s=self.URL||self.webkitURL,o=typeof i!="string"&&s.createObjectURL(i);try{return await UE(o||i,e)}finally{o&&s.revokeObjectURL(o)}}async function UE(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=o=>{const l=o instanceof Error?o.message:"error";s(new Error(l))}}catch(o){s(o)}})}const FE={};let Cb=!0;async function zE(n,e,t){let i;jp(t)?i=await Dx(n,e,t):i=Nx(n,t);const s=e&&e.imagebitmap;return await VE(i,s)}async function VE(n,e=null){if((HE(e)||!Cb)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),Cb=!1}return await createImageBitmap(n)}function HE(n){for(const e in n||FE)return!1;return!0}function jE(n){return!qE(n,"ftyp",4)||(n[8]&96)===0?null:WE(n)}function WE(n){switch($E(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function $E(n,e,t){return String.fromCharCode(...n.slice(e,t))}function XE(n){return[...n].map(e=>e.charCodeAt(0))}function qE(n,e,t=0){const i=XE(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const qn=!1,xa=!0;function kx(n){const e=Wa(n);return KE(e)||QE(e)||ZE(e)||GE(e)||YE(e)}function YE(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=jE(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function KE(n){const e=Wa(n);return e.byteLength>=24&&e.getUint32(0,qn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,qn),height:e.getUint32(20,qn)}:null}function ZE(n){const e=Wa(n);return e.byteLength>=10&&e.getUint32(0,qn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,xa),height:e.getUint16(8,xa)}:null}function GE(n){const e=Wa(n);return e.byteLength>=14&&e.getUint16(0,qn)===16973&&e.getUint32(2,xa)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,xa),height:e.getUint32(22,xa)}:null}function QE(n){const e=Wa(n);if(!(e.byteLength>=3&&e.getUint16(0,qn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=JE();let o=2;for(;o+9<e.byteLength;){const l=e.getUint16(o,qn);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(o+5,qn),width:e.getUint16(o+7,qn)};if(!i.has(l))return null;o+=2,o+=e.getUint16(o,qn)}return null}function JE(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Wa(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function eC(n,e){const{mimeType:t}=kx(n)||{},i=globalThis.loaders?.parseImageNode;return Qc(i),await i(n,t)}async function tC(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:o}=t||{},l=nC(s);let u;switch(l){case"imagebitmap":u=await zE(n,e,o);break;case"image":u=await Dx(n,e,o);break;case"data":u=await eC(n);break;default:Qc(!1)}return s==="data"&&(u=NE(u)),u}function nC(n){switch(n){case"auto":case"data":return IE();default:return OE(n),n}}const iC=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],sC=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],rC={image:{type:"auto",decode:!0}},oC={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:CE,mimeTypes:sC,extensions:iC,parse:tC,tests:[n=>!!kx(new DataView(n))],options:rC},Me=new Va({id:"deck"});let Qd={};function aC(n){Qd=n}function Ut(n,e,t,i){Me.level>0&&Qd[n]&&Qd[n].call(null,e,t,i)}function lC(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const cC={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:lC,parseTextSync:JSON.parse};function uC(){const n="9.2.9",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(Me.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Me,_registerLoggers:aC},nE([cC,[oC,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const fC=uC();function Wp(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const ad={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function hC(n){const e={};for(const[t,i]of Object.entries(n))e[t]=dC(i);return e}function dC(n){let e=Rb(n);if(e!=="object")return{value:n,...ad[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...ad[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=Rb(n.value),{...n,...ad[e],type:e}):{type:"object",value:null};throw new Error("props")}function Rb(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const pC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,gC=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,mC={vertex:pC,fragment:gC},Mb=/void\s+main\s*\([^)]*\)\s*\{\n?/,Ob=/}\n?[^{}]*$/,ld=[],Uc="__LUMA_INJECT_DECLARATIONS__";function _C(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=yC(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function yC(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function nu(n,e,t,i=!1){const s=e==="vertex";for(const o in t){const l=t[o];l.sort((f,d)=>f.order-d.order),ld.length=l.length;for(let f=0,d=l.length;f<d;++f)ld[f]=l[f].injection;const u=`${ld.join(`
`)}
`;switch(o){case"vs:#decl":s&&(n=n.replace(Uc,u));break;case"vs:#main-start":s&&(n=n.replace(Mb,f=>f+u));break;case"vs:#main-end":s&&(n=n.replace(Ob,f=>u+f));break;case"fs:#decl":s||(n=n.replace(Uc,u));break;case"fs:#main-start":s||(n=n.replace(Mb,f=>f+u));break;case"fs:#main-end":s||(n=n.replace(Ob,f=>u+f));break;default:n=n.replace(o,f=>f+u)}}return n=n.replace(Uc,""),i&&(n=n.replace(/\}\s*$/,o=>o+mC[e])),n}function iu(n){n.map(e=>bC(e))}function bC(n){if(n.instance)return;iu(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:_C(i),parsedDeprecations:vC(t)};e&&(s.propValidators=hC(e)),n.instance=s;let o={};e&&(o=Object.entries(e).reduce((l,[u,f])=>{const d=f?.value;return d&&(l[u]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...o}}function Bx(n,e,t){n.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function vC(n){return n.forEach(e=>{e.type==="function"?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),n}function $p(n){iu(n);const e={},t={};Lx({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,o)=>t[o]-t[s]).map(s=>e[s]);return iu(i),i}function Lx(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)i[o.name]=o,(s[o.name]===void 0||s[o.name]<t)&&(s[o.name]=t);for(const o of e)o.dependencies&&Lx({modules:o.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function TC(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function xC(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=Ib(n,SC),n;case"fragment":return n=Ib(n,AC),n;default:throw new Error(e)}}const Ux=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],SC=[...Ux,[Jd("attribute"),"in $1"],[Jd("varying"),"out $1"]],AC=[...Ux,[Jd("varying"),"in $1"]];function Ib(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function Jd(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Fx(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const o=e[i];o.sort((l,u)=>l.order-u.order);for(const l of o)t+=`  ${l.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function zx(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[o,l]=s.split(":"),u=s.replace(/\(.+/,""),f=Object.assign(i,{signature:l});switch(o){case"vs":e.vertex[u]=f;break;case"fs":e.fragment[u]=f;break;default:throw new Error(o)}}return e}function wC(n,e){return{name:EC(n,e),language:"glsl",version:CC(n)}}function EC(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function CC(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Vx=`

${Uc}
`,RC=`precision highp float;
`;function MC(n){const e=$p(n.modules||[]);return{source:IC(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:Hx(e)}}function OC(n){const{vs:e,fs:t}=n,i=$p(n.modules||[]);return{vs:Pb(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:Pb(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:Hx(i)}}function IC(n,e){const{source:t,stage:i,modules:s,hookFunctions:o=[],inject:l={},log:u}=e;Wp(typeof t=="string","shader source must be a string");const f=t;let d="";const p=zx(o),_={},y={},v={};for(const A in l){const R=typeof l[A]=="string"?{injection:l[A],order:0}:l[A],M=/^(v|f)s:(#)?([\w-]+)$/.exec(A);if(M){const H=M[2],O=M[3];H?O==="decl"?y[A]=[R]:v[A]=[R]:_[A]=[R]}else v[A]=[R]}const T=s;for(const A of T){u&&Bx(A,f,u);const R=jx(A,"wgsl");d+=R;const M=A.injections?.[i]||{};for(const H in M){const O=/^(v|f)s:#([\w-]+)$/.exec(H);if(O){const X=O[2]==="decl"?y:v;X[H]=X[H]||[],X[H].push(M[H])}else _[H]=_[H]||[],_[H].push(M[H])}}return d+=Vx,d=nu(d,i,y),d+=Fx(p[i],_),d+=f,d=nu(d,i,v),d}function Pb(n,e){const{source:t,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:f={},prologue:d=!0,log:p}=e;Wp(typeof t=="string","shader source must be a string");const _=s==="glsl"?wC(t).version:-1,y=n.shaderLanguageVersion,v=_===100?"#version 100":"#version 300 es",A=t.split(`
`).slice(1).join(`
`),R={};o.forEach(Y=>{Object.assign(R,Y.defines)}),Object.assign(R,l);let M="";switch(s){case"wgsl":break;case"glsl":M=d?`${v}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${TC(n)}
${i==="fragment"?RC:""}

// ----- APPLICATION DEFINES -------------------------

${PC(R)}

`:`${v}
`;break}const H=zx(u),O={},L={},X={};for(const Y in f){const re=typeof f[Y]=="string"?{injection:f[Y],order:0}:f[Y],le=/^(v|f)s:(#)?([\w-]+)$/.exec(Y);if(le){const oe=le[2],fe=le[3];oe?fe==="decl"?L[Y]=[re]:X[Y]=[re]:O[Y]=[re]}else X[Y]=[re]}for(const Y of o){p&&Bx(Y,A,p);const re=jx(Y,i);M+=re;const le=Y.instance?.normalizedInjections[i]||{};for(const oe in le){const fe=/^(v|f)s:#([\w-]+)$/.exec(oe);if(fe){const ve=fe[2]==="decl"?L:X;ve[oe]=ve[oe]||[],ve[oe].push(le[oe])}else O[oe]=O[oe]||[],O[oe].push(le[oe])}}return M+="// ----- MAIN SHADER SOURCE -------------------------",M+=Vx,M=nu(M,i,L),M+=Fx(H[i],O),M+=A,M=nu(M,i,X),s==="glsl"&&_!==y&&(M=xC(M,i)),M.trim()}function Hx(n){return function(t){const i={};for(const s of n){const o=s.getUniforms?.(t,i);Object.assign(i,o)}return i}}function PC(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function jx(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:Wp(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const NC=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,DC=/^\s*\#\s*endif\s*$/;function kC(n,e){const t=n.split(`
`),i=[];let s=!0,o=null;for(const l of t){const u=l.match(NC),f=l.match(DC);u?(o=u[1],s=!!e?.defines?.[o]):f?s=!0:s&&i.push(l)}return i.join(`
`)}class Ns{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Ns.defaultShaderAssembler=Ns.defaultShaderAssembler||new Ns,Ns.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:o}=MC({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?kC(s):s,getUniforms:o,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...OC({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let o=0,l=this._defaultModules.length;o<l;++o){const u=this._defaultModules[o],f=u.name;t[s++]=u,i[f]=!0}for(let o=0,l=e.length;o<l;++o){const u=e[o],f=u.name;i[f]||(t[s++]=u,i[f]=!0)}return t.length=s,iu(t),t}}const BC=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,LC=`#version 300 es
${BC}`;function Wx(n){const{input:e,inputChannels:t,output:i}=n||{};if(!e)return LC;if(!t)throw new Error("inputChannels");const s=UC(t),o=FC(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${o};
}`}function UC(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function FC(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class zC{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ha({id:e})),this.stats.get(e)}}const $x=new zC,ie=new Va({id:"luma.gl"}),cd={};function Tu(n="id"){cd[n]=cd[n]||1;const e=cd[n]++;return`${n}-${e}`}let Ge=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=VC(t,i);const s=this.props.id!=="undefined"?this.props.id:Tu(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function VC(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}class et extends Ge{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&et.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array?i.indexType="uint16":t.data instanceof Uint8Array&&(i.indexType="uint8")),delete i.data,super(e,i,et.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const s=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:i,et.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):t===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(t,t+o)}static defaultProps={...Ge.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function Xx(n){const[e,t,i]=Yp[n],s=n.includes("norm"),o=!s&&!n.startsWith("float"),l=n.startsWith("s");return{signedType:e,primitiveType:t,byteLength:i,normalized:s,integer:o,signed:l}}function HC(n){const e=n;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function jC(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}function Xp(n){const e=ArrayBuffer.isView(n)?n.constructor:n;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(Yp).find(i=>e===i[4]);if(!t)throw new Error(e.name);return t[0]}function qp(n){const[,,,,e]=Yp[n];return e}const Yp={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Kp(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,o=i?parseInt(i):1,l=Xx(s),u={type:s,components:o,byteLength:l.byteLength*o,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(u.webglOnly=!0),u}function WC(n,e,t){const i=t?HC(n):n;switch(i){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${i}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${i}x${e}`;default:return e===1?i:`${i}x${e}`}}function $C(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e,s=Xp(n);return WC(s,i,t)}function XC(n){let e;switch(n.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return n.components<=2?"float16x2":"float16x4"}return n.components===1?e:`${e}x${n.components}`}const kt="texture-compression-bc",Ze="texture-compression-astc",jn="texture-compression-etc2",qC="texture-compression-etc1-webgl",uc="texture-compression-pvrtc-webgl",ud="texture-compression-atc-webgl",fc="float32-renderable-webgl",fd="float16-renderable-webgl",YC="rgb9e5ufloat-renderable-webgl",hd="snorm8-renderable-webgl",ca="norm16-renderable-webgl",dd="snorm16-renderable-webgl",hc="float32-filterable",Nb="float16-filterable-webgl";function qx(n){const e=GC[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const KC={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:hd},rg8snorm:{render:hd},"rgb8snorm-webgl":{},rgba8snorm:{render:hd},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:ca},rg16unorm:{render:ca},"rgb16unorm-webgl":{f:ca},rgba16unorm:{render:ca},r16snorm:{f:dd},rg16snorm:{render:dd},"rgb16snorm-webgl":{f:ca},rgba16snorm:{render:dd},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:fd,filter:"float16-filterable-webgl"},rg16float:{render:fd,filter:Nb},rgba16float:{render:fd,filter:Nb},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:fc,filter:hc},rg32float:{render:!1,filter:hc},"rgb32float-webgl":{render:fc,filter:hc},rgba32float:{render:fc,filter:hc},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:YC},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:fc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},ZC={"bc1-rgb-unorm-webgl":{f:kt},"bc1-rgb-unorm-srgb-webgl":{f:kt},"bc1-rgba-unorm":{f:kt},"bc1-rgba-unorm-srgb":{f:kt},"bc2-rgba-unorm":{f:kt},"bc2-rgba-unorm-srgb":{f:kt},"bc3-rgba-unorm":{f:kt},"bc3-rgba-unorm-srgb":{f:kt},"bc4-r-unorm":{f:kt},"bc4-r-snorm":{f:kt},"bc5-rg-unorm":{f:kt},"bc5-rg-snorm":{f:kt},"bc6h-rgb-ufloat":{f:kt},"bc6h-rgb-float":{f:kt},"bc7-rgba-unorm":{f:kt},"bc7-rgba-unorm-srgb":{f:kt},"etc2-rgb8unorm":{f:jn},"etc2-rgb8unorm-srgb":{f:jn},"etc2-rgb8a1unorm":{f:jn},"etc2-rgb8a1unorm-srgb":{f:jn},"etc2-rgba8unorm":{f:jn},"etc2-rgba8unorm-srgb":{f:jn},"eac-r11unorm":{f:jn},"eac-r11snorm":{f:jn},"eac-rg11unorm":{f:jn},"eac-rg11snorm":{f:jn},"astc-4x4-unorm":{f:Ze},"astc-4x4-unorm-srgb":{f:Ze},"astc-5x4-unorm":{f:Ze},"astc-5x4-unorm-srgb":{f:Ze},"astc-5x5-unorm":{f:Ze},"astc-5x5-unorm-srgb":{f:Ze},"astc-6x5-unorm":{f:Ze},"astc-6x5-unorm-srgb":{f:Ze},"astc-6x6-unorm":{f:Ze},"astc-6x6-unorm-srgb":{f:Ze},"astc-8x5-unorm":{f:Ze},"astc-8x5-unorm-srgb":{f:Ze},"astc-8x6-unorm":{f:Ze},"astc-8x6-unorm-srgb":{f:Ze},"astc-8x8-unorm":{f:Ze},"astc-8x8-unorm-srgb":{f:Ze},"astc-10x5-unorm":{f:Ze},"astc-10x5-unorm-srgb":{f:Ze},"astc-10x6-unorm":{f:Ze},"astc-10x6-unorm-srgb":{f:Ze},"astc-10x8-unorm":{f:Ze},"astc-10x8-unorm-srgb":{f:Ze},"astc-10x10-unorm":{f:Ze},"astc-10x10-unorm-srgb":{f:Ze},"astc-12x10-unorm":{f:Ze},"astc-12x10-unorm-srgb":{f:Ze},"astc-12x12-unorm":{f:Ze},"astc-12x12-unorm-srgb":{f:Ze},"pvrtc-rgb4unorm-webgl":{f:uc},"pvrtc-rgba4unorm-webgl":{f:uc},"pvrtc-rbg2unorm-webgl":{f:uc},"pvrtc-rgba2unorm-webgl":{f:uc},"etc1-rbg-unorm-webgl":{f:qC},"atc-rgb-unorm-webgl":{f:ud},"atc-rgba-unorm-webgl":{f:ud},"atc-rgbai-unorm-webgl":{f:ud}},GC={...KC,...ZC},QC=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],JC=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class eR{getInfo(e){return Db(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return QC.some(t=>e.startsWith(t))}getCapabilities(e){const t=qx(e),i={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},s=Db(e),o=e.startsWith("depth")||e.startsWith("stencil"),l=s?.signed,u=s?.integer,f=s?.webgl;return i.render&&=!l,i.filter&&=!o&&!l&&!u&&!f,i}}const Kr=new eR;function Db(n){let e=tR(n);if(Kr.isCompressed(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=nR(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=JC.exec(n);if(t){const[,i,s,o,l,u]=t,f=`${o}${s}`,d=Xx(f),p=d.byteLength*8,_=i.length,y=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:n,attachment:e.attachment,dataType:d.signedType,components:_,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function tR(n){const e=qx(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function nR(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function iR(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}function sR(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}class rR{}class oR{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Hs{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[i,s]=e.getDevicePixelSize();ie.log(1,`${e} resized => ${i}x${s}px`)()},onPositionChange:(e,t)=>{const[i,s]=e.getPosition();ie.log(1,`${e} repositioned => ${i},${s}`)()},onVisibilityChange:e=>ie.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>ie.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:ie.get("debug")||void 0,debugShaders:ie.get("debug-shaders")||void 0,debugFramebuffers:!!ie.get("debug-framebuffers"),debugFactories:!!ie.get("debug-factories"),debugWebGL:!!ie.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=$x;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...Hs.defaultProps,...e},this.id=this.props.id||Tu(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return Kp(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Kr.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const i=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(i),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,i=1){const s=Math.max(e,t,i);return 1+Math.floor(Math.log2(s))}isExternalImage(e){return iR(e)}getExternalImageSize(e){return sR(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Kr.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...i){return this.props.onError(e,t)?()=>{}:ie.error(e.message,t,...i)}debug(){if(this.props.debug)debugger;else ie.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Kr.getCapabilities(e),i=o=>(typeof o=="string"?this.features.has(o):o)??!0,s=i(t.create);return{format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&et.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":e.data instanceof Uint8Array&&(t.data=new Uint16Array(e.data),t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const aR="set luma.log.level=1 (or higher) to trace rendering",kb="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class su{static defaultProps={...Hs.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=$x;log=ie;VERSION="9.2.6";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ie.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ie.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ie.error("This version of luma.gl has already been initialized")()}ie.log(1,`${this.VERSION} - ${aR}`)(),globalThis.luma=this}async createDevice(e={}){const t={...su.defaultProps,...e},i=this.selectAdapter(t.type,t.adapters);if(!i)throw new Error(kb);return t.waitForPageLoad&&await i.pageLoaded,await i.create(t)}async attachDevice(e,t){const i=this._getTypeFromHandle(e,t.adapters),s=i&&this.selectAdapter(i,t.adapters);if(!s)throw new Error(kb);return await s?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],i=this._getAdapterMap(e);for(const s of t)if(i.get(s)?.isSupported?.())return s;return null}selectAdapter(e,t=[]){let i=e;e==="best-available"&&(i=this.getBestAvailableAdapterType(t));const s=this._getAdapterMap(t);return i&&s.get(i)||null}enforceWebGL2(e=!0,t=[]){const s=this._getAdapterMap(t).get("webgl");s||ie.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(su.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?ie.warn("WebGL1 is not supported",e)():ie.warn("Unknown handle type",e)(),null)}}const ep=new su;class lR{get pageLoaded(){return fR()}}const cR=Ys()&&typeof document<"u",uR=()=>cR&&document.readyState==="complete";let dc=null;function fR(){return dc||(uR()||typeof window>"u"?dc=Promise.resolve():dc=new Promise(n=>window.addEventListener("load",()=>n()))),dc}function hR(){let n,e;return{promise:new Promise((i,s)=>{n=i,e=s}),resolve:n,reject:e}}class Ds{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=hR();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Ds.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Ys()?e.canvas?typeof e.canvas=="string"?this.canvas=pR(e.canvas):this.canvas=e.canvas:this.canvas=gR(e):this.canvas={width:e.width||1,height:e.height||1},Ds.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Ds.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Ds.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,o]=this.getDrawingBufferSize();return mR(e,i,s,o,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(s=>s.target===this.canvas);if(!t)return;const i=t.isIntersecting;this.isVisible!==i&&(this.isVisible=i,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(f=>f.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const i=this.getDevicePixelSize(),s=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,o=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[l,u]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,l)),this.devicePixelHeight=Math.max(1,Math.min(o,u)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:i})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const s=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:s})}}}}function dR(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}return n||document.body}function pR(n){const e=document.getElementById(n);if(!Ds.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function gR(n){const{width:e,height:t}=n,i=document.createElement("canvas");i.id=Tu("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",n?.visible||(i.style.visibility="hidden");const s=dR(n?.container||null);return s.insertBefore(i,s.firstChild),i}function mR(n,e,t,i,s){const o=n,l=Bb(o[0],e,t);let u=Lb(o[1],e,i,s),f=Bb(o[0]+1,e,t);const d=f===t-1?f:f-1;f=Lb(o[1]+1,e,i,s);let p;return s?(f=f===0?f:f+1,p=u,u=f):p=f===i-1?f:f-1,{x:l,y:u,width:Math.max(d-l+1,1),height:Math.max(p-u+1,1)}}function Bb(n,e,t){return Math.min(Math.round(n*e),t-1)}function Lb(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class js extends Ge{static defaultProps={...Ge.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=js.normalizeProps(e,t),super(e,t,js.defaultProps)}static normalizeProps(e,t){return t}}const _R={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class xt extends Ge{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=xt.normalizeProps(e,t),super(e,t,xt.defaultProps),this.dimension=this.props.dimension,this.baseDimension=_R[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const i=e.getExternalImageSize(t.data);this.width=i?.width||1,this.height=i?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&ie.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof js?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const i={...t},{width:s,height:o}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(i.height=Math.max(1,Math.ceil(o))),i}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:i,depth:s}=this,o={...xt.defaultCopyDataOptions,width:t,height:i,depth:s,...e},l=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!l.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return o.bytesPerRow=e.bytesPerRow||t*(l.bytesPerPixel||4),o.rowsPerImage=e.rowsPerImage||i,o}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),i={...xt.defaultCopyExternalImageOptions,...t,...e};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}static defaultProps={...Ge.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:xt.TEXTURE|xt.RENDER_ATTACHMENT|xt.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class xu extends Ge{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,xu.defaultProps)}static defaultProps={...Ge.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function yR(n,e,t){let i="";const s=e.split(/\r?\n/),o=n.slice().sort((l,u)=>l.lineNum-u.lineNum);switch(t?.showSourceCode||"no"){case"all":let l=0;for(let u=1;u<=s.length;u++)for(i+=Yx(s[u-1],u,t);o.length>l&&o[l].lineNum===u;){const f=o[l++];i+=pd(f,s,f.lineNum,{...t,inlineSource:!1})}for(;o.length>l;){const u=o[l++];i+=pd(u,[],0,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const u of n)i+=pd(u,s,u.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function pd(n,e,t,i){if(i?.inlineSource){const o=bR(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${o}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function bR(n,e,t){let i="";for(let s=e-2;s<=e;s++){const o=n[s-1];o!==void 0&&(i+=Yx(o,e,t))}return i}function Yx(n,e,t){const i=t?.html?TR(n):n;return`${vR(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function vR(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function TR(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Su extends Ge{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:xR(t),...t},Su.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const i=t,s=`${this.stage} shader "${i}"`;let o=yR(e,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const u=document.createElement("Button");u.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,u.style.top="10px",u.style.left="10px",u.style.position="absolute",u.style.zIndex="9999",u.style.width="100%",u.style.textAlign="left",document.body.appendChild(u),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),u.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}static defaultProps={...Ge.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function xR(n){return SR(n.source)||n.id||Tu(`unnamed ${n.stage}-shader`)}function SR(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}class Au extends Ge{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,Au.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(s=>s.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||i!==this.width,this.width=i,this.height=s}t&&(ie.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const s=this.createColorTexture(t,i);return this.attachResource(s),s.view}return t instanceof xt?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof xt?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:xt.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:xt.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}static defaultProps={...Ge.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Ls extends Ge{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,Ls.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Ge.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Ps extends Ge{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Ps.normalizeProps(e,t),super(e,t,Ps.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...Ge.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ps.defaultClearColor,clearColors:void 0,clearDepth:Ps.defaultClearDepth,clearStencil:Ps.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class ru extends Ge{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,ru.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...Ge.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Zp extends Ge{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Zp.defaultProps)}static defaultProps={...Ge.defaultProps,measureExecutionTime:void 0}}class Gp extends Ge{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Gp.defaultProps)}static defaultProps={...Ge.defaultProps}}function Kx(n){return CR[n]}function AR(n){const[e,t]=ER[n],i=e==="i32"||e==="u32",s=e!=="u32",o=wR[e]*t;return{primitiveType:e,components:t,byteLength:o,integer:i,signed:s}}const wR={f32:4,f16:2,i32:4,u32:4},ER={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},CR={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function Zx(n,e){const t={};for(const i of n.attributes){const s=MR(n,e,i.name);s&&(t[i.name]=s)}return t}function RR(n,e,t=16){const i=Zx(n,e),s=new Array(t).fill(null);for(const o of Object.values(i))s[o.location]=o;return s}function MR(n,e,t){const i=OR(n,t),s=IR(e,t);if(!i)return null;const o=AR(i.type),l=XC(o),u=s?.vertexFormat||l,f=Kp(u);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,primitiveType:o.primitiveType,shaderComponents:o.components,vertexFormat:u,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:o.integer,stepMode:s?.stepMode||i.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function OR(n,e){const t=n.attributes.find(i=>i.name===e);return t||ie.warn(`shader layout attribute "${e}" not present in shader`),t||null}function IR(n,e){PR(n);let t=NR(n,e);return t||(t=DR(n,e),t)?t:(ie.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function PR(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&ie.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function NR(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function DR(n,e){for(const t of n){let i=t.byteStride;if(typeof t.byteStride!="number")for(const o of t.attributes||[]){const l=Kp(o.format);i+=l.byteLength}const s=t.attributes?.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}class Qp extends Ge{static defaultProps={...Ge.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Qp.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=RR(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class Jp extends Ge{static defaultProps={...Ge.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Jp.defaultProps)}}class eg extends Ge{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,eg.defaultProps)}static defaultProps={...Ge.defaultProps,type:void 0,count:void 0}}let pc;function Gx(n){return(!pc||pc.byteLength<n)&&(pc=new ArrayBuffer(n)),pc}function kR(n,e){const t=Gx(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function BR(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ou(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":BR(n)}const LR=1024;class UR{layout={};byteLength;constructor(e,t={}){let i=0;for(const[o,l]of Object.entries(e)){const u=Kx(l),{type:f,components:d}=u,p=d*(t?.[o]??1);i=jC(i,p);const _=i;i+=p,this.layout[o]={type:f,size:p,offset:_}}i+=(4-i%4)%4;const s=i*4;this.byteLength=Math.max(s,LR)}getData(e){const t=Gx(this.byteLength),i={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){ie.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:f,offset:d}=l,p=i[u];if(f===1){if(typeof o!="number"&&typeof o!="boolean"){ie.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}p[d]=Number(o)}else{if(!ou(o)){ie.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}p.set(o,d)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function FR(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!ou(i))return!1;if(ou(s)&&i.length===s.length){for(let o=0;o<i.length;++o)if(s[o]!==i[o])return!1}return!0}function zR(n){return ou(n)?n.slice():n}class VR{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){FR(this.uniforms[e],t)||(this.uniforms[e]=zR(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class HR{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const s=t,o=new UR(i.uniformTypes??{},i.uniformSizes??{});this.uniformBufferLayouts.set(s,o);const l=new VR({name:t});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:et.UNIFORM|et.COPY_DST,byteLength:s}),l=this.getUniformBufferData(t);return o.write(l),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:et.UNIFORM|et.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&ie.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&t?.needsRedraw){s||=t.needsRedraw;const o=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(o);const l=this.uniformBlocks.get(e)?.getAllUniforms();ie.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return s}}class Sn{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Ub{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ts extends Sn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class os extends Sn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class tp extends Sn{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ws extends Sn{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Ji;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Ji||(Ji={}));class gc{constructor(e,t,i,s,o,l,u){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=o,this.resourceType=l,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class jR{constructor(e,t){this.name=e,this.type=t}}class WR{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}}class Fb{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}}class $R{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}class XR{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class qR{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class YR{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function KR(n){var e=(32768&n)>>15,t=(31744&n)>>10,i=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const Qx=new Float32Array(1),ZR=new Int32Array(Qx.buffer),Bt=new Uint16Array(1);function GR(n){Qx[0]=n;const e=ZR[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return Bt[0]=t<<15|31744|(s!==0?512:0),Bt[0];if(i===0){if(s===0)return Bt[0]=t<<15,Bt[0];s|=8388608;let o=113;for(;!(8388608&s);)s<<=1,o--;return i=127-o,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Bt[0]=t<<15|i<<10|s>>13,Bt[0]):(Bt[0]=t<<15,Bt[0])}return i=i-127+15,i>=31?(Bt[0]=t<<15|31744,Bt[0]):i<=0?i<-10?(Bt[0]=t<<15,Bt[0]):(s=(8388608|s)>>1-i,Bt[0]=t<<15|s>>13,Bt[0]):(s>>=13,Bt[0]=t<<15|i<<10|s,Bt[0])}const tg=new Uint32Array(1),Jx=new Float32Array(tg.buffer,0,1);function zb(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return tg[0]=e,Jx[0]}function QR(n,e,t,i,s,o,l,u,f){const d=i*(l>>=s)*(o>>=s)+t*l+e*u;switch(f){case"r8unorm":return[He(n,d,"8unorm",1)[0]];case"r8snorm":return[He(n,d,"8snorm",1)[0]];case"r8uint":return[He(n,d,"8uint",1)[0]];case"r8sint":return[He(n,d,"8sint",1)[0]];case"rg8unorm":{const p=He(n,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=He(n,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=He(n,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=He(n,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=He(n,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=He(n,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=He(n,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=He(n,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=He(n,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[He(n,d,"16uint",1)[0]];case"r16sint":return[He(n,d,"16sint",1)[0]];case"r16float":return[He(n,d,"16float",1)[0]];case"rg16uint":{const p=He(n,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=He(n,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=He(n,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=He(n,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=He(n,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=He(n,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[He(n,d,"32uint",1)[0]];case"r32sint":return[He(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[He(n,d,"32float",1)[0]];case"rg32uint":{const p=He(n,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=He(n,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=He(n,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=He(n,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=He(n,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=He(n,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,d,1)[0],_=(4192256&p)>>11,y=(4290772992&p)>>22;return[zb(2047&p),zb(_),(function(v){const T=112+(v>>5&31)<<23|(31&v)<<18;return tg[0]=T,Jx[0]})(y),1]}}return null}function He(n,e,t,i){const s=[0,0,0,0];for(let o=0;o<i;++o)switch(t){case"8unorm":s[o]=n[e]/255,e++;break;case"8snorm":s[o]=n[e]/255*2-1,e++;break;case"8uint":s[o]=n[e],e++;break;case"8sint":s[o]=n[e]-127,e++;break;case"16uint":s[o]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[o]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[o]=KR(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":s[o]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[o]=new Float32Array(n.buffer,e,1)[0],e+=4}return s}function je(n,e,t,i,s){for(let o=0;o<i;++o)switch(t){case"8unorm":n[e]=255*s[o],e++;break;case"8snorm":n[e]=.5*(s[o]+1)*255,e++;break;case"8uint":n[e]=s[o],e++;break;case"8sint":n[e]=s[o]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[o],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[o],e+=2;break;case"16float":{const l=GR(s[o]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[o],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[o],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[o],e+=4}return s}const gd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class En{constructor(){this.id=En._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(au.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(lu.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}En._id=0;class au extends En{}au.instance=new au;class lu extends En{}lu.instance=new lu;const e3=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class rt extends En{constructor(){super()}}class Na extends rt{constructor(e,t,i,s,o,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=o,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class JR extends rt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class t3 extends rt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class np extends rt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class n3 extends rt{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class yi extends rt{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class ng extends rt{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Sa extends rt{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Fc extends rt{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Vr,ga,j,U;(n=>{n.increment="++",n.decrement="--"})(Vr||(Vr={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Vr||(Vr={}));class i3 extends rt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(ga||(ga={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(ga||(ga={}));class s3 extends rt{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ig extends rt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return e3.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class r3 extends rt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class o3 extends rt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class a3 extends rt{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class l3 extends rt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class eM extends rt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class tM extends rt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class c3 extends rt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class sg extends rt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class nM extends rt{constructor(){super()}get astNodeType(){return"discard"}}class u3 extends rt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class f3 extends rt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class te extends rt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=te._priority.get(t.name);te._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?te.i32:t}getTypeName(){return this.name}}te.x32=new te("x32"),te.f32=new te("f32"),te.i32=new te("i32"),te.u32=new te("u32"),te.f16=new te("f16"),te.bool=new te("bool"),te.void=new te("void"),te._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Vb extends te{constructor(e){super(e)}}class mi extends te{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class V extends te{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}V.vec2f=new V("vec2",te.f32,null),V.vec3f=new V("vec3",te.f32,null),V.vec4f=new V("vec4",te.f32,null),V.vec2i=new V("vec2",te.i32,null),V.vec3i=new V("vec3",te.i32,null),V.vec4i=new V("vec4",te.i32,null),V.vec2u=new V("vec2",te.u32,null),V.vec3u=new V("vec3",te.u32,null),V.vec4u=new V("vec4",te.u32,null),V.vec2h=new V("vec2",te.f16,null),V.vec3h=new V("vec3",te.f16,null),V.vec4h=new V("vec4",te.f16,null),V.vec2b=new V("vec2",te.bool,null),V.vec3b=new V("vec3",te.bool,null),V.vec4b=new V("vec4",te.bool,null),V.mat2x2f=new V("mat2x2",te.f32,null),V.mat2x3f=new V("mat2x3",te.f32,null),V.mat2x4f=new V("mat2x4",te.f32,null),V.mat3x2f=new V("mat3x2",te.f32,null),V.mat3x3f=new V("mat3x3",te.f32,null),V.mat3x4f=new V("mat3x4",te.f32,null),V.mat4x2f=new V("mat4x2",te.f32,null),V.mat4x3f=new V("mat4x3",te.f32,null),V.mat4x4f=new V("mat4x4",te.f32,null),V.mat2x2h=new V("mat2x2",te.f16,null),V.mat2x3h=new V("mat2x3",te.f16,null),V.mat2x4h=new V("mat2x4",te.f16,null),V.mat3x2h=new V("mat3x2",te.f16,null),V.mat3x3h=new V("mat3x3",te.f16,null),V.mat3x4h=new V("mat3x4",te.f16,null),V.mat4x2h=new V("mat4x2",te.f16,null),V.mat4x3h=new V("mat4x3",te.f16,null),V.mat4x4h=new V("mat4x4",te.f16,null),V.mat2x2i=new V("mat2x2",te.i32,null),V.mat2x3i=new V("mat2x3",te.i32,null),V.mat2x4i=new V("mat2x4",te.i32,null),V.mat3x2i=new V("mat3x2",te.i32,null),V.mat3x3i=new V("mat3x3",te.i32,null),V.mat3x4i=new V("mat3x4",te.i32,null),V.mat4x2i=new V("mat4x2",te.i32,null),V.mat4x3i=new V("mat4x3",te.i32,null),V.mat4x4i=new V("mat4x4",te.i32,null),V.mat2x2u=new V("mat2x2",te.u32,null),V.mat2x3u=new V("mat2x3",te.u32,null),V.mat2x4u=new V("mat2x4",te.u32,null),V.mat3x2u=new V("mat3x2",te.u32,null),V.mat3x3u=new V("mat3x3",te.u32,null),V.mat3x4u=new V("mat3x4",te.u32,null),V.mat4x2u=new V("mat4x2",te.u32,null),V.mat4x3u=new V("mat4x3",te.u32,null),V.mat4x4u=new V("mat4x4",te.u32,null);class zc extends te{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class Aa extends te{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class ma extends te{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class kn extends En{constructor(){super(),this.postfix=null}}class $s extends kn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Xn extends kn{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class rg extends kn{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return e3.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class un extends kn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class h3 extends kn{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class vt extends kn{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof B}get isVector(){return this.value instanceof C||this.value instanceof Te}get scalarValue(){return this.value instanceof B?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof C||this.value instanceof Te?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class d3 extends kn{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Jr extends kn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class p3 extends kn{constructor(){super()}}class _t extends p3{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class In extends p3{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?te.f32:e.name==="u32"||t.name==="u32"?te.u32:te.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class g3 extends En{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Vc extends kn{constructor(){super()}get astNodeType(){return"default"}}class m3 extends g3{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class _3 extends g3{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Hb extends En{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class iM extends En{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class jb extends En{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class y3 extends En{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class wn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=wn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}wn._id=0;class ip extends wn{constructor(){super(new Sn("void",null),null)}toString(){return"void"}}ip.void=new ip;class Br extends wn{constructor(e){super(new tp("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class B extends wn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new B(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new B(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new B(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof B))return void console.error("SetDataValue: Invalid value",t);let o=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function sM(n,e,t){const i=e.length;return i===2?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class C extends wn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new C(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new C(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new C(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof $s?console.error("TODO: Set vector postfix"):t instanceof C?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof Ws)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let o=this;for(;t!==null&&o!==null;){if(t instanceof Jr){const l=t.index;let u=-1;if(l instanceof vt){if(!(l.value instanceof B))return console.error(`GetSubData: Invalid array index ${l.value}`),null;u=l.value.value}else{const f=e.evalExpression(l,i);if(!(f instanceof B))return console.error("GetSubData: Unknown index type",l),null;u=f.value}if(u<0||u>=o.data.length)return console.error("GetSubData: Index out of range",u),null;if(o.data instanceof Float32Array){const f=new Float32Array(o.data.buffer,o.data.byteOffset+4*u,1);return new B(f,s)}if(o.data instanceof Int32Array){const f=new Int32Array(o.data.buffer,o.data.byteOffset+4*u,1);return new B(f,s)}if(o.data instanceof Uint32Array){const f=new Uint32Array(o.data.buffer,o.data.byteOffset+4*u,1);return new B(f,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof $s))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;f=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new B(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new B(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new B(d,s,this)}}const u=[];for(const f of l)f==="x"||f==="r"?u.push(this.data[0]):f==="y"||f==="g"?u.push(this.data[1]):f==="z"||f==="b"?u.push(this.data[2]):f==="w"||f==="a"?u.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);o=sM(e,u,s.name)}t=t.postfix}return o}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Te extends wn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Te(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof $s?console.error("TODO: Set matrix postfix"):t instanceof Te?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ws)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof Jr){const o=t.index;let l=-1;if(o instanceof vt){if(!(o.value instanceof B))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;l=o.value.value}else{const d=e.evalExpression(o,i);if(!(d instanceof B))return console.error("GetDataValue: Unknown index type",o),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const u=s.endsWith("h")?"h":"f";let f;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")f=new C(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${u}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")f=new C(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${u}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;f=new C(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${u}`))}return t.postfix?f.getSubData(e,t.postfix,i):f}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ct extends wn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new ct(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let o=this.offset,l=this.typeInfo;for(;i;){if(i instanceof Jr)if(l instanceof os){const u=i.index;if(u instanceof vt){if(!(u.value instanceof B))return void console.error(`SetDataValue: Invalid index type ${u.value}`);o+=u.value.value*l.stride}else{const f=e.evalExpression(u,s);if(!(f instanceof B))return void console.error("SetDataValue: Unknown index type",u);o+=f.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof $s))return void console.error("SetDataValue: Unknown postfix type",i);{const u=i.value;if(l instanceof ts){let f=!1;for(const d of l.members)if(d.name===u){o+=d.offset,l=d.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${u} not found`)}else if(l instanceof Sn){const f=l.getTypeName();let d=0;if(u==="x"||u==="r")d=0;else if(u==="y"||u==="g")d=1;else if(u==="z"||u==="b")d=2;else{if(u!=="w"&&u!=="a")return void console.error(`SetDataValue: Unknown member ${u}`);d=3}if(!(t instanceof B))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return f==="vec2f"?void(new Float32Array(this.buffer,o,2)[d]=p):f==="vec3f"?void(new Float32Array(this.buffer,o,3)[d]=p):f==="vec4f"?void(new Float32Array(this.buffer,o,4)[d]=p):f==="vec2i"?void(new Int32Array(this.buffer,o,2)[d]=p):f==="vec3i"?void(new Int32Array(this.buffer,o,3)[d]=p):f==="vec4i"?void(new Int32Array(this.buffer,o,4)[d]=p):f==="vec2u"?void(new Uint32Array(this.buffer,o,2)[d]=p):f==="vec3u"?void(new Uint32Array(this.buffer,o,3)[d]=p):f==="vec4u"?void(new Uint32Array(this.buffer,o,4)[d]=p):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}i=i.postfix}this.setData(e,t,l,o,s)}setData(e,t,i,s,o){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool"){if(l==="vec2f"||l==="vec2h"){const u=new Float32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3f"||l==="vec3h"){const u=new Float32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4f"||l==="vec4h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2i"){const u=new Int32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3i"){const u=new Int32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4i"){const u=new Int32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2u"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3u"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4u"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2b"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3b"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4b"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="mat2x2f"||l==="mat2x2h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="mat2x3f"||l==="mat2x3h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(l==="mat2x4f"||l==="mat2x4h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(l==="mat3x2f"||l==="mat3x2h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(l==="mat3x3f"||l==="mat3x3h"){const u=new Float32Array(this.buffer,s,9);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8]))}if(l==="mat3x4f"||l==="mat3x4h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(l==="mat4x2f"||l==="mat4x2h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(l==="mat4x3f"||l==="mat4x3h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(l==="mat4x4f"||l==="mat4x4h"){const u=new Float32Array(this.buffer,s,16);return void(t instanceof Te?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11],u[12]=t.data[12],u[13]=t.data[13],u[14]=t.data[14],u[15]=t.data[15]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11],u[12]=t[12],u[13]=t[13],u[14]=t[14],u[15]=t[15]))}if(t instanceof ct){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`)}else t instanceof B&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof B&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof B&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof B&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,o,l;if(t===null)return this;let u=this.offset,f=this.typeInfo;for(;t;){if(t instanceof Jr){const p=t.index,_=p instanceof kn?e.evalExpression(p,i):p;let y=0;if(_ instanceof B?y=_.value:typeof _=="number"?y=_:console.error("GetDataValue: Invalid index type",p),f instanceof os)u+=y*f.stride,f=f.format;else{const v=f.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(u+=16*y,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(t instanceof $s))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(f instanceof ts){let _=!1;for(const y of f.members)if(y.name===p){u+=y.offset,f=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${p} not found`),null}else if(f instanceof Sn){const _=f.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(p.length>0&&p.length<5){let y="f";const v=[];for(let T=0;T<p.length;++T){const A=p[T].toLowerCase();let R=0;if(A==="x"||A==="r")R=0;else if(A==="y"||A==="g")R=1;else if(A==="z"||A==="b")R=2;else{if(A!=="w"&&A!=="a")return console.error(`Unknown member ${p}`),null;R=3}if(p.length===1){if(_.endsWith("f"))return this.buffer.byteLength<u+4*R+4?(console.log("Insufficient buffer data"),null):new B(new Float32Array(this.buffer,u+4*R,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new B(new Float32Array(this.buffer,u+4*R,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new B(new Int32Array(this.buffer,u+4*R,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new B(new Int32Array(this.buffer,u+4*R,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new B(new Uint32Array(this.buffer,u+4*R,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")v.push(new Float32Array(this.buffer,u,2)[R]);else if(_==="vec3f"){if(u+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const M=new Float32Array(this.buffer,u,3);v.push(M[R])}else if(_==="vec4f")v.push(new Float32Array(this.buffer,u,4)[R]);else if(_==="vec2i")y="i",v.push(new Int32Array(this.buffer,u,2)[R]);else if(_==="vec3i")y="i",v.push(new Int32Array(this.buffer,u,3)[R]);else if(_==="vec4i")y="i",v.push(new Int32Array(this.buffer,u,4)[R]);else if(_==="vec2u"){y="u";const M=new Uint32Array(this.buffer,u,2);v.push(M[R])}else _==="vec3u"?(y="u",v.push(new Uint32Array(this.buffer,u,3)[R])):_==="vec4u"&&(y="u",v.push(new Uint32Array(this.buffer,u,4)[R]))}return v.length===2?f=e.getTypeInfo(`vec2${y}`):v.length===3?f=e.getTypeInfo(`vec3${y}`):v.length===4?f=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new C(v,f,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}t=t.postfix}const d=f.getTypeName();return d==="f32"?new B(new Float32Array(this.buffer,u,1),f,this):d==="i32"?new B(new Int32Array(this.buffer,u,1),f,this):d==="u32"?new B(new Uint32Array(this.buffer,u,1),f,this):d==="vec2f"?new C(new Float32Array(this.buffer,u,2),f,this):d==="vec3f"?new C(new Float32Array(this.buffer,u,3),f,this):d==="vec4f"?new C(new Float32Array(this.buffer,u,4),f,this):d==="vec2i"?new C(new Int32Array(this.buffer,u,2),f,this):d==="vec3i"?new C(new Int32Array(this.buffer,u,3),f,this):d==="vec4i"?new C(new Int32Array(this.buffer,u,4),f,this):d==="vec2u"?new C(new Uint32Array(this.buffer,u,2),f,this):d==="vec3u"?new C(new Uint32Array(this.buffer,u,3),f,this):d==="vec4u"?new C(new Uint32Array(this.buffer,u,4),f,this):f instanceof Ws&&f.name==="atomic"?((s=f.format)===null||s===void 0?void 0:s.name)==="u32"?new B(new Uint32Array(this.buffer,u,1)[0],f.format,this):((o=f.format)===null||o===void 0?void 0:o.name)==="i32"?new B(new Int32Array(this.buffer,u,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=f.format)===null||l===void 0?void 0:l.name}`),null):new ct(this.buffer,f,u,this)}toString(){let e="";if(this.typeInfo instanceof os)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof ts?e+="{...}":e="[...]";return e}}class _i extends wn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new _i(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=gd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=gd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=gd[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,o=this.depthOrArrayLayers,l=this.dimension;return i/t.blockWidth*(l==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*o}getPixel(e,t,i=0,s=0){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,f=this.data[s];return QR(new Uint8Array(f),e,t,i,s,u,l,o,this.format)}setPixel(e,t,i,s,o){const l=this.texelByteSize,u=this.bytesPerRow,f=this.height,d=this.data[s];(function(p,_,y,v,T,A,R,M,H,O){const L=v*(R>>=T)*(A>>=T)+y*R+_*M;switch(H){case"r8unorm":return void je(p,L,"8unorm",1,O);case"r8snorm":return void je(p,L,"8snorm",1,O);case"r8uint":return void je(p,L,"8uint",1,O);case"r8sint":return void je(p,L,"8sint",1,O);case"rg8unorm":return void je(p,L,"8unorm",2,O);case"rg8snorm":return void je(p,L,"8snorm",2,O);case"rg8uint":return void je(p,L,"8uint",2,O);case"rg8sint":return void je(p,L,"8sint",2,O);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void je(p,L,"8unorm",4,O);case"rgba8snorm":return void je(p,L,"8snorm",4,O);case"rgba8uint":return void je(p,L,"8uint",4,O);case"rgba8sint":return void je(p,L,"8sint",4,O);case"r16uint":return void je(p,L,"16uint",1,O);case"r16sint":return void je(p,L,"16sint",1,O);case"r16float":return void je(p,L,"16float",1,O);case"rg16uint":return void je(p,L,"16uint",2,O);case"rg16sint":return void je(p,L,"16sint",2,O);case"rg16float":return void je(p,L,"16float",2,O);case"rgba16uint":return void je(p,L,"16uint",4,O);case"rgba16sint":return void je(p,L,"16sint",4,O);case"rgba16float":return void je(p,L,"16float",4,O);case"r32uint":return void je(p,L,"32uint",1,O);case"r32sint":return void je(p,L,"32sint",1,O);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void je(p,L,"32float",1,O);case"rg32uint":return void je(p,L,"32uint",2,O);case"rg32sint":return void je(p,L,"32sint",2,O);case"rg32float":return void je(p,L,"32float",2,O);case"rgba32uint":return void je(p,L,"32uint",4,O);case"rgba32sint":return void je(p,L,"32sint",4,O);case"rgba32float":return void je(p,L,"32float",4,O);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,f,u,l,this.format,o)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(U||(U={}));class F{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class w{}j=w,w.none=new F("",U.reserved,""),w.eof=new F("EOF",U.token,""),w.reserved={asm:new F("asm",U.reserved,"asm"),bf16:new F("bf16",U.reserved,"bf16"),do:new F("do",U.reserved,"do"),enum:new F("enum",U.reserved,"enum"),f16:new F("f16",U.reserved,"f16"),f64:new F("f64",U.reserved,"f64"),handle:new F("handle",U.reserved,"handle"),i8:new F("i8",U.reserved,"i8"),i16:new F("i16",U.reserved,"i16"),i64:new F("i64",U.reserved,"i64"),mat:new F("mat",U.reserved,"mat"),premerge:new F("premerge",U.reserved,"premerge"),regardless:new F("regardless",U.reserved,"regardless"),typedef:new F("typedef",U.reserved,"typedef"),u8:new F("u8",U.reserved,"u8"),u16:new F("u16",U.reserved,"u16"),u64:new F("u64",U.reserved,"u64"),unless:new F("unless",U.reserved,"unless"),using:new F("using",U.reserved,"using"),vec:new F("vec",U.reserved,"vec"),void:new F("void",U.reserved,"void")},w.keywords={array:new F("array",U.keyword,"array"),atomic:new F("atomic",U.keyword,"atomic"),bool:new F("bool",U.keyword,"bool"),f32:new F("f32",U.keyword,"f32"),i32:new F("i32",U.keyword,"i32"),mat2x2:new F("mat2x2",U.keyword,"mat2x2"),mat2x3:new F("mat2x3",U.keyword,"mat2x3"),mat2x4:new F("mat2x4",U.keyword,"mat2x4"),mat3x2:new F("mat3x2",U.keyword,"mat3x2"),mat3x3:new F("mat3x3",U.keyword,"mat3x3"),mat3x4:new F("mat3x4",U.keyword,"mat3x4"),mat4x2:new F("mat4x2",U.keyword,"mat4x2"),mat4x3:new F("mat4x3",U.keyword,"mat4x3"),mat4x4:new F("mat4x4",U.keyword,"mat4x4"),ptr:new F("ptr",U.keyword,"ptr"),sampler:new F("sampler",U.keyword,"sampler"),sampler_comparison:new F("sampler_comparison",U.keyword,"sampler_comparison"),struct:new F("struct",U.keyword,"struct"),texture_1d:new F("texture_1d",U.keyword,"texture_1d"),texture_2d:new F("texture_2d",U.keyword,"texture_2d"),texture_2d_array:new F("texture_2d_array",U.keyword,"texture_2d_array"),texture_3d:new F("texture_3d",U.keyword,"texture_3d"),texture_cube:new F("texture_cube",U.keyword,"texture_cube"),texture_cube_array:new F("texture_cube_array",U.keyword,"texture_cube_array"),texture_multisampled_2d:new F("texture_multisampled_2d",U.keyword,"texture_multisampled_2d"),texture_storage_1d:new F("texture_storage_1d",U.keyword,"texture_storage_1d"),texture_storage_2d:new F("texture_storage_2d",U.keyword,"texture_storage_2d"),texture_storage_2d_array:new F("texture_storage_2d_array",U.keyword,"texture_storage_2d_array"),texture_storage_3d:new F("texture_storage_3d",U.keyword,"texture_storage_3d"),texture_depth_2d:new F("texture_depth_2d",U.keyword,"texture_depth_2d"),texture_depth_2d_array:new F("texture_depth_2d_array",U.keyword,"texture_depth_2d_array"),texture_depth_cube:new F("texture_depth_cube",U.keyword,"texture_depth_cube"),texture_depth_cube_array:new F("texture_depth_cube_array",U.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new F("texture_depth_multisampled_2d",U.keyword,"texture_depth_multisampled_2d"),texture_external:new F("texture_external",U.keyword,"texture_external"),u32:new F("u32",U.keyword,"u32"),vec2:new F("vec2",U.keyword,"vec2"),vec3:new F("vec3",U.keyword,"vec3"),vec4:new F("vec4",U.keyword,"vec4"),bitcast:new F("bitcast",U.keyword,"bitcast"),block:new F("block",U.keyword,"block"),break:new F("break",U.keyword,"break"),case:new F("case",U.keyword,"case"),continue:new F("continue",U.keyword,"continue"),continuing:new F("continuing",U.keyword,"continuing"),default:new F("default",U.keyword,"default"),diagnostic:new F("diagnostic",U.keyword,"diagnostic"),discard:new F("discard",U.keyword,"discard"),else:new F("else",U.keyword,"else"),enable:new F("enable",U.keyword,"enable"),fallthrough:new F("fallthrough",U.keyword,"fallthrough"),false:new F("false",U.keyword,"false"),fn:new F("fn",U.keyword,"fn"),for:new F("for",U.keyword,"for"),function:new F("function",U.keyword,"function"),if:new F("if",U.keyword,"if"),let:new F("let",U.keyword,"let"),const:new F("const",U.keyword,"const"),loop:new F("loop",U.keyword,"loop"),while:new F("while",U.keyword,"while"),private:new F("private",U.keyword,"private"),read:new F("read",U.keyword,"read"),read_write:new F("read_write",U.keyword,"read_write"),return:new F("return",U.keyword,"return"),requires:new F("requires",U.keyword,"requires"),storage:new F("storage",U.keyword,"storage"),switch:new F("switch",U.keyword,"switch"),true:new F("true",U.keyword,"true"),alias:new F("alias",U.keyword,"alias"),type:new F("type",U.keyword,"type"),uniform:new F("uniform",U.keyword,"uniform"),var:new F("var",U.keyword,"var"),override:new F("override",U.keyword,"override"),workgroup:new F("workgroup",U.keyword,"workgroup"),write:new F("write",U.keyword,"write"),r8unorm:new F("r8unorm",U.keyword,"r8unorm"),r8snorm:new F("r8snorm",U.keyword,"r8snorm"),r8uint:new F("r8uint",U.keyword,"r8uint"),r8sint:new F("r8sint",U.keyword,"r8sint"),r16uint:new F("r16uint",U.keyword,"r16uint"),r16sint:new F("r16sint",U.keyword,"r16sint"),r16float:new F("r16float",U.keyword,"r16float"),rg8unorm:new F("rg8unorm",U.keyword,"rg8unorm"),rg8snorm:new F("rg8snorm",U.keyword,"rg8snorm"),rg8uint:new F("rg8uint",U.keyword,"rg8uint"),rg8sint:new F("rg8sint",U.keyword,"rg8sint"),r32uint:new F("r32uint",U.keyword,"r32uint"),r32sint:new F("r32sint",U.keyword,"r32sint"),r32float:new F("r32float",U.keyword,"r32float"),rg16uint:new F("rg16uint",U.keyword,"rg16uint"),rg16sint:new F("rg16sint",U.keyword,"rg16sint"),rg16float:new F("rg16float",U.keyword,"rg16float"),rgba8unorm:new F("rgba8unorm",U.keyword,"rgba8unorm"),rgba8unorm_srgb:new F("rgba8unorm_srgb",U.keyword,"rgba8unorm_srgb"),rgba8snorm:new F("rgba8snorm",U.keyword,"rgba8snorm"),rgba8uint:new F("rgba8uint",U.keyword,"rgba8uint"),rgba8sint:new F("rgba8sint",U.keyword,"rgba8sint"),bgra8unorm:new F("bgra8unorm",U.keyword,"bgra8unorm"),bgra8unorm_srgb:new F("bgra8unorm_srgb",U.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new F("rgb10a2unorm",U.keyword,"rgb10a2unorm"),rg11b10float:new F("rg11b10float",U.keyword,"rg11b10float"),rg32uint:new F("rg32uint",U.keyword,"rg32uint"),rg32sint:new F("rg32sint",U.keyword,"rg32sint"),rg32float:new F("rg32float",U.keyword,"rg32float"),rgba16uint:new F("rgba16uint",U.keyword,"rgba16uint"),rgba16sint:new F("rgba16sint",U.keyword,"rgba16sint"),rgba16float:new F("rgba16float",U.keyword,"rgba16float"),rgba32uint:new F("rgba32uint",U.keyword,"rgba32uint"),rgba32sint:new F("rgba32sint",U.keyword,"rgba32sint"),rgba32float:new F("rgba32float",U.keyword,"rgba32float"),static_assert:new F("static_assert",U.keyword,"static_assert")},w.tokens={decimal_float_literal:new F("decimal_float_literal",U.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new F("hex_float_literal",U.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new F("int_literal",U.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new F("uint_literal",U.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new F("name",U.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new F("ident",U.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new F("and",U.token,"&"),and_and:new F("and_and",U.token,"&&"),arrow:new F("arrow ",U.token,"->"),attr:new F("attr",U.token,"@"),forward_slash:new F("forward_slash",U.token,"/"),bang:new F("bang",U.token,"!"),bracket_left:new F("bracket_left",U.token,"["),bracket_right:new F("bracket_right",U.token,"]"),brace_left:new F("brace_left",U.token,"{"),brace_right:new F("brace_right",U.token,"}"),colon:new F("colon",U.token,":"),comma:new F("comma",U.token,","),equal:new F("equal",U.token,"="),equal_equal:new F("equal_equal",U.token,"=="),not_equal:new F("not_equal",U.token,"!="),greater_than:new F("greater_than",U.token,">"),greater_than_equal:new F("greater_than_equal",U.token,">="),shift_right:new F("shift_right",U.token,">>"),less_than:new F("less_than",U.token,"<"),less_than_equal:new F("less_than_equal",U.token,"<="),shift_left:new F("shift_left",U.token,"<<"),modulo:new F("modulo",U.token,"%"),minus:new F("minus",U.token,"-"),minus_minus:new F("minus_minus",U.token,"--"),period:new F("period",U.token,"."),plus:new F("plus",U.token,"+"),plus_plus:new F("plus_plus",U.token,"++"),or:new F("or",U.token,"|"),or_or:new F("or_or",U.token,"||"),paren_left:new F("paren_left",U.token,"("),paren_right:new F("paren_right",U.token,")"),semicolon:new F("semicolon",U.token,";"),star:new F("star",U.token,"*"),tilde:new F("tilde",U.token,"~"),underscore:new F("underscore",U.token,"_"),xor:new F("xor",U.token,"^"),plus_equal:new F("plus_equal",U.token,"+="),minus_equal:new F("minus_equal",U.token,"-="),times_equal:new F("times_equal",U.token,"*="),division_equal:new F("division_equal",U.token,"/="),modulo_equal:new F("modulo_equal",U.token,"%="),and_equal:new F("and_equal",U.token,"&="),or_equal:new F("or_equal",U.token,"|="),xor_equal:new F("xor_equal",U.token,"^="),shift_right_equal:new F("shift_right_equal",U.token,">>="),shift_left_equal:new F("shift_left_equal",U.token,"<<=")},w.simpleTokens={"@":j.tokens.attr,"{":j.tokens.brace_left,"}":j.tokens.brace_right,":":j.tokens.colon,",":j.tokens.comma,"(":j.tokens.paren_left,")":j.tokens.paren_right,";":j.tokens.semicolon},w.literalTokens={"&":j.tokens.and,"&&":j.tokens.and_and,"->":j.tokens.arrow,"/":j.tokens.forward_slash,"!":j.tokens.bang,"[":j.tokens.bracket_left,"]":j.tokens.bracket_right,"=":j.tokens.equal,"==":j.tokens.equal_equal,"!=":j.tokens.not_equal,">":j.tokens.greater_than,">=":j.tokens.greater_than_equal,">>":j.tokens.shift_right,"<":j.tokens.less_than,"<=":j.tokens.less_than_equal,"<<":j.tokens.shift_left,"%":j.tokens.modulo,"-":j.tokens.minus,"--":j.tokens.minus_minus,".":j.tokens.period,"+":j.tokens.plus,"++":j.tokens.plus_plus,"|":j.tokens.or,"||":j.tokens.or_or,"*":j.tokens.star,"~":j.tokens.tilde,_:j.tokens.underscore,"^":j.tokens.xor,"+=":j.tokens.plus_equal,"-=":j.tokens.minus_equal,"*=":j.tokens.times_equal,"/=":j.tokens.division_equal,"%=":j.tokens.modulo_equal,"&=":j.tokens.and_equal,"|=":j.tokens.or_equal,"^=":j.tokens.xor_equal,">>=":j.tokens.shift_right_equal,"<<=":j.tokens.shift_left_equal},w.regexTokens={decimal_float_literal:j.tokens.decimal_float_literal,hex_float_literal:j.tokens.hex_float_literal,int_literal:j.tokens.int_literal,uint_literal:j.tokens.uint_literal,ident:j.tokens.ident},w.storage_class=[j.keywords.function,j.keywords.private,j.keywords.workgroup,j.keywords.uniform,j.keywords.storage],w.access_mode=[j.keywords.read,j.keywords.write,j.keywords.read_write],w.sampler_type=[j.keywords.sampler,j.keywords.sampler_comparison],w.sampled_texture_type=[j.keywords.texture_1d,j.keywords.texture_2d,j.keywords.texture_2d_array,j.keywords.texture_3d,j.keywords.texture_cube,j.keywords.texture_cube_array],w.multisampled_texture_type=[j.keywords.texture_multisampled_2d],w.storage_texture_type=[j.keywords.texture_storage_1d,j.keywords.texture_storage_2d,j.keywords.texture_storage_2d_array,j.keywords.texture_storage_3d],w.depth_texture_type=[j.keywords.texture_depth_2d,j.keywords.texture_depth_2d_array,j.keywords.texture_depth_cube,j.keywords.texture_depth_cube_array,j.keywords.texture_depth_multisampled_2d],w.texture_external_type=[j.keywords.texture_external],w.any_texture_type=[...j.sampled_texture_type,...j.multisampled_texture_type,...j.storage_texture_type,...j.depth_texture_type,...j.texture_external_type],w.texel_format=[j.keywords.r8unorm,j.keywords.r8snorm,j.keywords.r8uint,j.keywords.r8sint,j.keywords.r16uint,j.keywords.r16sint,j.keywords.r16float,j.keywords.rg8unorm,j.keywords.rg8snorm,j.keywords.rg8uint,j.keywords.rg8sint,j.keywords.r32uint,j.keywords.r32sint,j.keywords.r32float,j.keywords.rg16uint,j.keywords.rg16sint,j.keywords.rg16float,j.keywords.rgba8unorm,j.keywords.rgba8unorm_srgb,j.keywords.rgba8snorm,j.keywords.rgba8uint,j.keywords.rgba8sint,j.keywords.bgra8unorm,j.keywords.bgra8unorm_srgb,j.keywords.rgb10a2unorm,j.keywords.rg11b10float,j.keywords.rg32uint,j.keywords.rg32sint,j.keywords.rg32float,j.keywords.rgba16uint,j.keywords.rgba16sint,j.keywords.rgba16float,j.keywords.rgba32uint,j.keywords.rgba32sint,j.keywords.rgba32float],w.const_literal=[j.tokens.int_literal,j.tokens.uint_literal,j.tokens.decimal_float_literal,j.tokens.hex_float_literal,j.keywords.true,j.keywords.false],w.literal_or_ident=[j.tokens.ident,j.tokens.int_literal,j.tokens.uint_literal,j.tokens.decimal_float_literal,j.tokens.hex_float_literal,j.tokens.name],w.element_count_expression=[j.tokens.int_literal,j.tokens.uint_literal,j.tokens.ident],w.template_types=[j.keywords.vec2,j.keywords.vec3,j.keywords.vec4,j.keywords.mat2x2,j.keywords.mat2x3,j.keywords.mat2x4,j.keywords.mat3x2,j.keywords.mat3x3,j.keywords.mat3x4,j.keywords.mat4x2,j.keywords.mat4x3,j.keywords.mat4x4,j.keywords.atomic,j.keywords.bitcast,...j.any_texture_type],w.attribute_name=[j.tokens.ident,j.keywords.block,j.keywords.diagnostic],w.assignment_operators=[j.tokens.equal,j.tokens.plus_equal,j.tokens.minus_equal,j.tokens.times_equal,j.tokens.division_equal,j.tokens.modulo_equal,j.tokens.and_equal,j.tokens.or_equal,j.tokens.xor_equal,j.tokens.shift_right_equal,j.tokens.shift_left_equal],w.increment_operators=[j.tokens.plus_plus,j.tokens.minus_minus];class Wb{constructor(e,t,i,s,o){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=o}toString(){return this.lexeme}isTemplateType(){return w.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==w.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class rM{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Wb(w.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=w.simpleTokens[e];if(t)return this._addToken(t),!0;let i=w.none;const s=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(s){const l=w.keywords[e];if(l)return this._addToken(l),!0}if(s||o)return this._addToken(w.tokens.ident),!0;for(;;){let l=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(w.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(w.tokens.minus_minus),!0;const f=this._tokens.length-1;if((w.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==w.tokens.paren_right)&&u!=">")return this._addToken(l),!0}if(e==">"&&(u==">"||u=="=")){let f=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&w.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===w.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===w.none){let f=e,d=0;const p=2;for(let _=0;_<p;++_)if(f+=this._peekAhead(_),l=this._findType(f),l!==w.none){d=_;break}if(l===w.none)return i!==w.none&&(this._current--,this._addToken(i),!0);e=f,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==w.none&&(this._addToken(i),!0)}_findType(e){for(const i in w.regexTokens){const s=w.regexTokens[i];if(this._match(e,s.rule))return s}return w.literalTokens[e]||w.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Wb(e,t,this._line,this._start,this._current))}}function ce(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const cu=new Float32Array(1),oM=new Uint32Array(cu.buffer),aM=new Uint32Array(cu.buffer),uu=new Int32Array(1),lM=new Float32Array(uu.buffer),cM=new Uint32Array(uu.buffer),fu=new Uint32Array(1),uM=new Float32Array(fu.buffer),fM=new Int32Array(fu.buffer);function $b(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return cu[0]=n,oM[0];if(t==="u32")return cu[0]=n,aM[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return uu[0]=n,lM[0];if(t==="u32")return uu[0]=n,cM[0]}else if(e==="u32"){if(t==="f32")return fu[0]=n,uM[0];if(t==="i32"||t==="x32")return fu[0]=n,fM[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class hM{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class mc{constructor(e,t){this.align=e,this.size=t}}class Yn{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new YR,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Na&&this._functions.set(t.name,new hM(t));for(const t of e)if(t instanceof mi){const i=this.getTypeInfo(t,null);i instanceof ts&&this.structs.push(i)}for(const t of e)if(t instanceof sg)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof ng){const i=t,s=this._getAttributeNum(i.attributes,"id",0),o=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new $R(i.name,o,i.attributes,s));continue}if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new gc(i.name,l,s,o,i.attributes,Ji.Uniform,i.access);u.access||(u.access="read"),this.uniforms.push(u);continue}if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),f=new gc(i.name,l,s,o,i.attributes,u?Ji.StorageTexture:Ji.Storage,i.access);f.access||(f.access="read"),this.storage.push(f);continue}if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),f=new gc(i.name,l,s,o,i.attributes,u?Ji.StorageTexture:Ji.Texture,i.access);f.access||(f.access="read"),u?this.storage.push(f):this.textures.push(f);continue}if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new gc(i.name,l,s,o,i.attributes,Ji.Sampler,i.access);this.samplers.push(u);continue}}for(const t of e)if(t instanceof Na){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),o=this._getAttribute(t,"compute"),l=i||s||o,u=new qR(t.name,l?.name,t.attributes);u.attributes=t.attributes,u.startLine=t.startLine,u.endLine=t.endLine,this.functions.push(u),this._functions.get(t.name).info=u,l&&(this._functions.get(t.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(t,!!l),u.inputs=this._getInputs(t.args),u.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(u)),u.arguments=t.args.map(f=>new XR(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),u.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,o,l;if(i instanceof y3){if(i.value)if(ce(i.value))for(const u of i.value)for(const f of this.overrides)u===f.name&&((s=t.info)===null||s===void 0||s.overrides.push(f));else for(const u of this.overrides)i.value===u.name&&((o=t.info)===null||o===void 0||o.overrides.push(u))}else if(i instanceof un)for(const u of this.overrides)i.name===u.name&&((l=t.info)===null||l===void 0||l.overrides.push(u))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const o=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;o&&t.add(o)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}for(const s of this.entry.vertex)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}for(const s of this.entry.fragment)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,o=[];return e.search(l=>{if(l instanceof au)o.push({});else if(l instanceof lu)o.pop();else if(l instanceof yi){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),o.length>0&&(o[o.length-1][u.name]=u)}else if(l instanceof Xn){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type)}else if(l instanceof Sa){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),o.length>0&&(o[o.length-1][u.name]=u)}else if(l instanceof un){const u=l;if(o.length>0&&o[o.length-1][u.name])return;const f=s._findResource(u.name);f&&i.push(f)}else if(l instanceof rg){const u=l,f=s._functions.get(u.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,t)),i.push(...f.resources))}else if(l instanceof ig){const u=l,f=s._functions.get(u.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,t)),i.push(...f.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof mi)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof mi)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const o=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),u=new Fb(i.name,o,s.name,l);t.push(u)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new Fb("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof mi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof mi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),l=new WR(e.name,s,t.name,o);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new jR(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof zc){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,o=new tp(e.name,s,t);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Aa){const s=e,o=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new os(s.name,t);return l.format=o,l.count=s.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof mi){const s=e,o=new ts(s.name,t);o.startLine=s.startLine,o.endLine=s.endLine;for(const l of s.members){const u=this.getTypeInfo(l.type,l.attributes);o.members.push(new Ub(l.name,u,l.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ma){const s=e,o=s.format instanceof te,l=s.format?o?this.getTypeInfo(s.format,null):new Sn(s.format,null):null,u=new Ws(s.name,l,t,s.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof V){const s=e,o=s.format?this.getTypeInfo(s.format,null):null,l=new Ws(s.name,o,t,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new Sn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const o=this._getTypeSize(e);if(e.size=(t=o?.size)!==null&&t!==void 0?t:0,e instanceof os&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l?.size)!==null&&i!==void 0?i:0,(s=l?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof tp&&this._updateTypeInfo(e.format),e instanceof ts&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,o=0,l=0;for(let u=0,f=e.members.length;u<f;++u){const d=e.members[u],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const _=p.align,y=p.size;i=this._roundUp(_,i+s),s=y,o=i,l=Math.max(l,_),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,o+s),e.align=l}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ub&&(e=e.type),e instanceof Sn){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=Yn._typeInfo[e.name];if(l!==void 0){const u=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new mc(Math.max(o,l.align/u),Math.max(s,l.size/u))}}{const l=Yn._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const u=e.name[e.name.length-1]==="h"?2:1;return new mc(Math.max(o,l.align/u),Math.max(s,l.size/u))}}if(e instanceof os){let l=e,u=8,f=8;const d=this._getTypeSize(l.format);return d!==null&&(f=d.size,u=d.align),f=l.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(u,f)),s&&(f=s),new mc(Math.max(o,u),Math.max(s,f))}if(e instanceof ts){let l=0,u=0,f=0,d=0,p=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+d),d=y.size,p=f)}return u=this._roundUp(l,p+d),new mc(Math.max(o,l),Math.max(s,u))}return null}_isUniformVar(e){return e instanceof yi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof yi&&e.storage=="storage"}_isTextureVar(e){return e instanceof yi&&e.type!==null&&Yn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof yi&&e.type!==null&&Yn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let o of s)if(o.name==t)return o;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let o=s!==null&&s.value!==null?s.value:i;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}Yn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Yn._textureTypes=w.any_texture_type.map(n=>n.name),Yn._samplerTypes=w.sampler_type.map(n=>n.name);let og=0;class ag{constructor(e,t,i){this.id=og++,this.name=e,this.value=t,this.node=i}clone(){return new ag(this.name,this.value,this.node)}}class lg{constructor(e){this.id=og++,this.name=e.name,this.node=e}clone(){return new lg(this.node)}}class cg{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=og++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new ag(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new cg(this)}}class dM{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class pM{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof C)return i.data.forEach(o=>{o||(s=!1)}),new B(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){const s=i.data.some(o=>o);return new B(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof B))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof ct&&s.typeInfo.size===0){const o=s.typeInfo,l=s.buffer.byteLength/o.stride;return new B(l,this.getTypeInfo("u32"))}return new B(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.abs(o)),i.typeInfo);const s=i;return new B(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.acos(o)),i.typeInfo);const s=i;return new B(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.acosh(o)),i.typeInfo);const s=i;return new B(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.asin(o)),i.typeInfo);const s=i;return new B(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.asinh(o)),i.typeInfo);const s=i;return new B(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.atan(o)),i.typeInfo);const s=i;return new B(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.atanh(o)),i.typeInfo);const s=i;return new B(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,f)=>Math.atan2(u,s.data[f])),i.typeInfo);const o=i,l=s;return new B(Math.atan2(o.value,l.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.ceil(o)),i.typeInfo);const s=i;return new B(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&o instanceof C)return new C(i.data.map((d,p)=>this._clamp(d,s.data[p],o.data[p])),i.typeInfo);const l=i,u=s,f=o;return new B(this._clamp(l.value,u.value,f.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.cos(o)),i.typeInfo);const s=i;return new B(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.cosh(o)),i.typeInfo);const s=i;return new B(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.clz32(o)),i.typeInfo);const s=i;return new B(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>this._countOneBits(o)),i.typeInfo);const s=i;return new B(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>this._countTrailingZeros(o)),i.typeInfo);const s=i;return new B(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const o=i.data,l=s.data;return new C([o[1]*l[2]-l[1]*o[2],o[2]*l[0]-l[2]*o[0],o[0]*l[1]-l[0]*o[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof C?new C(i.data.map(o=>o*s),i.typeInfo):new B(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Te){const s=i.data,o=i.typeInfo.getTypeName(),l=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new B(s[0]*s[3]-s[1]*s[2],l);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new B(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new B(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){let u=0;for(let f=0;f<i.data.length;++f)u+=(i.data[f]-s.data[f])*(i.data[f]-s.data[f]);return new B(Math.sqrt(u),this.getTypeInfo("f32"))}const o=i,l=s;return new B(Math.abs(o.value-l.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof C&&s instanceof C?new B(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.exp(o)),i.typeInfo);const s=i;return new B(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.pow(2,o)),i.typeInfo);const s=i;return new B(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=s.value,u=o.value;if(i instanceof C)return new C(i.data.map(d=>d>>l&(1<<u)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=i.value;return new B(f>>l&(1<<u)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&o instanceof C){const l=this._dot(s.data,o.data);return new C(l<0?Array.from(i.data):i.data.map(u=>-u),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>this._firstLeadingBit(o)),i.typeInfo);const s=i;return new B(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>this._firstTrailingBit(o)),i.typeInfo);const s=i;return new B(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.floor(o)),i.typeInfo);const s=i;return new B(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&o instanceof C)return i.data.length!==s.data.length||i.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new C(i.data.map((d,p)=>d*s.data[p]+o.data[p]),i.typeInfo);const l=i,u=s,f=o;return new B(l.value*u.value+f.value,l.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>o-Math.floor(o)),i.typeInfo);const s=i;return new B(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const u=o.value,f=(1<<l.value)-1<<u,d=~f;if(i instanceof C&&s instanceof C)return new C(i.data.map((y,v)=>y&d|s.data[v]<<u&f),i.typeInfo);const p=i.value,_=s.value;return new B(p&d|_<<u&f,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>1/Math.sqrt(o)),i.typeInfo);const s=i;return new B(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){let o=0;return i.data.forEach(l=>{o+=l*l}),new B(Math.sqrt(o),this.getTypeInfo("f32"))}const s=i;return new B(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.log(o)),i.typeInfo);const s=i;return new B(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.log2(o)),i.typeInfo);const s=i;return new B(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,f)=>Math.max(u,s.data[f])),i.typeInfo);const o=i,l=s;return new B(Math.max(o.value,l.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,f)=>Math.min(u,s.data[f])),i.typeInfo);const o=i,l=s;return new B(Math.min(o.value,l.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&o instanceof C)return new C(i.data.map((f,d)=>i.data[d]*(1-o.data[d])+s.data[d]*o.data[d]),i.typeInfo);const l=s,u=o;return new B(i.value*(1-u.value)+l.value*u.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((l,u)=>l%s.data[u]),i.typeInfo);const o=s;return new B(i.value%o.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){const s=this.Length(e,t).value;return new C(i.data.map(o=>o/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,f)=>Math.pow(u,s.data[f])),i.typeInfo);const o=i,l=s;return new B(Math.pow(o.value,l.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof C?new C(i.data.map(s=>s),i.typeInfo):new B(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof C?new C(i.data.map(s=>s*Math.PI/180),i.typeInfo):new B(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){const o=this._dot(i.data,s.data);return new C(i.data.map((l,u)=>l-2*o*s.data[u]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&o instanceof B){const l=this._dot(s.data,i.data);return new C(i.data.map((u,f)=>{const d=1-o.value*o.value*(1-l*l);if(d<0)return 0;const p=Math.sqrt(d);return o.value*u-(o.value*l+p)*s.data[f]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.round(o)),i.typeInfo);const s=i;return new B(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.min(Math.max(o,0),1)),i.typeInfo);const s=i;return new B(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.sign(o)),i.typeInfo);const s=i;return new B(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.sin(o)),i.typeInfo);const s=i;return new B(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.sinh(o)),i.typeInfo);const s=i;return new B(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(o instanceof C&&i instanceof C&&s instanceof C)return new C(o.data.map((d,p)=>this._smoothstep(i.data[p],s.data[p],d)),o.typeInfo);const l=i,u=s,f=o;return new B(this._smoothstep(l.value,u.value,f.value),o.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.sqrt(o)),i.typeInfo);const s=i;return new B(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof C&&i instanceof C)return new C(s.data.map((l,u)=>l<i.data[u]?0:1),s.typeInfo);const o=i;return new B(s.value<o.value?0:1,o.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.tan(o)),i.typeInfo);const s=i;return new B(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.tanh(o)),i.typeInfo);const s=i;return new B(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof Te))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const o=i.data;return new Te([o[0],o[2],o[1],o[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const o=i.data;return new Te([o[0],o[3],o[6],o[1],o[4],o[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const o=i.data;return new Te([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const o=i.data;return new Te([o[0],o[3],o[1],o[4],o[2],o[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const o=i.data;return new Te([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const o=i.data;return new Te([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const o=i.data;return new Te([o[0],o[4],o[1],o[5],o[2],o[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const o=i.data;return new Te([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const o=i.data;return new Te([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(o=>Math.trunc(o)),i.typeInfo);const s=i;return new B(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof un){const o=i.name,l=t.getVariableValue(o);if(l instanceof _i){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const u=l.getMipLevelSize(s),f=l.dimension;return f==="1d"?new B(u[0],this.getTypeInfo("u32")):f==="3d"?new C(u,this.getTypeInfo("vec3u")):f==="2d"?new C(u.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),o=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof C)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof un){const l=i.name,u=t.getVariableValue(l);if(u instanceof _i){const f=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(f<0||f>=u.width||d<0||d>=u.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=u.getPixel(f,d,0,o);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new C(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof un){const s=i.name,o=t.getVariableValue(s);return o instanceof _i?new B(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof un){const s=i.name,o=t.getVariableValue(s);return o instanceof _i?new B(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof un){const s=i.name,o=t.getVariableValue(s);return o instanceof _i?new B(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),o=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof C)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof un){const u=i.name,f=t.getVariableValue(u);if(f instanceof _i){const d=f.getMipLevelSize(0),p=Math.floor(s.data[0]),_=Math.floor(s.data[1]);return p<0||p>=d[0]||_<0||_>=d[1]?(console.error(`Texture ${u} out of bounds. Line ${e.line}`),null):(f.setPixel(p,_,0,o,Array.from(l)),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t);return f instanceof B&&u instanceof B&&(f.value=u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value+=u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value-=u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value=Math.max(f.value,u.value)),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value=Math.min(f.value,u.value)),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value=f.value&u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value=f.value|u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value=f.value^u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof _t&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),f=o.value.getSubData(this.exec,i.postfix,t),d=new B(f.value,f.typeInfo);return f instanceof B&&u instanceof B&&(f.value=u.value),o.value instanceof ct&&o.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const md={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Vt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Lt extends dM{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new Yn,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new cg,this.builtins=new pM(this),this.typeInfo={bool:this.getTypeInfo(te.bool),i32:this.getTypeInfo(te.i32),u32:this.getTypeInfo(te.u32),f32:this.getTypeInfo(te.f32),f16:this.getTypeInfo(te.f16),vec2f:this.getTypeInfo(V.vec2f),vec2u:this.getTypeInfo(V.vec2u),vec2i:this.getTypeInfo(V.vec2i),vec2h:this.getTypeInfo(V.vec2h),vec3f:this.getTypeInfo(V.vec3f),vec3u:this.getTypeInfo(V.vec3u),vec3i:this.getTypeInfo(V.vec3i),vec3h:this.getTypeInfo(V.vec3h),vec4f:this.getTypeInfo(V.vec4f),vec4u:this.getTypeInfo(V.vec4u),vec4i:this.getTypeInfo(V.vec4i),vec4h:this.getTypeInfo(V.vec4h),mat2x2f:this.getTypeInfo(V.mat2x2f),mat2x3f:this.getTypeInfo(V.mat2x3f),mat2x4f:this.getTypeInfo(V.mat2x4f),mat3x2f:this.getTypeInfo(V.mat3x2f),mat3x3f:this.getTypeInfo(V.mat3x3f),mat3x4f:this.getTypeInfo(V.mat3x4f),mat4x2f:this.getTypeInfo(V.mat4x2f),mat4x3f:this.getTypeInfo(V.mat4x3f),mat4x4f:this.getTypeInfo(V.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof B)return s.value;if(s instanceof C||s instanceof Te)return Array.from(s.data);if(s instanceof ct&&s.typeInfo instanceof os){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const o=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,o),this._execStatements(this.ast,o);const l=o.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const u=t[0],f=t[1],d=t[2],p=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new C(t,p));const _=this.reflection.getFunctionInfo(e);_===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const v in i[y]){const T=i[y][v];o.variables.forEach(A=>{var R;const M=A.node;if(M?.attributes){let H=null,O=null;for(const L of M.attributes)L.name==="binding"?H=L.value:L.name==="group"&&(O=L.value);if(v==H&&y==O){let L=!1;for(const X of _.resources)if(X.name===A.name&&X.group===parseInt(y)&&X.binding===parseInt(v)){L=!0;break}if(L)if(T.texture!==void 0&&T.descriptor!==void 0){const X=new _i(T.texture,this.getTypeInfo(M.type),T.descriptor,(R=T.texture.view)!==null&&R!==void 0?R:null);A.value=X}else T.uniform!==void 0?A.value=new ct(T.uniform,this.getTypeInfo(M.type)):A.value=new ct(T,this.getTypeInfo(M.type))}}})}for(let y=0;y<d;++y)for(let v=0;v<f;++v)for(let T=0;T<u;++T)o.setVariable("@workgroup_id",new C([T,v,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[T,v,y],o)}execStatement(e,t){if(e instanceof l3)return this.evalExpression(e.value,t);if(e instanceof u3){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof B))throw new Error("Invalid break-if condition");if(!i.value)return null}return Lt._breakObj}if(e instanceof f3)return Lt._continueObj;if(e instanceof Sa)this._let(e,t);else if(e instanceof yi)this._var(e,t);else if(e instanceof Fc)this._const(e,t);else if(e instanceof Na)this._function(e,t);else{if(e instanceof a3)return this._if(e,t);if(e instanceof o3)return this._switch(e,t);if(e instanceof n3)return this._for(e,t);if(e instanceof t3)return this._while(e,t);if(e instanceof r3)return this._loop(e,t);if(e instanceof np){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof s3)this._assign(e,t);else if(e instanceof i3)this._increment(e,t);else{if(e instanceof mi)return null;if(e instanceof ng){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new B(0,this.getTypeInfo("u32")))}else if(e instanceof ig)this._call(e,t);else{if(e instanceof c3||e instanceof sg)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof In?this._evalBinaryOp(e,t):e instanceof vt?this._evalLiteral(e,t):e instanceof un?this._evalVariable(e,t):e instanceof rg?this._evalCall(e,t):e instanceof Xn?this._evalCreate(e,t):e instanceof h3?this._evalConst(e,t):e instanceof d3?this._evalBitcast(e,t):e instanceof _t?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof te){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],o=this.reflection.getOverrideInfo(i);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?t.setVariable(i,new B(s,o.type)):o.type.name==="bool"?t.setVariable(i,new B(s?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?t.setVariable(i,new C(s,o.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=i.getVariableValue(p.value[0]);s[0]=_ instanceof B?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=i.getVariableValue(p.value[1]);s[1]=_ instanceof B?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=i.getVariableValue(p.value[2]);s[2]=_ instanceof B?_.value:parseInt(p.value[2])}}const o=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new C(s,o));const u=s[0],f=s[1],d=s[2];for(let p=0,_=0;p<d;++p)for(let y=0;y<f;++y)for(let v=0;v<u;++v,++_){const T=[v,y,p],A=[v+t[0]*s[0],y+t[1]*s[1],p+t[2]*s[2]];i.setVariable("@local_invocation_id",new C(T,o)),i.setVariable("@global_invocation_id",new C(A,o)),i.setVariable("@local_invocation_index",new B(_,l)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const o=`@${s.value}`,l=t.getVariable(o);l!==void 0&&t.variables.set(i.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof _t;)e=e.right;return e instanceof un?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const o=t.clone(),l=this._execStatements(i,o);if(l)return l;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let o=0;o<s.node.args.length;++o){const l=s.node.args[o],u=this.evalExpression(e.args[o],i);i.setVariable(l.name,u,l)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof B?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof B?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof un){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof _t){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof Br?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new Br(i)}}return null}_assign(e,t){let i=null,s="<var>",o=null;if(e.variable instanceof _t){const f=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(f instanceof B||f instanceof C||f instanceof Te){if(d instanceof B||d instanceof C||d instanceof Te&&f.data.length===d.data.length)return void f.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof ct&&d instanceof ct&&f.buffer.byteLength-f.offset>=d.buffer.byteLength-d.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return f instanceof B||f instanceof C||f instanceof Te?d instanceof B||d instanceof C||d instanceof Te?void f.data.set(d.data.map((_,y)=>f.data[y]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(f instanceof B||f instanceof C||f instanceof Te)&&(d instanceof B||d instanceof C||d instanceof Te)?void f.data.set(d.data.map((_,y)=>f.data[y]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof _t){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const f=t.getVariable(s);if(!(f&&f.value instanceof Br))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=f.value.reference;let d=e.variable.postfix;if(!d){let p=e.variable.right;for(;p instanceof _t;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(i=i.getSubData(this,d,t))}}else{o=e.variable.postfix,s=this.getVariableName(e.variable,t);const f=t.getVariable(s);if(f===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=f.value}if(i instanceof Br&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),u=e.operator;if(u!=="="){const f=i.getSubData(this,o,t);if(f instanceof C&&l instanceof B){const d=f.data,p=l.value;if(u==="+=")for(let _=0;_<d.length;++_)d[_]+=p;else if(u==="-=")for(let _=0;_<d.length;++_)d[_]-=p;else if(u==="*=")for(let _=0;_<d.length;++_)d[_]*=p;else if(u==="/=")for(let _=0;_<d.length;++_)d[_]/=p;else if(u==="%=")for(let _=0;_<d.length;++_)d[_]%=p;else if(u==="&=")for(let _=0;_<d.length;++_)d[_]&=p;else if(u==="|=")for(let _=0;_<d.length;++_)d[_]|=p;else if(u==="^=")for(let _=0;_<d.length;++_)d[_]^=p;else if(u==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p;else if(u===">>=")for(let _=0;_<d.length;++_)d[_]>>=p;else console.error(`Invalid operator ${u}. Line ${e.line}`)}else if(f instanceof C&&l instanceof C){const d=f.data,p=l.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(u==="+=")for(let _=0;_<d.length;++_)d[_]+=p[_];else if(u==="-=")for(let _=0;_<d.length;++_)d[_]-=p[_];else if(u==="*=")for(let _=0;_<d.length;++_)d[_]*=p[_];else if(u==="/=")for(let _=0;_<d.length;++_)d[_]/=p[_];else if(u==="%=")for(let _=0;_<d.length;++_)d[_]%=p[_];else if(u==="&=")for(let _=0;_<d.length;++_)d[_]&=p[_];else if(u==="|=")for(let _=0;_<d.length;++_)d[_]|=p[_];else if(u==="^=")for(let _=0;_<d.length;++_)d[_]^=p[_];else if(u==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p[_];else if(u===">>=")for(let _=0;_<d.length;++_)d[_]>>=p[_];else console.error(`Invalid operator ${u}. Line ${e.line}`)}else{if(!(f instanceof B&&l instanceof B))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);u==="+="?f.value+=l.value:u==="-="?f.value-=l.value:u==="*="?f.value*=l.value:u==="/="?f.value/=l.value:u==="%="?f.value%=l.value:u==="&="?f.value&=l.value:u==="|="?f.value|=l.value:u==="^="?f.value^=l.value:u==="<<="?f.value<<=l.value:u===">>="?f.value>>=l.value:console.error(`Invalid operator ${u}. Line ${e.line}`)}return void(i instanceof ct&&i.setDataValue(this,f,o,t))}if(i instanceof ct)i.setDataValue(this,l,o,t);else if(o){if(!(i instanceof C||i instanceof Te))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(o instanceof Jr){const f=this.evalExpression(o.index,t).value;if(i instanceof C){if(!(l instanceof B))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[f]=l.value}else{if(!(i instanceof Te))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(o.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l instanceof C))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(o instanceof $s){const f=o.value;if(!(i instanceof C))return void console.error(`Invalid assignment to ${f}. Variable ${s} is not a vector. Line ${e.line}`);if(l instanceof B){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);if(f==="x")i.data[0]=l.value;else if(f==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[1]=l.value}else if(f==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[2]=l.value}else if(f==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof C))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(f.length!==l.data.length)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);for(let d=0;d<f.length;++d){const p=f[d];if(p==="x"||p==="r")i.data[0]=l.data[d];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[1]=l.data[d]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[2]=l.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[3]=l.data[d]}}}}}else i instanceof B&&l instanceof B?i.value=l.value:i instanceof C&&l instanceof C||i instanceof Te&&l instanceof Te?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`)}_function(e,t){const i=new lg(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof _t||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const o=new Xn(e.type,[]);i=this._evalCreate(o,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof _t||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Aa||e.type instanceof mi||e.type instanceof V){const o=new Xn(e.type,[]);i=this._evalCreate(o,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof B))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const o of e.cases)if(o instanceof m3)for(const l of o.selectors){if(l instanceof Vc){s=o;continue}const u=this.evalExpression(l,t);if(!(u instanceof B))return console.error(`Invalid case selector. Line ${e.line}`),null;if(u.value===i.value)return this._execStatements(o.body,t)}else o instanceof _3&&(s=o);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof B))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const o=this.evalExpression(s.condition,t);if(!(o instanceof B))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof B?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Lt._breakObj)break;if(i!==null&&i!==Lt._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===Lt._breakObj)break;if(i===Lt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Lt._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Lt._breakObj)break;if(i!==Lt._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof B){const o=$b(i.value,i.typeInfo.name,s.name);return new B(o,this.getTypeInfo(s))}if(i instanceof C){const o=i.typeInfo.getTypeName();let l="";if(o.endsWith("f"))l="f32";else if(o.endsWith("i"))l="i32";else if(o.endsWith("u"))l="u32";else if(o.endsWith("b"))l="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;l="f16"}const u=s.getTypeName();let f="";if(u.endsWith("f"))f="f32";else if(u.endsWith("i"))f="i32";else if(u.endsWith("u"))f="u32";else if(u.endsWith("b"))f="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const d=(function(p,_,y){if(_===y)return p;const v=new Array(p.length);for(let T=0;T<p.length;T++)v[T]=$b(p[T],_,y);return v})(Array.from(i.data),l,f);return new C(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof Xn){if(e.type===null)return ip.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof Xn?e.type.name:e.name,o=e instanceof Xn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(o.size===0)return null;const l=new ct(new ArrayBuffer(o.size),o,0);if(o instanceof ts){if(e.args)for(let u=0;u<e.args.length;++u){const f=o.members[u],d=e.args[u],p=this.evalExpression(d,t);l.setData(this,p,f.type,f.offset,t)}}else if(o instanceof os){let u=0;if(e.args)for(let f=0;f<e.args.length;++f){const d=e.args[f],p=this.evalExpression(d,t);o.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=p.typeInfo),l.setData(this,p,o.format,u,t),u+=o.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof Xn?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new B(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=Lt._priority.get(t.name);Lt._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new Br(i);if(e.operator==="*")return i instanceof Br?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof B?i.value:i instanceof C?Array.from(i.data):null;switch(e.operator){case"+":{if(ce(s)){const u=s.map((f,d)=>+f);return new C(u,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new B(+o,l)}case"-":{if(ce(s)){const u=s.map((f,d)=>-f);return new C(u,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new B(-o,l)}case"!":{if(ce(s)){const u=s.map((f,d)=>f?0:1);return new C(u,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new B(o?0:1,l)}case"~":{if(ce(s)){const u=s.map((f,d)=>~f);return new C(u,i.typeInfo)}const o=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new B(~o,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),o=i instanceof B?i.value:i instanceof C||i instanceof Te?Array.from(i.data):null,l=s instanceof B?s.value:s instanceof C||s instanceof Te?Array.from(s.data):null;switch(e.operator){case"+":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v+_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y+p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p+y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u+f,d)}case"-":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v-_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y-p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p-y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u-f,d)}case"*":{if(ce(o)&&ce(l)){const p=o,_=l;if(i instanceof Te&&s instanceof Te){const y=(function(R,M,H,O){if(Vt[M.name]===void 0||Vt[O.name]===void 0)return null;const L=Vt[M.name][0],X=Vt[M.name][1],Y=Vt[O.name][0];if(L!==Vt[O.name][1])return null;const re=new Array(Y*X);for(let le=0;le<X;le++)for(let oe=0;oe<Y;oe++){let fe=0;for(let me=0;me<L;me++)fe+=R[me*X+le]*H[oe*L+me];re[le*Y+oe]=fe}return re})(p,i.typeInfo,_,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const v=Vt[s.typeInfo.name][0],T=Vt[i.typeInfo.name][1],A=this.getTypeInfo(`mat${v}x${T}f`);return new Te(y,A)}if(i instanceof Te&&s instanceof C){const y=(function(v,T,A,R){if(Vt[T.name]===void 0||md[R.name]===void 0)return null;const M=Vt[T.name][0],H=Vt[T.name][1];if(M!==A.length)return null;const O=new Array(H);for(let L=0;L<H;L++){let X=0;for(let Y=0;Y<M;Y++)X+=v[Y*H+L]*A[Y];O[L]=X}return O})(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new C(y,s.typeInfo)}if(i instanceof C&&s instanceof Te){const y=(function(v,T,A,R){if(md[T.name]===void 0||Vt[R.name]===void 0)return null;const M=Vt[R.name][0],H=Vt[R.name][1];if(H!==v.length)return null;const O=[];for(let L=0;L<M;L++){let X=0;for(let Y=0;Y<H;Y++)X+=v[Y]*A[Y*M+L];O[L]=X}return O})(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new C(y,i.typeInfo)}{if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v*_[T]);return new C(y,i.typeInfo)}}if(ce(o)){const p=l,_=o.map((y,v)=>y*p);return i instanceof Te?new Te(_,i.typeInfo):new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p*y);return s instanceof Te?new Te(_,s.typeInfo):new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u*f,d)}case"%":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v%_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y%p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p%y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u%f,d)}case"/":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v/_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y/p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p/y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u/f,d)}case"&":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v&_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y&p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p&y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u&f,d)}case"|":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v|_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y|p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p|y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u|f,d)}case"^":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v^_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y^p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p^y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u^f,d)}case"<<":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v<<_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y<<p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p<<y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u<<f,d)}case">>":{if(ce(o)&&ce(l)){const p=o,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v>>_[T]);return new C(y,i.typeInfo)}if(ce(o)){const p=l,_=o.map((y,v)=>y>>p);return new C(_,i.typeInfo)}if(ce(l)){const p=o,_=l.map((y,v)=>p>>y);return new C(_,s.typeInfo)}const u=o,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new B(u>>f,d)}case">":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p>f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d>u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u>d?1:0);return new C(f,s.typeInfo)}return new B(o>l?1:0,this.getTypeInfo("bool"));case"<":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p<f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d<u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u<d?1:0);return new C(f,s.typeInfo)}return new B(o<l?1:0,this.getTypeInfo("bool"));case"==":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p===f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d==u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u==d?1:0);return new C(f,s.typeInfo)}return new B(o===l?1:0,this.getTypeInfo("bool"));case"!=":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p!==f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d!==u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u!==d?1:0);return new C(f,s.typeInfo)}return new B(o!==l?1:0,this.getTypeInfo("bool"));case">=":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p>=f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d>=u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u>=d?1:0);return new C(f,s.typeInfo)}return new B(o>=l?1:0,this.getTypeInfo("bool"));case"<=":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p<=f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d<=u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u<=d?1:0);return new C(f,s.typeInfo)}return new B(o<=l?1:0,this.getTypeInfo("bool"));case"&&":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p&&f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d&&u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u&&d?1:0);return new C(f,s.typeInfo)}return new B(o&&l?1:0,this.getTypeInfo("bool"));case"||":if(ce(o)&&ce(l)){const u=o,f=l;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p||f[_]?1:0);return new C(d,i.typeInfo)}if(ce(o)){const u=l,f=o.map((d,p)=>d||u?1:0);return new C(f,i.typeInfo)}if(ce(l)){const u=o,f=l.map((d,p)=>u||d?1:0);return new C(f,s.typeInfo)}return new B(o||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<s.node.args.length;++o){const l=s.node.args[o],u=this.evalExpression(e.args[o],i);i.createVariable(l.name,u,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let o=0;o<i.node.args.length;++o){const l=i.node.args[o],u=this.evalExpression(e.args[o],s);s.setVariable(l.name,u,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new B(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),o=md[s];if(o===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof vt)if(e.isVector){const u=e.vectorValue;for(const f of u)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const f=this.evalExpression(u,t);if(f instanceof C){const d=f.data;for(let p=0;p<d.length;++p){let _=d[p];l.push(_)}}else if(f instanceof B){let d=f.value;l.push(d)}}if(e.type instanceof V&&e.type.format===null&&(e.type.format=V.f32),l.length===0){const u=new Array(o).fill(0);return new C(u,i).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<o;)l.push(l[0]);return l.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new C(l.length>o?l.slice(0,o):l,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),o=Vt[s];if(o===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof vt)if(e.isVector){const u=e.vectorValue;for(const f of u)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const f=this.evalExpression(u,t);f instanceof C?l.push(...f.data):f instanceof B?l.push(f.value):f instanceof Te&&l.push(...f.data)}if(i instanceof Ws&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const u=new Array(o[2]).fill(0);return new Te(u,i).getSubData(this,e.postfix,t)}return l.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Te(l,i).getSubData(this,e.postfix,t)}}Lt._breakObj=new wn(new Sn("BREAK",null),null),Lt._continueObj=new wn(new Sn("CONTINUE",null),null),Lt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class gM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class mM{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new gM,this._exec=new Lt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,o=i.countNode;if(o instanceof un){const l=o.name,u=this._context.constants.get(l);if(u)try{const f=u.constEvaluate(this._exec);s.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof jb||s instanceof zc?s.type=this._forwardType(s.type):s instanceof Aa?s.format=this._forwardType(s.format):s instanceof yi||s instanceof Sa||s instanceof Fc?s.type=this._forwardType(s.type):s instanceof Na?s.returnType=this._forwardType(s.returnType):s instanceof Hb&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof Vb){const t=this._getType(e.name);if(t)return t}else e instanceof zc?e.type=this._forwardType(e.type):e instanceof Aa&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new rM(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==w.eof}_match(e){if(e instanceof F)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const o of e){if(i===o)return!0;o===w.tokens.name&&(s=!0)}if(s){const o=w.tokens.name.rule.exec(t.lexeme);if(o&&o.index==0&&o[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===w.tokens.name){const i=w.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._match(w.keywords.alias)){const t=this._type_alias();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.diagnostic)){const t=this._diagnostic();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.requires)){const t=this._requires_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.enable)){const t=this._enable_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(w.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(w.keywords.fn))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected function name.").toString();this._consume(w.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(w.tokens.paren_right))do{if(this._check(w.tokens.paren_right))break;const u=this._attribute(),f=this._consume(w.tokens.name,"Expected argument name.").toString();this._consume(w.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(this._updateNode(new Hb(f,p,u))))}while(this._match(w.tokens.comma));this._consume(w.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(w.tokens.arrow)){const u=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=u)}const o=this._compound_statement(),l=this._currentLine;return this._updateNode(new Na(t,i,s,o,e,l),e)}_compound_statement(){const e=[];for(this._consume(w.tokens.brace_left,"Expected '{' for block.");!this._check(w.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(w.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._check(w.tokens.attr)&&this._attribute(),this._check(w.keywords.if))return this._if_statement();if(this._check(w.keywords.switch))return this._switch_statement();if(this._check(w.keywords.loop))return this._loop_statement();if(this._check(w.keywords.for))return this._for_statement();if(this._check(w.keywords.while))return this._while_statement();if(this._check(w.keywords.continuing))return this._continuing_statement();if(this._check(w.keywords.static_assert))return this._static_assert_statement();if(this._check(w.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(w.keywords.return))e=this._return_statement();else if(this._check([w.keywords.var,w.keywords.let,w.keywords.const]))e=this._variable_statement();else if(this._match(w.keywords.discard))e=this._updateNode(new nM);else if(this._match(w.keywords.break)){const t=this._updateNode(new u3);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(w.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(w.keywords.continue)){const t=this._updateNode(new f3);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(w.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(w.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new JR(t),e)}_while_statement(){if(!this._match(w.keywords.while))return null;const e=this._updateNode(new t3(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(w.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new np(i,e),t)}_for_statement(){if(!this._match(w.keywords.for))return null;this._consume(w.tokens.paren_left,"Expected '('.");const e=this._updateNode(new n3(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(w.tokens.semicolon)?null:this._for_init(),this._consume(w.tokens.semicolon,"Expected ';'."),e.condition=this._check(w.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(w.tokens.semicolon,"Expected ';'."),e.increment=this._check(w.tokens.paren_right)?null:this._for_increment(),this._consume(w.tokens.paren_right,"Expected ')'."),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(w.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(w.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new yi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(w.keywords.let)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(w.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(w.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Sa(t,i,null,null,s),e)}if(this._match(w.keywords.const)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(w.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(w.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof vt&&(i=s.type),this._updateNode(new Fc(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(w.increment_operators))return this._current=e,null;const i=this._consume(w.increment_operators,"Expected increment operator");return this._updateNode(new i3(i.type===w.tokens.plus_plus?Vr.increment:Vr.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(w.tokens.brace_right))return null;let i=this._match(w.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(w.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new s3(ga.parse(s.lexeme),e,o),t)}_func_call_statement(){if(!this._check(w.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(w.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new ig(i.lexeme,s),e)}_loop_statement(){if(!this._match(w.keywords.loop))return null;this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new r3([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof np){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(w.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(w.keywords.switch))return null;const e=this._updateNode(new o3(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(w.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([w.keywords.default,w.keywords.case]);){if(this._match(w.keywords.case)){const i=this._case_selectors();for(const o of i)if(o instanceof Vc){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new m3(i,s)))}if(this._match(w.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new _3(i)))}}return e}_case_selectors(){const e=[];for(this._match(w.keywords.default)?e.push(this._updateNode(new Vc)):e.push(this._shift_expression());this._match(w.tokens.comma);)this._match(w.keywords.default)?e.push(this._updateNode(new Vc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(w.keywords.fallthrough))return this._consume(w.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(w.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let o=null;return this._match(w.keywords.else)&&(this._check(w.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new a3(t,i,s,o),e)}_match_elseif(){return this._tokens[this._current].type===w.keywords.else&&this._tokens[this._current+1].type===w.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new iM(t,i))),this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(w.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new l3(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(w.tokens.or_or);)e=this._updateNode(new In(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(w.tokens.and_and);)e=this._updateNode(new In(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(w.tokens.or);)e=this._updateNode(new In(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(w.tokens.xor);)e=this._updateNode(new In(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(w.tokens.and);)e=this._updateNode(new In(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([w.tokens.equal_equal,w.tokens.not_equal])?this._updateNode(new In(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([w.tokens.less_than,w.tokens.greater_than,w.tokens.less_than_equal,w.tokens.greater_than_equal]);)e=this._updateNode(new In(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([w.tokens.shift_left,w.tokens.shift_right]);)e=this._updateNode(new In(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([w.tokens.plus,w.tokens.minus]);)e=this._updateNode(new In(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([w.tokens.star,w.tokens.forward_slash,w.tokens.modulo]);)e=this._updateNode(new In(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([w.tokens.minus,w.tokens.bang,w.tokens.tilde,w.tokens.star,w.tokens.and])?this._updateNode(new _t(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(w.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(w.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Jr(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(w.tokens.period)){const e=this._consume(w.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new $s(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return te.void;case"bool":return te.bool;case"i32":return te.i32;case"u32":return te.u32;case"f32":return te.f32;case"f16":return te.f16;case"vec2f":return V.vec2f;case"vec3f":return V.vec3f;case"vec4f":return V.vec4f;case"vec2i":return V.vec2i;case"vec3i":return V.vec3i;case"vec4i":return V.vec4i;case"vec2u":return V.vec2u;case"vec3u":return V.vec3u;case"vec4u":return V.vec4u;case"vec2h":return V.vec2h;case"vec3h":return V.vec3h;case"vec4h":return V.vec4h;case"mat2x2f":return V.mat2x2f;case"mat2x3f":return V.mat2x3f;case"mat2x4f":return V.mat2x4f;case"mat3x2f":return V.mat3x2f;case"mat3x3f":return V.mat3x3f;case"mat3x4f":return V.mat3x4f;case"mat4x2f":return V.mat4x2f;case"mat4x3f":return V.mat4x3f;case"mat4x4f":return V.mat4x4f;case"mat2x2h":return V.mat2x2h;case"mat2x3h":return V.mat2x3h;case"mat2x4h":return V.mat2x4h;case"mat3x2h":return V.mat3x2h;case"mat3x3h":return V.mat3x3h;case"mat3x4h":return V.mat3x4h;case"mat4x2h":return V.mat4x2h;case"mat4x3h":return V.mat4x3h;case"mat4x4h":return V.mat4x4h;case"mat2x2i":return V.mat2x2i;case"mat2x3i":return V.mat2x3i;case"mat2x4i":return V.mat2x4i;case"mat3x2i":return V.mat3x2i;case"mat3x3i":return V.mat3x3i;case"mat3x4i":return V.mat3x4i;case"mat4x2i":return V.mat4x2i;case"mat4x3i":return V.mat4x3i;case"mat4x4i":return V.mat4x4i;case"mat2x2u":return V.mat2x2u;case"mat2x3u":return V.mat2x3u;case"mat2x4u":return V.mat2x4u;case"mat3x2u":return V.mat3x2u;case"mat3x3u":return V.mat3x3u;case"mat3x4u":return V.mat3x4u;case"mat4x2u":return V.mat4x2u;case"mat4x3u":return V.mat4x3u;case"mat4x4u":return V.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(w.tokens.ident)){const i=this._previous().toString();if(this._check(w.tokens.paren_left)){const s=this._argument_expression_list(),o=this._getType(i);return o!==null?this._updateNode(new Xn(o,s)):this._updateNode(new rg(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new h3(i,s.value))}return this._updateNode(new un(i))}if(this._match(w.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?te.i32:i.endsWith("u")||i.endsWith("U")?te.u32:te.x32;const o=parseInt(i);return this._validateTypeRange(o,s),this._updateNode(new vt(new B(o,this._exec.getTypeInfo(s)),s))}if(this._match(w.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,te.u32),this._updateNode(new vt(new B(i,this._exec.getTypeInfo(te.u32)),te.u32))}if(this._match([w.tokens.decimal_float_literal,w.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const o=parseFloat(i);this._validateTypeRange(o,s?te.f16:te.f32);const l=s?te.f16:te.f32;return this._updateNode(new vt(new B(o,this._exec.getTypeInfo(l)),l))}if(this._match([w.keywords.true,w.keywords.false])){let i=this._previous().toString()===w.keywords.true.rule;return this._updateNode(new vt(new B(i?1:0,this._exec.getTypeInfo(te.bool)),te.bool))}if(this._check(w.tokens.paren_left))return this._paren_expression();if(this._match(w.keywords.bitcast)){this._consume(w.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(w.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new d3(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Xn(e,t))}_argument_expression_list(){if(!this._match(w.tokens.paren_left))return null;const e=[];do{if(this._check(w.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(w.tokens.comma));return this._consume(w.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(w.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(w.tokens.paren_right),e}_paren_expression(){this._consume(w.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(w.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(w.keywords.struct))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected name for struct.").toString();this._consume(w.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(w.tokens.brace_right);){const l=this._attribute(),u=this._consume(w.tokens.name,"Expected variable name.").toString();this._consume(w.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=f),this._check(w.tokens.brace_right)?this._match(w.tokens.comma):this._consume(w.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new jb(u,d,l)))}this._consume(w.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,o=this._updateNode(new mi(t,i,e,s),e);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(w.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof vt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof vt&&(e.type=e.value.type.name==="x32"?te.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(w.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(w.keywords.const))return null;const t=this._consume(w.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(w.tokens.colon)){const f=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=f)}let o=null;this._consume(w.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let f=[te.f32],d=l.constEvaluate(this._exec,f);d instanceof B&&this._validateTypeRange(d.value,f[0]),f[0]instanceof V&&f[0].format===null&&d.typeInfo instanceof Ws&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?f[0].format=te.f16:d.typeInfo.format.name==="f32"?f[0].format=te.f32:d.typeInfo.format.name==="i32"?f[0].format=te.i32:d.typeInfo.format.name==="u32"?f[0].format=te.u32:d.typeInfo.format.name==="bool"?f[0].format=te.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),o=this._updateNode(new vt(d,f[0])),this._exec.context.setVariable(t.toString(),d)}catch{o=l}if(s!==null&&o instanceof vt){if(o.type.name!=="x32"&&s.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${s.name}. Line:${this._currentLine}`);o.type=s,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else s===null&&o instanceof vt&&(s=(e=o?.type)!==null&&e!==void 0?e:te.f32,s===te.x32&&(s=te.i32));const u=this._updateNode(new Fc(t.toString(),s,"","",o),i);return this._context.constants.set(u.name,u),u}_global_let_decl(){if(!this._match(w.keywords.let))return null;const e=this._currentLine,t=this._consume(w.tokens.name,"Expected variable name");let i=null;if(this._match(w.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let s=null;if(this._match(w.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof vt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof vt&&(i=s.type.name==="x32"?te.i32:s.type);return s instanceof vt&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new Sa(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(w.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(w.tokens.less_than)&&(t=this._consume(w.storage_class,"Expected storage_class.").toString(),this._match(w.tokens.comma)&&(i=this._consume(w.access_mode,"Expected access_mode.").toString()),this._consume(w.tokens.greater_than,"Expected '>'."));const s=this._consume(w.tokens.name,"Expected variable name");let o=null;if(this._match(w.tokens.colon)){const l=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=l)}return this._updateNode(new yi(s.toString(),o,t,i,null),e)}_override_decl(){if(!this._match(w.keywords.override))return null;const e=this._consume(w.tokens.name,"Expected variable name");let t=null;if(this._match(w.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new ng(e.toString(),t,null))}_diagnostic(){this._consume(w.tokens.paren_left,"Expected '('");const e=this._consume(w.tokens.ident,"Expected severity control name.");this._consume(w.tokens.comma,"Expected ','");let t=this._consume(w.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(w.tokens.period)&&(t+=`.${this._consume(w.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(w.tokens.paren_right,"Expected ')'"),this._updateNode(new c3(e.toString(),t))}_enable_directive(){const e=this._consume(w.tokens.ident,"identity expected.");return this._updateNode(new eM(e.toString()))}_requires_directive(){const e=[this._consume(w.tokens.ident,"identity expected.").toString()];for(;this._match(w.tokens.comma);){const t=this._consume(w.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new tM(e))}_type_alias(){const e=this._consume(w.tokens.ident,"identity expected.");this._consume(w.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new sg(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([w.tokens.ident,...w.texel_format,w.keywords.bool,w.keywords.f32,w.keywords.i32,w.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new Vb(i));return this._forwardTypeCount++,s}return this._updateNode(new te(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(w.template_types)){let i=this._advance().toString(),s=null,o=null;return this._match(w.tokens.less_than)&&(s=this._type_decl(),o=null,this._match(w.tokens.comma)&&(o=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new V(i,s,o))}if(this._match(w.keywords.ptr)){let i=this._previous().toString();this._consume(w.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(w.storage_class,"Expected storage_class for pointer");this._consume(w.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let l=null;return this._match(w.tokens.comma)&&(l=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new zc(i,s.toString(),o,l))}const t=this._attribute();if(this._match(w.keywords.array)){let i=null,s=-1;const o=this._previous();let l=null;if(this._match(w.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let f="";if(this._match(w.tokens.comma)){l=this._shift_expression();try{f=l.constEvaluate(this._exec).toString(),l=null}catch{f="1"}}this._consume(w.tokens.greater_than,"Expected '>' for array."),s=f?parseInt(f):0}const u=this._updateNode(new Aa(o.toString(),t,i,s));return l&&this._deferArrayCountEval.push({arrayType:u,countNode:l}),u}return null}_texture_sampler_types(){if(this._match(w.sampler_type))return this._updateNode(new ma(this._previous().toString(),null,null));if(this._match(w.depth_texture_type))return this._updateNode(new ma(this._previous().toString(),null,null));if(this._match(w.sampled_texture_type)||this._match(w.multisampled_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ma(e.toString(),t,null))}if(this._match(w.storage_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(w.texel_format,"Invalid texel format.").toString();this._consume(w.tokens.comma,"Expected ',' after texel format.");const i=this._consume(w.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ma(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(w.tokens.attr);){const t=this._consume(w.attribute_name,"Expected attribute name"),i=this._updateNode(new y3(t.toString(),null));if(this._match(w.tokens.paren_left)){if(i.value=this._consume(w.literal_or_ident,"Expected attribute value").toString(),this._check(w.tokens.comma)){this._advance();do{const s=this._consume(w.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(w.tokens.comma))}this._consume(w.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class _M extends Yn{constructor(e){super(),e&&this.update(e)}update(e){const t=new mM().parse(e);this.updateAST(t)}}function yM(n){const e={attributes:[],bindings:[]};let t;try{t=bM(n)}catch(o){return ie.error(o.message)(),e}for(const o of t.uniforms){const l=[];for(const u of o.type?.members||[])l.push({name:u.name,type:Xb(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const i=t.entry.vertex[0],s=i?.inputs.length||0;for(let o=0;o<s;o++){const l=i.inputs[o];if(l.locationType==="location"){const u=Xb(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function Xb(n){return n?.format?`${n.name}<${n.format.name}>`:n.name}function bM(n){try{return new _M(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const vM={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...vM}};const Kt=globalThis.mathgl.config;function TM(n,{precision:e=Kt.precision}={}){return n=xM(n),`${parseFloat(n.toPrecision(e))}`}function Xs(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ns(n,e,t){return AM(n,i=>Math.max(e,Math.min(t,i)))}function Us(n,e,t){return Xs(n)?n.map((i,s)=>Us(i,e[s],t)):t*e+(1-t)*n}function vi(n,e,t){const i=Kt.EPSILON;try{if(n===e)return!0;if(Xs(n)&&Xs(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!vi(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Kt.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Kt.EPSILON=i}}function xM(n){return Math.round(n/Kt.EPSILON)*Kt.EPSILON}function SM(n){return n.clone?n.clone():new Array(n.length)}function AM(n,e,t){if(Xs(n)){const i=n;t=t||SM(i);for(let s=0;s<t.length&&s<i.length;++s){const o=typeof n=="number"?n:n[s];t[s]=e(o,s,t)}return t}return e(n)}class ug extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Xs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Kt)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+TM(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!vi(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const o=e[s],l=typeof t=="number"?t:t[s];this[s]=o+i*(l-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Kt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function wM(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Je(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function wa(n,e,t=""){if(Kt.debug&&!wM(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function Da(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class b3 extends ug{get x(){return this[0]}set x(e){this[0]=Je(e)}get y(){return this[1]}set y(e){this[1]=Je(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return Je(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return Je(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Da(e>=0&&e<this.ELEMENTS,"index is out of range"),Je(this[e])}setComponent(e,t){return Da(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Ea=1e-6;let Dn=typeof Float32Array<"u"?Float32Array:Array;function EM(){const n=new Dn(2);return Dn!=Float32Array&&(n[0]=0,n[1]=0),n}function qb(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function CM(n,e){return n[0]=-e[0],n[1]=-e[1],n}function v3(n,e,t,i){const s=e[0],o=e[1];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n}function RM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[3]*s+t[6],n[1]=t[1]*i+t[4]*s+t[7],n}function MM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}(function(){const n=EM();return function(e,t,i,s,o,l){let u,f;for(t||(t=2),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,u=i;u<f;u+=t)n[0]=e[u],n[1]=e[u+1],o(n,n,l),e[u]=n[0],e[u+1]=n[1];return e}})();function OM(n,e,t){const i=e[0],s=e[1],o=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/o,n[1]=(t[1]*i+t[5]*s)/o,n}function T3(n,e,t){const i=e[0],s=e[1],o=e[2],l=t[3]*i+t[7]*s+t[11]*o||1;return n[0]=(t[0]*i+t[4]*s+t[8]*o)/l,n[1]=(t[1]*i+t[5]*s+t[9]*o)/l,n[2]=(t[2]*i+t[6]*s+t[10]*o)/l,n}function IM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function PM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n[3]=e[3],n}function x3(n,e,t){const i=e[0],s=e[1],o=e[2];return n[0]=t[0]*i+t[3]*s+t[6]*o,n[1]=t[1]*i+t[4]*s+t[7]*o,n[2]=t[2]*i+t[5]*s+t[8]*o,n[3]=e[3],n}function S3(){const n=new Dn(3);return Dn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function NM(n){const e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function Yb(n,e,t){const i=new Dn(3);return i[0]=n,i[1]=e,i[2]=t,i}function DM(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function kM(n){const e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function BM(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function LM(n,e){const t=e[0],i=e[1],s=e[2];let o=t*t+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n}function A3(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Hc(n,e,t){const i=e[0],s=e[1],o=e[2],l=t[0],u=t[1],f=t[2];return n[0]=s*f-o*u,n[1]=o*l-i*f,n[2]=i*u-s*l,n}function UM(n,e,t,i){const s=e[0],o=e[1],l=e[2];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n[2]=l+i*(t[2]-l),n}function fg(n,e,t){const i=e[0],s=e[1],o=e[2];let l=t[3]*i+t[7]*s+t[11]*o+t[15];return l=l||1,n[0]=(t[0]*i+t[4]*s+t[8]*o+t[12])/l,n[1]=(t[1]*i+t[5]*s+t[9]*o+t[13])/l,n[2]=(t[2]*i+t[6]*s+t[10]*o+t[14])/l,n}function w3(n,e,t){const i=e[0],s=e[1],o=e[2];return n[0]=i*t[0]+s*t[3]+o*t[6],n[1]=i*t[1]+s*t[4]+o*t[7],n[2]=i*t[2]+s*t[5]+o*t[8],n}function E3(n,e,t){const i=t[0],s=t[1],o=t[2],l=t[3],u=e[0],f=e[1],d=e[2];let p=s*d-o*f,_=o*u-i*d,y=i*f-s*u,v=s*y-o*_,T=o*p-i*y,A=i*_-s*p;const R=l*2;return p*=R,_*=R,y*=R,v*=2,T*=2,A*=2,n[0]=u+p+v,n[1]=f+_+T,n[2]=d+y+A,n}function FM(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0],o[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),o[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function zM(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),o[1]=s[1],o[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function VM(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function HM(n,e){const t=n[0],i=n[1],s=n[2],o=e[0],l=e[1],u=e[2],f=Math.sqrt((t*t+i*i+s*s)*(o*o+l*l+u*u)),d=f&&A3(n,e)/f;return Math.acos(Math.min(Math.max(d,-1),1))}const C3=DM,R3=NM,_d=kM;(function(){const n=S3();return function(e,t,i,s,o,l){let u,f;for(t||(t=3),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,u=i;u<f;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],o(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2];return e}})();const yd=[0,0,0];let _c;class ue extends b3{static get ZERO(){return _c||(_c=new ue(0,0,0),Object.freeze(_c)),_c}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&Xs(e)?this.copy(e):(Kt.debug&&(Je(e),Je(t),Je(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Kt.debug&&(Je(e.x),Je(e.y),Je(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Je(e)}angle(e){return HM(this,e)}cross(e){return Hc(this,this,e),this.check()}rotateX({radians:e,origin:t=yd}){return FM(this,this,t,e),this.check()}rotateY({radians:e,origin:t=yd}){return zM(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=yd}){return VM(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return fg(this,this,e),this.check()}transformAsVector(e){return T3(this,this,e),this.check()}transformByMatrix3(e){return w3(this,this,e),this.check()}transformByMatrix2(e){return IM(this,this,e),this.check()}transformByQuaternion(e){return E3(this,this,e),this.check()}}let yc;class hg extends b3{static get ZERO(){return yc||(yc=new hg(0,0,0,0),Object.freeze(yc)),yc}constructor(e=0,t=0,i=0,s=0){super(-0,-0,-0,-0),Xs(e)&&arguments.length===1?this.copy(e):(Kt.debug&&(Je(e),Je(t),Je(i),Je(s)),this[0]=e,this[1]=t,this[2]=i,this[3]=s)}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Kt.debug&&(Je(e.x),Je(e.y),Je(e.z),Je(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Je(e)}get w(){return this[3]}set w(e){this[3]=Je(e)}transform(e){return fg(this,this,e),this.check()}transformByMatrix3(e){return x3(this,this,e),this.check()}transformByMatrix2(e){return PM(this,this,e),this.check()}transformByQuaternion(e){return E3(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class M3 extends ug{toString(){let e="[";if(Kt.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=Je(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function jM(){const n=new Dn(9);return Dn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function WM(n,e){if(n===e){const t=e[1],i=e[2],s=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=i,n[7]=s}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function $M(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],f=e[6],d=e[7],p=e[8],_=p*l-u*d,y=-p*o+u*f,v=d*o-l*f;let T=t*_+i*y+s*v;return T?(T=1/T,n[0]=_*T,n[1]=(-p*i+s*d)*T,n[2]=(u*i-s*l)*T,n[3]=y*T,n[4]=(p*t-s*f)*T,n[5]=(-u*t+s*o)*T,n[6]=v*T,n[7]=(-d*t+i*f)*T,n[8]=(l*t-i*o)*T,n):null}function XM(n){const e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],l=n[5],u=n[6],f=n[7],d=n[8];return e*(d*o-l*f)+t*(-d*s+l*u)+i*(f*s-o*u)}function Kb(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],u=e[4],f=e[5],d=e[6],p=e[7],_=e[8],y=t[0],v=t[1],T=t[2],A=t[3],R=t[4],M=t[5],H=t[6],O=t[7],L=t[8];return n[0]=y*i+v*l+T*d,n[1]=y*s+v*u+T*p,n[2]=y*o+v*f+T*_,n[3]=A*i+R*l+M*d,n[4]=A*s+R*u+M*p,n[5]=A*o+R*f+M*_,n[6]=H*i+O*l+L*d,n[7]=H*s+O*u+L*p,n[8]=H*o+O*f+L*_,n}function qM(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],u=e[4],f=e[5],d=e[6],p=e[7],_=e[8],y=t[0],v=t[1];return n[0]=i,n[1]=s,n[2]=o,n[3]=l,n[4]=u,n[5]=f,n[6]=y*i+v*l+d,n[7]=y*s+v*u+p,n[8]=y*o+v*f+_,n}function YM(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],u=e[4],f=e[5],d=e[6],p=e[7],_=e[8],y=Math.sin(t),v=Math.cos(t);return n[0]=v*i+y*l,n[1]=v*s+y*u,n[2]=v*o+y*f,n[3]=v*l-y*i,n[4]=v*u-y*s,n[5]=v*f-y*o,n[6]=d,n[7]=p,n[8]=_,n}function Zb(n,e,t){const i=t[0],s=t[1];return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function KM(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=t+t,u=i+i,f=s+s,d=t*l,p=i*l,_=i*u,y=s*l,v=s*u,T=s*f,A=o*l,R=o*u,M=o*f;return n[0]=1-_-T,n[3]=p-M,n[6]=y+R,n[1]=p+M,n[4]=1-d-T,n[7]=v-A,n[2]=y-R,n[5]=v+A,n[8]=1-d-_,n}var sp;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(sp||(sp={}));const ZM=Object.freeze([1,0,0,0,1,0,0,0,1]);class Nt extends M3{static get IDENTITY(){return QM()}static get ZERO(){return GM()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return sp}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(ZM)}fromObject(e){return this.check()}fromQuaternion(e){return KM(this,e),this.check()}set(e,t,i,s,o,l,u,f,d){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=l,this[6]=u,this[7]=f,this[8]=d,this.check()}setRowMajor(e,t,i,s,o,l,u,f,d){return this[0]=e,this[1]=s,this[2]=u,this[3]=t,this[4]=o,this[5]=f,this[6]=i,this[7]=l,this[8]=d,this.check()}determinant(){return XM(this)}transpose(){return WM(this,this),this.check()}invert(){return $M(this,this),this.check()}multiplyLeft(e){return Kb(this,e,this),this.check()}multiplyRight(e){return Kb(this,this,e),this.check()}rotate(e){return YM(this,this,e),this.check()}scale(e){return Array.isArray(e)?Zb(this,this,e):Zb(this,this,[e,e]),this.check()}translate(e){return qM(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=RM(t||[-0,-0],e,this);break;case 3:i=w3(t||[-0,-0,-0],e,this);break;case 4:i=x3(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return wa(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let bc,vc=null;function GM(){return bc||(bc=new Nt([0,0,0,0,0,0,0,0,0]),Object.freeze(bc)),bc}function QM(){return vc||(vc=new Nt,Object.freeze(vc)),vc}function JM(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function eO(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],o=e[6],l=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=o,n[11]=e[14],n[12]=s,n[13]=l,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function rp(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],f=e[6],d=e[7],p=e[8],_=e[9],y=e[10],v=e[11],T=e[12],A=e[13],R=e[14],M=e[15],H=t*u-i*l,O=t*f-s*l,L=t*d-o*l,X=i*f-s*u,Y=i*d-o*u,re=s*d-o*f,le=p*A-_*T,oe=p*R-y*T,fe=p*M-v*T,me=_*R-y*A,ve=_*M-v*A,xe=y*M-v*R;let de=H*xe-O*ve+L*me+X*fe-Y*oe+re*le;return de?(de=1/de,n[0]=(u*xe-f*ve+d*me)*de,n[1]=(s*ve-i*xe-o*me)*de,n[2]=(A*re-R*Y+M*X)*de,n[3]=(y*Y-_*re-v*X)*de,n[4]=(f*fe-l*xe-d*oe)*de,n[5]=(t*xe-s*fe+o*oe)*de,n[6]=(R*L-T*re-M*O)*de,n[7]=(p*re-y*L+v*O)*de,n[8]=(l*ve-u*fe+d*le)*de,n[9]=(i*fe-t*ve-o*le)*de,n[10]=(T*Y-A*L+M*H)*de,n[11]=(_*L-p*Y-v*H)*de,n[12]=(u*oe-l*me-f*le)*de,n[13]=(t*me-i*oe+s*le)*de,n[14]=(A*O-T*X-R*H)*de,n[15]=(p*X-_*O+y*H)*de,n):null}function tO(n){const e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],l=n[5],u=n[6],f=n[7],d=n[8],p=n[9],_=n[10],y=n[11],v=n[12],T=n[13],A=n[14],R=n[15],M=e*l-t*o,H=e*u-i*o,O=t*u-i*l,L=d*T-p*v,X=d*A-_*v,Y=p*A-_*T,re=e*Y-t*X+i*L,le=o*Y-l*X+u*L,oe=d*O-p*H+_*M,fe=v*O-T*H+A*M;return f*re-s*le+R*oe-y*fe}function Fs(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],u=e[4],f=e[5],d=e[6],p=e[7],_=e[8],y=e[9],v=e[10],T=e[11],A=e[12],R=e[13],M=e[14],H=e[15];let O=t[0],L=t[1],X=t[2],Y=t[3];return n[0]=O*i+L*u+X*_+Y*A,n[1]=O*s+L*f+X*y+Y*R,n[2]=O*o+L*d+X*v+Y*M,n[3]=O*l+L*p+X*T+Y*H,O=t[4],L=t[5],X=t[6],Y=t[7],n[4]=O*i+L*u+X*_+Y*A,n[5]=O*s+L*f+X*y+Y*R,n[6]=O*o+L*d+X*v+Y*M,n[7]=O*l+L*p+X*T+Y*H,O=t[8],L=t[9],X=t[10],Y=t[11],n[8]=O*i+L*u+X*_+Y*A,n[9]=O*s+L*f+X*y+Y*R,n[10]=O*o+L*d+X*v+Y*M,n[11]=O*l+L*p+X*T+Y*H,O=t[12],L=t[13],X=t[14],Y=t[15],n[12]=O*i+L*u+X*_+Y*A,n[13]=O*s+L*f+X*y+Y*R,n[14]=O*o+L*d+X*v+Y*M,n[15]=O*l+L*p+X*T+Y*H,n}function hu(n,e,t){const i=t[0],s=t[1],o=t[2];let l,u,f,d,p,_,y,v,T,A,R,M;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*o+e[12],n[13]=e[1]*i+e[5]*s+e[9]*o+e[13],n[14]=e[2]*i+e[6]*s+e[10]*o+e[14],n[15]=e[3]*i+e[7]*s+e[11]*o+e[15]):(l=e[0],u=e[1],f=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],A=e[9],R=e[10],M=e[11],n[0]=l,n[1]=u,n[2]=f,n[3]=d,n[4]=p,n[5]=_,n[6]=y,n[7]=v,n[8]=T,n[9]=A,n[10]=R,n[11]=M,n[12]=l*i+p*s+T*o+e[12],n[13]=u*i+_*s+A*o+e[13],n[14]=f*i+y*s+R*o+e[14],n[15]=d*i+v*s+M*o+e[15]),n}function dg(n,e,t){const i=t[0],s=t[1],o=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function nO(n,e,t,i){let s=i[0],o=i[1],l=i[2],u=Math.sqrt(s*s+o*o+l*l),f,d,p,_,y,v,T,A,R,M,H,O,L,X,Y,re,le,oe,fe,me,ve,xe,de,We;return u<Ea?null:(u=1/u,s*=u,o*=u,l*=u,d=Math.sin(t),f=Math.cos(t),p=1-f,_=e[0],y=e[1],v=e[2],T=e[3],A=e[4],R=e[5],M=e[6],H=e[7],O=e[8],L=e[9],X=e[10],Y=e[11],re=s*s*p+f,le=o*s*p+l*d,oe=l*s*p-o*d,fe=s*o*p-l*d,me=o*o*p+f,ve=l*o*p+s*d,xe=s*l*p+o*d,de=o*l*p-s*d,We=l*l*p+f,n[0]=_*re+A*le+O*oe,n[1]=y*re+R*le+L*oe,n[2]=v*re+M*le+X*oe,n[3]=T*re+H*le+Y*oe,n[4]=_*fe+A*me+O*ve,n[5]=y*fe+R*me+L*ve,n[6]=v*fe+M*me+X*ve,n[7]=T*fe+H*me+Y*ve,n[8]=_*xe+A*de+O*We,n[9]=y*xe+R*de+L*We,n[10]=v*xe+M*de+X*We,n[11]=T*xe+H*de+Y*We,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function O3(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[4],l=e[5],u=e[6],f=e[7],d=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*s+d*i,n[5]=l*s+p*i,n[6]=u*s+_*i,n[7]=f*s+y*i,n[8]=d*s-o*i,n[9]=p*s-l*i,n[10]=_*s-u*i,n[11]=y*s-f*i,n}function iO(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[0],l=e[1],u=e[2],f=e[3],d=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s-d*i,n[1]=l*s-p*i,n[2]=u*s-_*i,n[3]=f*s-y*i,n[8]=o*i+d*s,n[9]=l*i+p*s,n[10]=u*i+_*s,n[11]=f*i+y*s,n}function I3(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[0],l=e[1],u=e[2],f=e[3],d=e[4],p=e[5],_=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s+d*i,n[1]=l*s+p*i,n[2]=u*s+_*i,n[3]=f*s+y*i,n[4]=d*s-o*i,n[5]=p*s-l*i,n[6]=_*s-u*i,n[7]=y*s-f*i,n}function sO(n,e){const t=e[0],i=e[1],s=e[2],o=e[4],l=e[5],u=e[6],f=e[8],d=e[9],p=e[10];return n[0]=Math.sqrt(t*t+i*i+s*s),n[1]=Math.sqrt(o*o+l*l+u*u),n[2]=Math.sqrt(f*f+d*d+p*p),n}function rO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=t+t,u=i+i,f=s+s,d=t*l,p=i*l,_=i*u,y=s*l,v=s*u,T=s*f,A=o*l,R=o*u,M=o*f;return n[0]=1-_-T,n[1]=p+M,n[2]=y-R,n[3]=0,n[4]=p-M,n[5]=1-d-T,n[6]=v+A,n[7]=0,n[8]=y+R,n[9]=v-A,n[10]=1-d-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function oO(n,e,t,i,s,o,l){const u=1/(t-e),f=1/(s-i),d=1/(o-l);return n[0]=o*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*f,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(s+i)*f,n[10]=(l+o)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*o*2*d,n[15]=0,n}function aO(n,e,t,i,s){const o=1/Math.tan(e/2);if(n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const lO=aO;function cO(n,e,t,i,s,o,l){const u=1/(e-t),f=1/(i-s),d=1/(o-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*u,n[13]=(s+i)*f,n[14]=(l+o)*d,n[15]=1,n}const uO=cO;function fO(n,e,t,i){let s,o,l,u,f,d,p,_,y,v;const T=e[0],A=e[1],R=e[2],M=i[0],H=i[1],O=i[2],L=t[0],X=t[1],Y=t[2];return Math.abs(T-L)<Ea&&Math.abs(A-X)<Ea&&Math.abs(R-Y)<Ea?JM(n):(_=T-L,y=A-X,v=R-Y,s=1/Math.sqrt(_*_+y*y+v*v),_*=s,y*=s,v*=s,o=H*v-O*y,l=O*_-M*v,u=M*y-H*_,s=Math.sqrt(o*o+l*l+u*u),s?(s=1/s,o*=s,l*=s,u*=s):(o=0,l=0,u=0),f=y*u-v*l,d=v*o-_*u,p=_*l-y*o,s=Math.sqrt(f*f+d*d+p*p),s?(s=1/s,f*=s,d*=s,p*=s):(f=0,d=0,p=0),n[0]=o,n[1]=f,n[2]=_,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=u,n[9]=p,n[10]=v,n[11]=0,n[12]=-(o*T+l*A+u*R),n[13]=-(f*T+d*A+p*R),n[14]=-(_*T+y*A+v*R),n[15]=1,n)}function hO(){const n=new Dn(4);return Dn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function dO(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function pg(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function pO(n){const e=n[0],t=n[1],i=n[2],s=n[3];return Math.sqrt(e*e+t*t+i*i+s*s)}function gO(n){const e=n[0],t=n[1],i=n[2],s=n[3];return e*e+t*t+i*i+s*s}function mO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3];let l=t*t+i*i+s*s+o*o;return l>0&&(l=1/Math.sqrt(l)),n[0]=t*l,n[1]=i*l,n[2]=s*l,n[3]=o*l,n}function _O(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function yO(n,e,t,i){const s=e[0],o=e[1],l=e[2],u=e[3];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n[2]=l+i*(t[2]-l),n[3]=u+i*(t[3]-u),n}function ao(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*o+t[12]*l,n[1]=t[1]*i+t[5]*s+t[9]*o+t[13]*l,n[2]=t[2]*i+t[6]*s+t[10]*o+t[14]*l,n[3]=t[3]*i+t[7]*s+t[11]*o+t[15]*l,n}function bO(n,e,t){const i=e[0],s=e[1],o=e[2],l=t[0],u=t[1],f=t[2],d=t[3],p=d*i+u*o-f*s,_=d*s+f*i-l*o,y=d*o+l*s-u*i,v=-l*i-u*s-f*o;return n[0]=p*d+v*-l+_*-f-y*-u,n[1]=_*d+v*-u+y*-l-p*-f,n[2]=y*d+v*-f+p*-u-_*-l,n[3]=e[3],n}(function(){const n=hO();return function(e,t,i,s,o,l){let u,f;for(t||(t=4),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,u=i;u<f;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],n[3]=e[u+3],o(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2],e[u+3]=n[3];return e}})();var op;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(op||(op={}));const vO=45*Math.PI/180,TO=1,bd=.1,vd=500,xO=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Pt extends M3{static get IDENTITY(){return AO()}static get ZERO(){return SO()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return op}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,o,l,u,f,d,p,_,y,v,T,A,R){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=l,this[6]=u,this[7]=f,this[8]=d,this[9]=p,this[10]=_,this[11]=y,this[12]=v,this[13]=T,this[14]=A,this[15]=R,this.check()}setRowMajor(e,t,i,s,o,l,u,f,d,p,_,y,v,T,A,R){return this[0]=e,this[1]=o,this[2]=d,this[3]=v,this[4]=t,this[5]=l,this[6]=p,this[7]=T,this[8]=i,this[9]=u,this[10]=_,this[11]=A,this[12]=s,this[13]=f,this[14]=y,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(xO)}fromObject(e){return this.check()}fromQuaternion(e){return rO(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:o,near:l=bd,far:u=vd}=e;return u===1/0?wO(this,t,i,s,o,l):oO(this,t,i,s,o,l,u),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return fO(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:o,near:l=bd,far:u=vd}=e;return uO(this,t,i,s,o,l,u),this.check()}orthographic(e){const{fovy:t=vO,aspect:i=TO,focalDistance:s=1,near:o=bd,far:l=vd}=e;Gb(t);const u=t/2,f=s*Math.tan(u),d=f*i;return this.ortho({left:-d,right:d,bottom:-f,top:f,near:o,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:o=500}=e;return Gb(t),lO(this,t,i,s,o),this.check()}determinant(){return tO(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],o=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*o,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*o,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],o=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*o,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*o,e[8]=this[10]*l,e}transpose(){return eO(this,this),this.check()}invert(){return rp(this,this),this.check()}multiplyLeft(e){return Fs(this,e,this),this.check()}multiplyRight(e){return Fs(this,this,e),this.check()}rotateX(e){return O3(this,this,e),this.check()}rotateY(e){return iO(this,this,e),this.check()}rotateZ(e){return I3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return nO(this,this,e,t),this.check()}scale(e){return dg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return hu(this,this,e),this.check()}transform(e,t){return e.length===4?(t=ao(t||[-0,-0,-0,-0],e,this),wa(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=MM(t||[-0,-0],e,this);break;case 3:s=fg(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return wa(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=OM(t||[-0,-0],e,this);break;case 3:i=T3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return wa(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let Tc,xc;function SO(){return Tc||(Tc=new Pt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Tc)),Tc}function AO(){return xc||(xc=new Pt,Object.freeze(xc)),xc}function Gb(n){if(n>Math.PI*2)throw Error("expected radians")}function wO(n,e,t,i,s,o){const l=2*o/(t-e),u=2*o/(s-i),f=(t+e)/(t-e),d=(s+i)/(s-i),p=-1,_=-1,y=-2*o;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=f,n[9]=d,n[10]=p,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function Qb(){const n=new Dn(4);return Dn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function EO(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function P3(n,e,t){t=t*.5;const i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function Jb(n,e,t){const i=e[0],s=e[1],o=e[2],l=e[3],u=t[0],f=t[1],d=t[2],p=t[3];return n[0]=i*p+l*u+s*d-o*f,n[1]=s*p+l*f+o*u-i*d,n[2]=o*p+l*d+i*f-s*u,n[3]=l*p-i*u-s*f-o*d,n}function CO(n,e,t){t*=.5;const i=e[0],s=e[1],o=e[2],l=e[3],u=Math.sin(t),f=Math.cos(t);return n[0]=i*f+l*u,n[1]=s*f+o*u,n[2]=o*f-s*u,n[3]=l*f-i*u,n}function RO(n,e,t){t*=.5;const i=e[0],s=e[1],o=e[2],l=e[3],u=Math.sin(t),f=Math.cos(t);return n[0]=i*f-o*u,n[1]=s*f+l*u,n[2]=o*f+i*u,n[3]=l*f-s*u,n}function MO(n,e,t){t*=.5;const i=e[0],s=e[1],o=e[2],l=e[3],u=Math.sin(t),f=Math.cos(t);return n[0]=i*f+s*u,n[1]=s*f-i*u,n[2]=o*f+l*u,n[3]=l*f-o*u,n}function OO(n,e){const t=e[0],i=e[1],s=e[2];return n[0]=t,n[1]=i,n[2]=s,n[3]=Math.sqrt(Math.abs(1-t*t-i*i-s*s)),n}function jc(n,e,t,i){const s=e[0],o=e[1],l=e[2],u=e[3];let f=t[0],d=t[1],p=t[2],_=t[3],y,v,T,A,R;return y=s*f+o*d+l*p+u*_,y<0&&(y=-y,f=-f,d=-d,p=-p,_=-_),1-y>Ea?(v=Math.acos(y),R=Math.sin(v),T=Math.sin((1-i)*v)/R,A=Math.sin(i*v)/R):(T=1-i,A=i),n[0]=T*s+A*f,n[1]=T*o+A*d,n[2]=T*l+A*p,n[3]=T*u+A*_,n}function IO(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],l=t*t+i*i+s*s+o*o,u=l?1/l:0;return n[0]=-t*u,n[1]=-i*u,n[2]=-s*u,n[3]=o*u,n}function PO(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function N3(n,e){const t=e[0]+e[4]+e[8];let i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[l*3+l]+1),n[s]=.5*i,i=.5/i,n[3]=(e[o*3+l]-e[l*3+o])*i,n[o]=(e[o*3+s]+e[s*3+o])*i,n[l]=(e[l*3+s]+e[s*3+l])*i}return n}const NO=dO,DO=pg,kO=_O,BO=yO,LO=pO,UO=gO,D3=mO,FO=(function(){const n=S3(),e=Yb(1,0,0),t=Yb(0,1,0);return function(i,s,o){const l=A3(s,o);return l<-.999999?(Hc(n,e,s),R3(n)<1e-6&&Hc(n,t,s),LM(n,n),P3(i,n,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Hc(n,s,o),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+l,D3(i,i))}})();(function(){const n=Qb(),e=Qb();return function(t,i,s,o,l,u){return jc(n,i,l,u),jc(e,s,o,u),jc(t,n,e,2*u*(1-u)),t}})();(function(){const n=jM();return function(e,t,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],D3(e,N3(e,n))}})();const zO=[0,0,0,1];class ev extends ug{constructor(e=0,t=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return N3(this,e),this.check()}fromAxisRotation(e,t){return P3(this,e,t),this.check()}identity(){return EO(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Je(e)}get y(){return this[1]}set y(e){this[1]=Je(e)}get z(){return this[2]}set z(e){this[2]=Je(e)}get w(){return this[3]}set w(e){this[3]=Je(e)}len(){return LO(this)}lengthSquared(){return UO(this)}dot(e){return kO(this,e)}rotationTo(e,t){return FO(this,e,t),this.check()}add(e){return NO(this,this,e),this.check()}calculateW(){return OO(this,this),this.check()}conjugate(){return PO(this,this),this.check()}invert(){return IO(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):(BO(this,e,t,i),this.check())}multiplyRight(e){return Jb(this,this,e),this.check()}multiplyLeft(e){return Jb(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return CO(this,this,e),this.check()}rotateY(e){return RO(this,this,e),this.check()}rotateZ(e){return MO(this,this,e),this.check()}scale(e){return DO(this,this,e),this.check()}slerp(e,t,i){let s,o,l;switch(arguments.length){case 1:({start:s=zO,target:o,ratio:l}=e);break;case 2:s=this,o=e,l=t;break;default:s=e,o=t,l=i}return jc(this,s,o,l),this.check()}transformVector4(e,t=new hg){return bO(t,e,this),wa(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const VO=1e-15,HO=1e-20;function k3(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function jO(n){return n-Math.fround(n)}function WO(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;k3(n[i*4+t],e,s*2)}return e}const $O=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,XO={name:"fp32",vs:$O},qO=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,YO={ONE:1},KO={name:"fp64arithmetic",vs:qO,defaultUniforms:YO,uniformTypes:{ONE:"f32"},fp64ify:k3,fp64LowPart:jO,fp64ifyMatrix4:WO},ZO=[0,1,1,1],GO=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,QO=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,tv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:ZO},vs:GO,fs:QO,getUniforms:JO};function JO(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const nv=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,eI=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,tI=5,nI=255;var ka;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(ka||(ka={}));const Wc={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:ka.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:eI,vs:nv,fs:nv,getUniforms:iI};function iI(n,e={}){if(n=n&&{...n},!n)return{...Wc.defaultUniforms};n.lights&&(n={...n,...rI(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:s}=n||{};if(!(t||i&&i.length>0||s&&s.length>0))return{...Wc.defaultUniforms,enabled:0};const l={...Wc.defaultUniforms,...e,...sI({ambientLight:t,pointLights:i,directionalLights:s})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function sI({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientColor=Td(n);let s=0;for(const o of e){i.lightType=ka.POINT;const l=s;i[`lightColor${l}`]=Td(o),i[`lightPosition${l}`]=o.position,i[`lightAttenuation${l}`]=o.attenuation||[1,0,0],s++}for(const o of t){i.lightType=ka.DIRECTIONAL;const l=s;i[`lightColor${l}`]=Td(o),i[`lightDirection${l}`]=o.direction,s++}return s>tI&&ie.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function rI(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function Td(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/nI)}const oI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,aI=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,lI=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,B3={props:{},name:"gouraudMaterial",vs:aI.replace("phongMaterial","gouraudMaterial"),fs:oI.replace("phongMaterial","gouraudMaterial"),source:lI.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[Wc],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...B3.defaultUniforms,...e}}},iv=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,cI={name:"layer",vs:iv,fs:iv,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},uI=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,fI={name:"color",dependencies:[],source:uI,getUniforms:n=>({}),uniformTypes:{opacity:"f32"}},hI=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,L3="#define SMOOTH_EDGE_RADIUS 0.5",dI=`${L3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,pI=`${L3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,U3={name:"geometry",source:hI,vs:dI,fs:pI},gI=25;var yt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(yt||(yt={}));var Tt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Tt||(Tt={}));var we;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(we||(we={}));const mI="compute",_I="auto",ap="manipulation",$c="none",lp="pan-x",cp="pan-y";function yI(n){if(n.includes($c))return $c;const e=n.includes(lp),t=n.includes(cp);return e&&t?$c:e||t?e?lp:cp:n.includes(ap)?ap:_I}class bI{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===mI&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return yI(e.join(" "))}}function du(n){return n.trim().split(/\s+/g)}function xd(n,e,t){if(n)for(const i of du(e))n.addEventListener(i,t,!1)}function Sd(n,e,t){if(n)for(const i of du(e))n.removeEventListener(i,t,!1)}function sv(n){return(n.ownerDocument||n).defaultView}function vI(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function F3(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function rv(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:F3(e),deltaX:n.deltaX,deltaY:n.deltaY}}function z3(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function ov(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function TI(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function av(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function V3(n,e){return n===e?Tt.None:Math.abs(n)>=Math.abs(e)?n<0?Tt.Left:Tt.Right:e<0?Tt.Up:Tt.Down}function xI(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const o=n.prevInput;return(e.eventType===yt.Start||o?.eventType===yt.End)&&(s=n.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function H3(n,e,t){return{x:e/n||0,y:t/n||0}}function SI(n,e){return ov(e[0],e[1])/ov(n[0],n[1])}function AI(n,e){return av(e[1],e[0])-av(n[1],n[0])}function wI(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,o,l,u;if(e.eventType!==yt.Cancel&&(i>gI||t.velocity===void 0)){const f=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=H3(i,f,d);o=p.x,l=p.y,s=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,u=V3(f,d),n.lastInterval=e}else s=t.velocity,o=t.velocityX,l=t.velocityY,u=t.direction;e.velocity=s,e.velocityX=o,e.velocityY=l,e.direction=u}function EI(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=rv(e)),s>1&&!t.firstMultiple?t.firstMultiple=rv(e):s===1&&(t.firstMultiple=!1);const{firstInput:o,firstMultiple:l}=t,u=l?l.center:o.center,f=e.center=F3(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=TI(u,f),e.distance=z3(u,f);const{deltaX:d,deltaY:p}=xI(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=V3(e.deltaX,e.deltaY);const _=H3(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?SI(l.pointers,i):1,e.rotation=l?AI(l.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return vI(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,wI(t,e),e}function CI(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,o=e&yt.Start&&i-s===0,l=e&(yt.End|yt.Cancel)&&i-s===0;t.isFirst=!!o,t.isFinal=!!l,o&&(n.session={}),t.eventType=e;const u=EI(n,t);n.emit("hammer.input",u),n.recognize(u),n.session.prevInput=u}let RI=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){CI(this.manager,e,t)}init(){xd(this.element,this.evEl,this.domHandler),xd(this.target,this.evTarget,this.domHandler),xd(sv(this.element),this.evWin,this.domHandler)}destroy(){Sd(this.element,this.evEl,this.domHandler),Sd(this.target,this.evTarget,this.domHandler),Sd(sv(this.element),this.evWin,this.domHandler)}};const MI={pointerdown:yt.Start,pointermove:yt.Move,pointerup:yt.End,pointercancel:yt.Cancel,pointerout:yt.Cancel},OI="pointerdown",II="pointermove pointerup pointercancel";class PI extends RI{constructor(e){super(e),this.evEl=OI,this.evWin=II,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=MI[e.type],o=e.pointerType,l=o==="touch";let u=t.findIndex(f=>f.pointerId===e.pointerId);s&yt.Start&&(e.buttons||l)?u<0&&(t.push(e),u=t.length-1):s&(yt.End|yt.Cancel)&&(i=!0),!(u<0)&&(t[u]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:o,srcEvent:e}),i&&t.splice(u,1))}}const NI=["","webkit","Moz","MS","ms","o"];function DI(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of NI){const s=i?i+t:e;if(s in n)return s}}const kI=1,lv=2,cv={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class BI{constructor(e,t){this.options={...cv,...t,cssProps:{...cv.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new PI(this),this.touchAction=new bI(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?lv:kI}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:o}=t;(!o||o&&o.state&we.Recognized)&&(o=t.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],t.stopped!==lv&&(!o||i===o||i.canRecognizeWith(o))?i.recognize(e):i.reset(),!o&&i.state&(we.Began|we.Changed|we.Ended)&&(o=t.curRecognizer=i),l++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of du(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of du(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let o=0;for(;o<i.length;)i[o](s),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const o=DI(t.style,i);e?(this.oldCssProps[o]=t.style[o],t.style[o]=s):t.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}}let LI=1;function UI(){return LI++}function uv(n){return n&we.Cancelled?"cancel":n&we.Ended?"end":n&we.Changed?"move":n&we.Began?"start":""}class j3{constructor(e){this.options=e,this.id=UI(),this.state=we.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<we.Ended&&this.manager.emit(this.options.event+uv(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=we.Ended&&this.manager.emit(this.options.event+uv(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=we.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(we.Failed|we.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=we.Failed;return}this.state&(we.Recognized|we.Cancelled|we.Failed)&&(this.state=we.Possible),this.state=this.process(t),this.state&(we.Began|we.Changed|we.Ended|we.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class W3 extends j3{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(we.Began|we.Changed),o=this.attrTest(e);return s&&(i&yt.Cancel||!o)?t|we.Cancelled:s||o?i&yt.End?t|we.Ended:t&we.Began?t|we.Changed:we.Began:we.Failed}}class fv extends j3{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[ap]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&yt.Start&&this.count===0)return this.failTimeout();if(s&&o&&i){if(e.eventType!==yt.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,u=!this.pCenter||z3(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=we.Recognized,this.tryEmit(this._input)},t.interval),we.Began):we.Recognized}return we.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=we.Failed},this.options.interval),we.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===we.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const FI=["","start","move","end","cancel","up","down","left","right"];class hv extends W3{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Tt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Tt.Horizontal&&t.push(cp),e&Tt.Vertical&&t.push(lp),t}getEventNames(){return FI.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:o}=e;const l=e.deltaX,u=e.deltaY;return o&t.direction||(t.direction&Tt.Horizontal?(o=l===0?Tt.None:l<0?Tt.Left:Tt.Right,i=l!==this.pX,s=Math.abs(e.deltaX)):(o=u===0?Tt.None:u<0?Tt.Up:Tt.Down,i=u!==this.pY,s=Math.abs(e.deltaY))),e.direction=o,i&&s>t.threshold&&!!(o&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&we.Began)||!(this.state&we.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Tt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const zI=["","start","move","end","cancel","in","out"];class VI extends W3{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[$c]}getEventNames(){return zI.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&we.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class wu{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const HI=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",jI=HI.indexOf("firefox")!==-1,dv=4.000244140625,WI=40,$I=.25;class XI extends wu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let o=s.deltaY;globalThis.WheelEvent&&(jI&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=WI)),o!==0&&o%dv===0&&(o=Math.floor(o/dv)),s.shiftKey&&o&&(o=o*$I),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-o,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const pv=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class qI extends wu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,pv.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){pv.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const gv=["keydown","keyup"];class YI extends wu{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const o=s.target||s.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",gv.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){gv.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class KI extends wu{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const mv=1,up=2,_v=4,ZI={pointerdown:mv,pointermove:up,pointerup:_v,mousedown:mv,mousemove:up,mouseup:_v},GI=0,QI=1,JI=2,eP=1,tP=2,nP=4;function iP(n){const e=ZI[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,o=!1,l=!1;return e===up?(s=!!(t&eP),o=!!(t&nP),l=!!(t&tP)):(s=i===GI,o=i===QI,l=i===JI),{leftButton:s,middleButton:o,rightButton:l}}function sP(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,l={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/o};return{center:t,offsetCenter:l}}const rP={srcElement:"root",priority:0};class oP{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let o=i.srcEvent.target;for(;o&&o!==s.rootElement;){if(this._emit(s,o),s.handled)return;o=o.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,o=!1){const{handlers:l,handlersByElement:u}=this,f={...rP,...i};let d=u.get(f.srcElement);d||(d=[],u.set(f.srcElement,d));const p={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};s&&(p.once=!0),o&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=p.priority);)_--;d.splice(_+1,0,p)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.type===e&&l.handler===t){i.splice(o,1);const u=s.get(l.srcElement);u.splice(u.indexOf(l),1),u.length===0&&s.delete(l.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const o=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},u=[];for(let f=0;f<i.length;f++){const{type:d,handler:p,once:_}=i[f];if(p({...e,type:d,stopPropagation:o,stopImmediatePropagation:l}),_&&u.push(i[f]),s)break}for(let f=0;f<u.length;f++){const{type:d,handler:p}=u[f];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...iP(e),...sP(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function aP(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class lP{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new BI(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:o,requireFailure:l}=aP(i);this.manager.add(s),o&&s.recognizeWith(o),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new XI(e,this._onOtherEvent,{enable:!1}),this.moveInput=new qI(e,this._onOtherEvent,{enable:!1}),this.keyInput=new YI(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new KI(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,s,o){if(typeof e!="string"){i=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,i,s,o);return}const{manager:l,events:u}=this;if(!l)return;let f=u.get(e);if(!f){const d=this._getRecognizerName(e)||e;f=new oP(this,d),u.set(e,f),l&&l.on(e,f.handleEvent)}f.add(e,t,i,s,o),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[o,l]of Object.entries(e))this._removeEventHandler(o,l);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:o}=s;let l=!1;for(const u of i.values())if(u.recognizerName===o&&!u.isEmpty()){l=!0;break}l||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Re={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Re,"IDENTITY",{get:()=>(Me.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const fn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ti={common:0,meters:1,pixels:2},fp={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},yv={multipan:[hv,{threshold:10,direction:Tt.Vertical,pointers:2}],pinch:[VI,{},null,["multipan"]],pan:[hv,{threshold:1},["pinch"],["multipan"]],dblclick:[fv,{event:"dblclick",taps:2}],click:[fv,{event:"click"},null,["dblclick"]]};function cP(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function $a(n){let e={},t;return i=>{for(const s in i)if(!cP(i[s],e[s])){t=n(i),e=i;break}return t}}const bv=[0,0,0,0],uP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fP=[0,0,0],X3=[0,0,0],hP=$a(gP);function q3(n,e,t=X3){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,o=!0;switch(e===Re.LNGLAT_OFFSETS||e===Re.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case fn.WEB_MERCATOR:(e===Re.LNGLAT||e===Re.CARTESIAN)&&(s=[0,0,0],o=!1);break;case fn.WEB_MERCATOR_AUTO_OFFSET:e===Re.LNGLAT?i=s:e===Re.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case fn.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case fn.GLOBE:o=!1,s=null;break;default:o=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:o}}function dP(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:o,viewProjectionMatrix:l}=n,u=bv,f=bv,d=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=q3(n,e,t);return y&&(f=n.projectPosition(p||_),d=[d[0]-f[0],d[1]-f[1],d[2]-f[2]],f[3]=1,u=ao([],f,l),o=i||o,l=Fs([],s,o),l=Fs([],l,uP)),{viewMatrix:o,viewProjectionMatrix:l,projectionCenter:u,originCommon:f,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:p}}function pP({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Re.DEFAULT,coordinateOrigin:s=X3,autoWrapLongitude:o=!1}){i===Re.DEFAULT&&(i=n.isGeospatial?Re.LNGLAT:Re.CARTESIAN);const l=hP({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=o,l.modelMatrix=t||$3,l}function gP({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:o,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:f,geospatialOrigin:d}=dP(n,t,i),p=n.getDistanceScales(),_=[n.width*e,n.height*e],y=ao([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,v={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:fP,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:$3,cameraPosition:u};if(d){const T=n.getDistanceScales(d);switch(t){case Re.METER_OFFSETS:v.commonUnitsPerWorldUnit=T.unitsPerMeter,v.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case Re.LNGLAT:case Re.LNGLAT_OFFSETS:n._pseudoMeters||(v.commonUnitsPerMeter=T.unitsPerMeter),v.commonUnitsPerWorldUnit=T.unitsPerDegree,v.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case Re.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return v}const mP=Object.keys(Re).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Re[n]};`).join(""),_P=Object.keys(fn).map(n=>`const PROJECTION_MODE_${n}: i32 = ${fn[n]};`).join(""),yP=Object.keys(Ti).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Ti[n]};`).join(""),bP=`${mP}
${_P}
${yP}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,vP=`${bP}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,TP=Object.keys(Re).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Re[n]};`).join(""),xP=Object.keys(fn).map(n=>`const int PROJECTION_MODE_${n} = ${fn[n]};`).join(""),SP=Object.keys(Ti).map(n=>`const int UNIT_${n.toUpperCase()} = ${Ti[n]};`).join(""),AP=`${TP}
${xP}
${SP}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,wP={};function EP(n=wP){return"viewport"in n?pP(n):{}}const gg={name:"project",dependencies:[XO,U3],source:vP,vs:AP,getUniforms:EP,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},CP=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,RP=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,fs={name:"project32",dependencies:[gg],source:CP,vs:RP};function MP(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Zr(n,e){const t=ao([],e,n);return pg(t,t,1/t[3]),t}function vv(n,e){const t=n%e;return t<0?e+t:t}function hp(n,e,t){return n<e?e:n>t?t:n}function OP(n){return Math.log(n)*Math.LOG2E}const mg=Math.log2||OP;function xi(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Pn=Math.PI,Y3=Pn/4,An=Pn/180,dp=180/Pn,eo=512,pu=4003e4,is=85.051129,IP=1.5;function PP(n){return mg(n)}function cs(n){const[e,t]=n;xi(Number.isFinite(e)),xi(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*An,s=t*An,o=eo*(i+Pn)/(2*Pn),l=eo*(Pn+Math.log(Math.tan(Y3+s*.5)))/(2*Pn);return[o,l]}function to(n){const[e,t]=n,i=e/eo*(2*Pn)-Pn,s=2*(Math.atan(Math.exp(t/eo*(2*Pn)-Pn))-Y3);return[i*dp,s*dp]}function NP(n){const{latitude:e}=n;xi(Number.isFinite(e));const t=Math.cos(e*An);return PP(pu*t)-9}function Ad(n){const e=Math.cos(n*An);return eo/pu/e}function pp(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;xi(Number.isFinite(e)&&Number.isFinite(t));const s=eo,o=Math.cos(e*An),l=s/360,u=l/o,f=s/pu/o,d={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,u,f],degreesPerUnit:[1/l,1/u,1/f]};if(i){const p=An*Math.tan(e*An)/o,_=l*p/2,y=s/pu*p,v=y/u*f;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[v,0,v]}return d}function K3(n,e){const[t,i,s]=n,[o,l,u]=e,{unitsPerMeter:f,unitsPerMeter2:d}=pp({longitude:t,latitude:i,highPrecision:!0}),p=cs(n);p[0]+=o*(f[0]+d[0]*l),p[1]+=l*(f[1]+d[1]*l);const _=to(p),y=(s||0)+(u||0);return Number.isFinite(s)||Number.isFinite(u)?[_[0],_[1],y]:_}function DP(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:o,center:l}=n,u=MP();hu(u,u,[0,0,-s]),O3(u,u,-t*An),I3(u,u,i*An);const f=o/e;return dg(u,u,[f,f,f]),l&&hu(u,u,BM([],l)),u}function kP(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:o,center:l,scale:u,nearZMultiplier:f=1,farZMultiplier:d=1}=n;let{fovy:p=Ba(IP)}=n;i!==void 0&&(p=Ba(i));const _=p*An,y=s*An,v=_g(p);let T=v;l&&(T+=l[2]*u/Math.cos(y)/t);const A=_*(.5+(o?o[1]:0)/t),R=Math.sin(A)*T/Math.sin(hp(Math.PI/2-y-A,.01,Math.PI-.01)),M=Math.sin(y)*R+T,H=T*10,O=Math.min(M*d,H);return{fov:_,aspect:e/t,focalDistance:v,near:f,far:O}}function Ba(n){return 2*Math.atan(.5/n)*dp}function _g(n){return .5/Math.tan(.5*n*An)}function Z3(n,e){const[t,i,s=0]=n;return xi(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),Zr(e,[t,i,s,1])}function yg(n,e,t=0){const[i,s,o]=n;if(xi(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(o))return Zr(e,[i,s,o,1]);const l=Zr(e,[i,s,0,1]),u=Zr(e,[i,s,1,1]),f=l[2],d=u[2],p=f===d?0:((t||0)-f)/(d-f);return v3([],l,u,p)}function BP(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:o=24,offset:l=[0,0]}=n,[[u,f],[d,p]]=i,_=LP(n.padding),y=cs([u,hp(p,-is,is)]),v=cs([d,hp(f,-is,is)]),T=[Math.max(Math.abs(v[0]-y[0]),s),Math.max(Math.abs(v[1]-y[1]),s)],A=[e-_.left-_.right-Math.abs(l[0])*2,t-_.top-_.bottom-Math.abs(l[1])*2];xi(A[0]>0&&A[1]>0);const R=A[0]/T[0],M=A[1]/T[1],H=(_.right-_.left)/2/R,O=(_.top-_.bottom)/2/M,L=[(v[0]+y[0])/2+H,(v[1]+y[1])/2+O],X=to(L),Y=Math.min(o,mg(Math.abs(Math.min(R,M))));return xi(Number.isFinite(Y)),{longitude:X[0],latitude:X[1],zoom:Y}}function LP(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(xi(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Tv=Math.PI/180;function UP(n,e=0){const{width:t,height:i,unproject:s}=n,o={targetZ:e},l=s([0,i],o),u=s([t,i],o);let f,d;const p=n.fovy?.5*n.fovy*Tv:Math.atan(.5/n.altitude),_=(90-n.pitch)*Tv;return p>_-.01?(f=xv(n,0,e),d=xv(n,t,e)):(f=s([0,0],o),d=s([t,0],o)),[l,u,d,f]}function xv(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=Zr(i,[e,0,1,1]),o=Zr(i,[e,n.height,1,1]),u=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(o[2]-s[2]),f=v3([],s,o,u),d=to(f);return d.push(t),d}const Sv=512;function FP(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:o,zoom:l,bearing:u=0}=n;(s<-180||s>180)&&(s=vv(s+180,360)-180),(u<-180||u>180)&&(u=vv(u+180,360)-180);const f=mg(t/Sv);if(l<=f)l=f,o=0;else{const d=t/2/Math.pow(2,l),p=to([0,d])[1];if(o<p)o=p;else{const _=to([0,Sv-d])[1];o>_&&(o=_)}}return{width:e,height:t,longitude:s,latitude:o,zoom:l,pitch:i,bearing:u}}const G3=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,zP=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,VP=`
${G3}
${zP}
`,HP=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,jP=`
${G3}
${HP}
`,WP=$a(KP),$P=$a(ZP),XP=[0,0,0,1],qP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function YP(n,e){const[t,i,s]=n,o=yg([t,i,s],e);return Number.isFinite(s)?o:[o[0],o[1],0]}function KP({viewport:n,center:e}){return new Pt(n.viewProjectionMatrix).invert().transform(e)}function ZP({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,o=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>YP(l,i));for(const l of e){const u=l.clone().translate(new ue(n.center).negate()),f=o.map(p=>u.transform(p)),d=new Pt().ortho({left:Math.min(...f.map(p=>p[0])),right:Math.max(...f.map(p=>p[0])),bottom:Math.min(...f.map(p=>p[1])),top:Math.max(...f.map(p=>p[1])),near:Math.min(...f.map(p=>-p[2])),far:Math.max(...f.map(p=>-p[2]))});t.push(d.multiplyRight(l))}return t}function GP(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=gg.getUniforms(t),s=WP({viewport:t.viewport,center:i.center}),o=[],l=$P({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<n.shadowMatrices.length;f++){const d=l[f],p=d.clone().translate(new ue(t.viewport.center).negate());i.coordinateSystem===Re.LNGLAT&&i.projectionMode===fn.WEB_MERCATOR?(l[f]=p,o[f]=s):(l[f]=d.clone().multiplyRight(qP),o[f]=p.transform(s))}const u={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||XP,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let f=0;f<l.length;f++)u[`viewProjectionMatrix${f}`]=l[f],u[`projectCenter${f}`]=o[f];for(let f=0;f<2;f++)u[`shadow_uShadowMap${f}`]=n.shadowMaps&&n.shadowMaps[f]||n.dummyShadowMap;return u}const Av={name:"shadow",dependencies:[gg],vs:VP,fs:jP,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:GP,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},lo={...tv,defaultUniforms:{...tv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},QP=[U3],JP=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],e4=[];function t4(n){const e=Ns.getDefaultShaderAssembler();for(const i of QP)e.addDefaultModule(i);e._hookFunctions.length=0;const t=n==="glsl"?JP:e4;for(const i of t)e.addShaderHook(i);return e}const n4=[255,255,255],i4=1;let s4=0;class r4{constructor(e={}){this.type="ambient";const{color:t=n4}=e,{intensity:i=i4}=e;this.id=e.id||`ambient-${s4++}`,this.color=t,this.intensity=i}}const o4=[255,255,255],a4=1,l4=[0,0,-1];let c4=0;class wv{constructor(e={}){this.type="directional";const{color:t=o4}=e,{intensity:i=a4}=e,{direction:s=l4}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${c4++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new ue(s).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class u4{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class bg extends u4{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,o=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,u=s?0:!1,f=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=f),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:o,clearDepth:l,clearStencil:u});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:o,views:l,onViewportActive:u,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const d=[];for(const p of o){const _=l&&l[p.id];u?.(p);const y=this._getDrawLayerParams(p,t),v=p.subViewports||[p];for(const T of v){const A=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:T,view:_,pass:t.pass,layers:t.layers},y);d.push(A)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:o,cullRect:l,effects:u,shaderModuleProps:f},d=!1){const p=[],_=Q3(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:l},v={};for(let T=0;T<t.length;T++){const A=t[T],R=this._shouldDrawLayer(A,y,o,v),M={shouldDrawLayer:R};R&&!d&&(M.shouldDrawLayer=!0,M.layerRenderIndex=_(A,R),M.shaderModuleProps=this._getShaderModuleProps(A,u,i,f),M.layerParameters={...A.context.deck?.props.parameters,...this.getLayerParameters(A,T,e)}),p[T]=M}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:o,viewport:l,view:u},f){const d=f4(this.device,{shaderModuleProps:i,target:o,viewport:l});if(u){const{clear:_,clearColor:y,clearDepth:v,clearStencil:T}=u.props;if(_){let A=[0,0,0,0],R=1,M=0;Array.isArray(y)?A=[...y.slice(0,3),y[3]||255].map(O=>O/255):y===!1&&(A=!1),v!==void 0&&(R=v),T!==void 0&&(M=T),this.device.beginRenderPass({framebuffer:o,parameters:{viewport:d,scissorRect:d},clearColor:A,clearDepth:R,clearStencil:M}).end()}}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let _=0;_<t.length;_++){const y=t[_],v=f[_],{shouldDrawLayer:T}=v;if(T&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:A,shaderModuleProps:R,layerParameters:M}=v;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,A),R.project&&(R.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:R,uniforms:{layerIndex:A},parameters:M})}catch(H){y.raiseError(H,`drawing ${y} to ${s}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(i){const u=t.layer.id;if(u in s||(s[u]=i(t)),!s[u])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){const o=this.device.canvasContext.cssToDeviceRatio(),l=e.internalState?.propsInTransition||e.props,u={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const f of t)Ev(u,f.getShaderModuleProps?.(e,u));return Ev(u,this.getShaderModuleProps(e,t,u),s)}}function Q3(n=0,e={}){const t={},i=(s,o)=>{const l=s.props._offset,u=s.id,f=s.parent&&s.parent.id;let d;if(f&&!(f in e)&&i(s.parent,!1),f in t){const p=t[f]=t[f]||Q3(e[f],e);d=p(s,o),t[u]=p}else Number.isFinite(l)?(d=l+(e[f]||0),t[u]=null):d=n;return o&&d>=n&&(n=d+1),e[u]=d,d};return i}function f4(n,{shaderModuleProps:e,target:t,viewport:i}){const s=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,o]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:o,u=i;return[u.x*s,l-(u.y+u.height)*s,u.width*s,u.height*s]}function Ev(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class h4 extends bg{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],o=s.width*i,l=s.height*i,u=[1,1,1,1];(o!==t.width||l!==t.height)&&t.resize({width:o,height:l}),super.render({...e,clearColor:u,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const d4={color:[255,255,255],intensity:1},Cv=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],p4=[0,0,0,200/255];class J3{constructor(e={}){this.id="lighting-effect",this.shadowColor=p4,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(Av),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:o,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:i,lighting:s,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Av))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Pt().lookAt({eye:new ue(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new h4(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new r4(d4),this.directionalLights.push(new wv(Cv[0]),new wv(Cv[1])))}}class g4{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:o=0,copy:l=!1,initialize:u=!1,maxCount:f}){const d=s||e&&e.constructor||Float32Array,p=t*i+o;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let _=1/0;f&&(_=f*i+o);const y=this._allocate(d,p,u,_);return e&&l?y.set(e):u||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>s&&(o=s);const l=this._pool,u=e.BYTES_PER_ELEMENT*o,f=l.findIndex(d=>d.byteLength>=u);if(f>=0){const d=new e(l.splice(f,1)[0],0,o);return i&&d.fill(0),d}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,o=t.findIndex(l=>l.byteLength>=s);o<0?t.push(i):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,i),t.length>this.opts.poolSize&&t.shift()}}const no=new g4;function _a(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function m4(n){return[n[12],n[13],n[14]]}function _4(n){return{left:Lr(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Lr(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Lr(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Lr(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Lr(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Lr(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Rv=new ue;function Lr(n,e,t,i){Rv.set(n,e,t);const s=Rv.len();return{distance:i/s,normal:new ue(-n/s,-e/s,-t/s)}}function y4(n){return n-Math.fround(n)}let ua;function wd(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,o=(s-i)/t;ua=no.allocate(ua,o,{type:Float32Array,size:t*2});let l=i,u=0;for(;l<s;){for(let f=0;f<t;f++){const d=n[l++];ua[u+f]=d,ua[u+f+t]=y4(d)}u+=t*2}return ua.subarray(0,o*t*2)}function b4(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const v4=Math.PI/180,T4=_a(),Mv=[0,0,0],x4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function S4({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:o,near:l,far:u}){const f=n/e,d=t?new Pt().orthographic({fovy:i,aspect:f,focalDistance:s,near:l,far:u}):new Pt().perspective({fovy:i,aspect:f,near:l,far:u});if(o){const{left:p=0,right:_=0,top:y=0,bottom:v=0}=o,T=ns((p+n-_)/2,0,n)-n/2,A=ns((y+e-v)/2,0,e)-e/2;d[8]-=T*2/n,d[9]+=A*2/e}return d}class co{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||x4,this.focalDistance=e.focalDistance||1,this.position=e.position||Mv,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?fn.WEB_MERCATOR:fn.WEB_MERCATOR_AUTO_OFFSET:fn.IDENTITY}equals(e){return e instanceof co?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&vi(e.projectionMatrix,this.projectionMatrix)&&vi(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=Z3(i,this.pixelProjectionMatrix),[o,l]=s,u=t?l:this.height-l;return e.length===2?[o,u]:[o,u,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,o,l]=e,u=t?o:this.height-o,f=i&&i*this.distanceScales.unitsPerMeter[2],d=yg([s,u,l],this.pixelUnprojectionMatrix,f),[p,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,_,y]:Number.isFinite(i)?[p,_,i]:[p,_]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=cs(e);return t[1]=ns(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?to(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],o[0],l[0]),Math.min(i[1],s[1],o[1],l[1]),Math.max(i[0],s[0],o[0],l[0]),Math.max(i[1],s[1],o[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?pp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,_4(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t,i){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=NP({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||pp({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:o,modelMatrix:l}=e;let u=Mv;if(o&&(u=l?new Pt(l).transformAsVector(o,[]):o),this.isGeospatial){const f=this.projectPosition([t,i,0]);this.center=new ue(u).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:t=T4,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:o,fovy:l=75,near:u=.1,far:f=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Pt().multiplyRight(t).translate(new ue(this.center).negate()),this.projectionMatrix=i||S4({width:this.width,height:this.height,orthographic:s,fovyRadians:o||l*v4,focalDistance:p,padding:d,near:u,far:f});const _=_a();Fs(_,_,this.projectionMatrix),Fs(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=rp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=m4(this.viewMatrixInverse);const y=_a(),v=_a();dg(y,y,[this.width/2,-this.height/2,1]),hu(y,y,[1,-1,0]),Fs(v,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=rp(_a(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Me.warn("Pixel project matrix not invertible")()}}co.displayName="Viewport";class us extends co{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:o=0,bearing:l=0,nearZMultiplier:u=.1,farZMultiplier:f=1.01,nearZ:d,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:v=!1,worldOffset:T=0,position:A,padding:R,legacyMeterSizes:M=!1}=e;let{width:H,height:O,altitude:L=1.5}=e;const X=Math.pow(2,s);H=H||1,O=O||1;let Y,re=null;if(y)L=y[5]/2,Y=Ba(L);else{e.fovy?(Y=e.fovy,L=_g(Y)):Y=Ba(L);let oe;if(R){const{top:fe=0,bottom:me=0}=R;oe=[0,ns((fe+O-me)/2,0,O)-O/2]}re=kP({width:H,height:O,scale:X,center:A&&[0,0,A[2]*Ad(t)],offset:oe,pitch:o,fovy:Y,nearZMultiplier:u,farZMultiplier:f}),Number.isFinite(d)&&(re.near=d),Number.isFinite(p)&&(re.far=p)}let le=DP({height:O,pitch:o,bearing:l,scale:X,altitude:L});T&&(le=new Pt().translate([512*T,0,0]).multiplyLeft(le)),super({...e,width:H,height:O,viewMatrix:le,longitude:i,latitude:t,zoom:s,...re,fovy:Y,focalDistance:L}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=o,this.bearing=l,this.altitude=L,this.fovy=Y,this.orthographic=_,this._subViewports=v?[]:null,this._pseudoMeters=M,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const o=s?new us({...this,worldOffset:s}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*Ad(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/Ad(i);return[t,i,s]}addMetersToLngLat(e,t){return K3(e,t)}panByPosition(e,t,i){const s=yg(t,this.pixelUnprojectionMatrix),o=this.projectFlat(e),l=qb([],o,CM([],s)),u=qb([],this.center,l),[f,d]=this.unprojectFlat(u);return{longitude:f,latitude:d}}getBounds(e={}){const t=UP(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:o,latitude:l,zoom:u}=BP({width:i,height:s,bounds:e,...t});return new us({width:i,height:s,longitude:o,latitude:l,zoom:u})}}us.displayName="WebMercatorViewport";const Ov=[0,0,0];function Ed(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof us){const[s,o,l=0]=n,u=e.getDistanceScales([s,o]);i[2]=l*u.unitsPerMeter[2]}return i}function A4(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=n;return s===Re.DEFAULT&&(s=e.isGeospatial?Re.LNGLAT:Re.CARTESIAN),o===void 0&&(o=s),l===void 0&&(l=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:l}}function e2(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:o}){let[l,u,f=0]=n;switch(t&&([l,u,f]=ao([],[l,u,f,1],t)),i){case Re.LNGLAT:return Ed([l,u,f],e,o);case Re.LNGLAT_OFFSETS:return Ed([l+s[0],u+s[1],f+(s[2]||0)],e,o);case Re.METER_OFFSETS:return Ed(K3(s,[l,u,f]),e,o);case Re.CARTESIAN:default:return e.isGeospatial?[l+s[0],u+s[1],f+s[2]]:e.projectPosition([l,u,f])}}function w4(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:o,fromCoordinateSystem:l,fromCoordinateOrigin:u}=A4(e),{autoOffset:f=!0}=e,{geospatialOrigin:d=Ov,shaderCoordinateOrigin:p=Ov,offsetMode:_=!1}=f?q3(t,i,s):{},y=e2(n,{viewport:t,modelMatrix:o,coordinateSystem:l,coordinateOrigin:u,offsetMode:_});if(_){const v=t.projectPosition(d||p);C3(y,y,v)}return y}let E4=1,C4=1;class t2{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:o=1}=e,l=E4++,u={time:0,delay:t,duration:i,rate:s,repeat:o};return this._setChannelTime(u,this.time),this.channels.set(l,u),l}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:o,channel:l}=s;o.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=C4++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function R4(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function M4(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let O4=0;class vg{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:ep.stats.get(`animation-loop-${O4++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...vg.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new Ha({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=R4(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(M4(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,i=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let i=1;const s=this.device?.getDefaultCanvasContext().canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Cd={};function uo(n="id"){Cd[n]=Cd[n]||1;const e=Cd[n]++;return`${n}-${e}`}class Iv{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||uo("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&et.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function I4(n,e){if(e instanceof Iv)return e;const t=P4(n,e),{attributes:i,bufferLayout:s}=N4(n,e);return new Iv({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function P4(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:et.INDEX,data:t})}function N4(n,e){const t=[],i={};for(const[o,l]of Object.entries(e.attributes)){let u=o;switch(o){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(l){i[u]=n.createBuffer({data:l.value,id:`${o}-buffer`});const{value:f,size:d,normalized:p}=l;t.push({name:u,format:$C(f,d,p)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}class Tg{static defaultProps={...Ls.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Tg(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...Ls.defaultProps,...e},i=this._renderPipelineCache,s=this._hashRenderPipeline(t);let o=i[s]?.pipeline;return o?(i[s].useCount++,this.debug&&ie.log(3,`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${e.id})`)()):(o=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:uo("unnamed-cached")}),o.hash=s,i[s]={pipeline:o,useCount:1},this.debug&&ie.log(3,`${this}: ${o} created, count=${i[s].useCount}`)()),o}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...ru.defaultProps,...e},i=this._computePipelineCache,s=this._hashComputePipeline(t);let o=i[s]?.pipeline;return o?(i[s].useCount++,this.debug&&ie.log(3,`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${e.id})`)()):(o=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),o.hash=s,i[s]={pipeline:o,useCount:1},this.debug&&ie.log(3,`${this}: ${o} created, count=${i[s].useCount}`)()),o}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),i=e.hash;t[i].useCount--,t[i].useCount===0?(this._destroyPipeline(e),this.debug&&ie.log(3,`${this}: ${e} released and destroyed`)()):t[i].useCount<0?(ie.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[i].useCount=0):this.debug&&ie.log(3,`${this}: ${e} released, count=${t[i].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof ru&&(t=this._computePipelineCache),e instanceof Ls&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,i=this._getHash(e.shader.source);return`${t}/C/${i}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",o=this._getHash(JSON.stringify(e.bufferLayout)),{type:l}=this.device;if(l==="webgl")return`${l}/R/${t}/${i}V${s}BL${o}`;{const u=this._getHash(JSON.stringify(e.parameters));return`${l}/R/${t}/${i}V${s}T${e.topology}P${u}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class xg{static defaultProps={...Su.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new xg(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let i=this._cache[t];if(i)i.useCount++,this.debug&&ie.log(3,`${this}: Reusing shader ${i.shader.id} count=${i.useCount}`)();else{const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:1},this.debug&&ie.log(3,`${this}: Created new shader ${s.id}`)()}return i.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),i=this._cache[t];if(i)if(i.useCount--,i.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy(),this.debug&&ie.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(i.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&ie.log(3,`${this}: Releasing shader ${e.id} count=${i.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function D4(n,e){const t={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of n.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;t[`in ${o}`]={[i]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const o=`${s.location} ${s.name}`;t[`out ${o}`]={[i]:JSON.stringify(s)}}return t}let wt=null,Rd=null;function k4(n,{id:e,minimap:t,opaque:i,top:s="0",left:o="0",rgbaScale:l=1}){wt||(wt=document.createElement("canvas"),wt.id=e,wt.title=e,wt.style.zIndex="100",wt.style.position="absolute",wt.style.top=s,wt.style.left=o,wt.style.border="blue 5px solid",wt.style.transform="scaleY(-1)",document.body.appendChild(wt),Rd=wt.getContext("2d")),(wt.width!==n.width||wt.height!==n.height)&&(wt.width=n.width/2,wt.height=n.height/2,wt.style.width="400px",wt.style.height="400px");const u=n.device.readPixelsToArrayWebGL(n),f=Rd?.createImageData(n.width,n.height);if(f){for(let p=0;p<u.length;p+=4)f.data[0+p+0]=u[p+0]*l,f.data[0+p+1]=u[p+1]*l,f.data[0+p+2]=u[p+2]*l,f.data[0+p+3]=i?255:u[p+3]*l;Rd?.putImageData(f,0,0)}}function gp(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!gp(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!gp(n[o],e[o],t-1))return!1;return!0}return!1}class Md{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const o=i.findIndex(l=>l.name===s.name);o<0?i.push(s):i[o]=s}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&ie.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function B4(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=e.slice();return i.sort((s,o)=>{const l=s.attributes?s.attributes.map(p=>p.attribute):[s.name],u=o.attributes?o.attributes.map(p=>p.attribute):[o.name],f=Math.min(...l.map(p=>t[p])),d=Math.min(...u.map(p=>t[p]));return f-d}),i}function L4(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function U4(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function F4(n){return L4(n)||U4(n)}function z4(n){return F4(n)||typeof n=="number"||typeof n=="boolean"}function V4(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];z4(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class H4{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=$p(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;ie.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,o]of Object.entries(e))this._addModule(o),o.name&&s!==o.name&&!this.options.disableWarnings&&ie.warn(`Module name: ${s} vs ${o.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||ie.warn(`Module ${t} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],f=o.getUniforms?.(s,l)||s,{uniforms:d,bindings:p}=V4(f);this.moduleUniforms[i]={...l,...d},this.moduleBindings[i]={...u,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${t}.${s}`]={type:this.modules[t].uniformTypes?.[s],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let j4="";async function W4(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:j4+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const $4=["+X","-X","+Y","-Y","+Z","-Z"],X4=["+X","-X","+Y","-Y","+Z","-Z"];class Ca{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const i=uo("async-texture");this.props={...Ca.defaultProps,id:i,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=W4(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((s,o)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=o}),this.initAsync(t)}async initAsync(e){const t=e.data,i=await n2(t).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(i);if(!s)throw new Error("Texture size could not be determined");const o={...s,...e,data:void 0,mipLevels:1},l=this.device.getMipLevelCount(o.width,o.height);if(o.mipLevels=this.props.mipLevels==="auto"?l:Math.min(l,this.props.mipLevels),this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,i);break;case"2d":this._setTexture2DData(i);break;case"3d":this._setTexture3DData(this.texture,i);break;case"2d-array":this._setTextureArrayData(this.texture,i);break;case"cube":this._setTextureCubeData(this.texture,i);break;case"cube-array":this._setTextureCubeArrayData(this.texture,i);break}this.props.mipmaps&&this.generateMipmaps(),ie.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof js?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const i=this._normalizeTextureData(e);i.length>1&&this.props.mipmaps!==!1&&ie.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this.device.isExternalImage(o)?this.texture.copyExternalImage({image:o,depth:t,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:o.data,mipLevel:s})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[i,s]of Object.entries(t)){const o=X4.indexOf(i);this._setTexture2DData(s,o)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,i,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ie.warn(`${this.id} has mipmap and multiple LODs.`)();const o=$4.indexOf(i);this._setTexture2DData(t,o)}_normalizeTextureData(e){const t=this.texture;let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static defaultProps={...xt.defaultProps,data:null,mipmaps:!1}}async function n2(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(n2));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let o=0;o<i.length;o++)s[i[o]]=t[o];return s}return n}const Os=2,q4=1e4;class Zt{static defaultProps={...Ls.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Ns.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Zt.defaultProps,...t},t=this.props,this.id=t.id||uo("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(f=>[f.name,f])||[]),s=t.shaderInputs||new H4(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const o=K4(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:f,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:l});this.source=f,this._getModuleUniforms=d,this.props.shaderLayout||=yM(this.source)}else{const{vs:f,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:l});this.vs=f,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Tg.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||xg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ie.info(Os,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings});const{indexBuffer:o}=this.vertexArray,l=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&I4(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new Md(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Md(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){gp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new HR(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(Y4(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&ie.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=B4(this.pipeline.shaderLayout,this.bufferLayout);const s=new Md(this.bufferLayout);for(const[o,l]of Object.entries(e)){const u=s.getBufferLayout(o);if(!u){i||ie.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const f=s.getAttributeNamesForBuffer(u);let d=!1;for(const p of f){const _=this._attributeInfos[p];if(_){const y=this.device.type==="webgpu"?s.getBufferIndex(_.bufferName):_.location;this.vertexArray.setBuffer(y,l),d=!0}}!d&&!i&&ie.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const o=this._attributeInfos[i];o?this.vertexArray.setConstantWebGL(o.location,s):(t?.disableWarnings??this.props.disableWarnings)||ie.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Ca&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Ca?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof xu?e=Math.max(e,t.texture.updateTimestamp):t instanceof et||t instanceof xt?e=Math.max(e,t.updateTimestamp):t instanceof Ca?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof js||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ie.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=Zx(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=ie.level>3?0:q4;ie.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ie.group(Os,`>>> DRAWING MODEL ${this.id}`,{collapsed:ie.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=D4(this.pipeline.shaderLayout,this.id);ie.table(Os,e)();const t=this.shaderInputs.getDebugTable();ie.table(Os,t)();const i=this._getAttributeDebugTable();ie.table(Os,this._attributeInfos)(),ie.table(Os,i)(),ie.groupEnd(Os)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&k4(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=qp(t);return(e instanceof et?new i(e.debugData):e).toString()}}function Y4(n){return!!(n.uniformTypes&&!Z4(n.uniformTypes))}function K4(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Z4(n){for(const e in n)return!1;return!0}class io{device;model;transformFeedback;static defaultProps={...Zt.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=io.defaultProps){if(!io.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Zt(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Wx(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof et)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:o=i.byteLength}=t;return i.readAsync(s,o)}}const G4="transform_output";class Pv{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Zt(this.device,{id:t.id||uo("texture-transform-model"),fs:t.fs||Wx({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:G4}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end(),this.device.submit()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:s}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),s){e.targetTexture=s;const{width:o,height:l}=s;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:l,colorAttachments:[s]}),e.framebuffer.resize({width:o,height:l})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].sampler=this.sampler}}class so{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||uo("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[o,l]of Object.entries(t)){const u=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!u.size&&(u.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[o]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:o,size:l,constant:u}=s;!u&&o&&l!==void 0&&l>=1&&(i=Math.min(i,o.length/l))}return i}}const Q4={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class i2 extends bg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,pickingFBO:l,deviceRect:{x:u,y:f,width:d,height:p},cullRect:_,effects:y,pass:v="picking",pickZ:T,shaderModuleProps:A}){this.pickZ=T;const R=this._resetColorEncoder(T),M=[u,f,d,p],H=super.render({target:l,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,cullRect:_,effects:y?.filter(L=>L.useInPicking),pass:v,isPicking:!0,shaderModuleProps:A,clearColor:[0,0,0,0],colorMask:15,scissorRect:M});return this._colorEncoderState=null,{decodePickingColor:R&&eN.bind(null,R),stats:H}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:o,operation:l}=e.props;return this._colorEncoderState?o&&l.includes("draw")?(Object.assign(s,Q4),s.blend=!0,s.blendColor=J4(this._colorEncoderState,e,i)):l.includes("terrain")&&(s.blend=!1):s.blend=!1,s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function J4(n,e,t){const{byLayer:i,byAlpha:s}=n;let o,l=i.get(e);return l?(l.viewports.push(t),o=l.a):(o=i.size+1,o<=255?(l={a:o,layer:e,viewports:[t]},i.set(e,l),s[o]=l):(Me.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function eN(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Fr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},gu=Symbol.for("component"),as=Symbol.for("propTypes"),Od=Symbol.for("deprecatedProps"),Gr=Symbol.for("asyncPropDefaults"),qs=Symbol.for("asyncPropOriginal"),ss=Symbol.for("asyncPropResolved");function Eu(n,e=()=>!0){return Array.isArray(n)?s2(n,e,[]):e(n)?[n]:[]}function s2(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?s2(s,e,t):e(s)&&t.push(s)}return t}function tN({target:n,source:e,start:t=0,count:i=1}){const s=e.length,o=i*s;let l=0;for(let u=t;l<s;l++)n[u++]=e[l];for(;l<o;)l<o-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+o-l),l=o);return n}class nN{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=tu(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class iN{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let o=this._resources[e];o?o.setData(t,i):(o=new nN(e,t,this._context),this._resources[e]=o),o.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],o=this._resources[s.resourceId];o&&o.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:o,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=o[e];if(this._track(i,s,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const o=this._consumers,l=o[e]=o[e]||{};let u=l[t];const f=u&&u.resourceId&&this._resources[u.resourceId];f&&(f.unsubscribe(u),this.prune()),i&&(u?(u.onChange=s,u.resourceId=i.id):u={onChange:s,resourceId:i.id},l[t]=u,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const sN="layerManager.setLayers",rN="layerManager.activateViewport";class oN{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{Ut(rN,this,u),u&&(this.context.viewport=u)};const{deck:i,stats:s,viewport:o,timeline:l}=t||{};this.layers=[],this.resourceManager=new iN({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:t4(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[cI],renderPass:void 0,stats:s||new Ha({id:"deck.gl"}),viewport:o||new co({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new t2,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Ut(sN,this,t,e),this._lastRenderedLayers=e;const i=Eu(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const l of e)i[l.id]?Me.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let o=!1;for(const l of s)if(l.hasUniformTransition()){o=`Uniform transition in ${l}`;break}this._needsUpdate=o,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const o=t[s.id];o===null&&Me.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let l=null;try{this._debug&&o!==s&&s.validateProps(),o?(this._transferLayerState(o,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(u){this._handleError("matching",u,s)}l&&this._updateSublayersRecursively(l,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Fr.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Fr.MATCHED,t!==e&&(e.lifecycle=Fr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Fr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Fr.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function xn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!xn(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!xn(n[o],e[o],t-1))return!1;return!0}return!1}class aN{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){const l=i[o];if(l.containsPixel(s)){const u=e.slice();return u[0]-=l.x,u[1]-=l.y,l.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Eu(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!xn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Me.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(e.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(e,t,i,s){const o=e.controller;if(o&&i){const l={...t,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==o.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const o=e[s],l=this.getViewState(o),u=o.makeViewport({viewState:l,width:this.width,height:this.height});let f=t[o.id];const d=!!o.controller;d&&!f&&(i=!0),(i||!d)&&f&&(f.finalize(),f=null),this.controllers[o.id]=this._updateController(o,l,u,f),u&&this._viewports.unshift(u)}for(const s in t){const o=t[s];o&&!this.controllers[s]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const lN=/^(?:\d+\.?\d*|\.\d+)$/;function Ki(n){switch(typeof n){case"number":if(!Number.isFinite(n))throw new Error(`Could not parse position string ${n}`);return{type:"literal",value:n};case"string":try{const e=cN(n);return new uN(e).parseExpression()}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`Could not parse position string ${n}: ${t}`)}default:throw new Error(`Could not parse position string ${n}`)}}function mp(n,e){switch(n.type){case"literal":return n.value;case"percentage":return Math.round(n.value*e);case"binary":const t=mp(n.left,e),i=mp(n.right,e);return n.operator==="+"?t+i:t-i;default:throw new Error("Unknown layout expression type")}}function Zi(n,e){return mp(n,e)}function cN(n){const e=[];let t=0;for(;t<n.length;){const i=n[t];if(/\s/.test(i)){t++;continue}if(i==="+"||i==="-"||i==="("||i===")"||i==="%"){e.push({type:"symbol",value:i}),t++;continue}if(Nv(i)||i==="."){const s=t;let o=i===".";for(t++;t<n.length;){const u=n[t];if(Nv(u)){t++;continue}if(u==="."&&!o){o=!0,t++;continue}break}const l=n.slice(s,t);if(!lN.test(l))throw new Error("Invalid number token");e.push({type:"number",value:parseFloat(l)});continue}if(Dv(i)){const s=t;for(;t<n.length&&Dv(n[t]);)t++;const o=n.slice(s,t).toLowerCase();e.push({type:"word",value:o});continue}throw new Error("Invalid token in position string")}return e}class uN{constructor(e){this.index=0,this.tokens=e}parseExpression(){const e=this.parseBinaryExpression();if(this.index<this.tokens.length)throw new Error("Unexpected token at end of expression");return e}parseBinaryExpression(){let e=this.parseFactor(),t=this.peek();for(;fN(t);){this.index++;const i=this.parseFactor();e={type:"binary",operator:t.value,left:e,right:i},t=this.peek()}return e}parseFactor(){const e=this.peek();if(!e)throw new Error("Unexpected end of expression");if(e.type==="symbol"&&e.value==="+")return this.index++,this.parseFactor();if(e.type==="symbol"&&e.value==="-"){this.index++;const t=this.parseFactor();return{type:"binary",operator:"-",left:{type:"literal",value:0},right:t}}if(e.type==="symbol"&&e.value==="("){this.index++;const t=this.parseBinaryExpression();if(!this.consumeSymbol(")"))throw new Error("Missing closing parenthesis");return t}if(e.type==="word"&&e.value==="calc"){if(this.index++,!this.consumeSymbol("("))throw new Error("Missing opening parenthesis after calc");const t=this.parseBinaryExpression();if(!this.consumeSymbol(")"))throw new Error("Missing closing parenthesis");return t}if(e.type==="number"){this.index++;const t=e.value,i=this.peek();return i&&i.type==="symbol"&&i.value==="%"?(this.index++,{type:"percentage",value:t/100}):i&&i.type==="word"&&i.value==="px"?(this.index++,{type:"literal",value:t}):{type:"literal",value:t}}throw new Error("Unexpected token in expression")}consumeSymbol(e){const t=this.peek();return t&&t.type==="symbol"&&t.value===e?(this.index++,!0):!1}peek(){return this.tokens[this.index]||null}}function Nv(n){return n>="0"&&n<="9"}function Dv(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}function fN(n){return!!(n&&n.type==="symbol"&&(n.value==="+"||n.value==="-"))}class ro{constructor(e){const{id:t,x:i=0,y:s=0,width:o="100%",height:l="100%",padding:u=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ki(i),this._y=Ki(s),this._width=Ki(o),this._height=Ki(l),this._padding=u&&{left:Ki(u.left||0),right:Ki(u.right||0),top:Ki(u.top||0),bottom:Ki(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&xn(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const o=this.getViewportType(i);return new o({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Zi(this._x,e),y:Zi(this._y,t),width:Zi(this._width,e),height:Zi(this._height,t)};return this._padding&&(i.padding={left:Zi(this._padding.left,e),top:Zi(this._padding.top,t),right:Zi(this._padding.right,e),bottom:Zi(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Cu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const kv=()=>{},_p={BREAK:1,SNAP_TO_END:2,IGNORE:3},hN=n=>n,dN=_p.BREAK;class pN{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:o,endProps:l,duration:u,easing:f}}=t,d=f(i/u),p=s.interpolateProps(o,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Cu(e.timeline),this.onViewStateChange=e.onViewStateChange||kv,this.onStateChange=e.onStateChange||kv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:o,endProps:l}=this.transition.settings;s={...i,...o===_p.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===_p.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),o=t.transitionInterpolator,l=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(l===0)return;const u=o.initializeProps(e,s);this.propsInTransition={};const f={duration:l,easing:t.transitionEasing||hN,interpolator:o,interruption:t.transitionInterruption||dN,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Et(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class gN{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!vi(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const o of this._propsToExtract)(o in e||o in t)&&(i[o]=e[o],s[o]=t[o]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];Et(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const Sc=Math.PI/180,Bv=180/Math.PI,Xc=6370972,Hr=256;function mN(){const n=Hr/Xc,e=Math.PI/180*Hr;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class Sg extends co{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:s=.5,farZMultiplier:o=1,resolution:l=10}=e;let{latitude:u=0,height:f,altitude:d=1.5,fovy:p}=e;u=Math.max(Math.min(u,is),-is),f=f||1,p?d=_g(p):p=Ba(d);const _=Math.pow(2,i-Ac(u)),y=e.nearZ??s,v=e.farZ??(d+Hr*2*_/f)*o,T=new Pt().lookAt({eye:[0,-d,0],up:[0,0,1]});T.rotateX(u*Sc),T.rotateZ(-t*Sc),T.scale(_/f),super({...e,height:f,viewMatrix:T,longitude:t,latitude:u,zoom:i,distanceScales:mN(),fovy:p,focalDistance:d,near:y,far:v}),this.scale=_,this.latitude=u,this.longitude=t,this.fovy=p,this.resolution=l}get projectionMode(){return fn.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),o=this.unproject([this.width,this.height/2],t),l=this.unproject([this.width/2,this.height],t);return o[0]<this.longitude&&(o[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],o[0],s[0],l[0]),Math.min(i[1],o[1],s[1],l[1]),Math.max(i[0],o[0],s[0],l[0]),Math.max(i[1],o[1],s[1],l[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,o,l]=e,u=t?o:this.height-o,{pixelUnprojectionMatrix:f}=this;let d;if(Number.isFinite(l))d=Id(f,[s,u,l,1]);else{const v=Id(f,[s,u,-1,1]),T=Id(f,[s,u,1,1]),A=((i||0)/Xc+1)*Hr,R=_d(C3([],v,T)),M=_d(v),H=_d(T),L=4*((4*M*H-(R-M-H)**2)/16)/R,X=Math.sqrt(M-L),Y=Math.sqrt(Math.max(0,A*A-L)),re=(X-Y)/Math.sqrt(R);d=UM([],v,T,re)}const[p,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,_,y]:Number.isFinite(i)?[p,_,i]:[p,_]}projectPosition(e){const[t,i,s=0]=e,o=t*Sc,l=i*Sc,u=Math.cos(l),f=(s/Xc+1)*Hr;return[Math.sin(o)*u*f,-Math.cos(o)*u*f,Math.sin(l)*f]}unprojectPosition(e){const[t,i,s]=e,o=R3(e),l=Math.asin(s/o),f=Math.atan2(t,-i)*Bv,d=l*Bv,p=(o/Hr-1)*Xc;return[f,d,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition([e,t,i],s,o){const u=.25/Math.pow(2,this.zoom-Ac(this.latitude)),f=e+u*(o[0]-s[0]);let d=t-u*(o[1]-s[1]);d=Math.max(Math.min(d,is),-is);const p={longitude:f,latitude:d,zoom:i-Ac(t)};return p.zoom+=Ac(p.latitude),p}}Sg.displayName="GlobeViewport";function Ac(n){const e=Math.PI*Math.cos(n*Math.PI/180);return Math.log2(e)}function Id(n,e){const t=ao([],e,n);return pg(t,t,1/t[3]),t}const _N=["longitude","latitude","zoom","bearing","pitch"],yN=["longitude","latitude","zoom"];class r2 extends gN{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:_N,required:yN},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:o}=this.opts;if(s&&o)if(s(e)instanceof Sg)Me.warn("around not supported in GlobeView")();else{const u=s(e),f=s(t),d=u.unproject(o);i.start.around=o,Object.assign(i.end,{around:f.project(d),aroundPosition:d,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const o of this._propsToExtract)s[o]=Us(e[o]||0,t[o]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...s});Object.assign(s,o.panByPosition(t.aroundPosition,Us(e.around,t.around,i)))}return s}}const pi={transitionDuration:0},bN=300,wc=n=>1-(1-n)*(1-n),Ur={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Is={};class vN{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new pN({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?bN:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:o=!0,doubleClickZoom:l=!0,touchZoom:u=!0,touchRotate:f=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(Ur.WHEEL,p&&i),this.toggleEvents(Ur.PAN,p),this.toggleEvents(Ur.PINCH,p&&(u||f)),this.toggleEvents(Ur.MULTI_PAN,p&&f),this.toggleEvents(Ur.DOUBLE_CLICK,p&&l),this.toggleEvents(Ur.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=o,this.doubleClickZoom=l,this.touchZoom=u,this.touchRotate=f,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,pi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,pi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:wc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,pi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:wc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let l=2/(1+Math.exp(-Math.abs(o*i)));o<0&&l!==0&&(l=1/l);const u=s?{...this._getTransitionProps({around:t}),transitionDuration:250}:pi,f=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(f,u,{isZooming:!0,isPanning:!0}),s||this._setInteractionState({isZooming:!1,isPanning:!1}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,pi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,pi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:s});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:wc},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Is._startPinchRotation=e.rotation,Is._lastPinchEvent=e,this.updateViewport(i,pi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Is._startPinchRotation-i})}return this.updateViewport(t,pi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Is._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Is;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let o=this.controllerState.rotateEnd();const l=Math.log2(e.scale),u=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,l+u*t/2);o=o.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:wc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Is._startPinchRotation=null,Is._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:o,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let f;const d={};switch(e.srcEvent.code){case"Minus":f=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),d.isZooming=!0;break;case"Equal":f=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(f=u.rotateLeft(o),d.isRotating=!0):(f=u.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(f=u.rotateRight(o),d.isRotating=!0):(f=u.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(f=u.rotateUp(l),d.isRotating=!0):(f=u.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(f=u.rotateDown(l),d.isRotating=!0):(f=u.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?pi:e?{...t,transitionInterpolator:new r2({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class TN{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Lv=5,xN=1.2;class SN extends TN{constructor(e){const{width:t,height:i,latitude:s,longitude:o,zoom:l,bearing:u=0,pitch:f=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:v=60,minPitch:T=0,startPanLngLat:A,startZoomLngLat:R,startRotatePos:M,startBearing:H,startPitch:O,startZoom:L,normalize:X=!0}=e;Et(Number.isFinite(o)),Et(Number.isFinite(s)),Et(Number.isFinite(l)),super({width:t,height:i,latitude:s,longitude:o,zoom:l,bearing:u,pitch:f,altitude:d,maxZoom:_,minZoom:y,maxPitch:v,minPitch:T,normalize:X,position:p},{startPanLngLat:A,startZoomLngLat:R,startRotatePos:M,startBearing:H,startPitch:O,startZoom:L}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:o,startPitch:l}=this.getState();if(!s||o===void 0||l===void 0)return this;let u;return e?u=this._getNewRotation(e,s,l,o):u={bearing:o+t,pitch:l+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:o}=this.getState();if(o||(s=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:l,minZoom:u}=this.getViewportProps();let f=s+Math.log2(i);f=ns(f,u,l);const d=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...d.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:o}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(o-t.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=ns(s,i,t);const{maxPitch:o,minPitch:l,pitch:u}=e;e.pitch=ns(u,l,o);const{normalize:f=!0}=e;return f&&Object.assign(e,FP(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const o=e[0]-t[0],l=e[1]-t[1],u=e[1],f=t[1],{width:d,height:p}=this.getViewportProps(),_=o/d;let y=0;l>0?Math.abs(p-f)>Lv&&(y=l/(f-p)*xN):l<0&&f>Lv&&(y=1-u/f),y=ns(y,-1,1);const{minPitch:v,maxPitch:T}=this.getViewportProps(),A=s+180*_;let R=i;return y>0?R=i+y*(T-i):y<0&&(R=i-y*(v-i)),{pitch:R,bearing:A}}}class AN extends vN{constructor(){super(...arguments),this.ControllerState=SN,this.transition={transitionDuration:300,transitionInterpolator:new r2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class o2 extends ro{constructor(e={}){super(e)}getViewportType(){return us}get ControllerType(){return AN}}o2.displayName="MapView";const wN=new J3;function EN(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class CN{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>EN(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(xn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const o=t[s.id];let l=s;o&&o!==s?o.setProps?(o.setProps(s.props),l=o):o.cleanup(this._context):o||s.setup(this._context),i.push(l),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof J3)||this._resolvedEffects.push(wN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class RN extends bg{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const MN="deckRenderer.renderLayers";class ON{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new RN(e),this.pickLayersPass=new i2(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const o=t.render({...i,target:s});i.effects&&(this.lastPostProcessEffect&&(i.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(i.effects,i)),this.renderCount++,Ut(MN,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[i,s]=t;e.length===0&&[0,1].map(o=>{const l=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:i,height:s});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${o}`,colorAttachments:[l]}))});for(const o of e)o.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const o of e)if(o.postRender){s.target=o.id===this.lastPostProcessEffect?t.target:void 0;const l=o.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const IN={pickedColor:null,pickedObjectIndex:-1};function Uv({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:o}){const{x:l,y:u,width:f,height:d}=o;let p=s*s,_=-1,y=0;for(let v=0;v<d;v++){const T=v+u-i,A=T*T;if(A>p)y+=4*f;else for(let R=0;R<f;R++){if(n[y+3]-1>=0){const H=R+l-t,O=H*H+A;O<=p&&(p=O,_=y)}y+=4}}if(_>=0){const v=n.slice(_,_+4),T=e(v);if(T){const A=Math.floor(_/4/f),R=_/4-A*f;return{...T,pickedColor:v,pickedX:l+R,pickedY:u+A}}Me.error("Picked non-existent layer. Is picking buffer corrupt?")()}return IN}function Fv({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const o=n.slice(i,i+4),l=o.join(",");if(!t.has(l)){const u=e(o);u?t.set(l,{...u,color:o}):Me.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function yp({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:o}){let l=e[0];e.length>1&&(l=PN(n?.pickedViewports||e,{x:i,y:s}));let u;if(l){const f=[i-l.x,s-l.y];o!==void 0&&(f[2]=o),u=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function zv(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:o,pickedLayer:l,pickedObjectIndex:u}=e,f=l?[l]:[];if(i==="hover"){const _=t.index,y=t.layerId,v=l?l.props.id:null;if(v!==y||u!==_){if(v!==y){const T=s.find(A=>A.props.id===y);T&&f.unshift(T)}t.layerId=v,t.index=u,t.info=null}}const d=yp(n),p=new Map;return p.set(null,d),f.forEach(_=>{let y={...d};_===l&&(y.color=o,y.index=u,y.picked=!0),y=bp({layer:_,info:y,mode:i});const v=y.layer;_===l&&i==="hover"&&(t.info=y),p.set(v.id,y),i==="hover"&&v.updateAutoHighlight(y)}),p}function bp({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function PN(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class NN{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new i2(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},o=this.lastPickedInfo.info){const l=o&&o.layer&&o.layer.id,u=o&&o.viewport&&o.viewport.id,f=l?i.find(y=>y.id===l):null,d=u&&s.find(y=>y.id===u)||s[0],p=d&&d.unproject([e-d.x,t-d.y]);return{...o,...{x:e,y:t,viewport:d,coordinate:p,layer:f}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:i,x:s,y:o,radius:l=0,depth:u=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:yp({viewports:i,x:s,y:o,pixelRatio:y})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([s,o],!0),A=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],R=Math.round(l*y),{width:M,height:H}=this.pickingFBO,O=this._getPickingRect({deviceX:A[0],deviceY:A[1],deviceRadius:R,deviceWidth:M,deviceHeight:H}),L={x:s-l,y:o-l,width:l*2+1,height:l*2+1};let X;const Y=[],re=new Set;for(let le=0;le<u;le++){let oe;if(O){const me=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:p,deviceRect:O,cullRect:L,effects:_,pass:`picking:${f}`});oe=Uv({...me,deviceX:A[0],deviceY:A[1],deviceRadius:R,deviceRect:O})}else oe={pickedColor:null,pickedObjectIndex:-1};let fe;if(oe.pickedLayer&&d&&this.depthFBO){const{pickedColors:me}=this._drawAndSample({layers:[oe.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:oe.pickedX,y:oe.pickedY,width:1,height:1},cullRect:L,effects:_,pass:`picking:${f}:z`},!0);me[3]&&(fe=me[0])}oe.pickedLayer&&le+1<u&&(re.add(oe.pickedLayer),oe.pickedLayer.disablePickingIndex(oe.pickedObjectIndex)),X=zv({pickInfo:oe,lastPickedInfo:this.lastPickedInfo,mode:f,layers:v,viewports:i,x:s,y:o,z:fe,pixelRatio:y});for(const me of X.values())me.layer&&Y.push(me);if(!oe.pickedColor)break}for(const le of re)le.restorePickingColors();return{result:Y,emptyInfo:X.get(null)}}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:o,radius:l=0,depth:u=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:yp({viewports:i,x:s,y:o,pixelRatio:y})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([s,o],!0),A=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],R=Math.round(l*y),{width:M,height:H}=this.pickingFBO,O=this._getPickingRect({deviceX:A[0],deviceY:A[1],deviceRadius:R,deviceWidth:M,deviceHeight:H}),L={x:s-l,y:o-l,width:l*2+1,height:l*2+1};let X;const Y=[],re=new Set;for(let le=0;le<u;le++){let oe;if(O){const me=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:p,deviceRect:O,cullRect:L,effects:_,pass:`picking:${f}`});oe=Uv({...me,deviceX:A[0],deviceY:A[1],deviceRadius:R,deviceRect:O})}else oe={pickedColor:null,pickedObjectIndex:-1};let fe;if(oe.pickedLayer&&d&&this.depthFBO){const{pickedColors:me}=this._drawAndSample({layers:[oe.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:oe.pickedX,y:oe.pickedY,width:1,height:1},cullRect:L,effects:_,pass:`picking:${f}:z`},!0);me[3]&&(fe=me[0])}oe.pickedLayer&&le+1<u&&(re.add(oe.pickedLayer),oe.pickedLayer.disablePickingIndex(oe.pickedObjectIndex)),X=zv({pickInfo:oe,lastPickedInfo:this.lastPickedInfo,mode:f,layers:v,viewports:i,x:s,y:o,z:fe,pixelRatio:y});for(const me of X.values())me.layer&&Y.push(me);if(!oe.pickedColor)break}for(const le of re)le.restorePickingColors();return{result:Y,emptyInfo:X.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:i,x:s,y:o,width:l=1,height:u=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([s,o],!0),A=T.x,R=T.y+T.height,M=this.device.canvasContext.cssToDevicePixels([s+l,o+u],!0),H=M.x+M.width,O=M.y,L={x:A,y:O,width:H-A,height:R-O},X=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:L,cullRect:{x:s,y:o,width:l,height:u},effects:_,pass:`picking:${f}`}),Y=Fv(X),re=new Map,le=[],oe=Number.isFinite(d);for(let fe=0;fe<Y.length&&!(oe&&le.length>=d);fe++){const me=Y[fe];let ve={color:me.pickedColor,layer:null,index:me.pickedObjectIndex,picked:!0,x:s,y:o,pixelRatio:v};ve=bp({layer:me.pickedLayer,info:ve,mode:f});const xe=ve.layer.id;re.has(xe)||re.set(xe,new Set);const de=re.get(xe),We=ve.object??ve.index;de.has(We)||(de.add(We),le.push(ve))}return le}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:o,width:l=1,height:u=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([s,o],!0),A=T.x,R=T.y+T.height,M=this.device.canvasContext.cssToDevicePixels([s+l,o+u],!0),H=M.x+M.width,O=M.y,L={x:A,y:O,width:H-A,height:R-O},X=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:L,cullRect:{x:s,y:o,width:l,height:u},effects:_,pass:`picking:${f}`}),Y=Fv(X),re=new Map,le=[],oe=Number.isFinite(d);for(let fe=0;fe<Y.length&&!(oe&&le.length>=d);fe++){const me=Y[fe];let ve={color:me.pickedColor,layer:null,index:me.pickedObjectIndex,picked:!0,x:s,y:o,pixelRatio:v};ve=bp({layer:me.pickedLayer,info:ve,mode:f});const xe=ve.layer.id;re.has(xe)||re.set(xe,new Set);const de=re.get(xe),We=ve.object??ve.index;de.has(We)||(de.add(We),le.push(ve))}return le}async _drawAndSampleAsync({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:o,cullRect:l,effects:u,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:o,cullRect:l,effects:u,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const H of u)H.useInPicking&&(_.preRenderStats[H.id]=H.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:v,y:T,width:A,height:R}=o,M=new(d?Float32Array:Uint8Array)(A*R*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:T,sourceWidth:A,sourceHeight:R,target:M}),{pickedColors:M,decodePickingColor:y}}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:o,cullRect:l,effects:u,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:o,cullRect:l,effects:u,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const H of u)H.useInPicking&&(_.preRenderStats[H.id]=H.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:v,y:T,width:A,height:R}=o,M=new(d?Float32Array:Uint8Array)(A*R*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:T,sourceWidth:A,sourceHeight:R,target:M}),{pickedColors:M,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:o}){const l=Math.max(0,e-i),u=Math.max(0,t-i),f=Math.min(s,e+i+1)-l,d=Math.min(o,t+i+1)-u;return f<=0||d<=0?null:{x:l,y:u,width:f,height:d}}}const DN={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},kN="top-left",Vv="root";class BN{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!xn(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const i=e.reduce((s,o)=>(s[o.id]=o,s),{});for(const s of this.getWidgets()){const{viewId:o}=s;if(o){const l=i[o];l&&(s.onViewportChange&&s.onViewportChange(l),s.onRedraw?.({viewports:[l],layers:t}))}else{if(s.onViewportChange)for(const l of e)s.onViewportChange(l);s.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=fp[t.type];if(i)for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===e.viewport?.id)&&s[i]?.(e,t)}}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._removeWidget(s),this._addWidget(i)):i!==s&&(s.setProps(i.props),i=s):this._addWidget(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._removeWidget(s)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:i=kN}=e,s=e.props._container??t;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(s,i).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){if(e&&typeof e!="string")return e;const i=e||Vv;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let o=s.querySelector(`.${t}`);return o||(o=globalThis.document.createElement("div"),o.className=t,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,DN[t]),s.append(o)),o}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,o=i===Vv||s,l=this.containers[i];o?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:t}px`):l.style.display="none"}}}function Hv(n,e){e&&Object.entries(e).map(([t,i])=>{t.startsWith("--")?n.style.setProperty(t,i):n.style[t]=i})}function LN(n,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?n.style.removeProperty(t):n.style[t]=""})}class Ag{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,i=this.rootElement;i&&t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),i&&!xn(t.style,e.style,1)&&(LN(i,t.style),Hv(i,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(i=>typeof i=="string"&&i.length>0).forEach(i=>t.classList.add(i)),Hv(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Ag.defaultProps={id:"widget",style:{},_container:null,className:""};const UN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class a2 extends Ag{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,UN),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.rootElement;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}a2.defaultProps={...Ag.defaultProps};const FN="modulepreload",zN=function(n){return"/"+n},jv={},Wv=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let d=function(p){return Promise.all(p.map(_=>Promise.resolve(_).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};var l=d;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=u?.nonce||u?.getAttribute("nonce");s=d(t.map(p=>{if(p=zN(p),p in jv)return;jv[p]=!0;const _=p.endsWith(".css"),y=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${y}`))return;const v=document.createElement("link");if(v.rel=_?"stylesheet":FN,_||(v.as="script"),v.crossOrigin="",v.href=p,f&&v.setAttribute("nonce",f),document.head.appendChild(v),_)return new Promise((T,A)=>{v.addEventListener("load",T),v.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return s.then(u=>{for(const f of u||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})};var jr;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(jr||(jr={}));const VN={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},HN=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),jN=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),WN=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function $N(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&XN(s),s}return this.originalGetContext(t,i)}}function XN(n){n.getExtension("EXT_color_buffer_float");const e={...VN,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:HN(n),OES_vertex_array_object:jN(n),ANGLE_instanced_arrays:WN(n)},t=n.getExtension;n.getExtension=function(s){const o=t.call(n,s);return o||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(e))}}async function l2(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,o)=>{i.onload=s,i.onerror=l=>o(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(i)})}const qN=1;let ln=null,$v=!1;const wg={debugSpectorJS:ie.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function YN(n){if(!globalThis.SPECTOR)try{await l2(n.debugSpectorJSUrl||wg.debugSpectorJSUrl)}catch(e){ie.warn(String(e))}}function KN(n){if(n={...wg,...n},!n.debugSpectorJS)return null;if(!ln&&globalThis.SPECTOR&&!globalThis.luma?.spector){ie.probe(qN,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;ln=new e,globalThis.luma&&(globalThis.luma.spector=ln)}if(!ln)return null;if($v||($v=!0,ln.spyCanvases(),ln?.onCaptureStarted.add(e=>ie.info("Spector capture started:",e)()),ln?.onCapture.add(e=>{ie.info("Spector capture complete:",e)(),ln?.getResultUI(),ln?.resultView.display(),ln?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;ln?.startCapture(n.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{ie.info("Spector capture stopped after 2 seconds")(),ln?.stopCapture()})}return ln}const ZN="https://unpkg.com/webgl-debug@2.0.1/index.js";function c2(n){return n.luma=n.luma||{},n.luma}async function GN(){Ys()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await l2(ZN))}function QN(n,e={}){return e.debugWebGL||e.traceWebGL?eD(n,e):JN(n)}function JN(n){const e=c2(n);return e.realContext?e.realContext:n}function eD(n,e){if(!globalThis.WebGLDebugUtils)return ie.warn("webgl-debug not loaded")(),n;const t=c2(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...jr,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,tD.bind(null,e),nD.bind(null,e));for(const l in jr)!(l in i)&&typeof jr[l]=="number"&&(i[l]=jr[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const o=Object.create(s);return t.realContext=n,t.debugContext=o,o.debug=!0,o}function Xv(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function tD(n,e,t,i){i=Array.from(i).map(u=>u===void 0?"undefined":u);const s=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),l=`${s} in gl.${t}(${o})`;ie.error(l)();debugger}function nD(n,e,t){let i="";ie.level>=1&&(i=Xv(e,t),n.traceWebGL&&ie.log(1,i)());for(const s of t)if(s===void 0){i=i||Xv(e,t);debugger}}const Ec=1;class iD extends lR{type="webgl";constructor(){super(),Hs.defaultProps={...Hs.defaultProps,...wg}}enforceWebGL2(e){$N(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&ie.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:i}=await Wv(async()=>{const{WebGLDevice:o}=await Promise.resolve().then(()=>lT);return{WebGLDevice:o}},void 0);if(e instanceof i)return e;if(e?.device instanceof i)return e.device;if(!sD(e))throw new Error("Invalid WebGL2RenderingContext");const s=t.createCanvasContext===!0?{}:t.createCanvasContext;return new i({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...s}})}async create(e={}){const{WebGLDevice:t}=await Wv(async()=>{const{WebGLDevice:i}=await Promise.resolve().then(()=>lT);return{WebGLDevice:i}},void 0);ie.groupCollapsed(Ec,"WebGLDevice created")();try{const i=[];(e.debugWebGL||e.debug)&&i.push(GN()),e.debugSpectorJS&&i.push(YN(e));const s=await Promise.allSettled(i);for(const u of s)u.status==="rejected"&&ie.error(`Failed to initialize debug libraries ${u.reason}`)();const o=new t(e),l=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return ie.probe(Ec,l)(),ie.table(Ec,o.info)(),o}finally{ie.groupEnd(Ec)()}}}function sD(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const Pd=new iD,Eg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},mt=(n,e,t)=>e?n.enable(t):n.disable(t),qv=(n,e,t)=>n.hint(t,e),cn=(n,e,t)=>n.pixelStorei(t,e),Yv=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},fa=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function Nd(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const rD={3042:mt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:mt,2885:(n,e)=>n.cullFace(e),2929:mt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:mt,35723:qv,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:Yv,36010:Yv,34964:fa,36662:fa,36663:fa,35053:fa,35055:fa,2886:(n,e)=>n.frontFace(e),33170:qv,2849:(n,e)=>n.lineWidth(e),32823:mt,32824:"polygonOffset",10752:"polygonOffset",35977:mt,32926:mt,32928:mt,32938:"sampleCoverage",32939:"sampleCoverage",3089:mt,3088:(n,e)=>n.scissor(...e),2960:mt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:mt,10754:mt,12288:mt,12289:mt,12290:mt,12291:mt,12292:mt,12293:mt,12294:mt,12295:mt,3333:cn,3317:cn,37440:cn,37441:cn,37443:cn,3330:cn,3332:cn,3331:cn,3314:cn,32878:cn,3316:cn,3315:cn,32877:cn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Nd(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Nd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,o,l,u]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,o,l,u)},stencilOp:(n,e)=>{e=Nd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,o,l,u]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,o,l,u)},viewport:(n,e)=>n.viewport(...e)};function lt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const oD={blendEquation:(n,e,t)=>n.blendEquationSeparate(lt(32777,e,t),lt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(lt(32969,e,t),lt(32968,e,t),lt(32971,e,t),lt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(lt(32824,e,t),lt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(lt(32938,e,t),lt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,lt(2962,e,t),lt(2967,e,t),lt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,lt(34816,e,t),lt(36003,e,t),lt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,lt(2964,e,t),lt(2965,e,t),lt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,lt(34817,e,t),lt(34818,e,t),lt(34819,e,t))},Kv={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},Wn=(n,e)=>n.isEnabled(e),Zv={3042:Wn,2884:Wn,2929:Wn,3024:Wn,32823:Wn,32926:Wn,32928:Wn,3089:Wn,2960:Wn,35977:Wn},aD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function fo(n,e){if(cD(e))return;const t={};for(const s in e){const o=Number(s),l=rD[s];l&&(typeof l=="string"?t[l]=!0:l(n,e[s],o))}const i=n.state&&n.state.cache;if(i)for(const s in t){const o=oD[s];o(n,e,i)}}function u2(n,e=Eg){if(typeof e=="number"){const s=e,o=Zv[s];return o?o(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const o=Zv[s];i[s]=o?o(n,Number(s)):n.getParameter(Number(s))}return i}function lD(n){fo(n,Eg)}function cD(n){for(const e in n)return!1;return!0}function uD(n,e){if(n===e)return!0;if(Gv(n)&&Gv(e)&&n.length===e.length){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}return!1}function Gv(n){return Array.isArray(n)||ArrayBuffer.isView(n)}class zs{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];fo(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?u2(e):Object.assign({},Eg),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,hD(e);for(const i in Kv){const s=Kv[i];fD(e,i,s)}Qv(e,"getParameter"),Qv(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const l=e[o],u=this.cache[o];uD(l,u)||(t=!0,i=u,s&&!(o in s)&&(s[o]=u),this.cache[o]=l)}return{valueChanged:t,oldValue:i}}}function Qv(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||aD.has(s))return t(s);const o=zs.get(n);return s in o.cache||(o.cache[s]=t(s)),o.enable?o.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function fD(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...o){const l=zs.get(n),{valueChanged:u,oldValue:f}=t(l._updateCache,...o);return u&&i(...o),f},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function hD(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=zs.get(n);s.program!==i&&(e(i),s.program=i)}}function dD(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let o=null;if(o||=n.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,o=n.getContext("webgl2",s),o.luma||={},o.luma.softwareRenderer=!0),o||(o=n.getContext("webgl",{}),o&&(o=null,i||="Your browser only supports WebGL1")),!o)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:u}=e;return n.addEventListener("webglcontextlost",f=>l(f),!1),n.addEventListener("webglcontextrestored",f=>u(f),!1),o.luma||={},o}function oo(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function pD(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);oo(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,o=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),u=o||t,f=l||i,d=n.getParameter(7938),p=f2(u,f),_=gD(u,f),y=mD(u,f);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:u,renderer:f,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function f2(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function gD(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function mD(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(f2(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function h2(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const ya="WEBGL_compressed_texture_s3tc",ba="WEBGL_compressed_texture_s3tc_srgb",Wr="EXT_texture_compression_rgtc",$r="EXT_texture_compression_bptc",_D="WEBGL_compressed_texture_etc",yD="WEBGL_compressed_texture_astc",bD="WEBGL_compressed_texture_etc1",vD="WEBGL_compressed_texture_pvrtc",TD="WEBGL_compressed_texture_atc",Jv="EXT_texture_norm16",eT="EXT_render_snorm",xD="EXT_color_buffer_float",Cg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[eT],"norm16-renderable-webgl":[Jv],"snorm16-renderable-webgl":[Jv,eT],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[ya,ba,Wr,$r],"texture-compression-bc5-webgl":[Wr],"texture-compression-bc7-webgl":[$r],"texture-compression-etc2":[_D],"texture-compression-astc":[yD],"texture-compression-etc1-webgl":[bD],"texture-compression-pvrtc-webgl":[vD],"texture-compression-atc-webgl":[TD]};function SD(n){return n in Cg}function AD(n,e,t){return(Cg[e]||[]).every(s=>oo(n,s,t))}const Rg={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:xD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:ya},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ba},"bc1-rgba-unorm":{gl:33777,x:ya},"bc1-rgba-unorm-srgb":{gl:35916,x:ba},"bc2-rgba-unorm":{gl:33778,x:ya},"bc2-rgba-unorm-srgb":{gl:35918,x:ba},"bc3-rgba-unorm":{gl:33779,x:ya},"bc3-rgba-unorm-srgb":{gl:35919,x:ba},"bc4-r-unorm":{gl:36283,x:Wr},"bc4-r-snorm":{gl:36284,x:Wr},"bc5-rg-unorm":{gl:36285,x:Wr},"bc5-rg-snorm":{gl:36286,x:Wr},"bc6h-rgb-ufloat":{gl:36495,x:$r},"bc6h-rgb-float":{gl:36494,x:$r},"bc7-rgba-unorm":{gl:36492,x:$r},"bc7-rgba-unorm-srgb":{gl:36493,x:$r},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function wD(n,e,t){let i=e.create;const s=Rg[e.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!oo(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function d2(n){const e=Rg[n],t=RD(n),i=Kr.getInfo(n);return i.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||CD(i.channels,i.integer,i.normalized,t),type:i.dataType?h2(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function ED(n){switch(Kr.getInfo(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function CD(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function RD(n){const t=Rg[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const tT={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class MD extends oR{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,oo(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),SD(e)&&AD(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(tT),...Object.keys(Cg)]}getWebGLFeature(e){const t=tT[e];return typeof t=="string"?!!oo(this.gl,t,this.extensions):!!t}}class OD extends rR{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Ra extends Au{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const s=36064+t;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const t=ED(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${PD(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:s}=t,o=t.props.baseMipLevel,l=t.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,s.handle,o,l);break;case 34067:const u=ID(l);i.framebufferTexture2D(36160,e,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,e,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function ID(n){return n<34069?n+34069:n}function PD(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class ND extends Ds{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Ra(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Dd={};function DD(n="id"){Dd[n]=Dd[n]||1;const e=Dd[n]++;return`${n}-${e}`}class Ma extends et{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=kD(this.props.usage),this.glUsage=BD(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,i=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const i=ArrayBuffer.isView(e)?e:new Uint8Array(e),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,t,i),this.gl.bindBuffer(s,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,i=this.byteLength-t){const s=new ArrayBuffer(i);await e(s,"copied"),this.write(s,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,i){const s=await this.readAsync(t,i);return await e(s.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,s,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function kD(n){return n&et.INDEX?34963:n&et.VERTEX?34962:n&et.UNIFORM?35345:34962}function BD(n){return n&et.INDEX||n&et.VERTEX?35044:n&et.UNIFORM?35048:35044}function LD(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,y]=s;t.push({message:y.trim(),type:nT(_),lineNum:0,linePos:0});continue}const[o,l,u,...f]=s;let d=parseInt(u,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),t.push({message:f.join(":").trim(),type:nT(o),lineNum:d,linePos:p})}return t}function nT(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class UD extends Su{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?LD(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ie.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ie.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function FD(n,e,t,i){if(jD(e))return i(n);const s=n;s.pushState();try{return zD(n,e),fo(s.gl,t),i(n)}finally{s.popState()}}function zD(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Vs("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const o=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Vs("provokingVertex",e.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Vs("polygonMode",e.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,l),o?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(HD("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(vp("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&ie.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,o=vp("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,o,0,s),i.stencilFuncSeparate(1029,o,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=kd("stencilPassOperation",e.stencilPassOperation),o=kd("stencilFailOperation",e.stencilFailOperation),l=kd("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,o,l,s),i.stencilOpSeparate(1029,o,l,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=iT("blendColorOperation",e.blendColorOperation||"add"),o=iT("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,o);const l=Cc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=Cc("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=Cc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Cc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,u,f,d)}}function vp(n,e){return Vs(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function kd(n,e){return Vs(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function iT(n,e){return Vs(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Cc(n,e,t="color"){return Vs(n,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function VD(n,e){return`Illegal parameter ${e} for ${n}`}function Vs(n,e,t){if(!(e in t))throw new Error(VD(n,e));return t[e]}function HD(n,e){return e}function jD(n){let e=!0;for(const t in n){e=!1;break}return e}function p2(n){const e={};return n.addressModeU&&(e[10242]=Bd(n.addressModeU)),n.addressModeV&&(e[10243]=Bd(n.addressModeV)),n.addressModeW&&(e[32882]=Bd(n.addressModeW)),n.magFilter&&(e[10240]=Tp(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=WD(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=vp("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Bd(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Tp(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function WD(n,e="none"){if(!e)return Tp(n);switch(e){case"none":return Tp(n);case"nearest":switch(n){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(n){case"nearest":return 9986;case"linear":return 9987}}}class $D extends js{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=p2(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const s=Number(t);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}function La(n,e,t){if(XD(e))return t(n);const{nocatch:i=!0}=e,s=zs.get(n);s.push(),fo(n,e);let o;if(i)o=t(n),s.pop();else try{o=t(n)}finally{s.pop()}return o}function XD(n){for(const e in n)return!1;return!0}class Xr extends xu{device;gl;handle;texture;constructor(e,t){super(e,{...xt.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class Oa extends xt{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const i=d2(this.props.format);this.glTarget=qD(this.props.dimension),this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:o,height:l,depth:u,mipLevels:f,glTarget:d,glInternalFormat:p}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(d,f,p,o,l);break;case"2d-array":case"3d":this.gl.texStorage3D(d,f,p,o,l,u);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new Xr(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Xr(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=p2(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),i=t.data,{width:s,height:o,depth:l}=this,{mipLevel:u=0,byteOffset:f=0,x:d=0,y:p=0,z:_=0}=t,{glFormat:y,glType:v,compressed:T}=this,A=sT(this.glTarget,this.dimension,_);let R;if(!this.compressed){const{bytesPerPixel:H}=this.device.getTextureFormatInfo(this.format);if(H){if(t.bytesPerRow%H!==0)throw new Error(`bytesPerRow (${t.bytesPerRow}) must be a multiple of bytesPerPixel (${H}) for ${this.format}`);R=t.bytesPerRow/H}}const M=this.compressed?{}:{...R!==void 0?{3314:R}:{},32878:t.rowsPerImage};this.gl.bindTexture(A,this.handle),La(this.gl,M,()=>{switch(this.dimension){case"2d":case"cube":T?this.gl.compressedTexSubImage2D(A,u,d,p,s,o,y,i,f):this.gl.texSubImage2D(A,u,d,p,s,o,y,v,i,f);break;case"2d-array":case"3d":T?this.gl.compressedTexSubImage3D(A,u,d,p,_,s,o,l,y,i,f):this.gl.texSubImage3D(A,u,d,p,_,s,o,l,y,v,i,f);break;default:}}),this.gl.bindTexture(A,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:i,glType:s}=this,{image:o,depth:l,mipLevel:u,x:f,y:d,z:p,width:_,height:y}=t,v=sT(this.glTarget,this.dimension,l),T=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),La(this.gl,T,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(v,u,f,d,_,y,i,s,o);break;case"2d-array":case"3d":this.gl.texSubImage3D(v,u,f,d,p,_,y,l,i,s,o);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ie.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){ie.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){ie.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const s=Number(t),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function qD(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function sT(n,e,t){return e==="cube"?34069+t:n}function YD(n){return QD[n]}function Mg(n){return GD[n]}function KD(n){return!!g2[n]}function ZD(n){return g2[n]}const GD={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},g2={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},QD={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function JD(n,e){const t={attributes:[],bindings:[]};t.attributes=ek(n,e);const i=ik(n,e);for(const u of i){const f=u.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:f})}const s=nk(n,e);let o=0;for(const u of s)if(KD(u.type)){const{viewDimension:f,sampleType:d}=ZD(u.type);t.bindings.push({type:"texture",name:u.name,group:0,location:o,viewDimension:f,sampleType:d}),u.textureUnit=o,o+=1}s.length&&(t.uniforms=s);const l=tk(n,e);return l?.length&&(t.varyings=l),t}function ek(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const o=n.getActiveAttrib(e,s);if(!o)throw new Error("activeInfo");const{name:l,type:u}=o,f=n.getAttribLocation(e,l);if(f>=0){const d=Mg(u),p=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:f,stepMode:p,type:d})}}return t.sort((s,o)=>s.location-o.location),t}function tk(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const o=n.getTransformFeedbackVarying(e,s);if(!o)throw new Error("activeInfo");const{name:l,type:u,size:f}=o,d=Mg(u),{type:p,components:_}=Kx(d);t.push({location:s,name:l,type:p,size:f*_})}return t.sort((s,o)=>s.location-o.location),t}function nk(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const o=n.getActiveUniform(e,s);if(!o)throw new Error("activeInfo");const{name:l,size:u,type:f}=o,{name:d,isArray:p}=sk(l);let _=n.getUniformLocation(e,d);const y={location:_,name:d,size:u,type:f,isArray:p};if(t.push(y),y.size>1)for(let v=0;v<y.size;v++){const T=`${d}[${v}]`;_=n.getUniformLocation(e,T);const A={...y,name:T,location:_};t.push(A)}}return t}function ik(n,e){const t=(o,l)=>n.getActiveUniformBlockParameter(e,o,l),i=[],s=n.getProgramParameter(e,35382);for(let o=0;o<s;o++){const l={name:n.getActiveUniformBlockName(e,o)||"",location:t(o,35391),byteLength:t(o,35392),vertex:t(o,35396),fragment:t(o,35398),uniformCount:t(o,35394),uniforms:[]},u=t(o,35395)||[],f=n.getActiveUniforms(e,u,35383),d=n.getActiveUniforms(e,u,35384),p=n.getActiveUniforms(e,u,35387),_=n.getActiveUniforms(e,u,35388);for(let y=0;y<l.uniformCount;++y){const v=n.getActiveUniform(e,u[y]);if(!v)throw new Error("activeInfo");const T=Mg(f[y]);l.uniforms.push({name:v.name,format:T,type:f[y],arrayLength:d[y],byteOffset:p[y],byteStride:_[y]})}i.push(l)}return i.sort((o,l)=>o.location-l.location),i}function sk(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function rk(n,e,t,i){const s=n;let o=i;o===!0&&(o=1),o===!1&&(o=0);const l=typeof o=="number"?[o]:o;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function ok(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function ak(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const rT=4;class lk extends Ls{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:s=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),ie.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=JD(this.device.gl,this.handle),ie.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?ck(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[i,s]of Object.entries(e)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");t?.disableWarnings||ie.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||ie.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Ma)&&!(s.buffer instanceof Ma))throw new Error("buffer value");break;case"texture":if(!(s instanceof Xr||s instanceof Oa||s instanceof Ra))throw new Error(`${this} Bad texture binding for ${i}`);break;case"sampler":ie.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:u,isInstanced:f=!1,firstVertex:d=0,transformFeedback:p}=e,_=ok(s),y=!!o.indexBuffer,v=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return ie.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ie.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(t),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const T=t;return FD(this.device,i,T.glParameters,()=>{y&&f?this.device.gl.drawElementsInstanced(_,l||0,v,d,u||0):y?this.device.gl.drawElements(_,l||0,v,d):f?this.device.gl.drawArraysInstanced(_,d,l||0,u||0):this.device.gl.drawArrays(_,d,l||0),p&&p.end()}),o.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),ie.time(rT,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),ie.timeEnd(rT,`linkProgram for ${this.id}`)(),ie.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}ie.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ie.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(ie.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=e.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);e.uniformBlockBinding(this.handle,i,u),o instanceof Ma?e.bindBufferBase(35345,i,o.handle):e.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Xr||o instanceof Oa||o instanceof Ra))throw new Error("texture");let f;if(o instanceof Xr)f=o.texture;else if(o instanceof Oa)f=o;else if(o instanceof Ra&&o.colorAttachments[0]instanceof Xr)ie.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=o.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(f.glTarget,f.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:s,textureUnit:o}=e,l=this.uniforms[t]??o;l!==void 0&&rk(this.device.gl,i,s,l)}}}function ck(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const s=t.attributes.find(o=>o.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):ie.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class uk extends Gp{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":fk(this.device,t.options);break;case"copy-buffer-to-texture":hk(this.device,t.options);break;case"copy-texture-to-buffer":dk(this.device,t.options);break;case"copy-texture-to-texture":pk(this.device,t.options);break;default:throw new Error(t.name)}}}function fk(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function hk(n,e){throw new Error("Not implemented")}function dk(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:o=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:f=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||u!==0||_||y)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:T}=m2(t);let A;try{const R=d,M=o||v.width,H=l||v.height,O=d2(v.colorAttachments[0].texture.props.format),L=O.format,X=O.type;n.gl.bindBuffer(35051,R.handle),A=n.gl.bindFramebuffer(36160,v.handle),n.gl.readPixels(f[0],f[1],M,H,L,X,p)}finally{n.gl.bindBuffer(35051,null),A!==void 0&&n.gl.bindFramebuffer(36160,A),T&&v.destroy()}}function pk(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:o=[0,0],destinationTexture:l}=e;let{width:u=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=m2(t),[_,y]=s,[v,T,A]=o,R=n.gl.bindFramebuffer(36160,d.handle);let M,H;if(l instanceof Oa)M=l,u=Number.isFinite(u)?u:M.width,f=Number.isFinite(f)?f:M.height,M._bind(0),H=M.glTarget;else throw new Error("invalid destination");switch(H){case 3553:case 34067:n.gl.copyTexSubImage2D(H,i,v,T,_,y,u,f);break;case 35866:case 32879:n.gl.copyTexSubImage3D(H,i,v,T,A,_,y,u,f);break}M&&M._unbind(),n.gl.bindFramebuffer(36160,R),p&&d.destroy()}function m2(n){if(n instanceof xt){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}const gk=[1,2,4,8];class mk extends Ps{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:o,height:l}=t.framebuffer;i=[0,0,o,l]}else{const[o,l]=e.getDefaultCanvasContext().getDrawingBufferSize();i=[0,0,o,l]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&s?.handle){const o=this.props.framebuffer.colorAttachments.map((l,u)=>36064+u);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=gk.map(i=>!!(i&e.colorMask))),this.glParameters=t,fo(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&La(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){La(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class oT extends Zp{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new uk(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new mk(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function _k(n){const{target:e,source:t,start:i=0,count:s=1}=n,o=t.length,l=s*o;let u=0;for(let f=i;u<o;u++)e[f++]=t[u];for(;u<l;)u<l-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+l-u),u=l);return n.target}class Og extends Qp{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return BA()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:u,normalized:f,integer:d,divisor:p}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),d?this.device.gl.vertexAttribIPointer(e,s,o,l,u):this.device.gl.vertexAttribPointer(e,s,o,f,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,p||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=h2(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const s=Og.isConstantAttributeZeroSupported(this.device)||e!==0;(t||s)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=yk(t),s=i.byteLength*e,o=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l||=!bk(i,this.bufferValue),l){const u=kR(t.constructor,o);_k({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=t}return this.buffer}}function yk(n){return Array.isArray(n)?new Float32Array(n):n}function bk(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class vk extends Jp{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(ak(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=s,ie.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(e){if(aT(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Ma)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:s}}_getVaryingIndex(e){if(aT(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,s){const o=t&&t.handle;!o||s===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,i,s)}}function aT(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class Tk extends eg{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const i=this.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");this.handle=i,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function _2(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function xk(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Sk(n){return Ak[n]}const Ak={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function wk(n,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:o=null,sourceWidth:l,sourceHeight:u,sourceDepth:f,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:y}=y2(n),{gl:v,handle:T}=_;l||=_.width,u||=_.height;const A=_.colorAttachments[s]?.texture;if(!A)throw new Error(`Invalid framebuffer attachment ${s}`);f=A?.depth||1,d||=A?.glFormat||6408,p||=A?.glType||5121,o=Rk(o,p,d,l,u);const R=Xp(o);p=p||YD(R);const M=v.bindFramebuffer(36160,T);return v.readBuffer(36064+s),v.readPixels(t,i,l,u,d,p,o),v.readBuffer(36064),v.bindFramebuffer(36160,M||null),y&&_.destroy(),o}function Ek(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:o=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:u,sourceHeight:f,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:_}=y2(n);u=u||p.width,f=f||p.height;const y=p;d=d||5121;let v=t;if(!v){const A=_2(o),R=xk(d),M=l+u*f*A*R;v=y.device.createBuffer({byteLength:M})}const T=n.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:n,width:u,height:f,origin:[i,s],destinationBuffer:v,byteOffset:l}),T.destroy(),_&&p.destroy(),v}function y2(n){return n instanceof Au?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:Ck(n),deleteFramebuffer:!0}}function Ck(n,e){const{device:t,width:i,height:s,id:o}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:i,height:s,colorAttachments:[n]})}function Rk(n,e,t,i,s,o){if(n)return n;e||=5121;const l=Sk(e),u=qp(l),f=_2(t);return new u(i*s*f)}class xp extends Hs{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return e!=="unorm8x4-bgra"}constructor(e){super({...e,id:e.id||DD("webgl-device")});const t=Hs._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new ND(this,t),this.lost=new Promise(p=>{this._resolveContextLost=p});const s={...e.webgl};t.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),e.powerPreference!==void 0&&(s.powerPreference=e.powerPreference);const l=this.props._handle||dD(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(e._reuseDevices)return ie.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=KN({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=pD(this.gl,this._extensions),this.limits=new OD(this.gl),this.features=new MD(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new zs(this.gl,{log:(...p)=>ie.log(1,...p)()}).trackState(this.gl,{copyState:!1});const f=e.debugWebGL||e.debug,d=e.debugWebGL;f&&(this.gl=QN(this.gl,{debugWebGL:f,traceWebGL:d}),ie.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(ie.level=Math.max(ie.level,1))),this.commandEncoder=new oT(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Ma(this,t)}createTexture(e){return new Oa(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new $D(this,e)}createShader(e){return new UD(this,e)}createFramebuffer(e){return new Ra(this,e)}createVertexArray(e){return new Og(this,e)}createTransformFeedback(e){return new vk(this,e)}createQuerySet(e){return new Tk(this,e)}createRenderPipeline(e){return new lk(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new oT(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return wk(e,t)}readPixelsToBufferWebGL(e,t){return Ek(e,t)}setParametersWebGL(e){fo(this.gl,e)}getParametersWebGL(e){return u2(this.gl,e)}withParametersWebGL(e,t){return La(this.gl,e,t)}resetWebGL(){ie.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),lD(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return wD(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){zs.get(this.gl).push()}popState(){zs.get(this.gl).pop()}getGLKey(e,t){const i=Number(e);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,t)}`]=`${o}:${this.getGLKey(o,t)}`,i),{})}setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[e];switch(s&&Pk(s,t)&&ie.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Mk(this,e,t);break;case Int32Array:Ok(this,e,t);break;case Uint32Array:Ik(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return oo(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,i){e.luma=t;const s={props:i.spector,id:i.spector.id};e.__SPECTOR_Metadata=s}}function Mk(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function Ok(n,e,t){n.gl.vertexAttribI4iv(e,t)}function Ik(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function Pk(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const lT=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:xp},Symbol.toStringTag,{value:"Module"}));function Gi(){}const Nk=({isDragging:n})=>n?"grabbing":"grab",b2={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Gi,onWebGLInitialized:Gi,onResize:Gi,onViewStateChange:Gi,onInteractionStateChange:Gi,onBeforeRender:Gi,onAfterRender:Gi,onLoad:Gi,onError:n=>Me.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Nk,getTooltip:null,debug:!1,drawPickingColors:!1};class Ig{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ha({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null,unproject3D:!1},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const o=i.offsetCenter;if(!o)return;s.x=o.x,s.y=o.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=fp[i.type],o=i.offsetCenter;if(!s||!o||!this.layerManager)return;let l;const u=this.layerManager.getLayers(),f=u.some(v=>v.props.pickable==="3d");if(i.type==="click"&&f){const v=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius,unproject3D:!0});l=v.result[0]||v.emptyInfo}else l=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:u,viewports:this.getViewports(o)},this._lastPointerDownInfo);const{layer:d}=l,p=d&&(d[s]||d.props[s]),_=this.props[s];let y=!1;p&&(y=p.call(d,l,i)),y||(_?.(l,i),this.widgetManager.onEvent(l,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const s=i.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...b2,...e},e=this.props,e.viewState&&e.initialViewState&&Me.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;if(!t&&e.gl){e.gl instanceof WebGLRenderingContext&&Me.error("WebGL1 context not supported.")();const i=this.props.deviceProps?.onResize;t=Pd.attach(e.gl,{_cacheShaders:!0,_cachePipelines:!0,...this.props.deviceProps,onResize:(s,o)=>{const{width:l,height:u}=s.canvas;s.drawingBufferWidth=l,s.drawingBufferHeight=u,this._needsRedraw="Canvas resized",i?.(s,o)}})}t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&no.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Me.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Me.removed("onLayerClick","onClick")(),e.initialViewState&&!xn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Me.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.setProps&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||i||s||o||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Et(this.viewManager),this.viewManager.views}getView(e){return Et(this.viewManager),this.viewManager.getView(e)}getViewports(e){return Et(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){Et(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Et(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s}=t;return new vg({device:e,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,i=typeof t=="object"?t:void 0,s={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};s.adapters.includes(Pd)||s.adapters.push(Pd);const o={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},l=this.props.deviceProps?.onResize;return ep.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...o,...i,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(u,f)=>{this._needsRedraw="Canvas resized",l?.(u,f)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new o2({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const i=(this.layerManager?.getLayers()||[]).some(f=>f.props.pickable==="3d");e.unproject3D=i;const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let l=o,u=!1;for(const f of s)l=f,u=f.layer?.onHover(f,e.event)||u;u||(this.props.onHover?.(l,e.event),this.widgetManager.onHover(l,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new t2;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new lP(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(yv).map(s=>{const[o,l,u,f]=yv[s],d=this.props.eventRecognizerOptions?.[s],p={...l,...d,event:s};return{recognizer:new o(p),recognizeWith:u,requestFailure:f}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in fp)this.eventManager.on(s,this._onEvent);this.viewManager=new aN({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new oN(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new CN({deck:this,device:this.device}),this.deckRenderer=new ON(this.device),this.deckPicker=new NN(this.device),this.widgetManager=new BN({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new a2),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Me.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=ep.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Ig.defaultProps=b2;Ig.VERSION=fC;function Dk(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return qp(n)}}const kk=Xp;function Rc(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function ks(n){return n.stride||n.size*n.bytesPerElement}function Bk(n,e){return n.type===e.type&&n.size===e.size&&ks(n)===ks(e)&&(n.offset||0)===(e.offset||0)}function Sp(n,e){e.offset&&Me.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=ks(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,o=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:o,stride:t}}function Lk(n,e){const t=Sp(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class Uk{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,o=s==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let u;o?u="float32":!s&&t.isIndexed?u="uint32":u=s||"float32";let f=Dk(s||u);this.doublePrecision=o,o&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:l,logicalType:s,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*ks(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),no.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const o=Sp(this.getAccessor(),t),l=o.offset/s.BYTES_PER_ELEMENT,u=o.size||this.size;i[e]=s.subarray(l,l+u)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],o={name:this.id,byteStride:ks(i),attributes:s};if(this.doublePrecision){const l=Lk(i,t||{});s.push(Rc(e,{...i,...l.high},this.device.type),Rc(`${e}64Low`,{...i,...l.low},this.device.type))}else if(t){const l=Sp(i,t);s.push(Rc(e,{...i,...l},this.device.type))}else s.push(Rc(e,i,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,o=i*s;if(t&&o&&t.length>=o){const l=new Array(s).fill(1/0),u=new Array(s).fill(-1/0);for(let f=0;f<o;)for(let d=0;d<s;d++){const p=t[f++];p<l[d]&&(l[d]=p),p>u[d]&&(u[d]=p)}e=[l,u]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof et?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=kk(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=ks(s)}if(t.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(i.buffer){const o=i.buffer;t.externalBuffer=o,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let o=i.value;t.externalBuffer=null,t.constant=!1,this.value=o;let{buffer:l}=this;const u=ks(s),f=(s.vertexOffset||0)*u;if(this.doublePrecision&&o instanceof Float64Array&&(o=wd(o,s)),this.settings.isIndexed){const p=this.settings.defaultType;o.constructor!==p&&(o=new p(o))}const d=o.byteLength+f+u*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(o,f)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?wd(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,o=no.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{byteOffset:l}=this;let{buffer:u}=this;return(!u||u.byteLength<o.byteLength+l)&&(u=this._createBuffer(o.byteLength+l),t&&s&&u.write(s instanceof Float64Array?wd(s,this):s,l)),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Me.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:o}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let l=o;for(;--l>=0;)t[i+l]=s[l];return t}switch(o){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let l=o;for(;--l>=0;)t[i+l]=Number.isFinite(e[l])?e[l]:s[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?et.INDEX:et.VERTEX)|et.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const cT=[],uT=[];function Ru(n,e=0,t=1/0){let i=cT;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(uT.length=n.length,i=uT):i=cT,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function v2(n){return n&&n[Symbol.asyncIterator]}function T2(n,e){const{size:t,stride:i,offset:s,startIndices:o,nested:l}=e,u=n.BYTES_PER_ELEMENT,f=i?i/u:t,d=s?s/u:0,p=Math.floor((n.length-d)/f);return(_,{index:y,target:v})=>{if(!o){const M=y*f+d;for(let H=0;H<t;H++)v[H]=n[M+H];return v}const T=o[y],A=o[y+1]||p;let R;if(l){R=new Array(A-T);for(let M=T;M<A;M++){const H=M*f+d;v=new Array(t);for(let O=0;O<t;O++)v[O]=n[H+O];R[M-T]=v}}else if(f===t)R=n.subarray(T*t+d,A*t+d);else{R=new n.constructor((A-T)*t);let M=0;for(let H=T;H<A;H++){const O=H*f+d;for(let L=0;L<t;L++)R[M++]=n[O+L]}}return R}}const Fk=[],qc=[[0,1/0]];function zk(n,e){if(n===qc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let o=0;o<i;o++){const l=n[o];l[1]<e[0]?(t.push(l),s=o+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(s,0,e),t}const Vk={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function x2(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...Vk[t],...e,...n,type:t}}class S2 extends Uk{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:qc}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!Bk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return x2(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=zk(this.state.updateRanges,[i,s])}else this.state.updateRanges=qc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Fk}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==qc),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:l,noAlloc:u}}=this;let f=!0;if(l){for(const[d,p]of o)l.call(s,this,{data:t,startRow:d,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of o){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e,t){const i=this.device.type==="webgpu";if(i||t===void 0||typeof t=="function"){if(i&&typeof t!="function"){const l=this._normalizeValue(t,[],0);this._areValuesEqual(l,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Et(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const u=!!l.size&&l.size!==this.size;return i.binaryAccessor=T2(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const o in t){const l=super._getBufferLayout(o,t[o]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:o,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:u,state:f,value:d,size:p,startIndices:_}=e,{accessor:y,transform:v}=u;let T=f.binaryAccessor||(typeof y=="function"?y:o[y]);typeof T!="function"&&typeof y=="string"&&(T=()=>o[y]),Et(typeof T=="function",`accessor "${y}" is not a function`);let A=e.getVertexOffset(i);const{iterable:R,objectInfo:M}=Ru(t,i,s);for(const H of R){M.index++;let O=T(H,M);if(v&&(O=v.call(this,O)),_){const L=(M.index<_.length-1?_[M.index+1]:l)-_[M.index];if(O&&Array.isArray(O[0])){let X=A;for(const Y of O)e._normalizeValue(Y,d,X),X+=p}else O&&O.length>p?d.set(O,A):(e._normalizeValue(O,M.target,0),tN({target:d,source:M.target,start:A,count:L}));A+=L*p}else e._normalizeValue(O,d,A),A+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Ld(n){const{source:e,target:t,start:i=0,size:s,getData:o}=n,l=n.end||t.length,u=e.length,f=l-i;if(u>f){t.set(e.subarray(0,f),i);return}if(t.set(e,i),!o)return;let d=u;for(;d<f;){const p=o(d,e);for(let _=0;_<s;_++)t[i+d]=p[_]||0,d++}}function Hk({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:o}){if(!s||!o)return Ld({source:n,target:e,size:t,getData:i}),e;let l=0,u=0;const f=i&&((p,_)=>i(p+u,_)),d=Math.min(s.length,o.length);for(let p=1;p<d;p++){const _=s[p]*t,y=o[p]*t;Ld({source:n.subarray(l,_),target:e,start:u,end:y,size:t,getData:f}),l=_,u=y}return u<e.length&&Ld({source:[],target:e,start:u,size:t,getData:f}),e}function jk(n){const{device:e,settings:t,value:i}=n,s=new S2(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function A2(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function w2(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function E2(n){n.push(n.shift())}function Wk(n,e){const{doublePrecision:t,settings:i,value:s,size:o}=n,l=t&&s instanceof Float64Array?2:1;let u=0;const{shaderAttributes:f}=n.settings;if(f)for(const d of Object.values(f))u=Math.max(u,d.vertexOffset??0);return(i.noAlloc?s.length:(e+u)*o)*l}function C2({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function R2({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:o,getData:l=u=>u}){const u=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*u,d=t.byteOffset,p=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,_=t.startIndices,y=o&&_,v=t.isConstant;if(!y&&e&&i>=s)return e;const T=t.value instanceof Float64Array?Float32Array:t.value.constructor,A=v?t.value:new T(t.getBuffer().readSyncWebGL(d,s*T.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!v){const O=l;l=(L,X)=>t.normalizeConstant(O(L,X))}const R=v?(O,L)=>l(A,L):(O,L)=>l(A.subarray(O+d,O+d+f),L),M=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),H=new Float32Array(s);return Hk({source:M,target:H,sourceStartIndices:o,targetStartIndices:_,size:f,getData:R}),(!e||e.byteLength<H.byteLength+p)&&(e?.destroy(),e=n.createBuffer({byteLength:H.byteLength+p,usage:35050})),e.write(H,p),e}class M2{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Cu(i),this.attribute=t,this.attributeInTransition=jk(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Wk(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class $k extends M2{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=Kk(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:l}=this;E2(o),o[0]=R2({device:this.device,buffer:o[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),o[1]=C2({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:u}=this,f=u.model;let d=Math.floor(this.currentLength/l.size);O2(l)&&(d/=2),f.setVertexCount(d),l.isConstant?(f.setAttributes({aFrom:o[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:o[0],aTo:l.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:o}=this.transform,l={time:s};o.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Xk=`uniform interpolationUniforms {
  float time;
} interpolation;
`,fT={name:"interpolation",vs:Xk,uniformTypes:{time:"f32"}},qk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Yk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function O2(n){return n.doublePrecision&&n.value instanceof Float64Array}function Kk(n,e){const t=e.size,i=A2(t),s=w2(t),o=e.getBufferLayout();return O2(e)?new io(n,{vs:Yk,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[KO,fT],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new io(n,{vs:qk,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:o.attributes[0].format}],modules:[fT],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class Zk extends M2{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=n6(e),this.framebuffer=i6(e,this.texture),this.transform=t6(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:o,attribute:l}=this;for(let f=0;f<2;f++)o[f]=R2({device:this.device,buffer:o[f],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});o[2]=C2({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?u.setConstantAttributes({aTo:l.value}):u.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,o=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:o.stiffness,damping:o.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),E2(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Gk=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Qk={name:"spring",vs:Gk,uniformTypes:{damping:"f32",stiffness:"f32"}},Jk=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,e6=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function t6(n,e){const t=A2(e.size),i=w2(e.size);return new io(n,{vs:Jk,fs:e6,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Qk],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function n6(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function i6(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const s6={interpolation:$k,spring:Zk};class r6{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const o=e[s],l=o.getTransitionSetting(t);l&&this._updateAttribute(s,o,l)}for(const s in this.transitions){const o=e[s];(!o||!o.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let o=!s||s.type!==i.type;if(o){s&&this._removeTransition(e);const l=s6[i.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(Me.error(`unsupported transition type '${i.type}'`)(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const hT="attributeManager.invalidate",o6="attributeManager.updateStart",a6="attributeManager.updateEnd",l6="attribute.updateStart",c6="attribute.allocate",u6="attribute.updateEnd";class Pg{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=$a(b4),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new r6(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);Ut(hT,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Ut(hT,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:o={},buffers:l={},context:u={}}){let f=!1;Ut(o6,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],_=p.settings.accessor;p.startIndices=i,p.numInstances=t,o[d]&&Me.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&p.setConstantValue(u,o[_])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:o,context:u})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}f&&Ut(a6,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const o in t){const l=t[o];l.needsRedraw(e)&&!i.hasAttribute(o)&&(s[o]=l)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],o={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new S2(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,o=s[e];return o&&o.forEach(l=>{const u=i[l];u&&u.setNeedsUpdate(u.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(Ut(l6,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(i)&&Ut(c6,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Ut(u6,t,i))}}class f6 extends Cu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:o}}=this,l=o(e/s);this._value=Us(t,i,l)}}const dT=1e-5;function pT(n,e,t,i,s){const o=e-n,u=(t-e)*s,f=-o*i;return u+f+o+e}function h6(n,e,t,i,s){if(Array.isArray(t)){const o=[];for(let l=0;l<t.length;l++)o[l]=pT(n[l],e[l],t[l],i,s);return o}return pT(n,e,t,i,s)}function gT(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class d6 extends Cu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:o=e,_currValue:l=e}=this;let u=h6(o,l,t,i,s);const f=gT(u,t),d=gT(u,l);f<dT&&d<dT&&(u=t,this.end()),this._prevValue=l,this._currValue=u}}const p6={interpolation:f6,spring:d6};class g6{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:o}=this;if(o.has(e)){const f=o.get(e),{value:d=f.settings.fromValue}=f;t=d,this.remove(e)}if(s=x2(s),!s)return;const l=p6[s.type];if(!l){Me.error(`unsupported transition type '${s.type}'`)();return}const u=new l(this.timeline);u.start({...s,fromValue:t,toValue:i}),o.set(e,u)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function m6(n){const e=n[as];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function _6(n,e){const t=Ng({newProps:n,oldProps:e,propTypes:n[as],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=b6(n,e);let s=!1;return i||(s=v6(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:T6(n,e),transitionsChanged:y6(n,e)}}function y6(n,e){if(!n.transitions)return!1;const t={},i=n[as];let s=!1;for(const o in n.transitions){const l=i[o],u=l&&l.type;(u==="number"||u==="color"||u==="array")&&Ap(n[o],e[o],l)&&(t[o]=!0,s=!0)}return s?t:!1}function Ng({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const o of Object.keys(n))if(!(o in t)){if(!(o in e))return`${s}.${o} added`;const l=Ap(n[o],e[o],i[o]);if(l)return`${s}.${o} ${l}`}for(const o of Object.keys(e))if(!(o in t)){if(!(o in n))return`${s}.${o} dropped`;if(!Object.hasOwnProperty.call(n,o)){const l=Ap(n[o],e[o],i[o]);if(l)return`${s}.${o} ${l}`}}return!1}function Ap(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function b6(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function v6(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&mT(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&mT(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function T6(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function mT(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},Ng({oldProps:s,newProps:i,triggerName:t})}const x6="count(): argument not an object",S6="count(): argument not a container";function A6(n){if(!E6(n))throw new Error(x6);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(w6(n))return Object.keys(n).length;throw new Error(S6)}function w6(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function E6(n){return n!==null&&typeof n=="object"}function _T(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const C6={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},wp={};function R6(n,e,t,i){if(t instanceof xt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:o,height:l}=t.data,u=e.createTexture({...t,sampler:{...C6,...s,...i},mipLevels:e.getMipLevelCount(o,l)});return u.generateMipmapsWebGL(),wp[u.id]=n,u}function M6(n,e){!e||!(e instanceof xt)||wp[e.id]===n&&(e.delete(),delete wp[e.id])}const O6={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Ep(n)&&(n.length===3||n.length===4)},equal(n,e,t){return xn(n,e,1)}},accessor:{validate(n,e){const t=mu(n);return t==="function"||t===mu(e.value)},equal(n,e,t){return typeof e=="function"?!0:xn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Ep(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?xn(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?xn(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:R6(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{M6(t.id,n)}}};function I6(n){const e={},t={},i={};for(const[s,o]of Object.entries(n)){const l=o?.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const u=P6(s,o);e[s]=u,t[s]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function P6(n,e){switch(mu(e)){case"object":return ha(n,e);case"array":return ha(n,{type:"array",value:e,compare:!1});case"boolean":return ha(n,{type:"boolean",value:e});case"number":return ha(n,{type:"number",value:e});case"function":return ha(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function ha(n,e){return"type"in e?{name:n,...O6[e.type],...e}:"value"in e?{name:n,type:mu(e.value),...e}:{name:n,type:"object",value:e}}function Ep(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function mu(n){return Ep(n)?"array":n===null?"null":typeof n}function N6(n,e){let t;for(let o=e.length-1;o>=0;o--){const l=e[o];"extensions"in l&&(t=l.extensions)}const i=Cp(n.constructor,t),s=Object.create(i);s[gu]=n,s[qs]={},s[ss]={};for(let o=0;o<e.length;++o){const l=e[o];for(const u in l)s[u]=l[u]}return Object.freeze(s),s}const D6="_mergedDefaultProps";function Cp(n,e){if(!(n instanceof Mu.constructor))return{};let t=D6;if(e)for(const s of e){const o=s.constructor;o&&(t+=`:${o.extensionName||o.name}`)}const i=I2(n,t);return i||(n[t]=k6(n,e||[]))}function k6(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Cp(i),o=I2(n,"defaultProps")||{},l=I6(o),u=Object.assign(Object.create(null),s,l.defaultProps),f=Object.assign(Object.create(null),s?.[as],l.propTypes),d=Object.assign(Object.create(null),s?.[Od],l.deprecatedProps);for(const p of e){const _=Cp(p.constructor);_&&(Object.assign(u,_),Object.assign(f,_[as]),Object.assign(d,_[Od]))}return B6(u,n),U6(u,f),L6(u,d),u[as]=f,u[Od]=d,e.length===0&&!Dg(n,"_propTypes")&&(n._propTypes=f),u}function B6(n,e){const t=z6(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function L6(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const o of e[t])Dg(this,o)||(this[o]=i);Me.deprecated(s,e[t].join("/"))()}})}function U6(n,e){const t={},i={};for(const s in e){const o=e[s],{name:l,value:u}=o;o.async&&(t[l]=u,i[l]=F6(l))}n[Gr]=t,n[qs]={},Object.defineProperties(n,i)}function F6(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||v2(e)?this[qs][n]=e:this[ss][n]=e},get(){if(this[ss]){if(n in this[ss])return this[ss][n]||this[Gr][n];if(n in this[qs]){const e=this[gu]&&this[gu].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Gr][n]}}return this[Gr][n]}}}function Dg(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function I2(n,e){return Dg(n,e)&&n[e]}function z6(n){const e=n.componentName;return e||Me.warn(`${n.name}.componentName not specified`)(),e||n.name}let V6=0;class Mu{constructor(...e){this.props=N6(this,e),this.id=this.props.id,this.count=V6++}clone(e){const{props:t}=this,i={};for(const s in t[Gr])s in t[ss]?i[s]=t[ss][s]:s in t[qs]&&(i[s]=t[qs][s]);return new this.constructor({...t,...i,...e})}}Mu.componentName="Component";Mu.defaultProps={};const H6=Object.freeze({});class j6{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||H6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[gu]||this.component;const t=e[ss]||{},i=e[qs]||e,s=e[Gr]||{};for(const o in t){const l=t[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,l),t[o]=this.getAsyncProp(o)}for(const o in i){const l=i[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(v2(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,s),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let o=[],l=0;for await(const u of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?o=f(u,o):o=o.concat(u),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:l,endRow:o.length}]}),l=o.length,this._setAsyncPropValue(e,o,s)}this._onResolve(e,o)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[as];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class W6 extends j6{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i?.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const $6="layer.changeFlag",X6="layer.initialize",q6="layer.update",Y6="layer.finalize",K6="layer.matched",yT=2**24-1,Z6=Object.freeze([]),G6=$a(({oldViewport:n,viewport:e})=>n.equals(e));let On=new Uint8ClampedArray(0);const Q6={data:{type:"data",value:Z6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:o})=>{const{resourceManager:l}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,o&&(s={...s,fetch:{...s?.fetch,signal:o}});let u=l.contains(n);return!u&&!s&&(l.add({resourceId:n,data:tu(n,i),persistent:!1}),u=!0),u?l.subscribe({resourceId:n,onChange:f=>t.internalState?.reloadAsyncProp(e,f),consumerId:t.id,requestId:e}):tu(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Re.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Bn extends Mu{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Fr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Et(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=e2(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,o,l]=Z3(i,t.pixelProjectionMatrix);return e.length===2?[s,o]:[s,o,l]}unproject(e){return Et(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Et(this.internalState);const i=this.internalState.viewport||this.context.viewport;return w4(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Re.DEFAULT||e===Re.LNGLAT||e===Re.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Et(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:A6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=_T(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=_T(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,o=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||!!s.pickable||s.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(o!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:u,instancePickingColors:f}=t.attributes,d=u||f;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!G6({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(On.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>yT&&Me.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),On=no.allocate(On,t,{size:4,copy:!0,maxCount:Math.max(t,yT)});const s=Math.floor(On.length/4),o=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,o),On[l*4+0]=o[0],On[l*4+1]=o[1],On[l*4+2]=o[2],On[l*4+3]=0}e.value=On.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const s=e.userData?.excludeAttributes||{},o={},l={};for(const u in t){if(s[u])continue;const f=t[u].getValue();for(const d in f){const p=f[d];p instanceof et?t[u].settings.isIndexed?e.setIndexBuffer(p):o[d]=p:p&&(l[d]=p)}}e.setAttributes(o),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,o=i||s,l=o&&t.attributes&&t.attributes[o.id];if(l&&l.value){const u=l.value,f=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=o.getVertexOffset(d);u[p]===f[0]&&u[p+1]===f[1]&&u[p+2]===f[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const o=s.getVertexOffset(e),l=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(l-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==On.buffer&&(i.value=On.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Et(!this.internalState),Et(Number.isFinite(this.props.coordinateSystem)),Ut(X6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new W6({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Me.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new g6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ut(K6,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ut(q6,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,o=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||o,this.props=l;try{const u=this._getUpdateParams(),f=this.getModels();if(i.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const p of this.props.extensions)p.updateState.call(this,u,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==f[0];this._postUpdate(u,d)}finally{i.viewport=o,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Ut(Y6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:u}=this.props,f=u&&u(i)||[0,0];l.device instanceof xp&&l.device.setParametersWebGL({polygonOffset:f});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof xp)l.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let o=!1;switch(s){case"dataChanged":const l=e[s],u=t[s];l&&Array.isArray(u)&&(t.dataChanged=Array.isArray(l)?u.concat(l):l,o=!0);default:t[s]||(t[s]=e[s],o=!0)}o&&Ut($6,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=_6(e,t);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],e.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){m6(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Pg(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:u,highlightColor:f}=i;if(t||s.autoHighlight!==l||s.highlightedObjectIndex!==u||s.highlightColor!==f){const d={};Array.isArray(f)&&(d.highlightColor=f),(t||s.autoHighlight!==l||u!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Bn.defaultProps=Q6;Bn.layerName="Layer";const J6="compositeLayer.renderLayers";class Xa extends Bn{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:s,parameters:o,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:f,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:v,modelMatrix:T,extensions:A,fetch:R,operation:M,_subLayerProps:H}=this.props,O={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:o,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:f,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:v,modelMatrix:T,extensions:A,fetch:R,operation:M},L=H&&e.id&&H[e.id],X=L&&L.updateTriggers,Y=e.id||"sublayer";if(L){const re=this.props[as],le=e.type?e.type._propTypes:{};for(const oe in L){const fe=le[oe]||re[oe];fe&&fe.type==="accessor"&&(L[oe]=this.getSubLayerAccessor(L[oe]))}}Object.assign(O,e,L),O.id=`${this.props.id}-${Y}`,O.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...X};for(const re of A){const le=re.getSubLayerProps.call(this,re);le&&Object.assign(O,le,{updateTriggers:Object.assign(O.updateTriggers,le.updateTriggers)})}return O}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const o=this.renderLayers();i=Eu(o,Boolean),this.internalState.subLayers=i}Ut(J6,this,s,i);for(const o of i)o.parent=this}}Xa.layerName="CompositeLayer";class P2{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=no,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:s,geometryBuffer:o,positionFormat:l,dataChanged:u,normalize:f=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=o&&o.size||(l==="XY"?2:3),this.buffers=i,this.normalize=f,o&&(Et(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),f||(i.vertexPositions=o)),this.geometryBuffer=i.vertexPositions,Array.isArray(u))for(const d of u)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?T2(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:s,_attributeDefs:o,typedArrayManager:l}=this;for(const u in o)if(u in s)l.release(i[u]),i[u]=null;else{const f=o[u];f.copy=t,i[u]=l.allocate(i[u],e,f)}}_forEachGeometry(e,t,i){const{data:s,getGeometry:o}=this,{iterable:l,objectInfo:u}=Ru(s,t,i);for(const f of l){u.index++;const d=o?o(f,u):null;e(d,u.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:s}=this;const{data:o,geometryBuffer:l}=this,{startRow:u=0,endRow:f=1/0}=e||{},d={};if(e||(t=[0],i=[0]),this.normalize||!l)this._forEachGeometry((_,y)=>{const v=_&&this.normalizeGeometry(_);d[y]=v,i[y+1]=i[y]+(v?this.getGeometrySize(v):0)},u,f),s=i[i.length-1];else if(i=o.startIndices,s=i[o.length]||0,ArrayBuffer.isView(l))s=s||l.length/this.positionSize;else if(l instanceof et){const _=this.positionSize*4;s=s||l.byteLength/_}else if(l.buffer){const _=l.stride||this.positionSize*4;s=s||l.buffer.byteLength/_}else if(l.value){const _=l.value,y=l.stride/_.BYTES_PER_ELEMENT||this.positionSize;s=s||_.length/y}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=s;const p={};this._forEachGeometry((_,y)=>{const v=d[y]||_;p.vertexStart=i[y],p.indexStart=t[y];const T=y<i.length-1?i[y+1]:s;p.geometrySize=T-i[y],p.geometryIndex=y,this.updateGeometryAttributes(v,p)},u,f),this.vertexCount=t[t.length-1]}}const eB=typeof window<"u"?st.useLayoutEffect:st.useEffect;function _u(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const tB={position:"absolute",zIndex:-1};function N2(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>N2(t,e));if(Ou(n)){if(nB(n))return e.style=tB,st.cloneElement(n,e);if(iB(n))return st.cloneElement(n,e)}return n}function Ou(n){return n&&typeof n=="object"&&"type"in n||!1}function nB(n){return n.props?.mapStyle}function iB(n){const e=n.type;return e&&e.deckGLViewProps}function Rp(n){if(typeof n=="function")return st.createElement(ro,{},n);if(Array.isArray(n))return n.map(Rp);if(Ou(n)){if(n.type===st.Fragment)return Rp(n.props.children);if(_u(n.type,ro))return n}return n}function sB({children:n,layers:e=[],views:t=null}){const i=[],s=[],o={};return st.Children.forEach(Rp(n),l=>{if(Ou(l)){const u=l.type;if(_u(u,Bn)){const f=rB(u,l.props);s.push(f)}else i.push(l);if(_u(u,ro)&&u!==ro&&l.props.id){const f=new u(l.props);o[f.id]=f}}else l&&i.push(l)}),Object.keys(o).length>0&&(Array.isArray(t)?t.forEach(l=>{o[l.id]=l}):t&&(o[t.id]=t),t=Object.values(o)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function rB(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const oB=st.createContext();function aB({children:n,deck:e,ContextProvider:t=oB.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},o=i.views[0].id;for(const l of n){let u=o,f=l;Ou(l)&&_u(l.type,ro)&&(u=l.props.id||o,f=l.props.children);const d=i.getViewport(u),p=i.getViewState(u);if(d){p.padding=d.padding;const{x:_,y,width:v,height:T}=d;f=N2(f,{x:_,y,width:v,height:T,viewport:d,viewState:p}),s[u]||(s[u]={viewport:d,children:[]}),s[u].children.push(f)}}return Object.keys(s).map(l=>{const{viewport:u,children:f}=s[l],{x:d,y:p,width:_,height:y}=u,v={position:"absolute",left:d,top:p,width:_,height:y},T=`view-${l}`,A=st.createElement("div",{key:T,id:T,style:v},...f),R={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:H=>{H.viewId=l,e._onViewStateChange(H)},widgets:[]},M=`view-${l}-context`;return st.createElement(t,{key:M,value:R},A)})}const lB={mixBlendMode:null};function cB({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const o in t)o in lB?s[o]=t[o]:i[o]=t[o];return{containerStyle:i,canvasStyle:s}}function uB(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function D2(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function fB(n,e,t){const i=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{n.redrawReason=s;const o=i.getViewports();n.lastRenderedViewports!==o?n.forceUpdate():D2(n)}});return i}function hB(n,e){const[t,i]=st.useState(0),o=st.useRef({control:null,version:t,forceUpdate:()=>i(X=>X+1)}).current,l=st.useRef(null),u=st.useRef(null),f=st.useMemo(()=>sB(n),[n.layers,n.views,n.children]);let d=!0;const p=X=>d&&n.viewState?(o.viewStateUpdateRequested=X,null):(o.viewStateUpdateRequested=null,n.onViewStateChange?.(X)),_=X=>{d?o.interactionStateUpdateRequested=X:(o.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(X))},y=st.useMemo(()=>{const X={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:u.current,layers:f.layers,views:f.views,onViewStateChange:p,onInteractionStateChange:_};return delete X._customRender,o.deck&&o.deck.setProps(X),X},[n]);st.useEffect(()=>{const X=n.Deck||Ig;return o.deck=fB(o,X,{...y,parent:l.current,canvas:u.current}),()=>o.deck?.finalize()},[]),eB(()=>{D2(o);const{viewStateUpdateRequested:X,interactionStateUpdateRequested:Y}=o;X&&p(X),Y&&_(Y),o.deck?.isInitialized&&o.deck.redraw("Initial render")}),st.useImperativeHandle(e,()=>uB(o),[]);const v=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:T,width:A="100%",height:R="100%",id:M,style:H}=n,{containerStyle:O,canvasStyle:L}=st.useMemo(()=>cB({width:A,height:R,style:H}),[A,R,H]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===v||o.version!==t){o.lastRenderedViewports=v,o.version=t;const X=aB({children:f.children,deck:o.deck,ContextProvider:T}),Y=st.createElement("canvas",{key:"canvas",id:M||"deckgl-overlay",ref:u,style:L});o.control=st.createElement("div",{id:`${M||"deckgl"}-wrapper`,ref:l,style:O},[Y,X])}return d=!1,o.control}const dB=st.forwardRef(hB),pB=new Uint32Array([0,2,1,0,3,2]),gB=new Float32Array([0,1,0,0,1,0,1,1]);function mB(n,e){if(!e)return _B(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),i=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),s=Math.ceil(t/e)+1,o=Math.ceil(i/e)+1,l=(s-1)*(o-1)*6,u=new Uint32Array(l),f=new Float32Array(s*o*2),d=new Float64Array(s*o*3);let p=0,_=0;for(let y=0;y<s;y++){const v=y/(s-1);for(let T=0;T<o;T++){const A=T/(o-1),R=yB(n,v,A);d[p*3+0]=R[0],d[p*3+1]=R[1],d[p*3+2]=R[2]||0,f[p*2+0]=v,f[p*2+1]=1-A,y>0&&T>0&&(u[_++]=p-o,u[_++]=p-o-1,u[_++]=p-1,u[_++]=p-o,u[_++]=p-1,u[_++]=p),p++}}return{vertexCount:l,positions:d,indices:u,texCoords:f}}function _B(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:pB,texCoords:gB}}function yB(n,e,t){return Us(Us(n[0],n[1],t),Us(n[3],n[2],t),e)}const bT=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,bB={name:"bitmap",vs:bT,fs:bT,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},vB=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,TB=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,xB=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${TB}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,SB={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Re.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class kg extends Bn{getShaders(){return super.getShaders({vs:vB,fs:xB,modules:[fs,lo,bB]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:i}){const s=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==t.bounds){const o=this.state.mesh,l=this._createMesh();this.state.model.setVertexCount(l.vertexCount);for(const u in l)o&&o[u]!==l[u]&&s.invalidate(u);this.setState({mesh:l,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;const{width:s,height:o}=t;i.index=0;const l=AB(i.color);return i.bitmap={size:{width:s,height:o},uv:l,pixel:[Math.floor(l[0]*s),Math.floor(l[1]*o)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return vT(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),mB(t,this.context.viewport.resolution)}_getModel(){return new Zt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:i,coordinateConversion:s,bounds:o,disablePicking:l}=this.state,{image:u,desaturate:f,transparentColor:d,tintColor:p}=this.props;if(!(t.picking.isActive&&l)&&u&&i){const _={bitmapTexture:u,bounds:o,coordinateConversion:s,desaturate:f,tintColor:p.slice(0,3).map(y=>y/255),transparentColor:d.map(y=>y/255)};i.shaderInputs.setProps({bitmap:_}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=Re;let{_imageCoordinateSystem:s}=this.props;if(s!==i){const{bounds:o}=this.props;if(!vT(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const l=this.context.viewport.resolution?e:t;if(s=s===e?e:t,s===e&&l===t)return{coordinateConversion:-1,bounds:o};if(s===t&&l===e){const u=cs([o[0],o[1]]),f=cs([o[2],o[3]]);return{coordinateConversion:1,bounds:[u[0],u[1],f[0],f[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}kg.layerName="BitmapLayer";kg.defaultProps=SB;function AB(n){const[e,t,i]=n,s=(i&240)/256,o=(i&15)/16;return[(e+o)/256,(t+s)/256]}function vT(n){return Number.isFinite(n[0])}const TT=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,wB={name:"icon",vs:TT,fs:TT,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},EB=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,CB=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,RB=1024,MB=4,xT=()=>{},ST={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},OB={x:0,y:0,width:0,height:0};function IB(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function PB(n,e,t,i){const s=Math.min(t/e.width,i/e.height),o=Math.floor(e.width*s),l=Math.floor(e.height*s);return s===1?{image:e,width:o,height:l}:(n.canvas.height=l,n.canvas.width=o,n.clearRect(0,0,o,l),n.drawImage(e,0,0,e.width,e.height,0,0,o,l),{image:n.canvas,width:o,height:l})}function Ua(n){return n&&(n.id||n.url)}function NB(n,e,t,i){const{width:s,height:o,device:l}=n,u=l.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipLevels:l.getMipLevelCount(e,t)}),f=l.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:n,destinationTexture:u,width:s,height:o}),f.finish(),u.generateMipmapsWebGL(),n.destroy(),u}function AT(n,e,t){for(let i=0;i<e.length;i++){const{icon:s,xOffset:o}=e[i],l=Ua(s);n[l]={...s,x:o,y:t}}}function DB({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:s=0,rowHeight:o=0,canvasWidth:l}){let u=[];for(let f=0;f<n.length;f++){const d=n[f],p=Ua(d);if(!t[p]){const{height:_,width:y}=d;i+y+e>l&&(AT(t,u,s),i=0,s=o+s+e,o=0,u=[]),u.push({icon:d,xOffset:i}),i=i+y+e,o=Math.max(o,_)}}return u.length>0&&AT(t,u,s),{mapping:t,rowHeight:o,xOffset:i,yOffset:s,canvasWidth:l,canvasHeight:IB(o+s+e)}}function kB(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:s,objectInfo:o}=Ru(n);for(const l of s){o.index++;const u=e(l,o),f=Ua(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");!i[f]&&(!t[f]||u.url!==t[f].url)&&(i[f]={...u,source:l,sourceIndex:o.index})}return i}class BB{constructor(e,{onUpdate:t=xT,onError:i=xT}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=MB,this._canvasWidth=RB,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Ua(e):e;return this._mapping[t]||OB}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:s,textureParameters:o}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(kB(e,t,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:o,yOffset:l,rowHeight:u,canvasHeight:f}=DB({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=u,this._mapping=s,this._xOffset=o,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||ST,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=NB(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||ST)),this.onUpdate(!0),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,tu(i.url,this._loadOptions).then(s=>{const o=Ua(i),l=this._mapping[o],{x:u,y:f,width:d,height:p}=l,{image:_,width:y,height:v}=PB(t,s,d,p),T=u+(d-y)/2,A=f+(p-v)/2;this._texture?.copyExternalImage({image:_,x:T,y:A,width:y,height:v}),l.x=T,l.y=A,l.width=y,l.height=v,this._texture?.generateMipmapsWebGL(),this.onUpdate(y!==d||v!==p)}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const k2=[0,0,0,255],LB={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:k2},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Iu extends Bn{getShaders(){return super.getShaders({vs:EB,fs:CB,modules:[fs,lo,wB]})}initializeState(){this.state={iconManager:new BB(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:k2},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,o=this.getAttributeManager(),{iconAtlas:l,iconMapping:u,data:f,getIcon:d,textureParameters:p}=t,{iconManager:_}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?u:null,textureParameters:p}),y?i.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&_.packIcons(f,d),s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeBasis:i,sizeMinPixels:s,sizeMaxPixels:o,sizeUnits:l,billboard:u,alphaCutoff:f}=this.props,{iconManager:d}=this.state,p=d.getTexture();if(p){const _=this.state.model,y={iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Ti[l],sizeScale:t,sizeBasis:i==="height"?1:0,sizeMinPixels:s,sizeMaxPixels:o,billboard:u,alphaCutoff:f};_.shaderInputs.setProps({icon:y}),_.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Zt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new so({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(e){e?(this.getAttributeManager()?.invalidate("getIcon"),this.setNeedsUpdate()):this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):Me.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:s=t/2,anchorY:o=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,i/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:s,height:o}=this.state.iconManager.getIconMapping(e);return[t,i,s,o]}}Iu.defaultProps=LB;Iu.layerName="IconLayer";const wT=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,UB={name:"scatterplot",vs:wT,fs:wT,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},FB=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,zB=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,VB=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,ET=[0,0,0,255],HB={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:ET},getLineColor:{type:"accessor",value:ET},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Bg extends Bn{getShaders(){return super.getShaders({vs:FB,fs:zB,source:VB,modules:[fs,fI,lo,UB]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,stroked:l,filled:u,billboard:f,antialiasing:d,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:v}=this.props,T={stroked:l,filled:u,billboard:f,antialiasing:d,radiusUnits:Ti[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,lineWidthUnits:Ti[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:v},A=this.state.model;A.shaderInputs.setProps({scatterplot:T}),this.context.device.type==="webgpu"&&(A.instanceCount=this.props.data.length),A.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Zt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new so({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0,parameters:e})}}Bg.defaultProps=HB;Bg.layerName="ScatterplotLayer";const B2={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function L2(n,e,t={}){return jB(n,t)!==e?($B(n,t),!0):!1}function jB(n,e={}){return Math.sign(WB(n,e))}const CT={x:0,y:1,z:2};function WB(n,e={}){const{start:t=0,end:i=n.length,plane:s="xy"}=e,o=e.size||2;let l=0;const u=CT[s[0]],f=CT[s[1]];for(let d=t,p=i-o;d<i;d+=o)l+=(n[d+u]-n[p+u])*(n[d+f]+n[p+f]),p=d;return l/2}function $B(n,e){const{start:t=0,end:i=n.length,size:s=2}=e,o=(i-t)/s,l=Math.floor(o/2);for(let u=0;u<l;++u){const f=t+u*s,d=t+(o-1-u)*s;for(let p=0;p<s;++p){const _=n[f+p];n[f+p]=n[d+p],n[d+p]=_}}}function Nn(n,e){const t=e.length,i=n.length;if(i>0){let s=!0;for(let o=0;o<t;o++)if(n[i-t+o]!==e[o]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[i+s]=e[s];return!0}function Mp(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function Fa(n,e,t,i,s=[]){const o=i+e*t;for(let l=0;l<t;l++)s[l]=n[o+l];return s}function Op(n,e,t,i,s=[]){let o,l;if(t&8)o=(i[3]-n[1])/(e[1]-n[1]),l=3;else if(t&4)o=(i[1]-n[1])/(e[1]-n[1]),l=1;else if(t&2)o=(i[2]-n[0])/(e[0]-n[0]),l=2;else if(t&1)o=(i[0]-n[0])/(e[0]-n[0]),l=0;else return null;for(let u=0;u<n.length;u++)s[u]=(l&1)===u?i[l]:o*(e[u]-n[u])+n[u];return s}function Yc(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function U2(n,e){const{size:t=2,broken:i=!1,gridResolution:s=10,gridOffset:o=[0,0],startIndex:l=0,endIndex:u=n.length}=e||{},f=(u-l)/t;let d=[];const p=[d],_=Fa(n,0,t,l);let y,v;const T=z2(_,s,o,[]),A=[];Nn(d,_);for(let R=1;R<f;R++){for(y=Fa(n,R,t,l,y),v=Yc(y,T);v;){Op(_,y,v,T,A);const M=Yc(A,T);M&&(Op(_,A,M,T,A),v=M),Nn(d,A),Mp(_,A),qB(T,s,v),i&&d.length>t&&(d=[],p.push(d),Nn(d,_)),v=Yc(y,T)}Nn(d,y),Mp(_,y)}return i?p:p[0]}const RT=0,XB=1;function F2(n,e=null,t){if(!n.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:o=[0,0],edgeTypes:l=!1}=t||{},u=[],f=[{pos:n,types:l?new Array(n.length/i).fill(XB):null,holes:e||[]}],d=[[],[]];let p=[];for(;f.length;){const{pos:_,types:y,holes:v}=f.shift();YB(_,i,v[0]||_.length,d),p=z2(d[0],s,o,p);const T=Yc(d[1],p);if(T){let A=MT(_,y,i,0,v[0]||_.length,p,T);const R={pos:A[0].pos,types:A[0].types,holes:[]},M={pos:A[1].pos,types:A[1].types,holes:[]};f.push(R,M);for(let H=0;H<v.length;H++)A=MT(_,y,i,v[H],v[H+1]||_.length,p,T),A[0]&&(R.holes.push(R.pos.length),R.pos=Mc(R.pos,A[0].pos),l&&(R.types=Mc(R.types,A[0].types))),A[1]&&(M.holes.push(M.pos.length),M.pos=Mc(M.pos,A[1].pos),l&&(M.types=Mc(M.types,A[1].types)))}else{const A={positions:_};l&&(A.edgeTypes=y),v.length&&(A.holeIndices=v),u.push(A)}}return u}function MT(n,e,t,i,s,o,l){const u=(s-i)/t,f=[],d=[],p=[],_=[],y=[];let v,T,A;const R=Fa(n,u-1,t,i);let M=Math.sign(l&8?R[1]-o[3]:R[0]-o[2]),H=e&&e[u-1],O=0,L=0;for(let X=0;X<u;X++)v=Fa(n,X,t,i,v),T=Math.sign(l&8?v[1]-o[3]:v[0]-o[2]),A=e&&e[i/t+X],T&&M&&M!==T&&(Op(R,v,l,o,y),Nn(f,y)&&p.push(H),Nn(d,y)&&_.push(H)),T<=0?(Nn(f,v)&&p.push(A),O-=T):p.length&&(p[p.length-1]=RT),T>=0?(Nn(d,v)&&_.push(A),L+=T):_.length&&(_[_.length-1]=RT),Mp(R,v),M=T,H=A;return[O?{pos:f,types:e&&p}:null,L?{pos:d,types:e&&_}:null]}function z2(n,e,t,i){const s=Math.floor((n[0]-t[0])/e)*e+t[0],o=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=s,i[1]=o,i[2]=s+e,i[3]=o+e,i}function qB(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function YB(n,e,t,i){let s=1/0,o=-1/0,l=1/0,u=-1/0;for(let f=0;f<t;f+=e){const d=n[f],p=n[f+1];s=d<s?d:s,o=d>o?d:o,l=p<l?p:l,u=p>u?p:u}return i[0][0]=s,i[0][1]=l,i[1][0]=o,i[1][1]=u,i}function Mc(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const KB=85.051129;function ZB(n,e){const{size:t=2,startIndex:i=0,endIndex:s=n.length,normalize:o=!0}=e||{},l=n.slice(i,s);V2(l,t,0,s-i);const u=U2(l,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const f of u)H2(f,t);return u}function GB(n,e=null,t){const{size:i=2,normalize:s=!0,edgeTypes:o=!1}=t||{};e=e||[];const l=[],u=[];let f=0,d=0;for(let _=0;_<=e.length;_++){const y=e[_]||n.length,v=d,T=QB(n,i,f,y);for(let A=T;A<y;A++)l[d++]=n[A];for(let A=f;A<T;A++)l[d++]=n[A];V2(l,i,v,d),JB(l,i,v,d,t?.maxLatitude),f=y,u[_]=d}u.pop();const p=F2(l,u,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(s)for(const _ of p)H2(_.positions,i);return p}function QB(n,e,t,i){let s=-1,o=-1;for(let l=t+1;l<i;l+=e){const u=Math.abs(n[l]);u>s&&(s=u,o=l-1)}return o}function JB(n,e,t,i,s=KB){const o=n[t],l=n[i-e];if(Math.abs(o-l)>180){const u=Fa(n,0,e,t);u[0]+=Math.round((l-o)/360)*360,Nn(n,u),u[1]=Math.sign(u[1])*s,Nn(n,u),u[0]=o,Nn(n,u)}}function V2(n,e,t,i){let s=n[0],o;for(let l=t;l<i;l+=e){o=n[l];const u=o-s;(u>180||u<-180)&&(o-=Math.round(u/360)*360),n[l]=s=o}}function H2(n,e){let t;const i=n.length/e;for(let o=0;o<i&&(t=n[o*e],(t+180)%360===0);o++);const s=-Math.round(t/360)*360;if(s!==0)for(let o=0;o<i;o++)n[o*e]+=s}function eL(n,e,t,i){let s;if(Array.isArray(n[0])){const o=n.length*e;s=new Array(o);for(let l=0;l<n.length;l++)for(let u=0;u<e;u++)s[l*e+u]=n[l][u]||0}else s=n;return t?U2(s,{size:e,gridResolution:t}):i?ZB(s,{size:e}):s}const tL=1,nL=2,Ud=4;class iL extends P2{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?eL(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(OT(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&OT(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:l}=t;i.fill(0,o,o+l),s?(i[o]=Ud,i[o+l-2]=Ud):(i[o]+=tL,i[o+l-2]+=nL),i[o+l-1]=Ud}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:o}=t,l=new Array(3);for(let u=s,f=0;f<o;u++,f++)this.getPointOnPath(e,f,l),i[u*3]=l[0],i[u*3+1]=l[1],i[u*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const o=t*s;return i[0]=e[o],i[1]=e[o+1],i[2]=s===3&&e[o+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function OT(n){return Array.isArray(n[0])}const IT=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,sL={name:"path",vs:IT,fs:IT,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},rL=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oL=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,j2=[0,0,0,255],aL={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:j2},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Fd={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Lg extends Bn{getShaders(){return super.getShaders({vs:rL,fs:oL,modules:[fs,lo,sL]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Fd,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Fd,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Fd,defaultValue:j2},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:s,target:o})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,o)}}),this.setState({pathTesselator:new iL({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,u=t.data.attributes||{};l.updateGeometry({data:t.data,geometryBuffer:u.getPath,buffers:u,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||s.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(o=>o.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:s,miterLimit:o,widthUnits:l,widthScale:u,widthMinPixels:f,widthMaxPixels:d}=this.props,p=this.state.model,_={jointType:Number(t),capType:Number(i),billboard:s,widthUnits:Ti[l],widthScale:u,miterLimit:o,widthMinPixels:f,widthMaxPixels:d};p.shaderInputs.setProps({path:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Zt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new so({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Lg.defaultProps=aL;Lg.layerName="PathLayer";var Oc={exports:{}},PT;function lL(){if(PT)return Oc.exports;PT=1,Oc.exports=n,Oc.exports.default=n;function n(S,I,P){P=P||2;var G=I&&I.length,Q=G?I[0]*P:S.length,E=e(S,0,Q,P,!0),D=[];if(!E||E.next===E.prev)return D;var K,se,ae,pe,_e,Se,Oe;if(G&&(E=f(S,I,E,P)),S.length>80*P){K=ae=S[0],se=pe=S[1];for(var Ue=P;Ue<Q;Ue+=P)_e=S[Ue],Se=S[Ue+1],_e<K&&(K=_e),Se<se&&(se=Se),_e>ae&&(ae=_e),Se>pe&&(pe=Se);Oe=Math.max(ae-K,pe-se),Oe=Oe!==0?32767/Oe:0}return i(E,D,P,K,se,Oe,0),D}function e(S,I,P,G,Q){var E,D;if(Q===We(S,I,P,G)>0)for(E=I;E<P;E+=G)D=ve(E,S[E],S[E+1],D);else for(E=P-G;E>=I;E-=G)D=ve(E,S[E],S[E+1],D);return D&&L(D,D.next)&&(xe(D),D=D.next),D}function t(S,I){if(!S)return S;I||(I=S);var P=S,G;do if(G=!1,!P.steiner&&(L(P,P.next)||O(P.prev,P,P.next)===0)){if(xe(P),P=I=P.prev,P===P.next)break;G=!0}else P=P.next;while(G||P!==I);return I}function i(S,I,P,G,Q,E,D){if(S){!D&&E&&v(S,G,Q,E);for(var K=S,se,ae;S.prev!==S.next;){if(se=S.prev,ae=S.next,E?o(S,G,Q,E):s(S)){I.push(se.i/P|0),I.push(S.i/P|0),I.push(ae.i/P|0),xe(S),S=ae.next,K=ae.next;continue}if(S=ae,S===K){D?D===1?(S=l(t(S),I,P),i(S,I,P,G,Q,E,2)):D===2&&u(S,I,P,G,Q,E):i(t(S),I,P,G,Q,E,1);break}}}}function s(S){var I=S.prev,P=S,G=S.next;if(O(I,P,G)>=0)return!1;for(var Q=I.x,E=P.x,D=G.x,K=I.y,se=P.y,ae=G.y,pe=Q<E?Q<D?Q:D:E<D?E:D,_e=K<se?K<ae?K:ae:se<ae?se:ae,Se=Q>E?Q>D?Q:D:E>D?E:D,Oe=K>se?K>ae?K:ae:se>ae?se:ae,Ue=G.next;Ue!==I;){if(Ue.x>=pe&&Ue.x<=Se&&Ue.y>=_e&&Ue.y<=Oe&&M(Q,K,E,se,D,ae,Ue.x,Ue.y)&&O(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.next}return!0}function o(S,I,P,G){var Q=S.prev,E=S,D=S.next;if(O(Q,E,D)>=0)return!1;for(var K=Q.x,se=E.x,ae=D.x,pe=Q.y,_e=E.y,Se=D.y,Oe=K<se?K<ae?K:ae:se<ae?se:ae,Ue=pe<_e?pe<Se?pe:Se:_e<Se?_e:Se,Ln=K>se?K>ae?K:ae:se>ae?se:ae,Kn=pe>_e?pe>Se?pe:Se:_e>Se?_e:Se,ho=A(Oe,Ue,I,P,G),Un=A(Ln,Kn,I,P,G),Be=S.prevZ,Le=S.nextZ;Be&&Be.z>=ho&&Le&&Le.z<=Un;){if(Be.x>=Oe&&Be.x<=Ln&&Be.y>=Ue&&Be.y<=Kn&&Be!==Q&&Be!==D&&M(K,pe,se,_e,ae,Se,Be.x,Be.y)&&O(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Le.x>=Oe&&Le.x<=Ln&&Le.y>=Ue&&Le.y<=Kn&&Le!==Q&&Le!==D&&M(K,pe,se,_e,ae,Se,Le.x,Le.y)&&O(Le.prev,Le,Le.next)>=0))return!1;Le=Le.nextZ}for(;Be&&Be.z>=ho;){if(Be.x>=Oe&&Be.x<=Ln&&Be.y>=Ue&&Be.y<=Kn&&Be!==Q&&Be!==D&&M(K,pe,se,_e,ae,Se,Be.x,Be.y)&&O(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Le&&Le.z<=Un;){if(Le.x>=Oe&&Le.x<=Ln&&Le.y>=Ue&&Le.y<=Kn&&Le!==Q&&Le!==D&&M(K,pe,se,_e,ae,Se,Le.x,Le.y)&&O(Le.prev,Le,Le.next)>=0)return!1;Le=Le.nextZ}return!0}function l(S,I,P){var G=S;do{var Q=G.prev,E=G.next.next;!L(Q,E)&&X(Q,G,G.next,E)&&oe(Q,E)&&oe(E,Q)&&(I.push(Q.i/P|0),I.push(G.i/P|0),I.push(E.i/P|0),xe(G),xe(G.next),G=S=E),G=G.next}while(G!==S);return t(G)}function u(S,I,P,G,Q,E){var D=S;do{for(var K=D.next.next;K!==D.prev;){if(D.i!==K.i&&H(D,K)){var se=me(D,K);D=t(D,D.next),se=t(se,se.next),i(D,I,P,G,Q,E,0),i(se,I,P,G,Q,E,0);return}K=K.next}D=D.next}while(D!==S)}function f(S,I,P,G){var Q=[],E,D,K,se,ae;for(E=0,D=I.length;E<D;E++)K=I[E]*G,se=E<D-1?I[E+1]*G:S.length,ae=e(S,K,se,G,!1),ae===ae.next&&(ae.steiner=!0),Q.push(R(ae));for(Q.sort(d),E=0;E<Q.length;E++)P=p(Q[E],P);return P}function d(S,I){return S.x-I.x}function p(S,I){var P=_(S,I);if(!P)return I;var G=me(P,S);return t(G,G.next),t(P,P.next)}function _(S,I){var P=I,G=S.x,Q=S.y,E=-1/0,D;do{if(Q<=P.y&&Q>=P.next.y&&P.next.y!==P.y){var K=P.x+(Q-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(K<=G&&K>E&&(E=K,D=P.x<P.next.x?P:P.next,K===G))return D}P=P.next}while(P!==I);if(!D)return null;var se=D,ae=D.x,pe=D.y,_e=1/0,Se;P=D;do G>=P.x&&P.x>=ae&&G!==P.x&&M(Q<pe?G:E,Q,ae,pe,Q<pe?E:G,Q,P.x,P.y)&&(Se=Math.abs(Q-P.y)/(G-P.x),oe(P,S)&&(Se<_e||Se===_e&&(P.x>D.x||P.x===D.x&&y(D,P)))&&(D=P,_e=Se)),P=P.next;while(P!==se);return D}function y(S,I){return O(S.prev,S,I.prev)<0&&O(I.next,S,S.next)<0}function v(S,I,P,G){var Q=S;do Q.z===0&&(Q.z=A(Q.x,Q.y,I,P,G)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==S);Q.prevZ.nextZ=null,Q.prevZ=null,T(Q)}function T(S){var I,P,G,Q,E,D,K,se,ae=1;do{for(P=S,S=null,E=null,D=0;P;){for(D++,G=P,K=0,I=0;I<ae&&(K++,G=G.nextZ,!!G);I++);for(se=ae;K>0||se>0&&G;)K!==0&&(se===0||!G||P.z<=G.z)?(Q=P,P=P.nextZ,K--):(Q=G,G=G.nextZ,se--),E?E.nextZ=Q:S=Q,Q.prevZ=E,E=Q;P=G}E.nextZ=null,ae*=2}while(D>1);return S}function A(S,I,P,G,Q){return S=(S-P)*Q|0,I=(I-G)*Q|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,I=(I|I<<8)&16711935,I=(I|I<<4)&252645135,I=(I|I<<2)&858993459,I=(I|I<<1)&1431655765,S|I<<1}function R(S){var I=S,P=S;do(I.x<P.x||I.x===P.x&&I.y<P.y)&&(P=I),I=I.next;while(I!==S);return P}function M(S,I,P,G,Q,E,D,K){return(Q-D)*(I-K)>=(S-D)*(E-K)&&(S-D)*(G-K)>=(P-D)*(I-K)&&(P-D)*(E-K)>=(Q-D)*(G-K)}function H(S,I){return S.next.i!==I.i&&S.prev.i!==I.i&&!le(S,I)&&(oe(S,I)&&oe(I,S)&&fe(S,I)&&(O(S.prev,S,I.prev)||O(S,I.prev,I))||L(S,I)&&O(S.prev,S,S.next)>0&&O(I.prev,I,I.next)>0)}function O(S,I,P){return(I.y-S.y)*(P.x-I.x)-(I.x-S.x)*(P.y-I.y)}function L(S,I){return S.x===I.x&&S.y===I.y}function X(S,I,P,G){var Q=re(O(S,I,P)),E=re(O(S,I,G)),D=re(O(P,G,S)),K=re(O(P,G,I));return!!(Q!==E&&D!==K||Q===0&&Y(S,P,I)||E===0&&Y(S,G,I)||D===0&&Y(P,S,G)||K===0&&Y(P,I,G))}function Y(S,I,P){return I.x<=Math.max(S.x,P.x)&&I.x>=Math.min(S.x,P.x)&&I.y<=Math.max(S.y,P.y)&&I.y>=Math.min(S.y,P.y)}function re(S){return S>0?1:S<0?-1:0}function le(S,I){var P=S;do{if(P.i!==S.i&&P.next.i!==S.i&&P.i!==I.i&&P.next.i!==I.i&&X(P,P.next,S,I))return!0;P=P.next}while(P!==S);return!1}function oe(S,I){return O(S.prev,S,S.next)<0?O(S,I,S.next)>=0&&O(S,S.prev,I)>=0:O(S,I,S.prev)<0||O(S,S.next,I)<0}function fe(S,I){var P=S,G=!1,Q=(S.x+I.x)/2,E=(S.y+I.y)/2;do P.y>E!=P.next.y>E&&P.next.y!==P.y&&Q<(P.next.x-P.x)*(E-P.y)/(P.next.y-P.y)+P.x&&(G=!G),P=P.next;while(P!==S);return G}function me(S,I){var P=new de(S.i,S.x,S.y),G=new de(I.i,I.x,I.y),Q=S.next,E=I.prev;return S.next=I,I.prev=S,P.next=Q,Q.prev=P,G.next=P,P.prev=G,E.next=G,G.prev=E,G}function ve(S,I,P,G){var Q=new de(S,I,P);return G?(Q.next=G.next,Q.prev=G,G.next.prev=Q,G.next=Q):(Q.prev=Q,Q.next=Q),Q}function xe(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function de(S,I,P){this.i=S,this.x=I,this.y=P,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(S,I,P,G){var Q=I&&I.length,E=Q?I[0]*P:S.length,D=Math.abs(We(S,0,E,P));if(Q)for(var K=0,se=I.length;K<se;K++){var ae=I[K]*P,pe=K<se-1?I[K+1]*P:S.length;D-=Math.abs(We(S,ae,pe,P))}var _e=0;for(K=0;K<G.length;K+=3){var Se=G[K]*P,Oe=G[K+1]*P,Ue=G[K+2]*P;_e+=Math.abs((S[Se]-S[Ue])*(S[Oe+1]-S[Se+1])-(S[Se]-S[Oe])*(S[Ue+1]-S[Se+1]))}return D===0&&_e===0?0:Math.abs((_e-D)/D)};function We(S,I,P,G){for(var Q=0,E=I,D=P-G;E<P;E+=G)Q+=(S[D]-S[E])*(S[E+1]+S[D+1]),D=E;return Q}return n.flatten=function(S){for(var I=S[0][0].length,P={vertices:[],holes:[],dimensions:I},G=0,Q=0;Q<S.length;Q++){for(var E=0;E<S[Q].length;E++)for(var D=0;D<I;D++)P.vertices.push(S[Q][E][D]);Q>0&&(G+=S[Q-1].length,P.holes.push(G))}return P},Oc.exports}var cL=lL();const uL=hx(cL),Ic=B2.CLOCKWISE,NT=B2.COUNTER_CLOCKWISE,rs={};function fL(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function va(n){return"positions"in n?n.positions:n}function Kc(n){return"holeIndices"in n?n.holeIndices:null}function hL(n){return Array.isArray(n[0])}function dL(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function pL(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function gL(n,e,t,i){for(let s=0;s<e;s++)if(n[t+s]!==n[i-e+s])return!1;return!0}function DT(n,e,t,i,s){let o=e;const l=t.length;for(let u=0;u<l;u++)for(let f=0;f<i;f++)n[o++]=t[u][f]||0;if(!pL(t))for(let u=0;u<i;u++)n[o++]=t[0][u]||0;return rs.start=e,rs.end=o,rs.size=i,L2(n,s,rs),o}function kT(n,e,t,i,s=0,o,l){o=o||t.length;const u=o-s;if(u<=0)return e;let f=e;for(let d=0;d<u;d++)n[f++]=t[s+d];if(!gL(t,i,s,o))for(let d=0;d<i;d++)n[f++]=t[s+d];return rs.start=e,rs.end=f,rs.size=i,L2(n,l,rs),f}function mL(n,e){fL(n);const t=[],i=[];if("positions"in n){const{positions:s,holeIndices:o}=n;if(o){let l=0;for(let u=0;u<=o.length;u++)l=kT(t,l,s,e,o[u-1],o[u],u===0?Ic:NT),i.push(l);return i.pop(),{positions:t,holeIndices:i}}n=s}if(!hL(n))return kT(t,0,n,e,0,t.length,Ic),t;if(!dL(n)){let s=0;for(const[o,l]of n.entries())s=DT(t,s,l,e,o===0?Ic:NT),i.push(s);return i.pop(),{positions:t,holeIndices:i}}return DT(t,0,n,e,Ic),t}function zd(n,e,t){const i=n.length/3;let s=0;for(let o=0;o<i;o++){const l=(o+1)%i;s+=n[o*3+e]*n[l*3+t],s-=n[l*3+e]*n[o*3+t]}return Math.abs(s/2)}function BT(n,e,t,i){const s=n.length/3;for(let o=0;o<s;o++){const l=o*3,u=n[l+0],f=n[l+1],d=n[l+2];n[l+e]=u,n[l+t]=f,n[l+i]=d}}function _L(n,e,t,i){let s=Kc(n);s&&(s=s.map(u=>u/e));let o=va(n);const l=i&&e===3;if(t){const u=o.length;o=o.slice();const f=[];for(let d=0;d<u;d+=e){f[0]=o[d],f[1]=o[d+1],l&&(f[2]=o[d+2]);const p=t(f);o[d]=p[0],o[d+1]=p[1],l&&(o[d+2]=p[2])}}if(l){const u=zd(o,0,1),f=zd(o,0,2),d=zd(o,1,2);if(!u&&!f&&!d)return[];u>f&&u>d||(f>d?(t||(o=o.slice()),BT(o,0,2,1)):(t||(o=o.slice()),BT(o,2,0,1)))}return uL(o,s,e)}class yL extends P2{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=mL(e,this.positionSize);return this.opts.resolution?F2(va(t),Kc(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?GB(va(t),Kc(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(LT(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return va(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&LT(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:s}){const{attributes:o,indexStarts:l,typedArrayManager:u}=this;let f=o.indices;if(!f||!e)return;let d=s;const p=_L(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=u.allocate(f,s+p.length,{copy:!0});for(let _=0;_<p.length;_++)f[d++]=p[_]+i;l[t+1]=s+p.length,o.indices=f}_updatePositions(e,{vertexStart:t,geometrySize:i}){const{attributes:{positions:s},positionSize:o}=this;if(!s||!e)return;const l=va(e);for(let u=t,f=0;f<i;u++,f++){const d=l[f*o],p=l[f*o+1],_=o>2?l[f*o+2]:0;s[u*3]=d,s[u*3+1]=p,s[u*3+2]=_}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){const{positionSize:s}=this,o=this.attributes.vertexValid,l=e&&Kc(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,t):o.fill(1,t,t+i),l)for(let u=0;u<l.length;u++)o[t+l[u]/s-1]=0;o[t+i-1]=0}}function LT(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const UT=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,bL={name:"solidPolygon",vs:UT,fs:UT,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},W2=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${W2}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,TL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${W2}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,xL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,yu=[0,0,0,255],SL={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:yu},getLineColor:{type:"accessor",value:yu},material:!0},Pc={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Ug extends Bn{getShaders(e){return super.getShaders({vs:e==="top"?vL:TL,fs:xL,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[fs,B3,lo,bL]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&t===Re.DEFAULT&&(t=Re.LNGLAT);let s;t===Re.LNGLAT&&(i?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new yL({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),l=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Pc,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:Pc,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Pc,accessor:"getFillColor",defaultValue:yu},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Pc,accessor:"getLineColor",defaultValue:yu},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(u,{index:f,target:d})=>this.encodePickingColor(u&&u.__source?u.__source.index:f,d)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(o=>o.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:i,wireframe:s,elevationScale:o}=this.props,{topModel:l,sideModel:u,wireframeModel:f,polygonTesselator:d}=this.state,p={extruded:!!t,elevationScale:o,isWireframe:!1};f&&s&&(f.setInstanceCount(d.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...p,isWireframe:!0}}),f.draw(this.context.renderPass)),u&&i&&(u.setInstanceCount(d.instanceCount-1),u.shaderInputs.setProps({solidPolygon:p}),u.draw(this.context.renderPass)),l&&i&&(l.setVertexCount(d.vertexCount),l.shaderInputs.setProps({solidPolygon:p}),l.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:s}=e,o=this.getAttributeManager();(s.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(this.state.models?.forEach(u=>u.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,l=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let s,o,l;if(t){const u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new Zt(this.context.device,{...u,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const u=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new Zt(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:u,geometry:new so({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new Zt(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:u,geometry:new so({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,l,s].filter(Boolean),topModel:s,sideModel:o,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Ug.defaultProps=SL;Ug.layerName="SolidPolygonLayer";function AL({data:n,getIndex:e,dataRange:t,replace:i}){const{startRow:s=0,endRow:o=1/0}=t,l=n.length;let u=l,f=l;for(let y=0;y<l;y++){const v=e(n[y]);if(u>y&&v>=s&&(u=y),v>=o){f=y;break}}let d=u;const _=f-u!==i.length?n.slice(f):void 0;for(let y=0;y<i.length;y++)n[d++]=i[y];if(_){for(let y=0;y<_.length;y++)n[d++]=_[y];n.length=d}return{startRow:u,endRow:u+i.length}}function wL(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,i=n.featureIds.value[t];return t!==-1?EL(n,i,t):null}function EL(n,e,t){const i={properties:{...n.properties[e]}};for(const s in n.numericProps)i.properties[s]=n.numericProps[s].value[t];return i}function CL(n,e){const t={points:null,lines:null,polygons:null};for(const i in t){const s=n[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(s.length*4);const o=[];for(let l=0;l<s.length;l++)e(s[l],o),t[i][l*4+0]=o[0],t[i][l*4+1]=o[1],t[i][l*4+2]=o[2],t[i][l*4+3]=255}return t}const FT=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,RL={name:"sdf",vs:FT,fs:FT,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},ML=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Vd=192/256,zT=[],OL={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Fg extends Iu{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,RL],fs:ML}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e,{outlineColor:s}=t;if(s!==i.outlineColor){const o=[s[0]/255,s[1]/255,s[2]/255,(s[3]??255)/255];this.setState({outlineColor:o})}!t.sdf&&t.outlineWidth&&Me.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:i,outlineWidth:s}=this.props,{outlineColor:o}=this.state,l=s?Math.max(i,Vd*(1-s)):-1,u=this.state.model,f={buffer:Vd,outlineBuffer:l,gamma:i,enabled:!!t,outlineColor:o};if(u.shaderInputs.setProps({sdf:f}),super.draw(e),t&&s){const{iconManager:d}=this.state;d.getTexture()&&(u.shaderInputs.setProps({sdf:{...f,outlineBuffer:Vd}}),u.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):zT}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):zT}}Fg.defaultProps=OL;Fg.layerName="MultiIconLayer";const Ia=1e20;class IL{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:o="sans-serif",fontWeight:l="normal",fontStyle:u="normal",lang:f=null}={}){this.buffer=t,this.cutoff=s,this.radius=i,this.lang=f;const d=this.size=e+t*4,p=this._createCanvas(d),_=this.ctx=p.getContext("2d",{willReadFrequently:!0});_.font=`${u} ${l} ${e}px ${o}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:o,actualBoundingBoxRight:l}=this.ctx.measureText(e),u=Math.ceil(i),f=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-o))),p=Math.min(this.size-this.buffer,u+Math.ceil(s)),_=d+2*this.buffer,y=p+2*this.buffer,v=Math.max(_*y,0),T=new Uint8ClampedArray(v),A={data:T,width:_,height:y,glyphWidth:d,glyphHeight:p,glyphTop:u,glyphLeft:f,glyphAdvance:t};if(d===0||p===0)return A;const{ctx:R,buffer:M,gridInner:H,gridOuter:O}=this;this.lang&&(R.lang=this.lang),R.clearRect(M,M,d,p),R.fillText(e,M,M+u);const L=R.getImageData(M,M,d,p);O.fill(Ia,0,v),H.fill(0,0,v);for(let X=0;X<p;X++)for(let Y=0;Y<d;Y++){const re=L.data[4*(X*d+Y)+3]/255;if(re===0)continue;const le=(X+M)*_+Y+M;if(re===1)O[le]=0,H[le]=Ia;else{const oe=.5-re;O[le]=oe>0?oe*oe:0,H[le]=oe<0?oe*oe:0}}VT(O,0,0,_,y,_,this.f,this.v,this.z),VT(H,M,M,d,p,_,this.f,this.v,this.z);for(let X=0;X<v;X++){const Y=Math.sqrt(O[X])-Math.sqrt(H[X]);T[X]=Math.round(255-255*(Y/this.radius+this.cutoff))}return A}}function VT(n,e,t,i,s,o,l,u,f){for(let d=e;d<e+i;d++)HT(n,t*o+d,o,s,l,u,f);for(let d=t;d<t+s;d++)HT(n,d*o+e,1,i,l,u,f)}function HT(n,e,t,i,s,o,l){o[0]=0,l[0]=-Ia,l[1]=Ia,s[0]=n[e];for(let u=1,f=0,d=0;u<i;u++){s[u]=n[e+u*t];const p=u*u;do{const _=o[f];d=(s[u]-s[_]+p-_*_)/(u-_)/2}while(d<=l[f]&&--f>-1);f++,o[f]=u,l[f]=d,l[f+1]=Ia}for(let u=0,f=0;u<i;u++){for(;l[f+1]<u;)f++;const d=o[f],p=u-d;n[e+u*t]=s[d]+p*p}}const PL=32,NL=[];function DL(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function kL({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:s,mapping:o={},xOffset:l=0,yOffset:u=0}){let f=0,d=l;const p=t+i*2;for(const _ of n)if(!o[_]){const y=e(_);d+y+i*2>s&&(d=0,f++),o[_]={x:d+i,y:u+f*p+i,width:y,height:p,layoutWidth:y,layoutHeight:t},d+=y+i*2}return{mapping:o,xOffset:d,yOffset:u+f*p,canvasHeight:DL(u+(f+1)*p)}}function $2(n,e,t,i){let s=0;for(let o=e;o<t;o++){const l=n[o];s+=i[l]?.layoutWidth||0}return s}function X2(n,e,t,i,s,o){let l=e,u=0;for(let f=e;f<t;f++){const d=$2(n,f,f+1,s);u+d>i&&(l<f&&o.push(f),l=f,u=0),u+=d}return u}function BL(n,e,t,i,s,o){let l=e,u=e,f=e,d=0;for(let p=e;p<t;p++)if((n[p]===" "||n[p+1]===" "||p+1===t)&&(f=p+1),f>u){let _=$2(n,u,f,s);d+_>i&&(l<u&&(o.push(u),l=u,d=0),_>i&&(_=X2(n,u,f,i,s,o),l=o[o.length-1])),u=f,d+=_}return d}function LL(n,e,t,i,s=0,o){o===void 0&&(o=n.length);const l=[];return e==="break-all"?X2(n,s,o,t,i,l):BL(n,s,o,t,i,l),l}function UL(n,e,t,i,s,o){let l=0,u=0;for(let f=e;f<t;f++){const d=n[f],p=i[d];p?(u||(u=p.layoutHeight),s[f]=l+p.layoutWidth/2,l+=p.layoutWidth):(Me.warn(`Missing character: ${d} (${d.codePointAt(0)})`)(),s[f]=l,l+=PL)}o[0]=l,o[1]=u}function FL(n,e,t,i,s){const o=Array.from(n),l=o.length,u=new Array(l),f=new Array(l),d=new Array(l),p=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,_=[0,0],y=[0,0];let v=0,T=0,A=0;for(let R=0;R<=l;R++){const M=o[R];if((M===`
`||R===l)&&(A=R),A>T){const H=p?LL(o,t,i,s,T,A):NL;for(let O=0;O<=H.length;O++){const L=O===0?T:H[O-1],X=O<H.length?H[O]:A;UL(o,L,X,s,u,y);for(let Y=L;Y<X;Y++){const re=o[Y],le=s[re]?.layoutOffsetY||0;f[Y]=v+y[1]/2+le,d[Y]=y[0]}v=v+y[1]*e,_[0]=Math.max(_[0],y[0])}T=A}M===`
`&&(u[T]=0,f[T]=0,d[T]=0,T++)}return _[1]=v,{x:u,y:f,rowWidth:d,size:_}}function zL({value:n,length:e,stride:t,offset:i,startIndices:s,characterSet:o}){const l=n.BYTES_PER_ELEMENT,u=t?t/l:1,f=i?i/l:0,d=s[e]||Math.ceil((n.length-f)/u),p=o&&new Set,_=new Array(e);let y=n;if(u>1||f>0){const v=n.constructor;y=new v(d);for(let T=0;T<d;T++)y[T]=n[T*u+f]}for(let v=0;v<e;v++){const T=s[v],A=s[v+1]||d,R=y.subarray(T,A);_[v]=String.fromCodePoint.apply(null,R),p&&R.forEach(p.add,p)}if(p)for(const v of p)o.add(String.fromCodePoint(v));return{texts:_,characterCount:d}}class q2{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function VL(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const Qr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:VL(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},jT=1024,WT=.9,$T=1.2,Y2=3;let bu=new q2(Y2);function HL(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const i=bu.get(n);if(!i)return t;for(const s in i.mapping)t.has(s)&&t.delete(s);return t}function jL(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function XT(n,e,t,i){n.font=`${i} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function WL(n){Me.assert(Number.isFinite(n)&&n>=Y2,"Invalid cache limit"),bu=new q2(n)}class $L{constructor(){this.props={...Qr}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*$T+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=HL(this._key,this.props.characterSet),i=bu.get(this._key);if(i&&t.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(t,i);this._atlas=s,bu.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:i,fontWeight:s,fontSize:o,buffer:l,sdf:u,radius:f,cutoff:d}=this.props;let p=t&&t.data;p||(p=document.createElement("canvas"),p.width=jT);const _=p.getContext("2d",{willReadFrequently:!0});XT(_,i,o,s);const{mapping:y,canvasHeight:v,xOffset:T,yOffset:A}=kL({getFontWidth:R=>_.measureText(R).width,fontHeight:o*$T,buffer:l,characterSet:e,maxCanvasWidth:jT,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(p.height!==v){const R=_.getImageData(0,0,p.width,p.height);p.height=v,_.putImageData(R,0,0)}if(XT(_,i,o,s),u){const R=new IL({fontSize:o,buffer:l,radius:f,cutoff:d,fontFamily:i,fontWeight:`${s}`});for(const M of e){const{data:H,width:O,height:L,glyphTop:X}=R.draw(M);y[M].width=O,y[M].layoutOffsetY=o*WT-X;const Y=_.createImageData(O,L);jL(H,Y),_.putImageData(Y,y[M].x,y[M].y)}}else for(const R of e)_.fillText(R,y[R].x,y[R].y+l+o*WT);return{xOffset:T,yOffset:A,mapping:y,data:p,width:p.width,height:p.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:s,sdf:o,radius:l,cutoff:u}=this.props;return o?`${e} ${t} ${i} ${s} ${l} ${u}`:`${e} ${t} ${i} ${s}`}}const qT=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,XL={name:"textBackground",vs:qT,fs:qT,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},qL=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,YL=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,KL={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class zg extends Bn{getShaders(){return super.getShaders({vs:qL,fs:YL,modules:[fs,lo,XL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:i,sizeUnits:s,sizeMinPixels:o,sizeMaxPixels:l,getLineWidth:u}=this.props;let{padding:f,borderRadius:d}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]),Array.isArray(d)||(d=[d,d,d,d]);const p=this.state.model,_={billboard:t,stroked:!!u,borderRadius:d,padding:f,sizeUnits:Ti[s],sizeScale:i,sizeMinPixels:o,sizeMaxPixels:l};p.shaderInputs.setProps({textBackground:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Zt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new so({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}zg.defaultProps=KL;zg.layerName="TextBackgroundLayer";const YT={start:1,middle:0,end:-1},KT={top:1,center:0,bottom:-1},Hd=[0,0,0,255],ZL=1,GL={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Hd},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Qr.characterSet},fontFamily:Qr.fontFamily,fontWeight:Qr.fontWeight,lineHeight:ZL,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Hd},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:Hd},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Vg extends Xa{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,s]}=this.transformParagraph(e,t);const{fontSize:o}=this.state.fontAtlasManager.props;i/=o,s/=o;const{getTextAnchor:l,getAlignmentBaseline:u}=this.props,f=YT[typeof l=="function"?l(e,t):l],d=KT[typeof u=="function"?u(e,t):u];return[(f-1)*i/2,(d-1)*s/2,i,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:o,y:l,rowWidth:u,size:[f,d]}=this.transformParagraph(e,t),p=YT[typeof i=="function"?i(e,t):i],_=KT[typeof s=="function"?s(e,t):s],y=o.length,v=new Array(y*2);let T=0;for(let A=0;A<y;A++){const R=(1-p)*(f-u[A])/2;v[T++]=(p-1)*f/2+R+o[A],v[T++]=(_-1)*d/2+l[A]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new $L},this.props.maxWidth>0&&Me.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:o}=this.state,l={...e,characterSet:o,fontFamily:t,fontWeight:i};if(!s.mapping)return s.setProps(l),!0;for(const u in l)if(l[u]!==s.props[u])return s.setProps(l),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,i=e.attributes?.getText;let{getText:s}=this.props,o=e.startIndices,l;const u=t==="auto"&&new Set;if(i&&o){const{texts:f,characterCount:d}=zL({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:o,characterSet:u});l=d,s=(p,{index:_})=>f[_]}else{const{iterable:f,objectInfo:d}=Ru(e);o=[0],l=0;for(const p of f){d.index++;const _=Array.from(s(p,d)||"");u&&_.forEach(u.add,u),l+=_.length,o.push(l)}}this.setState({getText:s,startIndices:o,numInstances:l,characterSet:u||t})}transformParagraph(e,t){const{fontAtlasManager:i}=this.state,s=i.mapping,o=this.state.getText,{wordBreak:l,lineHeight:u,maxWidth:f}=this.props,d=o(e,t)||"";return FL(d,u,l,f*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:s,atlas:o,mapping:l},styleVersion:u}=this.state,{data:f,_dataDiff:d,getPosition:p,getColor:_,getSize:y,getAngle:v,getPixelOffset:T,getBackgroundColor:A,getBorderColor:R,getBorderWidth:M,backgroundBorderRadius:H,backgroundPadding:O,background:L,billboard:X,fontSettings:Y,outlineWidth:re,outlineColor:le,sizeScale:oe,sizeUnits:fe,sizeMinPixels:me,sizeMaxPixels:ve,transitions:xe,updateTriggers:de}=this.props,We=this.getSubLayerClass("characters",Fg),S=this.getSubLayerClass("background",zg);return[L&&new S({getFillColor:A,getLineColor:R,getLineWidth:M,borderRadius:H,padding:O,getPosition:p,getSize:y,getAngle:v,getPixelOffset:T,billboard:X,sizeScale:oe,sizeUnits:fe,sizeMinPixels:me,sizeMaxPixels:ve,transitions:xe&&{getPosition:xe.getPosition,getAngle:xe.getAngle,getSize:xe.getSize,getFillColor:xe.getBackgroundColor,getLineColor:xe.getBorderColor,getLineWidth:xe.getBorderWidth,getPixelOffset:xe.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:de.getPosition,getAngle:de.getAngle,getSize:de.getSize,getFillColor:de.getBackgroundColor,getLineColor:de.getBorderColor,getLineWidth:de.getBorderWidth,getPixelOffset:de.getPixelOffset,getBoundingRect:{getText:de.getText,getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:u}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new We({sdf:Y.sdf,smoothing:Number.isFinite(Y.smoothing)?Y.smoothing:Qr.smoothing,outlineWidth:re/(Y.radius||Qr.radius),outlineColor:le,iconAtlas:o,iconMapping:l,getPosition:p,getColor:_,getSize:y,getAngle:v,getPixelOffset:T,billboard:X,sizeScale:oe*s,sizeUnits:fe,sizeMinPixels:me*s,sizeMaxPixels:ve*s,transitions:xe&&{getPosition:xe.getPosition,getAngle:xe.getAngle,getColor:xe.getColor,getSize:xe.getSize,getPixelOffset:xe.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:de.getText,getPosition:de.getPosition,getAngle:de.getAngle,getColor:de.getColor,getSize:de.getSize,getPixelOffset:de.getPixelOffset,getIconOffsets:{getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:u}}}),{data:f,_dataDiff:d,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){WL(e)}}Vg.defaultProps=GL;Vg.layerName="TextLayer";const Zc={circle:{type:Bg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Iu,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Vg,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Gc={type:Lg,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Ip={type:Ug,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function da({type:n,props:e}){const t={};for(const i in e)t[i]=n.defaultProps[e[i]];return t}function jd(n,e){const{transitions:t,updateTriggers:i}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const o in e){const l=e[o];let u=n.props[o];o.startsWith("get")&&(u=n.getSubLayerAccessor(u),s.updateTriggers[l]=i[o],t&&(s.transitions[l]=t[o])),s[l]=u}return s}function QL(n){if(Array.isArray(n))return n;switch(Me.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return Me.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function ZT(n,e,t={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:o=n.length}=t;for(let l=s;l<o;l++){const u=n[l],{geometry:f}=u;if(f)if(f.type==="GeometryCollection"){Me.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:d}=f;for(let p=0;p<d.length;p++){const _=d[p];GT(_,i,e,u,l)}}else GT(f,i,e,u,l)}return i}function GT(n,e,t,i,s){const{type:o,coordinates:l}=n,{pointFeatures:u,lineFeatures:f,polygonFeatures:d,polygonOutlineFeatures:p}=e;if(!eU(o,l)){Me.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":u.push(t({geometry:n},i,s));break;case"MultiPoint":l.forEach(_=>{u.push(t({geometry:{type:"Point",coordinates:_}},i,s))});break;case"LineString":f.push(t({geometry:n},i,s));break;case"MultiLineString":l.forEach(_=>{f.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"Polygon":d.push(t({geometry:n},i,s)),l.forEach(_=>{p.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"MultiPolygon":l.forEach(_=>{d.push(t({geometry:{type:"Polygon",coordinates:_}},i,s)),_.forEach(y=>{p.push(t({geometry:{type:"LineString",coordinates:y}},i,s))})});break}}const JL={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function eU(n,e){let t=JL[n];for(Me.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function K2(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Nc(n){return n.geometry.coordinates}function tU(n,e){const t=K2(),{pointFeatures:i,lineFeatures:s,polygonFeatures:o,polygonOutlineFeatures:l}=n;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=Nc,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=Nc,t.polygons.data=o,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=Nc,t.polygonsOutline.data=l,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=Nc,t}function nU(n,e){const t=K2(),{points:i,lines:s,polygons:o}=n,l=CL(n,e);t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:l.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:l.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open";const u=o.positions.value.length/o.positions.size,f=Array(u).fill(1);for(const d of o.primitivePolygonIndices.value)f[d-1]=0;return t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,instanceVertexValid:{size:1,value:new Uint16Array(f)},pickingColors:{size:4,value:l.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:l.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}const iU=["points","linestrings","polygons"],sU={...da(Zc.circle),...da(Zc.icon),...da(Zc.text),...da(Gc),...da(Ip),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Hg extends Xa{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const i=nU(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){const i=QL(e.data),s=this.getSubLayerRow.bind(this);let o={};const l={};if(Array.isArray(t.dataChanged)){const f=this.state.features;for(const d in f)o[d]=f[d].slice(),l[d]=[];for(const d of t.dataChanged){const p=ZT(i,s,d);for(const _ in f)l[_].push(AL({data:o[_],getIndex:y=>y.__source.index,dataRange:d,replace:p[_]}))}}else o=ZT(i,s);const u=tU(o,l);this.setState({features:o,featuresDiff:l,layerProps:u})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i,sourceLayer:s}=t;return t.featureType=iU.find(o=>s.id.startsWith(`${this.id}-${o}-`)),i>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,s="polygons-fill",o=this.shouldRenderSubLayer(s,i.polygons?.data)&&this.getSubLayerClass(s,Ip.type);if(o){const l=jd(this,Ip.props),u=e&&t;return u||delete l.getLineColor,l.updateTriggers.lineColors=u,new o(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,s="polygons-stroke",o="linestrings",l=!e&&t&&this.shouldRenderSubLayer(s,i.polygonsOutline?.data)&&this.getSubLayerClass(s,Gc.type),u=this.shouldRenderSubLayer(o,i.lines?.data)&&this.getSubLayerClass(o,Gc.type);if(l||u){const f=jd(this,Gc.props);return[l&&new l(f,this.getSubLayerProps({id:s,updateTriggers:f.updateTriggers}),i.polygonsOutline),u&&new u(f,this.getSubLayerProps({id:o,updateTriggers:f.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=t.points.data.findIndex(u=>u.__source.index===s));const o=new Set(e.split("+")),l=[];for(const u of o){const f=`points-${u}`,d=Zc[u],p=d&&this.shouldRenderSubLayer(f,t.points?.data)&&this.getSubLayerClass(f,d.type);if(p){const _=jd(this,d.props);let y=t.points;if(u==="text"&&i){const{instancePickingColors:v,...T}=y.data.attributes;y={...y,data:{...y.data,attributes:T}}}l.push(new p(_,this.getSubLayerProps({id:f,updateTriggers:_.updateTriggers,highlightedObjectIndex:s}),y))}}return l}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,i,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:o,index:l}=s,u=wL(o,l);return e(u,s)}}}Hg.layerName="GeoJsonLayer";Hg.defaultProps=sU;const rU=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function oU(n,e=!1,t=Float32Array){let i;if(Number.isFinite(n[0]))i=new t(n);else{i=new t(n.length*4);let s=0;for(let o=0;o<n.length;o++){const l=n[o];i[s++]=l[0],i[s++]=l[1],i[s++]=l[2],i[s++]=Number.isFinite(l[3])?l[3]:255}}if(e)for(let s=0;s<i.length;s++)i[s]/=255;return i}function aU(n){const e=n.map(u=>u[0]),t=n.map(u=>u[1]),i=Math.min.apply(null,e),s=Math.max.apply(null,e),o=Math.min.apply(null,t),l=Math.max.apply(null,t);return[i,o,s,l]}function lU(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const QT=new Float32Array(12);function JT(n,e=2){let t=0;for(const i of n)for(let s=0;s<e;s++)QT[t++]=i[s]||0;return QT}function cU(n,e,t){const[i,s,o,l]=n,u=o-i,f=l-s;let d=u,p=f;u/f<e/t?d=e/t*f:p=t/e*u,d<e&&(d=e,p=t);const _=(o+i)/2,y=(l+s)/2;return[_-d/2,y-p/2,_+d/2,y+p/2]}function uU(n,e){const[t,i,s,o]=e;return[(n[0]-t)/(s-t),(n[1]-i)/(o-i)]}const fU=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,hU=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,ex=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,dU={name:"triangle",vs:ex,fs:ex,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class Z2 extends Bn{getShaders(){return super.getShaders({vs:fU,fs:hU,modules:[fs,dU]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:i}=this.props;return new Zt(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:i,intensity:s,threshold:o,colorTexture:l,maxTexture:u,weightsTexture:f}=this.props,d={aggregationMode:t,colorDomain:i,intensity:s,threshold:o,colorTexture:l,maxTexture:u,weightsTexture:f};e.shaderInputs.setProps({triangle:d}),e.draw(this.context.renderPass)}}Z2.layerName="TriangleLayer";function pU(n,e){const t={};for(const i in n)e.includes(i)||(t[i]=n[i]);return t}class G2 extends Xa{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:pU(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:i,oldProps:s,changeFlags:o}=e,{compareAll:l=!1,dimension:u}=t,{ignoreProps:f}=this.state,{props:d,accessors:p=[]}=u,{updateTriggersChanged:_}=o;if(o.dataChanged)return!0;if(_){if(_.all)return!0;for(const y of p)if(_[y])return!0}if(l)return o.extensionsChanged?!0:Ng({oldProps:s,newProps:i,ignoreProps:f,propTypes:this.constructor._propTypes});for(const y of d)if(i[y]!==s[y])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!gU(t)}_getAttributeManager(){return new Pg(this.context.device,{id:this.props.id,stats:this.context.stats})}}G2.layerName="AggregationLayer";function gU(n){let e=!0;for(const t in n){e=!1;break}return e}const Wd=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,$d=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,mU=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,_U=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,yU=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,bU={name:"weight",vs:yU,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},vU={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},TU=2,Xd={format:"rgba8unorm",dimension:"2d",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},tx=[0,0],xU={SUM:0,MEAN:1},SU={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:rU,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},AU=["float32-renderable-webgl","texture-blend-float-webgl"],wU={data:{props:["radiusPixels"]}};class jg extends G2{getShaders(e){let t=[fs];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(wU),this.setState({colorDomain:tx}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:i}=e,s=this._getChangeFlags(e);if((s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged){if(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0}),s.dataChanged){const o=this.getShaders({vs:Wd,fs:$d});this._createWeightsTransform(o)}}else s.viewportZoomChanged&&this._debouncedUpdateWeightmap();t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:s,colorTexture:o,colorDomain:l}=this.state,{updateTriggers:u,intensity:f,threshold:d,aggregation:p}=this.props,_=this.getSubLayerClass("triangle",Z2);return new _(this.getSubLayerProps({id:"triangle-layer",updateTriggers:u}),{coordinateSystem:Re.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:s,colorTexture:o,aggregationMode:xU[p]||0,weightsTexture:e,intensity:f,threshold:d,colorDomain:l})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:i,maxWeightTransform:s,maxWeightsTexture:o,triPositionBuffer:l,triTexCoordBuffer:u,colorTexture:f,updateTimer:d}=this.state;t?.destroy(),i?.destroy(),s?.destroy(),o?.destroy(),l?.destroy(),u?.destroy(),f?.destroy(),d&&clearTimeout(d)}_getAttributeManager(){return new Pg(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:s}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==s)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Xd,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...Xd,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),s=AU.every(u=>e.features.has(u)),o=s?"rgba32float":"rgba8unorm",l=s?1:1/255;this.setState({textureSize:i,format:o,weightsScale:l}),s||Me.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:i}=this.state,s=this.getAttributeManager();t?.destroy(),t=new Pv(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,bU]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:s}=this.state,o=this.getShaders({vs:Wd,fs:$d});this._createWeightsTransform(o);const l=this.getShaders({vs:mU,fs:_U,modules:[vU]}),u=new Pv(e,{id:`${this.id}-max-weights-transform`,targetTexture:s,...l,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blend:!0,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),f={inTexture:i,textureSize:t};u.model.shaderInputs.setProps({maxWeight:f}),this.setState({weightsTexture:i,maxWeightsTexture:s,maxWeightTransform:u,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:Wd,fs:$d,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(u=>u.map(Math.fround)),s=aU(i),o={visibleWorldBounds:s,viewportCorners:i};let l=!1;if(e||!this.state.worldBounds||!lU(this.state.worldBounds,s)){const u=this._worldToCommonBounds(s),f=this._commonToWorldBounds(u);this.props.coordinateSystem===Re.LNGLAT&&(f[1]=Math.max(f[1],-85.051129),f[3]=Math.min(f[3],85.051129),f[0]=Math.max(f[0],-360),f[2]=Math.min(f[2],360));const d=this._worldToCommonBounds(f);o.worldBounds=f,o.normalizedCommonBounds=d,l=!0}return this.setState(o),l}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:s}=this.state,{viewport:o}=this.context;e.write(JT(s,3));const l=s.map(u=>uU(o.projectPosition(u),i));t.write(JT(l,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:i}=this.state;const s=oU(t,!1,Uint8Array);i?.destroy(),i=this.context.device.createTexture({...Xd,data:s,width:t.length,height:1}),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:s,textureSize:o,weightsScale:l,weightsTexture:u}=this.state,f=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const d=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(t&&i==="SUM"){const{viewport:O}=this.context,L=O.distanceScales.metersPerUnit[2]*(d[2]-d[0])/o;this.state.colorDomain=[t[0]*L*l,t[1]*L*l]}else this.state.colorDomain=t||tx;const _=this.getAttributeManager().getAttributes(),y=this.getModuleSettings();this._setModelAttributes(f.model,_),f.model.setVertexCount(this.getNumInstances());const v={radiusPixels:e,commonBounds:d,textureWidth:o,weightsScale:l,weightsTexture:u},{viewport:T,devicePixelRatio:A,coordinateSystem:R,coordinateOrigin:M}=y,{modelMatrix:H}=this.props;f.model.shaderInputs.setProps({project:{viewport:T,devicePixelRatio:A,modelMatrix:H,coordinateSystem:R,coordinateOrigin:M},weight:v}),f.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:i=!1}=t,[s,o,l,u]=e,{viewport:f}=this.context,{textureSize:d}=this.state,{coordinateSystem:p}=this.props,_=i&&(p===Re.LNGLAT_OFFSETS||p===Re.METER_OFFSETS),y=_?f.projectPosition(this.props.coordinateOrigin):[0,0],v=d*TU/f.scale;let T,A;return i&&!_?(T=this.projectPosition([s,o,0]),A=this.projectPosition([l,u,0])):(T=f.projectPosition([s,o,0]),A=f.projectPosition([l,u,0])),cU([T[0]-y[0],T[1]-y[1],A[0]-y[0],A[1]-y[1]],v,v)}_commonToWorldBounds(e){const[t,i,s,o]=e,{viewport:l}=this.context,u=l.unprojectPosition([t,i]),f=l.unprojectPosition([s,o]);return u.slice(0,2).concat(f.slice(0,2))}}jg.layerName="HeatmapLayer";jg.defaultProps=SU;class EU{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:s}){const{index:o,id:l,bbox:u,userData:f,zoom:d}=this,p=this._loaderId;this._abortController=new AbortController;const{signal:_}=this._abortController,y=await t.scheduleRequest(this,A=>A.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let v=null,T;try{v=await e({index:o,id:l,bbox:u,userData:f,zoom:d,signal:_})}catch(A){T=A||!0}finally{y.done()}if(p===this._loaderId){if(this._loader=void 0,this.content=v,this._isCancelled&&!v){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,T?s(T,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const Ft={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},nx=new ue,CU=new ue;class Wg{constructor(e=[0,0,0],t=[0,0,0],i){i=i||nx.copy(e).add(t).scale(.5),this.center=new ue(i),this.halfDiagonal=new ue(t).subtract(this.center),this.minimum=new ue(e),this.maximum=new ue(t)}clone(){return new Wg(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,i=CU.from(e.normal),s=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-s>0?Ft.INSIDE:o+s<0?Ft.OUTSIDE:Ft.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=nx.from(e).subtract(this.center),{halfDiagonal:i}=this;let s=0,o;return o=Math.abs(t.x)-i.x,o>0&&(s+=o*o),o=Math.abs(t.y)-i.y,o>0&&(s+=o*o),o=Math.abs(t.z)-i.z,o>0&&(s+=o*o),s}}const pa=new ue,ix=new ue;class $g{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new ue,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=pa.from(t),this.center=new ue().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new $g(this.center,this.radius)}union(e){const t=this.center,i=this.radius,s=e.center,o=e.radius,l=pa.copy(s).subtract(t),u=l.magnitude();if(i>=u+o)return this.clone();if(o>=u+i)return e.clone();const f=(i+u+o)*.5;return ix.copy(l).scale((-i+f)/u).add(t),this.center.copy(ix),this.radius=f,this}expand(e){const i=pa.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const t=sO(pa,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const i=pa.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const t=this.center,i=this.radius,o=e.normal.dot(t)+e.distance;return o<-i?Ft.OUTSIDE:o<i?Ft.INTERSECTING:Ft.INSIDE}}const RU=new ue,MU=new ue,Dc=new ue,kc=new ue,Bc=new ue,OU=new ue,IU=new ue,gi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Xg{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new ue().from(e),this.halfAxes=new Nt(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new ue(e).len(),new ue(t).len(),new ue(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new ue(e).normalize(),o=new ue(t).normalize(),l=new ue(i).normalize();return new ev().fromMatrix3(new Nt([...s,...o,...l]))}fromCenterHalfSizeQuaternion(e,t,i){const s=new ev(i),o=new Nt().fromQuaternion(s);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new ue().from(e),this.halfAxes=o,this}clone(){return new Xg(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new $g){const t=this.halfAxes,i=t.getColumn(0,Dc),s=t.getColumn(1,kc),o=t.getColumn(2,Bc),l=RU.copy(i).add(s).add(o);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,i=e.normal,s=this.halfAxes,o=i.x,l=i.y,u=i.z,f=Math.abs(o*s[gi.COLUMN0ROW0]+l*s[gi.COLUMN0ROW1]+u*s[gi.COLUMN0ROW2])+Math.abs(o*s[gi.COLUMN1ROW0]+l*s[gi.COLUMN1ROW1]+u*s[gi.COLUMN1ROW2])+Math.abs(o*s[gi.COLUMN2ROW0]+l*s[gi.COLUMN2ROW1]+u*s[gi.COLUMN2ROW2]),d=i.dot(t)+e.distance;return d<=-f?Ft.OUTSIDE:d>=f?Ft.INSIDE:Ft.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=MU.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,Dc),o=i.getColumn(1,kc),l=i.getColumn(2,Bc),u=s.magnitude(),f=o.magnitude(),d=l.magnitude();s.normalize(),o.normalize(),l.normalize();let p=0,_;return _=Math.abs(t.dot(s))-u,_>0&&(p+=_*_),_=Math.abs(t.dot(o))-f,_>0&&(p+=_*_),_=Math.abs(t.dot(l))-d,_>0&&(p+=_*_),p}computePlaneDistances(e,t,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const l=this.center,u=this.halfAxes,f=u.getColumn(0,Dc),d=u.getColumn(1,kc),p=u.getColumn(2,Bc),_=OU.copy(f).add(d).add(p).add(l),y=IU.copy(_).subtract(e);let v=t.dot(y);return s=Math.min(v,s),o=Math.max(v,o),_.copy(l).add(f).add(d).subtract(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),_.copy(l).add(f).subtract(d).add(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),_.copy(l).add(f).subtract(d).subtract(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),l.copy(_).subtract(f).add(d).add(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),l.copy(_).subtract(f).add(d).subtract(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),l.copy(_).subtract(f).subtract(d).add(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),l.copy(_).subtract(f).subtract(d).subtract(p),y.copy(_).subtract(e),v=t.dot(y),s=Math.min(v,s),o=Math.max(v,o),i[0]=s,i[1]=o,i}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Dc);t.transformAsPoint(e);const i=this.halfAxes.getColumn(1,kc);i.transformAsPoint(e);const s=this.halfAxes.getColumn(2,Bc);return s.transformAsPoint(e),this.halfAxes=new Nt([...t,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const sx=new ue,rx=new ue;class za{constructor(e=[0,0,1],t=0){this.normal=new ue,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Da(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=sx.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,s){return this.normal.set(e,t,i),Da(vi(this.normal.len(),1)),this.distance=s,this}clone(){return new za(this.normal,this.distance)}equals(e){return vi(this.distance,e.distance)&&vi(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=rx.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){const i=sx.from(e),s=this.getPointDistance(i),o=rx.copy(this.normal).scale(s);return i.subtract(o).to(t)}}const ox=[new ue([1,0,0]),new ue([0,1,0]),new ue([0,0,1])],ax=new ue,PU=new ue;class bi{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*ox.length;const t=e.center,i=e.radius;let s=0;for(const o of ox){let l=this.planes[s],u=this.planes[s+1];l||(l=this.planes[s]=new za),u||(u=this.planes[s+1]=new za);const f=ax.copy(o).scale(-i).add(t);l.fromPointNormal(f,o);const d=ax.copy(o).scale(i).add(t),p=PU.copy(o).negate();u.fromPointNormal(d,p),s+=2}return this}computeVisibility(e){let t=Ft.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Ft.OUTSIDE:return Ft.OUTSIDE;case Ft.INTERSECTING:t=Ft.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Da(Number.isFinite(t),"parentPlaneMask is required."),t===bi.MASK_OUTSIDE||t===bi.MASK_INSIDE)return t;let i=bi.MASK_INSIDE;const s=this.planes;for(let o=0;o<this.planes.length;++o){const l=o<31?1<<o:0;if(o<31&&(t&l)===0)continue;const u=s[o],f=e.intersectPlane(u);if(f===Ft.OUTSIDE)return bi.MASK_OUTSIDE;f===Ft.INTERSECTING&&(i|=l)}return i}}bi.MASK_OUTSIDE=4294967295;bi.MASK_INSIDE=0;bi.MASK_INDETERMINATE=2147483647;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;new ue;const $n=new Nt,NU=new Nt,DU=new Nt,Lc=new Nt,lx=new Nt;function kU(n,e={}){const t=HO,i=10;let s=0,o=0;const l=NU,u=DU;l.identity(),u.copy(n);const f=t*BU(u);for(;o<i&&LU(u)>f;)UU(u,Lc),lx.copy(Lc).transpose(),u.multiplyRight(Lc),u.multiplyLeft(lx),l.multiplyRight(Lc),++s>2&&(++o,s=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=u.toTarget(e.diagonal),e}function BU(n){let e=0;for(let t=0;t<9;++t){const i=n[t];e+=i*i}return Math.sqrt(e)}const Pp=[1,0,0],Np=[2,2,1];function LU(n){let e=0;for(let t=0;t<3;++t){const i=n[$n.getElementIndex(Np[t],Pp[t])];e+=2*i*i}return Math.sqrt(e)}function UU(n,e){const t=VO;let i=0,s=1;for(let d=0;d<3;++d){const p=Math.abs(n[$n.getElementIndex(Np[d],Pp[d])]);p>i&&(s=d,i=p)}const o=Pp[s],l=Np[s];let u=1,f=0;if(Math.abs(n[$n.getElementIndex(l,o)])>t){const d=n[$n.getElementIndex(l,l)],p=n[$n.getElementIndex(o,o)],_=n[$n.getElementIndex(l,o)],y=(d-p)/2/_;let v;y<0?v=-1/(-y+Math.sqrt(1+y*y)):v=1/(y+Math.sqrt(1+y*y)),u=1/Math.sqrt(1+v*v),f=v*u}return Nt.IDENTITY.to(e),e[$n.getElementIndex(o,o)]=e[$n.getElementIndex(l,l)]=u,e[$n.getElementIndex(l,o)]=f,e[$n.getElementIndex(o,l)]=-f,e}const Qi=new ue,FU=new ue,zU=new ue,VU=new ue,HU=new ue,jU=new Nt,WU={diagonal:new Nt,unitary:new Nt};function $U(n,e=new Xg){if(!n||n.length===0)return e.halfAxes=new Nt([0,0,0,0,0,0,0,0,0]),e.center=new ue,e;const t=n.length,i=new ue(0,0,0);for(const oe of n)i.add(oe);const s=1/t;i.multiplyByScalar(s);let o=0,l=0,u=0,f=0,d=0,p=0;for(const oe of n){const fe=Qi.copy(oe).subtract(i);o+=fe.x*fe.x,l+=fe.x*fe.y,u+=fe.x*fe.z,f+=fe.y*fe.y,d+=fe.y*fe.z,p+=fe.z*fe.z}o*=s,l*=s,u*=s,f*=s,d*=s,p*=s;const _=jU;_[0]=o,_[1]=l,_[2]=u,_[3]=l,_[4]=f,_[5]=d,_[6]=u,_[7]=d,_[8]=p;const{unitary:y}=kU(_,WU),v=e.halfAxes.copy(y);let T=v.getColumn(0,zU),A=v.getColumn(1,VU),R=v.getColumn(2,HU),M=-Number.MAX_VALUE,H=-Number.MAX_VALUE,O=-Number.MAX_VALUE,L=Number.MAX_VALUE,X=Number.MAX_VALUE,Y=Number.MAX_VALUE;for(const oe of n)Qi.copy(oe),M=Math.max(Qi.dot(T),M),H=Math.max(Qi.dot(A),H),O=Math.max(Qi.dot(R),O),L=Math.min(Qi.dot(T),L),X=Math.min(Qi.dot(A),X),Y=Math.min(Qi.dot(R),Y);T=T.multiplyByScalar(.5*(L+M)),A=A.multiplyByScalar(.5*(X+H)),R=R.multiplyByScalar(.5*(Y+O)),e.center.copy(T).add(A).add(R);const re=FU.set(M-L,H-X,O-Y).multiplyByScalar(.5),le=new Nt([re[0],0,0,0,re[1],0,0,0,re[2]]);return e.halfAxes.multiplyRight(le),e}const qr=512,cx=3,Q2=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],J2=Q2.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),XU=J2.concat([[.25,.5],[.75,.5]]);class Yr{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){const e=this.x*2,t=this.y*2,i=this.z+1;this._children=[new Yr(e,t,i),new Yr(e,t+1,i),new Yr(e+1,t,i),new Yr(e+1,t+1,i)]}return this._children}update(e){const{viewport:t,cullingVolume:i,elevationBounds:s,minZ:o,maxZ:l,bounds:u,offset:f,project:d}=e,p=this.getBoundingVolume(s,f,d);if(u&&!this.insideBounds(u)||i.computeVisibility(p)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<l&&y>=o){const v=p.distanceTo(t.cameraPosition)*t.scale/t.height;y+=Math.floor(Math.log2(v))}if(y>=l)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,s]){const o=Math.pow(2,this.z),l=qr/o;return this.x*l<i&&this.y*l<s&&(this.x+1)*l>e&&(this.y+1)*l>t}getBoundingVolume(e,t,i){if(i){const f=this.z<1?XU:this.z<2?J2:Q2,d=[];for(const p of f){const _=kp(this.x+p[0],this.y+p[1],this.z);_[2]=e[0],d.push(i(_)),e[0]!==e[1]&&(_[2]=e[1],d.push(i(_)))}return $U(d)}const s=Math.pow(2,this.z),o=qr/s,l=this.x*o+t*qr,u=qr-(this.y+1)*o;return new Wg([l,u,e[0]],[l+o,u+o,e[1]])}}function qU(n,e,t,i){const s=n instanceof Sg&&n.resolution?n.projectPosition:null,o=Object.values(n.getFrustumPlanes()).map(({normal:v,distance:T})=>new za(v.clone().negate(),T)),l=new bi(o),u=n.distanceScales.unitsPerMeter[2],f=t&&t[0]*u||0,d=t&&t[1]*u||0,p=n instanceof us&&n.pitch<=60?e:0;if(i){const[v,T,A,R]=i,M=cs([v,R]),H=cs([A,T]);i=[M[0],qr-M[1],H[0],qr-H[1]]}const _=new Yr(0,0,0),y={viewport:n,project:s,cullingVolume:l,elevationBounds:[f,d],minZ:p,maxZ:e,bounds:i,offset:0};if(_.update(y),n instanceof us&&n.subViewports&&n.subViewports.length>1){for(y.offset=-1;_.update(y)&&!(--y.offset<-cx););for(y.offset=1;_.update(y)&&!(++y.offset>cx););}return _.getSelected()}const Si=512,YU=[-1/0,-1/0,1/0,1/0],KU={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}};function qg(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(s=>s[0])),Math.min(...t.map(s=>s[1])),Math.max(...t.map(s=>s[0])),Math.max(...t.map(s=>s[1]))]}function ZU(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function GU(n,e){if(!n||!n.length)return null;const{index:t,id:i}=e;if(Array.isArray(n)){const o=ZU(i)%n.length;n=n[o]}let s=n;for(const o of Object.keys(t)){const l=new RegExp(`{${o}}`,"g");s=s.replace(l,String(t[o]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),s}function QU(n,e,t){let i;return i=n.getBounds(),n.isGeospatial?[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]:[Math.max(Math.min(i[0],t[2]),t[0]),Math.max(Math.min(i[1],t[3]),t[1]),Math.min(Math.max(i[2],t[0]),t[2]),Math.min(Math.max(i[3],t[1]),t[3])]}function JU({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(s=>Dp(s,e||0,t))}function Dp(n,e,t){if(!Array.isArray(e)){const o=t.x-n.x,l=t.y-n.y,{width:u,height:f}=t,d={targetZ:e},p=n.unproject([o,l],d),_=n.unproject([o+u,l],d),y=n.unproject([o,l+f],d),v=n.unproject([o+u,l+f],d);return[Math.min(p[0],_[0],y[0],v[0]),Math.min(p[1],_[1],y[1],v[1]),Math.max(p[0],_[0],y[0],v[0]),Math.max(p[1],_[1],y[1],v[1])]}const i=Dp(n,e[0],t),s=Dp(n,e[1],t);return[Math.min(i[0],s[0]),Math.min(i[1],s[1]),Math.max(i[2],s[2]),Math.max(i[3],s[3])]}function eF(n,e,t){return t?qg(n,t).map(s=>s*e/Si):n.map(i=>i*e/Si)}function Yg(n,e){return Math.pow(2,n)*Si/e}function kp(n,e,t){const i=Yg(t,Si),s=n/i*360-180,o=Math.PI-2*Math.PI*e/i,l=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[s,l]}function ux(n,e,t,i){const s=Yg(t,i);return[n/s*Si,e/s*Si]}function tF(n,e,t,i,s=Si){if(n.isGeospatial){const[d,p]=kp(e,t,i),[_,y]=kp(e+1,t+1,i);return{west:d,north:p,east:_,south:y}}const[o,l]=ux(e,t,i,s),[u,f]=ux(e+1,t+1,i,s);return{left:o,top:l,right:u,bottom:f}}function nF(n,e,t,i,s){const o=QU(n,null,i),l=Yg(e,t),[u,f,d,p]=eF(o,l,s),_=[];for(let y=Math.floor(u);y<d;y++)for(let v=Math.floor(f);v<p;v++)_.push({x:y,y:v,z:e});return _}function iF({viewport:n,maxZoom:e,minZoom:t,zRange:i,extent:s,tileSize:o=Si,modelMatrix:l,modelMatrixInverse:u,zoomOffset:f=0}){let d=n.isGeospatial?Math.round(n.zoom+Math.log2(Si/o))+f:Math.ceil(n.zoom)+f;if(typeof t=="number"&&Number.isFinite(t)&&d<t){if(!s)return[];d=t}typeof e=="number"&&Number.isFinite(e)&&d>e&&(d=e);let p=s;return l&&u&&s&&!n.isGeospatial&&(p=qg(s,l)),n.isGeospatial?qU(n,d,i,s):nF(n,d,o,p||YU,u)}function sF(n){let e={},t;return i=>{for(const s in i)if(!rF(i[s],e[s])){t=n(i),e=i;break}return t}}function rF(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}const fx=1,Pu=2,oF="never",aF="no-overlap",Kg="best-available",lF=5,cF={[Kg]:hF,[aF]:dF,[oF]:()=>{}},uF={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class fF{constructor(e){this._getCullBounds=sF(JU),this.opts={...uF,...e},this.setOptions(this.opts),this.onTileLoad=t=>{this.opts.onTileLoad?.(t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Sw({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Pt,this._modelMatrixInverse=new Pt}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:i}={zRange:null,modelMatrix:null}){const s=i?new Pt(i):new Pt,o=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!vi(this._zRange,t)||o){o&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=t;const u=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=u.map(f=>this._getTile(f,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(u=>this._getTile(u.index,!0)));const l=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),l&&this._frameNumber++,this._frameNumber}isTileVisible(e,t,i){if(!e.isVisible)return!1;if(t&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t});let{bbox:o}=e;for(const[l,u,f,d]of s){let p;if("west"in o)p=o.west<f&&o.east>l&&o.south<d&&o.north>u;else{if(i&&!Pt.IDENTITY.equals(i)){const[v,T,A,R]=qg([o.left,o.top,o.right,o.bottom],i);o={left:v,top:T,right:A,bottom:R}}const _=Math.min(o.top,o.bottom),y=Math.max(o.top,o.bottom);p=o.left<f&&o.right>l&&_<d&&y>u}if(p)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:s,modelMatrix:o,modelMatrixInverse:l}){const{tileSize:u,extent:f,zoomOffset:d}=this.opts;return iF({viewport:e,maxZoom:t,minZoom:i,zRange:s,tileSize:u,extent:f,modelMatrix:o,modelMatrixInverse:l,zoomOffset:d})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:tF(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),i=Math.floor(e.y/2),s=e.z-1;return{x:t,y:i,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||Kg,t=new Array(this._cache.size);let i=0;for(const s of this._cache.values())t[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:cF[e])(Array.from(this._cache.values())),i=0;for(const s of this._cache.values())if(t[i++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let i=0;for(const s of this._cache.values())s.isLoading&&(i++,!s.isSelected&&!s.isVisible&&t.push(s));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const i=this._getNearestAncestor(t);t.parent=i,i?.children&&i.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,i=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:lF*this.selectedTiles.length),s=t.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>s){for(const[l,u]of e)if(!u.isVisible&&!u.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?u.byteLength:0,e.delete(l),this.opts.onTileUnload?.(u)),e.size<=i&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,u)=>l.zoom-u.zoom),this._dirty=!1)}_getTile(e,t){const i=this.getTileId(e);let s=this._cache.get(i),o=!1;return!s&&t?(s=new EU(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:i,zoom:this.getTileZoom(s.index)}),o=!0,this._cache.set(i,s),this._dirty=!0):s&&s.needsReload&&(o=!0),s&&o&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:t=0}=this;let i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);const s=this._getTile(i);if(s)return s}return null}}function hF(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!e1(e)&&Zg(e);for(const e of n)e.isVisible=!!(e.state&Pu)}function dF(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&e1(t);const e=Array.from(n).sort((t,i)=>t.zoom-i.zoom);for(const t of e)if(t.isVisible=!!(t.state&Pu),t.children&&(t.isVisible||t.state&fx))for(const i of t.children)i.state=fx;else t.isSelected&&Zg(t)}function e1(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=Pu,!0;e=e.parent}return!1}function Zg(n){for(const e of n.children)e.isLoaded||e.content?e.state|=Pu:Zg(e)}const pF={TilesetClass:fF,data:{type:"data",value:[]},dataComparator:KU.equal,renderSubLayers:{type:"function",value:n=>new Hg(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Kg,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Gg extends Xa{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(t=>t.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),s?t.reloadAll():t.tiles.forEach(o=>{o.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:s,extent:o,maxZoom:l,minZoom:u,maxRequests:f,debounceTime:d,zoomOffset:p}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:l,minZoom:u,tileSize:e,refinementStrategy:s,extent:o,maxRequests:f,debounceTime:d,zoomOffset:p,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,s=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:o}=e,l=this.state.isLoaded!==o,u=this.state.frameNumber!==s;o&&(l||u)&&this._onViewportLoad(),u&&this.setState({frameNumber:s}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:i,fetch:s}=this.props,{signal:o}=e;return e.url=typeof t=="string"||Array.isArray(t)?GU(t,e):null,i?i(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,i=t.props.tile,s=e.info;return s.picked&&(s.tile=i),s.sourceTile=i,s.sourceTileSubLayer=t,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(i=>e.layers[0].props[i]!==t[i])&&(e.layers=e.layers.map(i=>i.clone(t)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Eu(i,Boolean).map(s=>s.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:i}=e.props,{modelMatrix:s}=this.props;return this.state.tileset.isTileVisible(i,t,s?new Pt(s):null)}}Gg.defaultProps=pF;Gg.layerName="TileLayer";const gF=[{coordinates:[-122.41,37.77],score:.85},{coordinates:[-155.5,19.6],score:.98},{coordinates:[139.69,35.68],score:.66},{coordinates:[121.47,31.23],score:.58},{coordinates:[178.44,-18.14],score:.79},{coordinates:[-71.54,-16.4],score:.72},{coordinates:[15.09,37.5],score:.64},{coordinates:[-17.86,28.68],score:.69}],mF={longitude:0,latitude:20,zoom:1.5,minZoom:1,maxZoom:15,pitch:0,bearing:0},_F=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]],yF="https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}";function bF(n,e,t){return yF.replace("{z}",String(t)).replace("{x}",String(n)).replace("{y}",String(e))}function vF(){const n=st.useMemo(()=>{const e=new Gg({id:"dark-basemap-layer",data:null,minZoom:0,maxZoom:19,tileSize:256,getTileData:({x:i,y:s,z:o})=>bF(i,s,o),onTileError:i=>{console.error("Basemap tile failed to load:",i)},renderSubLayers:i=>{const{tile:{bbox:s}}=i;return new kg(i,{data:null,image:i.data,bounds:[s.west,s.south,s.east,s.north]})}}),t=new jg({id:"geothermal-heatmap-layer",data:gF,getPosition:i=>i.coordinates,getWeight:i=>i.score,radiusPixels:60,intensity:1,threshold:.03,colorRange:_F});return[e,t]},[]);return Pa.jsx(dB,{initialViewState:mF,controller:!0,layers:n,parameters:{clearColor:[.02,.02,.02,1]},style:{width:"100%",height:"100%"}})}function TF(){return Pa.jsx("main",{className:"app",children:Pa.jsx(vF,{})})}DA.createRoot(document.getElementById("root")).render(Pa.jsx(CA.StrictMode,{children:Pa.jsx(TF,{})}));
